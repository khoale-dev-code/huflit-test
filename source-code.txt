This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.firebaserc
.gitignore
Backend/.git/objects/1c/931beec90738c48d2eb9158919ebbe532e5490
Backend/.git/objects/23/96f913c0cd1a98460075141a697595cb90b64a
Backend/.git/objects/24/3f80ef5dbd7d622bb029ded5e5ac358226da65
Backend/.git/objects/31/bf66b348a7ed1257783186e78a6da5d4f43809
Backend/.git/objects/4a/f0e2a19273dc7cbee8f4a90403f62f5b62c79f
Backend/.git/objects/5a/6c20f356e7140b1d2f5258a5b07d78b480a586
Backend/.git/objects/61/7ea120dd77a65c250a3dcbe1225ff606ed96ce
Backend/.git/objects/7c/91974b11a0ff5e68a0a426af7fad912f63db18
Backend/.git/objects/82/725f538bea1f7fb356c0ffeaa06d24b9fda9a3
Backend/.git/objects/8a/dd4ccaddc9a8bd22245404f84932f7bd9c36c8
Backend/.git/objects/c3/87ba5345654ed3a90452cb4b6702e05f73cf6e
Backend/.git/objects/c5/9c84435cf72486d82e82d90dc8782e4e84de00
Backend/.git/objects/c8/d70a8a2c571ec36a8d77507395f5de1d607fd6
Backend/.gitignore
Backend/chat-server.js
Backend/controllers/chatController.js
Backend/firebase-config.js
Backend/index.js
Backend/nodemon.json
Backend/package.json
Backend/routes/chat.js
Backend/vercel.json
dataconnect/dataconnect.yaml
dataconnect/example/connector.yaml
dataconnect/example/queries.gql
dataconnect/schema/schema.gql
dataconnect/seed_data.gql
eslint.config.js
et --hard 5c4fce2
firebase.json
firestore.indexes.json
firestore.rules
functions/.eslintrc.js
functions/.gitignore
functions/index.js
functions/package.json
huflit-test.git/config
huflit-test.git/description
huflit-test.git/HEAD
huflit-test.git/hooks/applypatch-msg.sample
huflit-test.git/hooks/commit-msg.sample
huflit-test.git/hooks/fsmonitor-watchman.sample
huflit-test.git/hooks/post-update.sample
huflit-test.git/hooks/pre-applypatch.sample
huflit-test.git/hooks/pre-commit.sample
huflit-test.git/hooks/pre-merge-commit.sample
huflit-test.git/hooks/pre-push.sample
huflit-test.git/hooks/pre-rebase.sample
huflit-test.git/hooks/pre-receive.sample
huflit-test.git/hooks/prepare-commit-msg.sample
huflit-test.git/hooks/push-to-checkout.sample
huflit-test.git/hooks/sendemail-validate.sample
huflit-test.git/hooks/update.sample
huflit-test.git/info/exclude
huflit-test.git/objects/pack/pack-232e5c89f598674b9fb6bc5badfac703622bb898.idx
huflit-test.git/objects/pack/pack-232e5c89f598674b9fb6bc5badfac703622bb898.pack
huflit-test.git/objects/pack/pack-232e5c89f598674b9fb6bc5badfac703622bb898.rev
huflit-test.git/packed-refs
index.html
package.json
postcss.config.js
public/data/audio/exam1/listening/part1.mp3
public/data/audio/exam1/listening/part2.mp3
public/data/audio/exam1/listening/part3.mp3
public/data/audio/exam1/listening/part4.mp3
public/data/audio/exam2/listening/part1.mp3
public/data/audio/exam2/listening/part2.mp3
public/data/audio/exam2/listening/part3.mp3
public/data/audio/exam2/listening/part4.mp3
public/index.html
public/vite.svg
README.md
scripts/createAdmin.js
scripts/createFirstAdmin.js
scripts/migrateData.js
scripts/uploadAllData.js
scripts/uploadData.js
scripts/uploadExamData.js
scripts/uploadGrammarData.js
scripts/uploadRealData.js
scripts/uploadvocabularyData.js
src/admin/AdminApp.jsx
src/admin/components/AdminLogsViewer.jsx
src/admin/components/AdminSetup.jsx
src/admin/components/ExamManagement.jsx
src/admin/components/GrammarManagement.jsx
src/admin/components/UserManagement.jsx
src/admin/components/VocabularyManagement.jsx
src/admin/config/adminAuth.js
src/admin/hooks/useAdminAuth.js
src/admin/pages/AdminDashboard.jsx
src/admin/pages/AdminLogin.jsx
src/admin/services/adminCloudFunctionService.js
src/admin/services/adminManagementService.js
src/App.css
src/App.jsx
src/assets/logo.png
src/assets/react.svg
src/components/Audio/AudioControls.css
src/components/Audio/AudioControls.jsx
src/components/Auth/AuthModal.jsx
src/components/Auth/ClerkAuth.jsx
src/components/Auth/CombinedAuth.jsx
src/components/Auth/FirebaseAuthButtons.jsx
src/components/Auth/UserProfile.jsx
src/components/Chat/ChatApp.jsx
src/components/common/Badge.jsx
src/components/common/Button.jsx
src/components/common/Card.jsx
src/components/common/CollapsibleSection.jsx
src/components/common/InfoCard.jsx
src/components/common/LoadingSpinner.css
src/components/common/LoadingSpinner.jsx
src/components/common/StatBox.jsx
src/components/ConfettiEffect.jsx
src/components/Display/ContentDisplay.jsx
src/components/Display/ExplanationDisplay.jsx
src/components/Display/PartSelector.jsx
src/components/Display/PreviousResults.jsx
src/components/Display/QuestionDisplay.jsx
src/components/Display/Readingdisplay.jsx
src/components/Display/ReadingPart6Display.jsx
src/components/Display/ReadingPart7Display.jsx
src/components/Display/ReadingPart8Display.jsx
src/components/Display/ResultsDisplay.jsx
src/components/Display/ScriptDisplay.jsx
src/components/footer/Footer.css
src/components/footer/Footer.jsx
src/components/footer/ScrollToTopButton.jsx
src/components/FullExam/components/ExamScreen/ExamScreen.jsx
src/components/FullExam/components/ExamScreen/QuestionCard.jsx
src/components/FullExam/components/ExamSetup/ExamSetup.jsx
src/components/FullExam/components/Header/AutosaveIndicator.jsx
src/components/FullExam/components/Header/Timer.jsx
src/components/FullExam/components/Modals/SubmitModal.jsx
src/components/FullExam/components/Navigation/PartNavigation.jsx
src/components/FullExam/components/Results/BreakdownChart.jsx
src/components/FullExam/components/Results/ExamErrorBoundary.jsx
src/components/FullExam/components/Results/PartResults.jsx
src/components/FullExam/components/Results/ResultsScreen.jsx
src/components/FullExam/components/Results/ScoreDisplay.jsx
src/components/FullExam/components/Warnings/OfflineWarning.jsx
src/components/FullExam/components/Warnings/TimeWarning.jsx
src/components/FullExam/constants/colors.js
src/components/FullExam/constants/examConfig.js
src/components/FullExam/constants/messages.js
src/components/FullExam/constants/timings.js
src/components/FullExam/FullExamMode.jsx
src/components/FullExam/hooks/useExamState.js
src/components/FullExam/hooks/useExamTimer.js
src/components/FullExam/hooks/useKeyboardShortcuts.js
src/components/FullExam/hooks/useNetworkStatus.js
src/components/FullExam/StepIndicator.jsx
src/components/FullExam/utils/answerKey.js
src/components/FullExam/utils/examHelpers.js
src/components/Grama/GrammarReview.jsx
src/components/Grama/GrammarTopicPage.jsx
src/components/hooks/useAdvancedVoice.js
src/components/hooks/useLocalStorage.js
src/components/hooks/useOnlineUsers.js
src/components/hooks/usePresence.js
src/components/hooks/useScriptParser.js
src/components/hooks/useSpeech.js
src/components/hooks/useStreak.js
src/components/hooks/useTextToSpeech.js
src/components/hooks/useTextToSpeechWithExpression.js
src/components/hooks/useVoiceExpression.js
src/components/hooks/useVoices.js
src/components/layout/MainLayout.jsx
src/components/Navbar.jsx
src/components/Online/OnlineIndicator.css
src/components/Online/OnlineIndicator.jsx
src/components/Online/OnlineStats.jsx
src/components/pages/EmotionSelector.jsx
src/components/pages/ExamAnswersPage.jsx
src/components/pages/NotFoundPage.jsx
src/components/sections/HeaderSection.jsx
src/components/sections/InstructionsSection.jsx
src/components/styles/FullExamMode.css
src/components/styles/GrammarReview.css
src/components/styles/GrammarTopicPage.css
src/components/styles/Navbar.module.css
src/components/styles/UserProfile.module.css
src/components/utils/scriptUtils.js
src/components/utils/sounds.js
src/components/Voca/VocabularyPractice.jsx
src/components/VoiceMetricsBadge.jsx
src/config/firebase.js
src/config/routes.js
src/config/voiceConfig.js
src/config/voiceExpression.js
src/constants/config.js
src/contexts/AuthContext.jsx
src/contexts/ClerkUserContext.jsx
src/data/advancedData.js
src/data/beginnerData.js
src/data/examData.js
src/data/exams/exam1.js
src/data/exams/exam2.js
src/data/grammarData.js
src/data/intermediateData.js
src/data/vocabulary/vocabularyDataLevel1.js
src/data/vocabulary/vocabularyDataLevel2.js
src/data/vocabulary/vocabularyDataLevel3.js
src/data/vocabulary/vocabularyDataLevel4.js
src/data/vocabulary/vocabularyDataLevel5.js
src/data/vocabularyData.js
src/data/vocabularyHelpers.js
src/dataconnect-generated/.guides/config.json
src/dataconnect-generated/.guides/setup.md
src/dataconnect-generated/.guides/usage.md
src/dataconnect-generated/esm/index.esm.js
src/dataconnect-generated/esm/package.json
src/dataconnect-generated/index.cjs.js
src/dataconnect-generated/index.d.ts
src/dataconnect-generated/package.json
src/dataconnect-generated/react/esm/index.esm.js
src/dataconnect-generated/react/esm/package.json
src/dataconnect-generated/react/index.cjs.js
src/dataconnect-generated/react/index.d.ts
src/dataconnect-generated/react/package.json
src/dataconnect-generated/react/README.md
src/dataconnect-generated/README.md
src/hooks/useAppNavigation.js
src/hooks/useAppState.js
src/hooks/useAudio.js
src/hooks/useAudioPlayer.js
src/hooks/useAutoSaveProgress.js
src/hooks/useClerkAuth.js
src/hooks/useClerkFirebaseSync.js
src/hooks/useFirebaseAuth.js
src/hooks/useFirebaseUserSync.js
src/hooks/useFirestore.js
src/hooks/useFirestoreData.js
src/hooks/useOnlineUsers.js
src/hooks/usePresence.js
src/hooks/usePreviousAttempts.js
src/hooks/useResponsiveTTS.js
src/hooks/useSplashScreen.js
src/hooks/useUnifiedAuth.js
src/hooks/useUserProgress.js
src/hooks/useVoices.js
src/index.css
src/main.jsx
src/pages/HomePage.jsx
src/styles/animations.css
src/utils/helpers.js
src/views/CategoriesView.jsx
src/views/FlashcardsView.jsx
src/views/QuizView.jsx
src/views/StatsView.jsx
tailwind.config.js
vercel.json
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".firebaserc">
{
  "projects": {
    "default": "huflit-test-4ce25"
  }
}
</file>

<file path="Backend/nodemon.json">
{
  "watch": ["index.js", "chat-server.js", "routes", "controllers"],
  "ext": "js,mjs,cjs,json",
  "ignore": ["node_modules", ".git"],
  "exec": "node index.js",
  "delay": 500
}
</file>

<file path="Backend/routes/chat.js">
// backend/routes/chat.js
import express from 'express';
import {
  getAllMessages,
  getAllUsers,
  clearMessages,
  clearUsers,
} from '../controllers/chatController.js';

const router = express.Router();

/**
 * GET /api/chat/messages
 * Get all chat messages from Firestore
 */
router.get('/messages', async (req, res) => {
  try {
    const messages = await getAllMessages();
    res.json({
      success: true,
      data: messages,
      count: messages.length,
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message,
    });
  }
});

/**
 * GET /api/chat/users
 * Get all online users
 */
router.get('/users', (req, res) => {
  try {
    const users = getAllUsers();
    res.json({
      success: true,
      data: users,
      count: users.length,
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message,
    });
  }
});

/**
 * GET /api/chat/stats
 * Get chat statistics
 */
router.get('/stats', async (req, res) => {
  try {
    const messages = await getAllMessages();
    const users = getAllUsers();

    res.json({
      success: true,
      stats: {
        totalMessages: messages.length,
        onlineUsers: users.length,
        timestamp: new Date(),
      },
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message,
    });
  }
});

/**
 * DELETE /api/chat/messages (Admin only)
 * Clear all messages
 */
router.delete('/messages', async (req, res) => {
  try {
    const adminKey = req.headers['x-admin-key'];
    
    if (adminKey !== process.env.ADMIN_KEY) {
      return res.status(403).json({
        success: false,
        error: 'Unauthorized',
      });
    }

    await clearMessages();
    res.json({
      success: true,
      message: 'All messages cleared',
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message,
    });
  }
});

/**
 * DELETE /api/chat/users (Admin only)
 * Clear all users
 */
router.delete('/users', (req, res) => {
  try {
    const adminKey = req.headers['x-admin-key'];
    
    if (adminKey !== process.env.ADMIN_KEY) {
      return res.status(403).json({
        success: false,
        error: 'Unauthorized',
      });
    }

    clearUsers();
    res.json({
      success: true,
      message: 'All users cleared',
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message,
    });
  }
});

/**
 * Export route factory function
 */
export default (io) => {
  return router;
};
</file>

<file path="Backend/vercel.json">
{
  "version": 2,
  "builds": [
    {
      "src": "index.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "index.js"
    }
  ],
  "env": {
    "NODE_ENV": "production"
  }
}
</file>

<file path="dataconnect/dataconnect.yaml">
specVersion: "v1"
serviceId: "listening"
location: "us-east4"
schema:
  source: "./schema"
  datasource:
    postgresql:
      database: "fdcdb"
      cloudSql:
        instanceId: "listening-fdc"
        # schemaValidation: "STRICT"     # STRICT mode makes Postgres schema match Data Connect exactly.
        # schemaValidation: "COMPATIBLE" # COMPATIBLE mode makes Postgres schema compatible with Data Connect.
connectorDirs: ["./example"]
</file>

<file path="dataconnect/example/connector.yaml">
connectorId: example
generate:
  javascriptSdk:
    - outputDir: ..\..\src\dataconnect-generated
      package: "@dataconnect/generated"
      packageJsonDir: ..\..
      react: true
      angular: false
</file>

<file path="dataconnect/example/queries.gql">
mutation CreateNewList($name: String!, $description: String, $isPublic: Boolean) @auth(level: USER) {
  list_insert(data: {
    name: $name,
    description: $description,
    isPublic: $isPublic,
    userId_expr: "auth.uid",
    createdAt_expr: "request.time",
    updatedAt_expr: "request.time"
  })
}

query GetMyLists @auth(level: USER) {
  lists(where: {userId: {eq_expr: "auth.uid"}}) {
    id
    name
    description
    isPublic
    createdAt
    updatedAt
  }
}

mutation AddMovieToList($listId: UUID!, $movieId: UUID!, $note: String, $position: Int!) @auth(level: USER) {
  listItem_insert(data: {
    listId: $listId,
    movieId: $movieId,
    note: $note,
    position: $position
  })
}

query GetMoviesInList($listId: UUID!) @auth(level: USER) {
  list(id: $listId) {
    movies_via_ListItem {
      id
      title
      year
      summary
      runtime
      genres
    }
  }
}
</file>

<file path="dataconnect/schema/schema.gql">
type User @table {
  displayName: String!
  createdAt: Timestamp!
  email: String
  photoUrl: String
}

type Movie @table {
  title: String!
  year: Int!
  createdAt: Timestamp!
  summary: String
  genres: [String]
  runtime: Int
}

type Watch @table {
  user: User!
  movie: Movie!
  createdAt: Timestamp!
  watchDate: Date!
  location: String
}

type Review @table {
  user: User!
  movie: Movie!
  watch: Watch!
  rating: Int!
  createdAt: Timestamp!
  updatedAt: Timestamp!
  reviewText: String
  isPublic: Boolean
  shareLink: String
}

type List @table {
  user: User!
  name: String!
  isPublic: Boolean
  createdAt: Timestamp!
  updatedAt: Timestamp!
  description: String
}

type ListItem @table(key: ["list", "movie"]) {
  list: List!
  movie: Movie!
  position: Int!
  note: String
}
</file>

<file path="dataconnect/seed_data.gql">
mutation CreateDemoData @transaction @auth(level: USER, insecureReason: "This mutation is safe to expose to all logged in users.") {
  user_insertMany(
    data: [
      {
        id: "550e8400-e29b-41d4-a716-446655440000"
        createdAt: "2024-04-03T00:00:00Z"
        displayName: "demouser1"
      }
      {
        id: "550e8400-e29b-41d4-a716-446655440001"
        createdAt: "2024-04-03T00:00:00Z"
        displayName: "demouser2"
      }
    ]
  )
  movie_insertMany(
    data: [
      {
        id: "550e8400-e29b-41d4-a716-446655440002"
        createdAt: "2024-04-03T00:00:00Z"
        title: "Example Movie 1"
        year: 2023
      }
      {
        id: "550e8400-e29b-41d4-a716-446655440003"
        createdAt: "2024-04-03T00:00:00Z"
        title: "Example Movie 2"
        year: 2024
      }
    ]
  )
  list_insertMany(
    data: [
      {
        id: "550e8400-e29b-41d4-a716-446655440004"
        userId: "550e8400-e29b-41d4-a716-446655440000"
        createdAt: "2024-04-03T00:00:00Z"
        name: "Example List 1"
        updatedAt: "2024-04-03T00:00:00Z"
      }
      {
        id: "550e8400-e29b-41d4-a716-446655440005"
        userId: "550e8400-e29b-41d4-a716-446655440001"
        createdAt: "2024-04-03T00:00:00Z"
        name: "Example List 2"
        updatedAt: "2024-04-03T00:00:00Z"
      }
    ]
  )
  listItem_insertMany(
    data: [
      {
        listId: "550e8400-e29b-41d4-a716-446655440004"
        movieId: "550e8400-e29b-41d4-a716-446655440002"
        position: 1
      }
      {
        listId: "550e8400-e29b-41d4-a716-446655440005"
        movieId: "550e8400-e29b-41d4-a716-446655440003"
        position: 1
      }
    ]
  )
  watch_insertMany(
    data: [
      {
        id: "550e8400-e29b-41d4-a716-446655440006"
        movieId: "550e8400-e29b-41d4-a716-446655440002"
        userId: "550e8400-e29b-41d4-a716-446655440000"
        createdAt: "2024-04-03T00:00:00Z"
        watchDate: "2024-04-03"
      }
      {
        id: "550e8400-e29b-41d4-a716-446655440007"
        movieId: "550e8400-e29b-41d4-a716-446655440003"
        userId: "550e8400-e29b-41d4-a716-446655440001"
        createdAt: "2024-04-03T00:00:00Z"
        watchDate: "2024-04-03"
      }
    ]
  )
  review_insertMany(
    data: [
      {
        id: "550e8400-e29b-41d4-a716-446655440008"
        movieId: "550e8400-e29b-41d4-a716-446655440002"
        userId: "550e8400-e29b-41d4-a716-446655440000"
        watchId: "550e8400-e29b-41d4-a716-446655440006"
        createdAt: "2024-04-03T00:00:00Z"
        rating: 5
      }
      {
        id: "550e8400-e29b-41d4-a716-446655440009"
        movieId: "550e8400-e29b-41d4-a716-446655440003"
        userId: "550e8400-e29b-41d4-a716-446655440001"
        watchId: "550e8400-e29b-41d4-a716-446655440007"
        createdAt: "2024-04-03T00:00:00Z"
        rating: 4
      }
    ]
  )
}
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="et --hard 5c4fce2">

</file>

<file path="firestore.indexes.json">
{
  "indexes": [],
  "fieldOverrides": []
}
</file>

<file path="firestore.rules">
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ============================================
    // PUBLIC DATA - Everyone can read
    // ============================================
    
    // Exam Data - public read
    match /examData/{document=**} {
      allow read: if true;
      allow write: if false;
    }
    
    // Vocabulary Data - public read
    match /vocabularyData/{document=**} {
      allow read: if true;
      allow write: if false;
    }
    
    // Grammar Data - public read
    match /grammarData/{document=**} {
      allow read: if true;
      allow write: if false;
    }
    
    // Metadata - public read
    match /metadata/{document=**} {
      allow read: if true;
      allow write: if false;
    }
    
    // ============================================
    // PRIVATE DATA - User Progress
    // ============================================
    
    // Users collection (Clerk webhook creates these)
    match /users/{userId} {
      allow read: if true;  // Allow read for now
      allow write: if false; // Only webhook can write
    }
    
    // User Progress - OPEN FOR DEVELOPMENT
    // TODO: Add proper security after Clerk-Firebase integration
    match /userProgress/{docId} {
      // TEMPORARY: Allow all authenticated reads/writes
      allow read, write, create, update, delete: if true;
    }
    
    // ============================================
    // FALLBACK - Deny everything else
    // ============================================
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
</file>

<file path="functions/.eslintrc.js">
module.exports = {
  env: {
    es6: true,
    node: true,
  },
  parserOptions: {
    "ecmaVersion": 2018,
  },
  extends: [
    "eslint:recommended",
    "google",
  ],
  rules: {
    "no-restricted-globals": ["error", "name", "length"],
    "prefer-arrow-callback": "error",
    "quotes": ["error", "double", {"allowTemplateLiterals": true}],
  },
  overrides: [
    {
      files: ["**/*.spec.*"],
      env: {
        mocha: true,
      },
      rules: {},
    },
  ],
  globals: {},
};
</file>

<file path="functions/.gitignore">
node_modules/
*.local
</file>

<file path="functions/index.js">
/**
 * Import function triggers from their respective submodules:
 *
 * const {onCall} = require("firebase-functions/v2/https");
 * const {onDocumentWritten} = require("firebase-functions/v2/firestore");
 *
 * See a full list of supported triggers at https://firebase.google.com/docs/functions
 */

const {setGlobalOptions} = require("firebase-functions");
const {onRequest} = require("firebase-functions/https");
const logger = require("firebase-functions/logger");

// For cost control, you can set the maximum number of containers that can be
// running at the same time. This helps mitigate the impact of unexpected
// traffic spikes by instead downgrading performance. This limit is a
// per-function limit. You can override the limit for each function using the
// `maxInstances` option in the function's options, e.g.
// `onRequest({ maxInstances: 5 }, (req, res) => { ... })`.
// NOTE: setGlobalOptions does not apply to functions using the v1 API. V1
// functions should each use functions.runWith({ maxInstances: 10 }) instead.
// In the v1 API, each function can only serve one request per container, so
// this will be the maximum concurrent request count.
setGlobalOptions({ maxInstances: 10 });

// Create and deploy your first functions
// https://firebase.google.com/docs/functions/get-started

// exports.helloWorld = onRequest((request, response) => {
//   logger.info("Hello logs!", {structuredData: true});
//   response.send("Hello from Firebase!");
// });
</file>

<file path="functions/package.json">
{
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "lint": "eslint .",
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "24"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^13.6.0",
    "firebase-functions": "^7.0.0"
  },
  "devDependencies": {
    "eslint": "^8.15.0",
    "eslint-config-google": "^0.14.0",
    "firebase-functions-test": "^3.4.1"
  },
  "private": true
}
</file>

<file path="huflit-test.git/config">
[core]
	repositoryformatversion = 0
	filemode = false
	bare = true
	symlinks = false
	ignorecase = true
[remote "origin"]
	url = https://github.com/khoale-dev-code/huflit-test.git
	fetch = +refs/*:refs/*
	mirror = true
</file>

<file path="huflit-test.git/description">
Unnamed repository; edit this file 'description' to name the repository.
</file>

<file path="huflit-test.git/HEAD">
ref: refs/heads/main
</file>

<file path="huflit-test.git/hooks/applypatch-msg.sample">
#!/bin/sh
#
# An example hook script to check the commit log message taken by
# applypatch from an e-mail message.
#
# The hook should exit with non-zero status after issuing an
# appropriate message if it wants to stop the commit.  The hook is
# allowed to edit the commit message file.
#
# To enable this hook, rename this file to "applypatch-msg".

. git-sh-setup
commitmsg="$(git rev-parse --git-path hooks/commit-msg)"
test -x "$commitmsg" && exec "$commitmsg" ${1+"$@"}
:
</file>

<file path="huflit-test.git/hooks/commit-msg.sample">
#!/bin/sh
#
# An example hook script to check the commit log message.
# Called by "git commit" with one argument, the name of the file
# that has the commit message.  The hook should exit with non-zero
# status after issuing an appropriate message if it wants to stop the
# commit.  The hook is allowed to edit the commit message file.
#
# To enable this hook, rename this file to "commit-msg".

# Uncomment the below to add a Signed-off-by line to the message.
# Doing this in a hook is a bad idea in general, but the prepare-commit-msg
# hook is more suited to it.
#
# SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
# grep -qs "^$SOB" "$1" || echo "$SOB" >> "$1"

# This example catches duplicate Signed-off-by lines.

test "" = "$(grep '^Signed-off-by: ' "$1" |
	 sort | uniq -c | sed -e '/^[ 	]*1[ 	]/d')" || {
	echo >&2 Duplicate Signed-off-by lines.
	exit 1
}
</file>

<file path="huflit-test.git/hooks/fsmonitor-watchman.sample">
#!/usr/bin/perl

use strict;
use warnings;
use IPC::Open2;

# An example hook script to integrate Watchman
# (https://facebook.github.io/watchman/) with git to speed up detecting
# new and modified files.
#
# The hook is passed a version (currently 2) and last update token
# formatted as a string and outputs to stdout a new update token and
# all files that have been modified since the update token. Paths must
# be relative to the root of the working tree and separated by a single NUL.
#
# To enable this hook, rename this file to "query-watchman" and set
# 'git config core.fsmonitor .git/hooks/query-watchman'
#
my ($version, $last_update_token) = @ARGV;

# Uncomment for debugging
# print STDERR "$0 $version $last_update_token\n";

# Check the hook interface version
if ($version ne 2) {
	die "Unsupported query-fsmonitor hook version '$version'.\n" .
	    "Falling back to scanning...\n";
}

my $git_work_tree = get_working_dir();

my $retry = 1;

my $json_pkg;
eval {
	require JSON::XS;
	$json_pkg = "JSON::XS";
	1;
} or do {
	require JSON::PP;
	$json_pkg = "JSON::PP";
};

launch_watchman();

sub launch_watchman {
	my $o = watchman_query();
	if (is_work_tree_watched($o)) {
		output_result($o->{clock}, @{$o->{files}});
	}
}

sub output_result {
	my ($clockid, @files) = @_;

	# Uncomment for debugging watchman output
	# open (my $fh, ">", ".git/watchman-output.out");
	# binmode $fh, ":utf8";
	# print $fh "$clockid\n@files\n";
	# close $fh;

	binmode STDOUT, ":utf8";
	print $clockid;
	print "\0";
	local $, = "\0";
	print @files;
}

sub watchman_clock {
	my $response = qx/watchman clock "$git_work_tree"/;
	die "Failed to get clock id on '$git_work_tree'.\n" .
		"Falling back to scanning...\n" if $? != 0;

	return $json_pkg->new->utf8->decode($response);
}

sub watchman_query {
	my $pid = open2(\*CHLD_OUT, \*CHLD_IN, 'watchman -j --no-pretty')
	or die "open2() failed: $!\n" .
	"Falling back to scanning...\n";

	# In the query expression below we're asking for names of files that
	# changed since $last_update_token but not from the .git folder.
	#
	# To accomplish this, we're using the "since" generator to use the
	# recency index to select candidate nodes and "fields" to limit the
	# output to file names only. Then we're using the "expression" term to
	# further constrain the results.
	my $last_update_line = "";
	if (substr($last_update_token, 0, 1) eq "c") {
		$last_update_token = "\"$last_update_token\"";
		$last_update_line = qq[\n"since": $last_update_token,];
	}
	my $query = <<"	END";
		["query", "$git_work_tree", {$last_update_line
			"fields": ["name"],
			"expression": ["not", ["dirname", ".git"]]
		}]
	END

	# Uncomment for debugging the watchman query
	# open (my $fh, ">", ".git/watchman-query.json");
	# print $fh $query;
	# close $fh;

	print CHLD_IN $query;
	close CHLD_IN;
	my $response = do {local $/; <CHLD_OUT>};

	# Uncomment for debugging the watch response
	# open ($fh, ">", ".git/watchman-response.json");
	# print $fh $response;
	# close $fh;

	die "Watchman: command returned no output.\n" .
	"Falling back to scanning...\n" if $response eq "";
	die "Watchman: command returned invalid output: $response\n" .
	"Falling back to scanning...\n" unless $response =~ /^\{/;

	return $json_pkg->new->utf8->decode($response);
}

sub is_work_tree_watched {
	my ($output) = @_;
	my $error = $output->{error};
	if ($retry > 0 and $error and $error =~ m/unable to resolve root .* directory (.*) is not watched/) {
		$retry--;
		my $response = qx/watchman watch "$git_work_tree"/;
		die "Failed to make watchman watch '$git_work_tree'.\n" .
		    "Falling back to scanning...\n" if $? != 0;
		$output = $json_pkg->new->utf8->decode($response);
		$error = $output->{error};
		die "Watchman: $error.\n" .
		"Falling back to scanning...\n" if $error;

		# Uncomment for debugging watchman output
		# open (my $fh, ">", ".git/watchman-output.out");
		# close $fh;

		# Watchman will always return all files on the first query so
		# return the fast "everything is dirty" flag to git and do the
		# Watchman query just to get it over with now so we won't pay
		# the cost in git to look up each individual file.
		my $o = watchman_clock();
		$error = $output->{error};

		die "Watchman: $error.\n" .
		"Falling back to scanning...\n" if $error;

		output_result($o->{clock}, ("/"));
		$last_update_token = $o->{clock};

		eval { launch_watchman() };
		return 0;
	}

	die "Watchman: $error.\n" .
	"Falling back to scanning...\n" if $error;

	return 1;
}

sub get_working_dir {
	my $working_dir;
	if ($^O =~ 'msys' || $^O =~ 'cygwin') {
		$working_dir = Win32::GetCwd();
		$working_dir =~ tr/\\/\//;
	} else {
		require Cwd;
		$working_dir = Cwd::cwd();
	}

	return $working_dir;
}
</file>

<file path="huflit-test.git/hooks/post-update.sample">
#!/bin/sh
#
# An example hook script to prepare a packed repository for use over
# dumb transports.
#
# To enable this hook, rename this file to "post-update".

exec git update-server-info
</file>

<file path="huflit-test.git/hooks/pre-applypatch.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed
# by applypatch from an e-mail message.
#
# The hook should exit with non-zero status after issuing an
# appropriate message if it wants to stop the commit.
#
# To enable this hook, rename this file to "pre-applypatch".

. git-sh-setup
precommit="$(git rev-parse --git-path hooks/pre-commit)"
test -x "$precommit" && exec "$precommit" ${1+"$@"}
:
</file>

<file path="huflit-test.git/hooks/pre-commit.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed.
# Called by "git commit" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message if
# it wants to stop the commit.
#
# To enable this hook, rename this file to "pre-commit".

if git rev-parse --verify HEAD >/dev/null 2>&1
then
	against=HEAD
else
	# Initial commit: diff against an empty tree object
	against=$(git hash-object -t tree /dev/null)
fi

# If you want to allow non-ASCII filenames set this variable to true.
allownonascii=$(git config --type=bool hooks.allownonascii)

# Redirect output to stderr.
exec 1>&2

# Cross platform projects tend to avoid non-ASCII filenames; prevent
# them from being added to the repository. We exploit the fact that the
# printable range starts at the space character and ends with tilde.
if [ "$allownonascii" != "true" ] &&
	# Note that the use of brackets around a tr range is ok here, (it's
	# even required, for portability to Solaris 10's /usr/bin/tr), since
	# the square bracket bytes happen to fall in the designated range.
	test $(git diff-index --cached --name-only --diff-filter=A -z $against |
	  LC_ALL=C tr -d '[ -~]\0' | wc -c) != 0
then
	cat <<\EOF
Error: Attempt to add a non-ASCII file name.

This can cause problems if you want to work with people on other platforms.

To be portable it is advisable to rename the file.

If you know what you are doing you can disable this check using:

  git config hooks.allownonascii true
EOF
	exit 1
fi

# If there are whitespace errors, print the offending file names and fail.
exec git diff-index --check --cached $against --
</file>

<file path="huflit-test.git/hooks/pre-merge-commit.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed.
# Called by "git merge" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message to
# stderr if it wants to stop the merge commit.
#
# To enable this hook, rename this file to "pre-merge-commit".

. git-sh-setup
test -x "$GIT_DIR/hooks/pre-commit" &&
        exec "$GIT_DIR/hooks/pre-commit"
:
</file>

<file path="huflit-test.git/hooks/pre-push.sample">
#!/bin/sh

# An example hook script to verify what is about to be pushed.  Called by "git
# push" after it has checked the remote status, but before anything has been
# pushed.  If this script exits with a non-zero status nothing will be pushed.
#
# This hook is called with the following parameters:
#
# $1 -- Name of the remote to which the push is being done
# $2 -- URL to which the push is being done
#
# If pushing without using a named remote those arguments will be equal.
#
# Information about the commits which are being pushed is supplied as lines to
# the standard input in the form:
#
#   <local ref> <local oid> <remote ref> <remote oid>
#
# This sample shows how to prevent push of commits where the log message starts
# with "WIP" (work in progress).

remote="$1"
url="$2"

zero=$(git hash-object --stdin </dev/null | tr '[0-9a-f]' '0')

while read local_ref local_oid remote_ref remote_oid
do
	if test "$local_oid" = "$zero"
	then
		# Handle delete
		:
	else
		if test "$remote_oid" = "$zero"
		then
			# New branch, examine all commits
			range="$local_oid"
		else
			# Update to existing branch, examine new commits
			range="$remote_oid..$local_oid"
		fi

		# Check for WIP commit
		commit=$(git rev-list -n 1 --grep '^WIP' "$range")
		if test -n "$commit"
		then
			echo >&2 "Found WIP commit in $local_ref, not pushing"
			exit 1
		fi
	fi
done

exit 0
</file>

<file path="huflit-test.git/hooks/pre-rebase.sample">
#!/bin/sh
#
# Copyright (c) 2006, 2008 Junio C Hamano
#
# The "pre-rebase" hook is run just before "git rebase" starts doing
# its job, and can prevent the command from running by exiting with
# non-zero status.
#
# The hook is called with the following parameters:
#
# $1 -- the upstream the series was forked from.
# $2 -- the branch being rebased (or empty when rebasing the current branch).
#
# This sample shows how to prevent topic branches that are already
# merged to 'next' branch from getting rebased, because allowing it
# would result in rebasing already published history.

publish=next
basebranch="$1"
if test "$#" = 2
then
	topic="refs/heads/$2"
else
	topic=`git symbolic-ref HEAD` ||
	exit 0 ;# we do not interrupt rebasing detached HEAD
fi

case "$topic" in
refs/heads/??/*)
	;;
*)
	exit 0 ;# we do not interrupt others.
	;;
esac

# Now we are dealing with a topic branch being rebased
# on top of master.  Is it OK to rebase it?

# Does the topic really exist?
git show-ref -q "$topic" || {
	echo >&2 "No such branch $topic"
	exit 1
}

# Is topic fully merged to master?
not_in_master=`git rev-list --pretty=oneline ^master "$topic"`
if test -z "$not_in_master"
then
	echo >&2 "$topic is fully merged to master; better remove it."
	exit 1 ;# we could allow it, but there is no point.
fi

# Is topic ever merged to next?  If so you should not be rebasing it.
only_next_1=`git rev-list ^master "^$topic" ${publish} | sort`
only_next_2=`git rev-list ^master           ${publish} | sort`
if test "$only_next_1" = "$only_next_2"
then
	not_in_topic=`git rev-list "^$topic" master`
	if test -z "$not_in_topic"
	then
		echo >&2 "$topic is already up to date with master"
		exit 1 ;# we could allow it, but there is no point.
	else
		exit 0
	fi
else
	not_in_next=`git rev-list --pretty=oneline ^${publish} "$topic"`
	/usr/bin/perl -e '
		my $topic = $ARGV[0];
		my $msg = "* $topic has commits already merged to public branch:\n";
		my (%not_in_next) = map {
			/^([0-9a-f]+) /;
			($1 => 1);
		} split(/\n/, $ARGV[1]);
		for my $elem (map {
				/^([0-9a-f]+) (.*)$/;
				[$1 => $2];
			} split(/\n/, $ARGV[2])) {
			if (!exists $not_in_next{$elem->[0]}) {
				if ($msg) {
					print STDERR $msg;
					undef $msg;
				}
				print STDERR " $elem->[1]\n";
			}
		}
	' "$topic" "$not_in_next" "$not_in_master"
	exit 1
fi

<<\DOC_END

This sample hook safeguards topic branches that have been
published from being rewound.

The workflow assumed here is:

 * Once a topic branch forks from "master", "master" is never
   merged into it again (either directly or indirectly).

 * Once a topic branch is fully cooked and merged into "master",
   it is deleted.  If you need to build on top of it to correct
   earlier mistakes, a new topic branch is created by forking at
   the tip of the "master".  This is not strictly necessary, but
   it makes it easier to keep your history simple.

 * Whenever you need to test or publish your changes to topic
   branches, merge them into "next" branch.

The script, being an example, hardcodes the publish branch name
to be "next", but it is trivial to make it configurable via
$GIT_DIR/config mechanism.

With this workflow, you would want to know:

(1) ... if a topic branch has ever been merged to "next".  Young
    topic branches can have stupid mistakes you would rather
    clean up before publishing, and things that have not been
    merged into other branches can be easily rebased without
    affecting other people.  But once it is published, you would
    not want to rewind it.

(2) ... if a topic branch has been fully merged to "master".
    Then you can delete it.  More importantly, you should not
    build on top of it -- other people may already want to
    change things related to the topic as patches against your
    "master", so if you need further changes, it is better to
    fork the topic (perhaps with the same name) afresh from the
    tip of "master".

Let's look at this example:

		   o---o---o---o---o---o---o---o---o---o "next"
		  /       /           /           /
		 /   a---a---b A     /           /
		/   /               /           /
	       /   /   c---c---c---c B         /
	      /   /   /             \         /
	     /   /   /   b---b C     \       /
	    /   /   /   /             \     /
    ---o---o---o---o---o---o---o---o---o---o---o "master"


A, B and C are topic branches.

 * A has one fix since it was merged up to "next".

 * B has finished.  It has been fully merged up to "master" and "next",
   and is ready to be deleted.

 * C has not merged to "next" at all.

We would want to allow C to be rebased, refuse A, and encourage
B to be deleted.

To compute (1):

	git rev-list ^master ^topic next
	git rev-list ^master        next

	if these match, topic has not merged in next at all.

To compute (2):

	git rev-list master..topic

	if this is empty, it is fully merged to "master".

DOC_END
</file>

<file path="huflit-test.git/hooks/pre-receive.sample">
#!/bin/sh
#
# An example hook script to make use of push options.
# The example simply echoes all push options that start with 'echoback='
# and rejects all pushes when the "reject" push option is used.
#
# To enable this hook, rename this file to "pre-receive".

if test -n "$GIT_PUSH_OPTION_COUNT"
then
	i=0
	while test "$i" -lt "$GIT_PUSH_OPTION_COUNT"
	do
		eval "value=\$GIT_PUSH_OPTION_$i"
		case "$value" in
		echoback=*)
			echo "echo from the pre-receive-hook: ${value#*=}" >&2
			;;
		reject)
			exit 1
		esac
		i=$((i + 1))
	done
fi
</file>

<file path="huflit-test.git/hooks/prepare-commit-msg.sample">
#!/bin/sh
#
# An example hook script to prepare the commit log message.
# Called by "git commit" with the name of the file that has the
# commit message, followed by the description of the commit
# message's source.  The hook's purpose is to edit the commit
# message file.  If the hook fails with a non-zero status,
# the commit is aborted.
#
# To enable this hook, rename this file to "prepare-commit-msg".

# This hook includes three examples. The first one removes the
# "# Please enter the commit message..." help message.
#
# The second includes the output of "git diff --name-status -r"
# into the message, just before the "git status" output.  It is
# commented because it doesn't cope with --amend or with squashed
# commits.
#
# The third example adds a Signed-off-by line to the message, that can
# still be edited.  This is rarely a good idea.

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2
SHA1=$3

/usr/bin/perl -i.bak -ne 'print unless(m/^. Please enter the commit message/..m/^#$/)' "$COMMIT_MSG_FILE"

# case "$COMMIT_SOURCE,$SHA1" in
#  ,|template,)
#    /usr/bin/perl -i.bak -pe '
#       print "\n" . `git diff --cached --name-status -r`
# 	 if /^#/ && $first++ == 0' "$COMMIT_MSG_FILE" ;;
#  *) ;;
# esac

# SOB=$(git var GIT_COMMITTER_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
# git interpret-trailers --in-place --trailer "$SOB" "$COMMIT_MSG_FILE"
# if test -z "$COMMIT_SOURCE"
# then
#   /usr/bin/perl -i.bak -pe 'print "\n" if !$first_line++' "$COMMIT_MSG_FILE"
# fi
</file>

<file path="huflit-test.git/hooks/push-to-checkout.sample">
#!/bin/sh

# An example hook script to update a checked-out tree on a git push.
#
# This hook is invoked by git-receive-pack(1) when it reacts to git
# push and updates reference(s) in its repository, and when the push
# tries to update the branch that is currently checked out and the
# receive.denyCurrentBranch configuration variable is set to
# updateInstead.
#
# By default, such a push is refused if the working tree and the index
# of the remote repository has any difference from the currently
# checked out commit; when both the working tree and the index match
# the current commit, they are updated to match the newly pushed tip
# of the branch. This hook is to be used to override the default
# behaviour; however the code below reimplements the default behaviour
# as a starting point for convenient modification.
#
# The hook receives the commit with which the tip of the current
# branch is going to be updated:
commit=$1

# It can exit with a non-zero status to refuse the push (when it does
# so, it must not modify the index or the working tree).
die () {
	echo >&2 "$*"
	exit 1
}

# Or it can make any necessary changes to the working tree and to the
# index to bring them to the desired state when the tip of the current
# branch is updated to the new commit, and exit with a zero status.
#
# For example, the hook can simply run git read-tree -u -m HEAD "$1"
# in order to emulate git fetch that is run in the reverse direction
# with git push, as the two-tree form of git read-tree -u -m is
# essentially the same as git switch or git checkout that switches
# branches while keeping the local changes in the working tree that do
# not interfere with the difference between the branches.

# The below is a more-or-less exact translation to shell of the C code
# for the default behaviour for git's push-to-checkout hook defined in
# the push_to_deploy() function in builtin/receive-pack.c.
#
# Note that the hook will be executed from the repository directory,
# not from the working tree, so if you want to perform operations on
# the working tree, you will have to adapt your code accordingly, e.g.
# by adding "cd .." or using relative paths.

if ! git update-index -q --ignore-submodules --refresh
then
	die "Up-to-date check failed"
fi

if ! git diff-files --quiet --ignore-submodules --
then
	die "Working directory has unstaged changes"
fi

# This is a rough translation of:
#
#   head_has_history() ? "HEAD" : EMPTY_TREE_SHA1_HEX
if git cat-file -e HEAD 2>/dev/null
then
	head=HEAD
else
	head=$(git hash-object -t tree --stdin </dev/null)
fi

if ! git diff-index --quiet --cached --ignore-submodules $head --
then
	die "Working directory has staged changes"
fi

if ! git read-tree -u -m "$commit"
then
	die "Could not update working tree to new HEAD"
fi
</file>

<file path="huflit-test.git/hooks/sendemail-validate.sample">
#!/bin/sh

# An example hook script to validate a patch (and/or patch series) before
# sending it via email.
#
# The hook should exit with non-zero status after issuing an appropriate
# message if it wants to prevent the email(s) from being sent.
#
# To enable this hook, rename this file to "sendemail-validate".
#
# By default, it will only check that the patch(es) can be applied on top of
# the default upstream branch without conflicts in a secondary worktree. After
# validation (successful or not) of the last patch of a series, the worktree
# will be deleted.
#
# The following config variables can be set to change the default remote and
# remote ref that are used to apply the patches against:
#
#   sendemail.validateRemote (default: origin)
#   sendemail.validateRemoteRef (default: HEAD)
#
# Replace the TODO placeholders with appropriate checks according to your
# needs.

validate_cover_letter () {
	file="$1"
	# TODO: Replace with appropriate checks (e.g. spell checking).
	true
}

validate_patch () {
	file="$1"
	# Ensure that the patch applies without conflicts.
	git am -3 "$file" || return
	# TODO: Replace with appropriate checks for this patch
	# (e.g. checkpatch.pl).
	true
}

validate_series () {
	# TODO: Replace with appropriate checks for the whole series
	# (e.g. quick build, coding style checks, etc.).
	true
}

# main -------------------------------------------------------------------------

if test "$GIT_SENDEMAIL_FILE_COUNTER" = 1
then
	remote=$(git config --default origin --get sendemail.validateRemote) &&
	ref=$(git config --default HEAD --get sendemail.validateRemoteRef) &&
	worktree=$(mktemp --tmpdir -d sendemail-validate.XXXXXXX) &&
	git worktree add -fd --checkout "$worktree" "refs/remotes/$remote/$ref" &&
	git config --replace-all sendemail.validateWorktree "$worktree"
else
	worktree=$(git config --get sendemail.validateWorktree)
fi || {
	echo "sendemail-validate: error: failed to prepare worktree" >&2
	exit 1
}

unset GIT_DIR GIT_WORK_TREE
cd "$worktree" &&

if grep -q "^diff --git " "$1"
then
	validate_patch "$1"
else
	validate_cover_letter "$1"
fi &&

if test "$GIT_SENDEMAIL_FILE_COUNTER" = "$GIT_SENDEMAIL_FILE_TOTAL"
then
	git config --unset-all sendemail.validateWorktree &&
	trap 'git worktree remove -ff "$worktree"' EXIT &&
	validate_series
fi
</file>

<file path="huflit-test.git/hooks/update.sample">
#!/bin/sh
#
# An example hook script to block unannotated tags from entering.
# Called by "git receive-pack" with arguments: refname sha1-old sha1-new
#
# To enable this hook, rename this file to "update".
#
# Config
# ------
# hooks.allowunannotated
#   This boolean sets whether unannotated tags will be allowed into the
#   repository.  By default they won't be.
# hooks.allowdeletetag
#   This boolean sets whether deleting tags will be allowed in the
#   repository.  By default they won't be.
# hooks.allowmodifytag
#   This boolean sets whether a tag may be modified after creation. By default
#   it won't be.
# hooks.allowdeletebranch
#   This boolean sets whether deleting branches will be allowed in the
#   repository.  By default they won't be.
# hooks.denycreatebranch
#   This boolean sets whether remotely creating branches will be denied
#   in the repository.  By default this is allowed.
#

# --- Command line
refname="$1"
oldrev="$2"
newrev="$3"

# --- Safety check
if [ -z "$GIT_DIR" ]; then
	echo "Don't run this script from the command line." >&2
	echo " (if you want, you could supply GIT_DIR then run" >&2
	echo "  $0 <ref> <oldrev> <newrev>)" >&2
	exit 1
fi

if [ -z "$refname" -o -z "$oldrev" -o -z "$newrev" ]; then
	echo "usage: $0 <ref> <oldrev> <newrev>" >&2
	exit 1
fi

# --- Config
allowunannotated=$(git config --type=bool hooks.allowunannotated)
allowdeletebranch=$(git config --type=bool hooks.allowdeletebranch)
denycreatebranch=$(git config --type=bool hooks.denycreatebranch)
allowdeletetag=$(git config --type=bool hooks.allowdeletetag)
allowmodifytag=$(git config --type=bool hooks.allowmodifytag)

# check for no description
projectdesc=$(sed -e '1q' "$GIT_DIR/description")
case "$projectdesc" in
"Unnamed repository"* | "")
	echo "*** Project description file hasn't been set" >&2
	exit 1
	;;
esac

# --- Check types
# if $newrev is 0000...0000, it's a commit to delete a ref.
zero=$(git hash-object --stdin </dev/null | tr '[0-9a-f]' '0')
if [ "$newrev" = "$zero" ]; then
	newrev_type=delete
else
	newrev_type=$(git cat-file -t $newrev)
fi

case "$refname","$newrev_type" in
	refs/tags/*,commit)
		# un-annotated tag
		short_refname=${refname##refs/tags/}
		if [ "$allowunannotated" != "true" ]; then
			echo "*** The un-annotated tag, $short_refname, is not allowed in this repository" >&2
			echo "*** Use 'git tag [ -a | -s ]' for tags you want to propagate." >&2
			exit 1
		fi
		;;
	refs/tags/*,delete)
		# delete tag
		if [ "$allowdeletetag" != "true" ]; then
			echo "*** Deleting a tag is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/tags/*,tag)
		# annotated tag
		if [ "$allowmodifytag" != "true" ] && git rev-parse $refname > /dev/null 2>&1
		then
			echo "*** Tag '$refname' already exists." >&2
			echo "*** Modifying a tag is not allowed in this repository." >&2
			exit 1
		fi
		;;
	refs/heads/*,commit)
		# branch
		if [ "$oldrev" = "$zero" -a "$denycreatebranch" = "true" ]; then
			echo "*** Creating a branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/heads/*,delete)
		# delete branch
		if [ "$allowdeletebranch" != "true" ]; then
			echo "*** Deleting a branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/remotes/*,commit)
		# tracking branch
		;;
	refs/remotes/*,delete)
		# delete tracking branch
		if [ "$allowdeletebranch" != "true" ]; then
			echo "*** Deleting a tracking branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	*)
		# Anything else (is there anything else?)
		echo "*** Update hook: unknown type of update to ref $refname of type $newrev_type" >&2
		exit 1
		;;
esac

# --- Finished
exit 0
</file>

<file path="huflit-test.git/info/exclude">
# git ls-files --others --exclude-from=.git/info/exclude
# Lines that start with '#' are comments.
# For a project mostly in C, the following would be a good set of
# exclude patterns (uncomment them if you want to use them):
# *.[oa]
# *~
</file>

<file path="huflit-test.git/packed-refs">
# pack-refs with: peeled fully-peeled sorted 
661cb70a0ab75d3f66e9f7a2a858c975730667f0 refs/heads/main
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K THI NNG LC NGOI NG NI B HUFLIT</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
</file>

<file path="public/index.html">
<script
src="https://code.responsivevoice.org/responsivevoice.js?key=arMTNtOF"></script>
</file>

<file path="public/vite.svg">
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="2048px" height="2048px" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" xmlns:xlink="http://www.w3.org/1999/xlink">
<g><path style="opacity:0.789" fill="#284b97" d="M 2047.5,1003.5 C 2047.5,1016.83 2047.5,1030.17 2047.5,1043.5C 2040.48,1146.07 2006.65,1238.74 1946,1321.5C 1904.28,1378.22 1855.45,1428.05 1799.5,1471C 1708.4,1539.9 1608.4,1593.23 1499.5,1631C 1311.58,1694.78 1118.58,1719.78 920.5,1706C 763.761,1696.15 613.094,1660.81 468.5,1600C 361.551,1554.74 265.885,1492.74 181.5,1414C 125.51,1360.02 80.3436,1298.19 46,1228.5C 18.711,1169.68 3.21095,1108.01 -0.5,1043.5C -0.5,1030.17 -0.5,1016.83 -0.5,1003.5C 6.52052,900.929 40.3539,808.262 101,725.5C 142.716,668.783 191.549,618.95 247.5,576C 338.604,507.099 438.604,453.766 547.5,416C 735.422,352.218 928.422,327.218 1126.5,341C 1283.24,350.853 1433.91,386.186 1578.5,447C 1685.48,492.275 1781.15,554.275 1865.5,633C 1921.49,686.981 1966.66,748.814 2001,818.5C 2028.29,877.323 2043.79,938.99 2047.5,1003.5 Z"/></g>
<g><path style="opacity:1" fill="#fbda01" d="M 960.5,343.5 C 1115.93,337.609 1268.6,355.109 1418.5,396C 1530.1,427.142 1634.76,473.475 1732.5,535C 1804.24,580.711 1867.4,636.545 1922,702.5C 1963.74,753.79 1995.58,810.957 2017.5,874C 2056.03,994.215 2048.86,1111.72 1996,1226.5C 1960.11,1299.42 1912.27,1363.58 1852.5,1419C 1767.32,1495.7 1671.32,1556.04 1564.5,1600C 1410.67,1662.42 1250.67,1696.76 1084.5,1703C 889.012,1711.73 699.679,1682.07 516.5,1614C 411.204,1574.18 315.204,1519.18 228.5,1449C 168.538,1399.06 118.038,1341.23 77,1275.5C 6.32538,1157.11 -12.008,1031.11 22,897.5C 42.4772,829.203 74.4772,767.203 118,711.5C 177.746,637.45 247.912,575.617 328.5,526C 447.724,453.914 575.724,403.581 712.5,375C 794.46,357.755 877.127,347.255 960.5,343.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1077.5,436.5 C 1077.5,437.5 1077.5,438.5 1077.5,439.5C 1072.83,439.5 1068.17,439.5 1063.5,439.5C 1062.15,433.98 1058.82,430.147 1053.5,428C 1032.61,424.036 1021.94,432.869 1021.5,454.5C 1023.16,479.31 1035.49,487.477 1058.5,479C 1062.55,475.027 1064.55,470.194 1064.5,464.5C 1058.5,464.5 1052.5,464.5 1046.5,464.5C 1046.5,460.833 1046.5,457.167 1046.5,453.5C 1057.17,453.5 1067.83,453.5 1078.5,453.5C 1078.5,457.5 1078.5,461.5 1078.5,465.5C 1077.25,480.851 1069.25,490.684 1054.5,495C 1023.97,498.476 1008.31,484.809 1007.5,454C 1006.95,435.586 1014.95,422.586 1031.5,415C 1047.74,410.53 1061.57,414.363 1073,426.5C 1075.32,429.48 1076.82,432.813 1077.5,436.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 982.5,414.5 C 984.833,414.5 987.167,414.5 989.5,414.5C 990.533,441.498 991.533,468.498 992.5,495.5C 988.154,495.666 983.821,495.499 979.5,495C 966,477.5 952.5,460 939,442.5C 939.222,456.492 939.722,470.492 940.5,484.5C 940.5,488.833 940.5,493.167 940.5,497.5C 937.287,497.19 934.287,497.523 931.5,498.5C 929.833,498.5 928.167,498.5 926.5,498.5C 925.498,471.476 924.165,444.476 922.5,417.5C 927.214,417.173 931.88,417.507 936.5,418.5C 949.751,435.35 962.751,452.35 975.5,469.5C 975.56,470.043 975.893,470.376 976.5,470.5C 977.808,466.685 977.808,463.019 976.5,459.5C 975.977,447.506 975.643,435.506 975.5,423.5C 975.5,420.833 975.5,418.167 975.5,415.5C 978.059,415.802 980.393,415.468 982.5,414.5 Z"/></g>
<g><path style="opacity:1" fill="#30306d" d="M 1120.5,416.5 C 1144.93,413.108 1160.43,423.108 1167,446.5C 1168.53,459.111 1166.53,471.111 1161,482.5C 1150.55,496.54 1136.72,501.706 1119.5,498C 1104.83,492.997 1096.33,482.83 1094,467.5C 1090.65,449.894 1095.48,435.061 1108.5,423C 1112.43,420.536 1116.43,418.369 1120.5,416.5 Z"/></g>
<g><path style="opacity:1" fill="#605754" d="M 982.5,414.5 C 980.393,415.468 978.059,415.802 975.5,415.5C 975.5,418.167 975.5,420.833 975.5,423.5C 974.523,420.713 974.19,417.713 974.5,414.5C 977.167,414.5 979.833,414.5 982.5,414.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 874.5,476.5 C 877.082,476.025 879.082,476.692 880.5,478.5C 878.229,494.273 869.229,503.773 853.5,507C 827.888,509.593 813.055,498.093 809,472.5C 805.085,451.529 812.585,436.363 831.5,427C 848.003,421.787 861.836,425.621 873,438.5C 875.072,441.971 876.572,445.638 877.5,449.5C 872.463,450.259 867.463,450.259 862.5,449.5C 860.632,444.132 856.965,440.632 851.5,439C 830.269,437.234 820.769,447.067 823,468.5C 823.751,478.843 828.251,487.01 836.5,493C 852.019,497.907 862.353,492.74 867.5,477.5C 869.747,476.626 872.08,476.292 874.5,476.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1206.5,424.5 C 1212.89,424.646 1219.23,425.313 1225.5,426.5C 1231.5,454.167 1237.5,481.833 1243.5,509.5C 1238.23,509.362 1233.06,508.695 1228,507.5C 1227,500.512 1225.5,493.679 1223.5,487C 1213.2,485.689 1202.87,484.855 1192.5,484.5C 1190.53,490.614 1187.86,496.448 1184.5,502C 1179.48,502.074 1174.48,501.574 1169.5,500.5C 1182.22,475.315 1194.56,449.982 1206.5,424.5 Z"/></g>
<g><path style="opacity:1" fill="#f9d706" d="M 1123.5,429.5 C 1137.42,427.205 1146.92,432.538 1152,445.5C 1153.3,455.431 1152.3,465.097 1149,474.5C 1140.58,487.288 1129.74,489.788 1116.5,482C 1105.86,468.379 1104.7,453.879 1113,438.5C 1116.1,434.886 1119.6,431.886 1123.5,429.5 Z"/></g>
<g><path style="opacity:1" fill="#2d2f6e" d="M 1269.5,511.5 C 1265.14,512.189 1260.8,511.689 1256.5,510C 1260.61,488.258 1264.44,466.425 1268,444.5C 1268.8,441.961 1268.63,439.628 1267.5,437.5C 1267.5,435.833 1267.5,434.167 1267.5,432.5C 1272.11,433.554 1276.77,434.221 1281.5,434.5C 1277.83,460.214 1273.83,485.881 1269.5,511.5 Z"/></g>
<g><path style="opacity:1" fill="#6a614d" d="M 1077.5,436.5 C 1078.43,437.568 1078.77,438.901 1078.5,440.5C 1073.31,440.821 1068.31,440.487 1063.5,439.5C 1068.17,439.5 1072.83,439.5 1077.5,439.5C 1077.5,438.5 1077.5,437.5 1077.5,436.5 Z"/></g>
<g><path style="opacity:1" fill="#30316d" d="M 747.5,439.5 C 778.365,437.691 794.365,452.358 795.5,483.5C 792.969,512.131 777.302,524.631 748.5,521C 734.189,515.266 725.355,504.766 722,489.5C 716.548,465.4 725.048,448.733 747.5,439.5 Z"/></g>
<g><path style="opacity:1" fill="#f2d10f" d="M 1220.5,472.5 C 1219.45,474.256 1217.78,474.923 1215.5,474.5C 1210.17,474.167 1204.83,473.833 1199.5,473.5C 1203.41,462.353 1208.41,451.686 1214.5,441.5C 1217.01,451.74 1219.01,462.073 1220.5,472.5 Z"/></g>
<g><path style="opacity:1" fill="#2e306e" d="M 1342.5,446.5 C 1349.62,463.686 1356.45,481.019 1363,498.5C 1363.55,500.76 1364.72,502.426 1366.5,503.5C 1367.79,505.255 1368.79,507.255 1369.5,509.5C 1374.61,492.044 1378.95,474.377 1382.5,456.5C 1387.24,457.185 1391.91,458.185 1396.5,459.5C 1390.71,485.547 1384.71,511.547 1378.5,537.5C 1374.14,536.993 1369.81,536.327 1365.5,535.5C 1357.89,514.279 1349.72,493.279 1341,472.5C 1336.36,490.068 1332.19,507.735 1328.5,525.5C 1324.09,525.147 1319.75,524.314 1315.5,523C 1314.92,522.107 1314.59,521.107 1314.5,520C 1319.85,495.386 1325.69,470.886 1332,446.5C 1332.31,445.692 1332.81,445.025 1333.5,444.5C 1336.48,445.275 1339.48,445.941 1342.5,446.5 Z"/></g>
<g><path style="opacity:1" fill="#f9d804" d="M 749.5,452.5 C 766.065,450.235 776.232,457.235 780,473.5C 780.667,480.167 780.667,486.833 780,493.5C 774.954,505.866 765.788,510.699 752.5,508C 744.413,504.352 739.246,498.185 737,489.5C 735.076,481.144 735.076,472.811 737,464.5C 739.744,458.921 743.911,454.921 749.5,452.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 692.5,452.5 C 695.388,452.22 696.888,453.553 697,456.5C 702.882,480.589 709.048,504.589 715.5,528.5C 715.182,529.647 714.516,530.481 713.5,531C 709.486,531.837 705.486,532.671 701.5,533.5C 699.531,522.79 696.864,512.29 693.5,502C 690.134,501.67 686.801,502.003 683.5,503C 674.798,505.175 666.132,507.342 657.5,509.5C 659.383,520.7 662.05,531.7 665.5,542.5C 660.967,544.805 656.301,545.805 651.5,545.5C 644.916,520.333 638.25,495.167 631.5,470C 631.833,469.5 632.167,469 632.5,468.5C 636.775,466.67 641.109,466.003 645.5,466.5C 647.88,477.357 650.88,488.023 654.5,498.5C 665.96,494.718 677.627,491.718 689.5,489.5C 687.937,478.247 685.27,467.247 681.5,456.5C 685.142,454.915 688.808,453.581 692.5,452.5 Z"/></g>
<g><path style="opacity:1" fill="#3d3868" d="M 1342.5,446.5 C 1344.89,447.219 1346.39,448.885 1347,451.5C 1353.81,468.753 1360.31,486.086 1366.5,503.5C 1364.72,502.426 1363.55,500.76 1363,498.5C 1356.45,481.019 1349.62,463.686 1342.5,446.5 Z"/></g>
<g><path style="opacity:1" fill="#827541" d="M 1046.5,453.5 C 1057.32,452.505 1068.32,452.172 1079.5,452.5C 1079.82,457.032 1079.48,461.366 1078.5,465.5C 1078.5,461.5 1078.5,457.5 1078.5,453.5C 1067.83,453.5 1057.17,453.5 1046.5,453.5 Z"/></g>
<g><path style="opacity:1" fill="#7c7045" d="M 976.5,459.5 C 977.808,463.019 977.808,466.685 976.5,470.5C 975.893,470.376 975.56,470.043 975.5,469.5C 976.479,466.375 976.813,463.042 976.5,459.5 Z"/></g>
<g><path style="opacity:1" fill="#3e3868" d="M 1267.5,437.5 C 1268.63,439.628 1268.8,441.961 1268,444.5C 1264.44,466.425 1260.61,488.258 1256.5,510C 1260.8,511.689 1265.14,512.189 1269.5,511.5C 1269.5,512.5 1269.5,513.5 1269.5,514.5C 1264.48,513.942 1259.48,513.275 1254.5,512.5C 1258.53,487.32 1262.86,462.32 1267.5,437.5 Z"/></g>
<g><path style="opacity:1" fill="#958439" d="M 1220.5,472.5 C 1221.4,473.209 1221.74,474.209 1221.5,475.5C 1219.26,475.795 1217.26,475.461 1215.5,474.5C 1217.78,474.923 1219.45,474.256 1220.5,472.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1475.5,500.5 C 1476.05,504.012 1475.39,507.012 1473.5,509.5C 1469.79,508.708 1466.12,507.708 1462.5,506.5C 1460.93,495.267 1454.6,488.6 1443.5,486.5C 1440.04,485.135 1436.71,485.469 1433.5,487.5C 1426.12,491.049 1420.96,496.715 1418,504.5C 1415.1,512.716 1414.76,521.049 1417,529.5C 1424.79,542.763 1435.63,545.929 1449.5,539C 1451.8,536.901 1453.46,534.401 1454.5,531.5C 1455.25,530.469 1455.92,529.302 1456.5,528C 1451.06,526.899 1445.89,525.066 1441,522.5C 1440.13,517.876 1441.96,515.543 1446.5,515.5C 1454.89,517.63 1463.22,519.964 1471.5,522.5C 1468.23,546.617 1454.56,557.45 1430.5,555C 1408.38,548.936 1398.54,534.436 1401,511.5C 1404.02,491.835 1414.85,479.001 1433.5,473C 1449.65,471.659 1462.48,477.492 1472,490.5C 1473.87,493.605 1475.03,496.938 1475.5,500.5 Z"/></g>
<g><path style="opacity:1" fill="#91823b" d="M 874.5,476.5 C 876.607,475.532 878.941,475.198 881.5,475.5C 881.737,476.791 881.404,477.791 880.5,478.5C 879.082,476.692 877.082,476.025 874.5,476.5 Z"/></g>
<g><path style="opacity:1" fill="#31316c" d="M 1525.5,480.5 C 1529.79,480.035 1533.79,480.868 1537.5,483C 1539.82,486.323 1542.49,489.323 1545.5,492C 1548.79,492.746 1551.29,491.58 1553,488.5C 1560.62,490.352 1561.45,493.852 1555.5,499C 1549.98,502.443 1544.64,502.276 1539.5,498.5C 1537.52,495.391 1535.19,492.557 1532.5,490C 1528.79,488.776 1526.12,489.942 1524.5,493.5C 1521.68,492.905 1519.35,491.572 1517.5,489.5C 1519.5,485.834 1522.17,482.834 1525.5,480.5 Z"/></g>
<g><path style="opacity:1" fill="#30316d" d="M 580.5,484.5 C 581.496,484.414 582.329,484.748 583,485.5C 591.5,510.5 600,535.5 608.5,560.5C 604.094,561.969 599.761,563.636 595.5,565.5C 586.448,540.678 577.781,515.678 569.5,490.5C 569.833,489.833 570.167,489.167 570.5,488.5C 574.013,487.336 577.346,486.002 580.5,484.5 Z"/></g>
<g><path style="opacity:1" fill="#a69239" d="M 1443.5,486.5 C 1440.14,486.616 1436.81,486.949 1433.5,487.5C 1436.71,485.469 1440.04,485.135 1443.5,486.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1559.5,527.5 C 1558.96,527.56 1558.62,527.893 1558.5,528.5C 1560.3,529.788 1561.97,529.788 1563.5,528.5C 1565.37,528.141 1566.87,527.141 1568,525.5C 1569.67,522.833 1571.33,520.167 1573,517.5C 1575.59,519.196 1578.42,520.196 1581.5,520.5C 1577.84,534.183 1568.84,540.183 1554.5,538.5C 1549.94,549.949 1545.11,561.282 1540,572.5C 1529.28,584.624 1516.45,587.457 1501.5,581C 1484.2,573.568 1477.7,560.734 1482,542.5C 1489,526.33 1495.5,509.996 1501.5,493.5C 1506.35,494.26 1511.01,495.594 1515.5,497.5C 1509.5,513.996 1503,530.33 1496,546.5C 1493.57,560.564 1499.4,568.564 1513.5,570.5C 1518.64,570.509 1523.14,568.842 1527,565.5C 1534.9,548.189 1542.4,530.689 1549.5,513C 1553.84,513.742 1558.01,515.242 1562,517.5C 1561.52,520.839 1560.68,524.173 1559.5,527.5 Z"/></g>
<g><path style="opacity:1" fill="#90813c" d="M 940.5,484.5 C 941.486,488.97 941.819,493.637 941.5,498.5C 938.167,498.5 934.833,498.5 931.5,498.5C 934.287,497.523 937.287,497.19 940.5,497.5C 940.5,493.167 940.5,488.833 940.5,484.5 Z"/></g>
<g><path style="opacity:1" fill="#a59231" d="M 1475.5,500.5 C 1476.48,503.625 1476.81,506.958 1476.5,510.5C 1475.21,510.737 1474.21,510.404 1473.5,509.5C 1475.39,507.012 1476.05,504.012 1475.5,500.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 528.5,583.5 C 528.721,586.279 528.388,588.946 527.5,591.5C 524.673,592.108 522.007,593.108 519.5,594.5C 517.883,595.038 516.216,595.371 514.5,595.5C 514.823,588.978 514.49,582.645 513.5,576.5C 512.825,554.495 512.325,532.495 512,510.5C 517.31,507.841 522.81,506.008 528.5,505C 547.02,526.019 565.353,547.186 583.5,568.5C 579.142,570.505 574.809,572.505 570.5,574.5C 565.5,569.167 560.5,563.833 555.5,558.5C 546.793,561.902 538.127,565.402 529.5,569C 528.531,573.737 528.197,578.57 528.5,583.5 Z"/></g>
<g><path style="opacity:1" fill="#30316d" d="M 1201.5,511.5 C 1211.62,511.431 1214.62,515.931 1210.5,525C 1201.48,528.949 1196.98,526.116 1197,516.5C 1198.02,514.313 1199.52,512.646 1201.5,511.5 Z"/></g>
<g><path style="opacity:1" fill="#453d65" d="M 1446.5,515.5 C 1441.96,515.543 1440.13,517.876 1441,522.5C 1445.89,525.066 1451.06,526.899 1456.5,528C 1455.92,529.302 1455.25,530.469 1454.5,531.5C 1454.59,530.504 1454.25,529.671 1453.5,529C 1448.74,527.801 1444.07,526.301 1439.5,524.5C 1437.98,520.269 1438.81,516.603 1442,513.5C 1443.73,513.899 1445.23,514.566 1446.5,515.5 Z"/></g>
<g><path style="opacity:1" fill="#f2d20e" d="M 528.5,556.5 C 527.833,554.167 527.167,551.833 526.5,549.5C 525.735,540.812 525.735,532.146 526.5,523.5C 533.846,531.516 540.846,539.849 547.5,548.5C 541.34,551.554 535.006,554.221 528.5,556.5 Z"/></g>
<g><path style="opacity:1" fill="#30316d" d="M 764.5,526.5 C 772.712,525.226 776.546,528.559 776,536.5C 773.459,541.069 769.625,542.569 764.5,541C 759.214,536.169 759.214,531.335 764.5,526.5 Z"/></g>
<g><path style="opacity:1" fill="#87793f" d="M 1559.5,527.5 C 1560.57,528.434 1561.9,528.768 1563.5,528.5C 1561.97,529.788 1560.3,529.788 1558.5,528.5C 1558.62,527.893 1558.96,527.56 1559.5,527.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 449.5,539.5 C 469.777,538.612 483.61,547.612 491,566.5C 498.274,584.232 494.774,599.398 480.5,612C 469.99,617.755 459.323,623.255 448.5,628.5C 442.34,618.185 436.674,607.518 431.5,596.5C 431.167,596.167 430.833,595.833 430.5,595.5C 427.276,596.695 424.109,598.029 421,599.5C 419.14,597.625 417.64,595.458 416.5,593C 420.04,591.069 423.374,588.902 426.5,586.5C 422.106,576.711 417.439,567.045 412.5,557.5C 424.242,550.128 436.575,544.128 449.5,539.5 Z"/></g>
<g><path style="opacity:1" fill="#f8d607" d="M 448.5,552.5 C 460.367,551.516 469.201,556.183 475,566.5C 481.364,576.527 482.031,586.86 477,597.5C 475.167,599.333 473.333,601.167 471.5,603C 466.04,605.564 460.706,608.397 455.5,611.5C 451.456,604.377 447.789,597.044 444.5,589.5C 447.493,587.336 450.493,585.169 453.5,583C 452.836,580.146 451.336,577.979 449,576.5C 446.106,577.697 443.273,579.03 440.5,580.5C 437.04,574.413 433.706,568.246 430.5,562C 436.435,558.535 442.435,555.368 448.5,552.5 Z"/></g>
<g><path style="opacity:1" fill="#7d7044" d="M 526.5,549.5 C 527.167,551.833 527.833,554.167 528.5,556.5C 528.44,557.043 528.107,557.376 527.5,557.5C 526.52,554.914 526.187,552.247 526.5,549.5 Z"/></g>
<g><path style="opacity:1" fill="#b59f30" d="M 1174.5,560.5 C 1179.73,560.444 1184.73,561.111 1189.5,562.5C 1184.27,562.556 1179.27,561.889 1174.5,560.5 Z"/></g>
<g><path style="opacity:1" fill="#30316d" d="M 1606.5,577.5 C 1617.76,582.257 1628.42,588.09 1638.5,595C 1637.7,599.403 1635.37,602.07 1631.5,603C 1621.92,598.402 1612.58,593.402 1603.5,588C 1602.98,587.439 1602.64,586.772 1602.5,586C 1604.24,583.357 1605.57,580.523 1606.5,577.5 Z"/></g>
<g><path style="opacity:1" fill="#a49131" d="M 528.5,583.5 C 529.156,584.622 529.489,585.955 529.5,587.5C 529.415,589.333 528.748,590.666 527.5,591.5C 528.388,588.946 528.721,586.279 528.5,583.5 Z"/></g>
<g><path style="opacity:1" fill="#33326c" d="M 552.5,587.5 C 561.61,587.772 564.443,592.105 561,600.5C 553.662,605.61 548.829,603.944 546.5,595.5C 547.357,591.977 549.357,589.31 552.5,587.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1697.5,589.5 C 1715.46,601.153 1733.12,613.32 1750.5,626C 1748.53,629.433 1746.2,632.6 1743.5,635.5C 1736.83,630.833 1730.17,626.167 1723.5,621.5C 1710.15,640.204 1696.82,658.871 1683.5,677.5C 1679.69,674.858 1676.02,672.025 1672.5,669C 1685.57,650.931 1698.24,632.598 1710.5,614C 1710.24,612.739 1709.57,611.739 1708.5,611C 1702.91,607.29 1697.41,603.457 1692,599.5C 1691.68,598.092 1692.02,596.759 1693,595.5C 1694.75,593.649 1696.25,591.649 1697.5,589.5 Z"/></g>
<g><path style="opacity:1" fill="#bca52a" d="M 513.5,576.5 C 514.49,582.645 514.823,588.978 514.5,595.5C 516.216,595.371 517.883,595.038 519.5,594.5C 518.01,596.28 516.01,596.946 513.5,596.5C 513.5,589.833 513.5,583.167 513.5,576.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 352.5,593.5 C 363.229,593.075 372.562,596.409 380.5,603.5C 376.772,606.559 372.772,609.226 368.5,611.5C 355.444,604.122 344.944,606.788 337,619.5C 333.787,639.236 341.287,653.403 359.5,662C 368.988,662.948 376.822,659.781 383,652.5C 387.373,645.72 387.539,638.886 383.5,632C 377.89,634.387 372.557,637.554 367.5,641.5C 365.5,638.5 363.5,635.5 361.5,632.5C 369.672,626.505 378.005,620.671 386.5,615C 387.996,614.493 389.163,614.993 390,616.5C 401.856,631.379 402.523,646.712 392,662.5C 375.622,677.991 358.122,679.491 339.5,667C 322.312,651.418 317.812,632.918 326,611.5C 332.602,602.123 341.435,596.123 352.5,593.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 289.5,634.5 C 307.624,654.468 325.29,674.968 342.5,696C 338.989,698.847 335.489,701.68 332,704.5C 311.305,698.993 290.639,693.326 270,687.5C 269.5,687.833 269,688.167 268.5,688.5C 279.833,702.167 291.167,715.833 302.5,729.5C 299.172,732.658 295.672,735.658 292,738.5C 274.358,718.538 257.192,698.204 240.5,677.5C 243.024,673.467 246.524,670.8 251,669.5C 271.865,675.066 292.698,680.733 313.5,686.5C 313.833,686.167 314.167,685.833 314.5,685.5C 302.833,671.5 291.167,657.5 279.5,643.5C 282.906,640.483 286.24,637.483 289.5,634.5 Z"/></g>
<g><path style="opacity:1" fill="#30316d" d="M 1763.5,637.5 C 1767.21,639.785 1770.71,642.452 1774,645.5C 1774.67,646.5 1774.67,647.5 1774,648.5C 1757.62,667.877 1741.62,687.543 1726,707.5C 1725.28,708.451 1724.45,708.617 1723.5,708C 1720.83,706 1718.17,704 1715.5,702C 1713.99,701.163 1713.49,699.996 1714,698.5C 1730.99,678.503 1747.49,658.169 1763.5,637.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1791.5,660.5 C 1796.25,662.916 1799.58,666.583 1801.5,671.5C 1797.67,692.97 1794.34,714.303 1791.5,735.5C 1804.13,722.374 1816.96,709.374 1830,696.5C 1833.35,699.682 1836.52,703.015 1839.5,706.5C 1821.48,726.022 1802.98,745.022 1784,763.5C 1780.17,761 1777,757.833 1774.5,754C 1778.67,732.504 1782,711.004 1784.5,689.5C 1772.37,702.126 1760.04,714.626 1747.5,727C 1746.83,727.667 1746.17,727.667 1745.5,727C 1742.5,724 1739.5,721 1736.5,718C 1755.04,698.964 1773.37,679.798 1791.5,660.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 232.5,707.5 C 231.115,708.947 231.448,709.947 233.5,710.5C 248.303,716.134 259.137,726.134 266,740.5C 270.497,762.339 262.664,777.839 242.5,787C 218.854,790.593 201.354,781.76 190,760.5C 182.602,737.123 190.102,720.289 212.5,710C 216.095,709.416 219.595,708.582 223,707.5C 223.826,701.483 221.659,696.816 216.5,693.5C 218.192,691.641 219.692,689.641 221,687.5C 222.049,686.483 223.216,686.316 224.5,687C 230.928,692.357 233.594,699.19 232.5,707.5 Z"/></g>
<g><path style="opacity:1" fill="#8f7f3d" d="M 232.5,707.5 C 232.557,708.609 232.89,709.609 233.5,710.5C 231.448,709.947 231.115,708.947 232.5,707.5 Z"/></g>
<g><path style="opacity:1" fill="#31316d" d="M 174.5,707.5 C 181.112,708.734 187.445,710.734 193.5,713.5C 191.322,717.026 188.322,719.359 184.5,720.5C 178.4,719.843 172.4,718.676 166.5,717C 169.754,714.253 172.42,711.086 174.5,707.5 Z"/></g>
<g><path style="opacity:1" fill="#f9d805" d="M 216.5,722.5 C 233.492,723.084 245.658,731.084 253,746.5C 255.167,767 246,776.167 225.5,774C 213.974,769.141 205.808,760.974 201,749.5C 199.243,736.443 204.41,727.443 216.5,722.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1875.5,749.5 C 1879.3,752.538 1882.3,756.371 1884.5,761C 1876.21,767.483 1867.55,773.483 1858.5,779C 1857.98,779.561 1857.64,780.228 1857.5,781C 1863.96,791.409 1870.79,801.575 1878,811.5C 1887.51,805.414 1896.84,799.081 1906,792.5C 1908.63,796.265 1911.13,800.098 1913.5,804C 1892.11,819.876 1870.11,835.043 1847.5,849.5C 1844.64,845.805 1841.97,841.971 1839.5,838C 1848.7,831.305 1858.03,824.805 1867.5,818.5C 1860.75,807.994 1853.75,797.66 1846.5,787.5C 1837.17,793.833 1827.83,800.167 1818.5,806.5C 1815.62,802.794 1812.96,798.961 1810.5,795C 1832.2,779.821 1853.87,764.655 1875.5,749.5 Z"/></g>
<g><path style="opacity:1" fill="#30306d" d="M 158.5,761.5 C 164.43,764.262 168.93,768.595 172,774.5C 172.539,779.625 172.205,784.625 171,789.5C 180.581,796.042 190.414,802.209 200.5,808C 211.513,817.047 214.347,828.214 209,841.5C 202.035,860.057 188.868,867.89 169.5,865C 152,855.42 135,845.087 118.5,834C 120.81,829.867 123.476,826.034 126.5,822.5C 142.167,832 157.833,841.5 173.5,851C 187.839,852.508 195.839,846.008 197.5,831.5C 197.033,825.738 194.367,821.238 189.5,818C 174.75,809.543 160.25,800.71 146,791.5C 147.038,786.756 149.205,782.423 152.5,778.5C 155.571,780.898 158.905,782.898 162.5,784.5C 163.641,782.579 163.808,780.579 163,778.5C 160.264,774.943 157.431,771.61 154.5,768.5C 155.576,766.014 156.909,763.681 158.5,761.5 Z"/></g>
<g><path style="opacity:1" fill="#30306d" d="M 1902.5,836.5 C 1925.44,835.612 1939.6,846.279 1945,868.5C 1946.3,885.077 1939.8,897.577 1925.5,906C 1914.66,912.501 1903,914.835 1890.5,913C 1875.48,908.305 1866.31,898.138 1863,882.5C 1861.29,866.078 1867.46,853.578 1881.5,845C 1888.19,841.057 1895.19,838.224 1902.5,836.5 Z"/></g>
<g><path style="opacity:1" fill="#f9d805" d="M 1901.5,851.5 C 1922.52,848.691 1932.35,857.691 1931,878.5C 1928.82,884.038 1925.32,888.538 1920.5,892C 1911.29,897.85 1901.29,900.183 1890.5,899C 1879.59,894.015 1874.75,885.515 1876,873.5C 1877.58,867.914 1880.75,863.414 1885.5,860C 1890.64,856.685 1895.98,853.851 1901.5,851.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 160.5,937.5 C 161.953,936.175 161.619,935.342 159.5,935C 139.425,928.197 119.425,921.197 99.5,914C 97.5273,913.505 95.5273,913.338 93.5,913.5C 91.0523,913.915 89.7189,912.915 89.5,910.5C 93.2631,897.704 98.0965,885.371 104,873.5C 113.878,862.323 125.378,860.49 138.5,868C 145.304,872.303 148.97,878.47 149.5,886.5C 161.442,884.293 173.442,882.793 185.5,882C 183.137,886.59 181.47,891.423 180.5,896.5C 169.48,897.781 158.48,899.281 147.5,901C 144.678,905.77 143.344,910.77 143.5,916C 151.726,919.279 160.059,922.279 168.5,925C 168.957,925.414 169.291,925.914 169.5,926.5C 168.167,930.167 166.833,933.833 165.5,937.5C 163.833,938.666 162.166,938.666 160.5,937.5 Z"/></g>
<g><path style="opacity:1" fill="#f6d508" d="M 118.5,878.5 C 131.229,877.398 137.063,883.064 136,895.5C 133.983,900.713 132.483,906.046 131.5,911.5C 122.83,908.999 114.33,905.999 106,902.5C 106.864,892.713 111.031,884.713 118.5,878.5 Z"/></g>
<g><path style="opacity:1" fill="#31316d" d="M 1850.5,888.5 C 1860.41,889.221 1863.41,894.055 1859.5,903C 1849.32,906.66 1845.15,903.16 1847,892.5C 1848.38,891.295 1849.54,889.962 1850.5,888.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1923.5,922.5 C 1940.23,919.905 1954.06,924.905 1965,937.5C 1975.34,955.465 1973.17,971.632 1958.5,986C 1955.78,988.027 1952.78,989.527 1949.5,990.5C 1948.36,985.995 1947.36,981.495 1946.5,977C 1961.31,966.192 1962.31,954.192 1949.5,941C 1932.96,933.344 1918.12,935.844 1905,948.5C 1898.98,960.102 1900.81,970.269 1910.5,979C 1913.54,981.006 1916.87,981.84 1920.5,981.5C 1921.04,986.186 1921.7,990.853 1922.5,995.5C 1907.33,995.655 1896.83,988.655 1891,974.5C 1884.29,946.255 1895.13,928.922 1923.5,922.5 Z"/></g>
<g><path style="opacity:1" fill="#403a67" d="M 93.5,913.5 C 95.5273,913.338 97.5273,913.505 99.5,914C 119.425,921.197 139.425,928.197 159.5,935C 161.619,935.342 161.953,936.175 160.5,937.5C 137.94,929.871 115.607,921.871 93.5,913.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 82.5,934.5 C 86.4809,935.021 90.4809,935.354 94.5,935.5C 93.6641,944.187 92.6641,952.854 91.5,961.5C 114.269,964.181 136.936,967.515 159.5,971.5C 158.462,975.769 157.795,980.102 157.5,984.5C 135.661,981.582 113.827,978.582 92,975.5C 90.6739,975.755 89.6739,976.422 89,977.5C 87.8371,984.803 87.0037,992.136 86.5,999.5C 83.1501,999.665 79.8168,999.498 76.5,999C 75.4216,998.326 74.7549,997.326 74.5,996C 77.1222,975.479 79.7889,954.979 82.5,934.5 Z"/></g>
<g><path style="opacity:1" fill="#bfa72d" d="M 220.5,1051.5 C 221.972,1055.92 222.638,1060.59 222.5,1065.5C 221.028,1061.08 220.362,1056.41 220.5,1051.5 Z"/></g>
<g><path style="opacity:1" fill="#bfa72d" d="M 1826.5,1051.5 C 1826.64,1056.41 1825.97,1061.08 1824.5,1065.5C 1824.36,1060.59 1825.03,1055.92 1826.5,1051.5 Z"/></g>
<g><path style="opacity:1" fill="#37346a" d="M 1174.5,560.5 C 1179.27,561.889 1184.27,562.556 1189.5,562.5C 1299.91,575.852 1406.24,604.352 1508.5,648C 1581.05,679.745 1646.72,721.745 1705.5,774C 1752.53,817.027 1787.7,868.193 1811,927.5C 1825.05,967.707 1830.22,1009.04 1826.5,1051.5C 1825.03,1055.92 1824.36,1060.59 1824.5,1065.5C 1811.99,1131.19 1783.49,1188.86 1739,1238.5C 1697.38,1283.81 1650.22,1321.98 1597.5,1353C 1511.07,1402.71 1419.07,1438.71 1321.5,1461C 1285.62,1469.08 1249.62,1475.91 1213.5,1481.5C 1208.27,1481.44 1203.27,1482.11 1198.5,1483.5C 1195.39,1483.26 1192.39,1483.6 1189.5,1484.5C 1184.27,1484.44 1179.27,1485.11 1174.5,1486.5C 1006.41,1505.25 840.745,1492.75 677.5,1449C 583.389,1423.43 495.722,1384.1 414.5,1331C 379.025,1306.54 346.192,1278.71 316,1247.5C 280.858,1209.97 254.192,1166.97 236,1118.5C 230.37,1100.98 225.87,1083.31 222.5,1065.5C 222.638,1060.59 221.972,1055.92 220.5,1051.5C 215.712,991.653 227.546,935.32 256,882.5C 279.119,841.688 307.952,805.188 342.5,773C 405.906,716.594 477.24,672.26 556.5,640C 669.067,594.284 786.067,566.617 907.5,557C 996.603,550.263 1085.6,551.429 1174.5,560.5 Z"/></g>
<g><path style="opacity:1" fill="#fad903" d="M 624.5,1328.5 C 625.873,1328.34 627.207,1328.51 628.5,1329C 668.221,1365.01 712.554,1394.34 761.5,1417C 729.594,1423.31 698.261,1431.48 667.5,1441.5C 613.534,1426.13 561.534,1405.96 511.5,1381C 534.726,1365.72 559.393,1353.05 585.5,1343C 598.588,1338.11 611.588,1333.28 624.5,1328.5 Z"/></g>
<g><path style="opacity:1" fill="#fbd902" d="M 1419.5,1326.5 C 1461.64,1338.57 1501.64,1355.57 1539.5,1377.5C 1540.83,1378.17 1540.83,1378.83 1539.5,1379.5C 1486.67,1405.22 1432.01,1426.22 1375.5,1442.5C 1342.18,1432.42 1308.51,1423.75 1274.5,1416.5C 1318.84,1397.51 1360.17,1373.68 1398.5,1345C 1405.99,1339.34 1412.99,1333.17 1419.5,1326.5 Z"/></g>
<g><path style="opacity:1" fill="#fbd902" d="M 838.5,1384.5 C 843.964,1390.46 849.63,1396.3 855.5,1402C 846.536,1403.56 837.536,1404.72 828.5,1405.5C 808.121,1408.67 787.788,1411.84 767.5,1415C 717.932,1392.39 672.932,1363.05 632.5,1327C 669.417,1314.69 707.084,1305.02 745.5,1298C 754.82,1296.22 764.154,1294.89 773.5,1294C 791.143,1327.14 812.81,1357.31 838.5,1384.5 Z"/></g>
<g><path style="opacity:1" fill="#fbd902" d="M 1268.5,1414.5 C 1243.86,1411.04 1219.19,1407.71 1194.5,1404.5C 1194.39,1403.88 1194.06,1403.38 1193.5,1403C 1225.79,1371.04 1252.29,1334.88 1273,1294.5C 1274.23,1293.89 1275.56,1293.56 1277,1293.5C 1323.75,1300.55 1369.58,1311.21 1414.5,1325.5C 1384.73,1351.74 1352.06,1373.91 1316.5,1392C 1300.53,1399.82 1284.53,1407.32 1268.5,1414.5 Z"/></g>
<g><path style="opacity:1" fill="#fcda01" d="M 1072.5,1274.5 C 1138.17,1276.4 1203.51,1282.06 1268.5,1291.5C 1251.64,1327.03 1229.64,1359.03 1202.5,1387.5C 1197.6,1394.25 1191.44,1399.25 1184,1402.5C 1132.35,1396.43 1080.52,1393.1 1028.5,1392.5C 1028.22,1361.17 1027.89,1329.83 1027.5,1298.5C 1027.5,1290.5 1027.5,1282.5 1027.5,1274.5C 1042.5,1274.5 1057.5,1274.5 1072.5,1274.5 Z"/></g>
<g><path style="opacity:1" fill="#fcda01" d="M 970.5,1274.5 C 987.5,1274.5 1004.5,1274.5 1021.5,1274.5C 1021.18,1279.69 1021.51,1284.69 1022.5,1289.5C 1023.14,1323.83 1023.8,1358.17 1024.5,1392.5C 970.315,1392.35 916.315,1395.35 862.5,1401.5C 859.895,1400.23 857.562,1398.56 855.5,1396.5C 824.243,1366.31 798.576,1331.97 778.5,1293.5C 787.523,1290.55 796.856,1288.88 806.5,1288.5C 811.731,1288.56 816.731,1287.89 821.5,1286.5C 826.731,1286.56 831.731,1285.89 836.5,1284.5C 843.279,1283.02 850.279,1282.35 857.5,1282.5C 862.414,1282.64 867.081,1281.97 871.5,1280.5C 877.329,1280.03 882.996,1279.36 888.5,1278.5C 892.167,1278.5 895.833,1278.5 899.5,1278.5C 909.699,1278.57 919.699,1277.9 929.5,1276.5C 943.123,1275.27 956.79,1274.61 970.5,1274.5 Z"/></g>
<g><path style="opacity:1" fill="#36336b" d="M 1059.5,654.5 C 1049.86,655.325 1040.19,655.658 1030.5,655.5C 1029.65,695.163 1028.99,734.83 1028.5,774.5C 1051.83,774.204 1075.17,773.87 1098.5,773.5C 1101.64,774.321 1104.97,774.821 1108.5,775C 1104.61,775.419 1100.94,776.252 1097.5,777.5C 1074.18,778.333 1050.84,778.666 1027.5,778.5C 1027.5,793.833 1027.5,809.167 1027.5,824.5C 1026.17,824.5 1024.83,824.5 1023.5,824.5C 1023.5,809.167 1023.5,793.833 1023.5,778.5C 1012.83,778.5 1002.17,778.5 991.5,778.5C 980.019,777.235 968.352,776.402 956.5,776C 954.833,775.667 953.167,775.333 951.5,775C 954.695,774.819 957.695,774.319 960.5,773.5C 969.167,773.5 977.833,773.5 986.5,773.5C 998.989,774.495 1011.66,774.829 1024.5,774.5C 1024.5,765.833 1024.5,757.167 1024.5,748.5C 1024.7,723.831 1025.04,699.165 1025.5,674.5C 1026.49,668.021 1026.82,661.354 1026.5,654.5C 1013.17,654.5 999.833,654.5 986.5,654.5C 999.983,653.167 1013.82,652.501 1028,652.5C 1041.83,652.667 1055.67,652.833 1069.5,653C 1065.97,653.179 1062.64,653.679 1059.5,654.5 Z"/></g>
<g><path style="opacity:1" fill="#6c624e" d="M 983.5,654.5 C 984.5,654.5 985.5,654.5 986.5,654.5C 999.833,654.5 1013.17,654.5 1026.5,654.5C 1026.82,661.354 1026.49,668.021 1025.5,674.5C 1025.5,668.167 1025.5,661.833 1025.5,655.5C 1011.32,655.829 997.323,655.496 983.5,654.5 Z"/></g>
<g><path style="opacity:1" fill="#fcda00" d="M 991.5,778.5 C 1002.17,778.5 1012.83,778.5 1023.5,778.5C 1023.5,793.833 1023.5,809.167 1023.5,824.5C 1024.83,824.5 1026.17,824.5 1027.5,824.5C 1027.5,809.167 1027.5,793.833 1027.5,778.5C 1050.84,778.666 1074.18,778.333 1097.5,777.5C 1127.88,776.077 1158.21,774.077 1188.5,771.5C 1193.73,771.556 1198.73,770.889 1203.5,769.5C 1210.12,768.397 1216.79,767.73 1223.5,767.5C 1228.73,767.556 1233.73,766.889 1238.5,765.5C 1243.73,765.556 1248.73,764.889 1253.5,763.5C 1259.14,762.19 1264.97,761.19 1271,760.5C 1272.44,760.559 1273.77,760.892 1275,761.5C 1284.85,780.527 1293.02,800.194 1299.5,820.5C 1303.07,820.592 1304.24,818.926 1303,815.5C 1295.7,796.24 1287.87,777.24 1279.5,758.5C 1327.48,751.453 1374.64,740.786 1421,726.5C 1452.99,753.813 1480.66,784.813 1504,819.5C 1506.97,818.01 1507.3,816.01 1505,813.5C 1482.64,781.298 1456.81,751.964 1427.5,725.5C 1461,713.935 1493.67,700.101 1525.5,684C 1532.17,680 1538.83,676 1545.5,672C 1614.76,704.093 1675.93,747.926 1729,803.5C 1761.54,838.752 1786.87,878.752 1805,923.5C 1835.21,1010.47 1827.21,1093.8 1781,1173.5C 1750.59,1222.73 1712.42,1265.23 1666.5,1301C 1628.77,1329.53 1588.77,1354.69 1546.5,1376.5C 1507.92,1354.04 1467.25,1336.21 1424.5,1323C 1452.45,1298.06 1477.12,1270.4 1498.5,1240C 1497.42,1239.04 1496.25,1238.21 1495,1237.5C 1475.21,1265.48 1452.71,1291.32 1427.5,1315C 1424.61,1317.39 1421.61,1319.56 1418.5,1321.5C 1371.87,1307.62 1324.53,1296.95 1276.5,1289.5C 1285.74,1268.44 1294.41,1247.11 1302.5,1225.5C 1301.18,1223.73 1299.68,1223.4 1298,1224.5C 1290.89,1245.82 1282.23,1266.48 1272,1286.5C 1271.33,1287.25 1270.5,1287.59 1269.5,1287.5C 1188.95,1275.59 1107.95,1269.59 1026.5,1269.5C 1026.5,1264.17 1026.5,1258.83 1026.5,1253.5C 1026.5,1243.5 1026.5,1233.5 1026.5,1223.5C 1024.59,1223.22 1022.92,1223.55 1021.5,1224.5C 1021.5,1234.83 1021.5,1245.17 1021.5,1255.5C 1021.5,1259.83 1021.5,1264.17 1021.5,1268.5C 1010.65,1268.17 999.987,1268.51 989.5,1269.5C 952.442,1270.48 915.442,1272.48 878.5,1275.5C 873.269,1275.44 868.269,1276.11 863.5,1277.5C 834.038,1280.4 804.704,1283.9 775.5,1288C 764.828,1267.49 755.662,1246.32 748,1224.5C 746.951,1222.89 745.451,1222.23 743.5,1222.5C 746.132,1232.77 749.632,1242.77 754,1252.5C 759.518,1264.87 765.018,1277.2 770.5,1289.5C 722.372,1297.32 675.205,1308.66 629,1323.5C 600.664,1297.84 575.998,1269.18 555,1237.5C 550.692,1236.15 549.692,1237.48 552,1241.5C 572.686,1271.37 596.186,1299.04 622.5,1324.5C 581.554,1338.48 542.554,1356.48 505.5,1378.5C 428.116,1341.88 360.949,1291.55 304,1227.5C 266.55,1183.6 241.55,1133.26 229,1076.5C 216.533,1006.44 227.866,940.44 263,878.5C 293.91,827.243 333.076,783.076 380.5,746C 420.024,715.857 462.191,689.69 507,667.5C 543.199,690.348 581.699,708.514 622.5,722C 592.292,749.513 566.626,780.513 545.5,815C 545.613,816.28 546.28,817.113 547.5,817.5C 560.726,798.765 574.559,780.432 589,762.5C 601.378,748.622 614.545,735.622 628.5,723.5C 675.314,738.286 722.98,749.786 771.5,758C 772.517,759.049 772.684,760.216 772,761.5C 761.095,781.214 751.928,801.714 744.5,823C 745.722,825.965 747.222,826.132 749,823.5C 756.999,801.667 766.499,780.5 777.5,760C 807.164,763.416 836.831,767.083 866.5,771C 908.11,774.496 949.777,776.996 991.5,778.5 Z"/></g>
<g><path style="opacity:1" fill="#c2aa2a" d="M 821.5,1286.5 C 816.731,1287.89 811.731,1288.56 806.5,1288.5C 811.269,1287.11 816.269,1286.44 821.5,1286.5 Z"/></g>
<g><path style="opacity:1" fill="#bca52c" d="M 836.5,1284.5 C 831.731,1285.89 826.731,1286.56 821.5,1286.5C 826.269,1285.11 831.269,1284.44 836.5,1284.5 Z"/></g>
<g><path style="opacity:1" fill="#bca52c" d="M 871.5,1280.5 C 867.081,1281.97 862.414,1282.64 857.5,1282.5C 861.919,1281.03 866.586,1280.36 871.5,1280.5 Z"/></g>
<g><path style="opacity:1" fill="#584e5a" d="M 878.5,1275.5 C 876.735,1276.46 874.735,1276.79 872.5,1276.5C 869.609,1277.4 866.609,1277.74 863.5,1277.5C 868.269,1276.11 873.269,1275.44 878.5,1275.5 Z"/></g>
<g><path style="opacity:1" fill="#cbb21e" d="M 1072.5,1274.5 C 1057.5,1274.5 1042.5,1274.5 1027.5,1274.5C 1027.5,1282.5 1027.5,1290.5 1027.5,1298.5C 1026.51,1290.35 1026.17,1282.02 1026.5,1273.5C 1042.01,1273.17 1057.34,1273.5 1072.5,1274.5 Z"/></g>
<g><path style="opacity:1" fill="#b8a22a" d="M 970.5,1274.5 C 987.659,1273.5 1004.99,1273.17 1022.5,1273.5C 1022.5,1278.83 1022.5,1284.17 1022.5,1289.5C 1021.51,1284.69 1021.18,1279.69 1021.5,1274.5C 1004.5,1274.5 987.5,1274.5 970.5,1274.5 Z"/></g>
<g><path style="opacity:1" fill="#90803b" d="M 1021.5,1255.5 C 1022.49,1259.97 1022.82,1264.64 1022.5,1269.5C 1011.5,1269.5 1000.5,1269.5 989.5,1269.5C 999.987,1268.51 1010.65,1268.17 1021.5,1268.5C 1021.5,1264.17 1021.5,1259.83 1021.5,1255.5 Z"/></g>
<g><path style="opacity:1" fill="#b39e2a" d="M 1021.5,1224.5 C 1022.92,1223.55 1024.59,1223.22 1026.5,1223.5C 1026.5,1233.5 1026.5,1243.5 1026.5,1253.5C 1025.51,1244.01 1025.17,1234.35 1025.5,1224.5C 1024.17,1224.5 1022.83,1224.5 1021.5,1224.5 Z"/></g>
<g><path style="opacity:1" fill="#ef9b0f" d="M 587.5,911.5 C 588.499,985.665 588.833,1060 588.5,1134.5C 565.994,1134.83 543.66,1134.5 521.5,1133.5C 543.5,1133.5 565.5,1133.5 587.5,1133.5C 587.5,1059.83 587.5,986.167 587.5,912.5C 587.5,912.167 587.5,911.833 587.5,911.5 Z"/></g>
<g><path style="opacity:1" fill="#f1a40d" d="M 1194.5,973.5 C 1195.5,1012.33 1195.83,1051.33 1195.5,1090.5C 1232,1090.17 1268.34,1090.5 1304.5,1091.5C 1267.83,1091.5 1231.17,1091.5 1194.5,1091.5C 1194.5,1052.17 1194.5,1012.83 1194.5,973.5 Z"/></g>
<g><path style="opacity:1" fill="#eb8b14" d="M 1431.5,911.5 C 1432.5,985.665 1432.83,1060 1432.5,1134.5C 1409.66,1134.83 1386.99,1134.5 1364.5,1133.5C 1364.83,1133.5 1365.17,1133.5 1365.5,1133.5C 1387.5,1133.5 1409.5,1133.5 1431.5,1133.5C 1431.5,1059.83 1431.5,986.167 1431.5,912.5C 1431.5,912.167 1431.5,911.833 1431.5,911.5 Z"/></g>
<g><path style="opacity:1" fill="#eb8a14" d="M 983.5,995.5 C 1017.17,995.5 1050.83,995.5 1084.5,995.5C 1084.5,1010.17 1084.5,1024.83 1084.5,1039.5C 1050.17,1039.5 1015.83,1039.5 981.5,1039.5C 981.832,1071 981.498,1102.34 980.5,1133.5C 980.5,1101.83 980.5,1070.17 980.5,1038.5C 1014.83,1038.5 1049.17,1038.5 1083.5,1038.5C 1083.5,1024.5 1083.5,1010.5 1083.5,996.5C 1050,996.832 1016.66,996.498 983.5,995.5 Z"/></g>
<g><path style="opacity:1" fill="#e77719" d="M 587.5,911.5 C 587.5,911.833 587.5,912.167 587.5,912.5C 565.833,912.5 544.167,912.5 522.5,912.5C 522.5,940.5 522.5,968.5 522.5,996.5C 491.662,996.831 460.995,996.498 430.5,995.5C 460.833,995.5 491.167,995.5 521.5,995.5C 521.5,967.5 521.5,939.5 521.5,911.5C 543.5,911.5 565.5,911.5 587.5,911.5 Z"/></g>
<g><path style="opacity:1" fill="#e15920" d="M 1431.5,911.5 C 1431.5,911.833 1431.5,912.167 1431.5,912.5C 1409.5,912.5 1387.5,912.5 1365.5,912.5C 1365.5,986.167 1365.5,1059.83 1365.5,1133.5C 1365.17,1133.5 1364.83,1133.5 1364.5,1133.5C 1364.5,1059.5 1364.5,985.5 1364.5,911.5C 1386.83,911.5 1409.17,911.5 1431.5,911.5 Z"/></g>
<g><path style="opacity:1" fill="#f0a20d" d="M 1487.5,953.5 C 1513.5,953.5 1539.5,953.5 1565.5,953.5C 1565.5,1013.83 1565.5,1074.17 1565.5,1134.5C 1564.5,1074.67 1564.17,1014.67 1564.5,954.5C 1538.66,954.831 1512.99,954.498 1487.5,953.5 Z"/></g>
<g><path style="opacity:1" fill="#e4691b" d="M 1487.5,912.5 C 1562.33,911.501 1637.33,911.167 1712.5,911.5C 1712.5,925.833 1712.5,940.167 1712.5,954.5C 1686.17,954.5 1659.83,954.5 1633.5,954.5C 1659.33,953.502 1685.33,953.169 1711.5,953.5C 1711.5,939.833 1711.5,926.167 1711.5,912.5C 1636.83,912.5 1562.17,912.5 1487.5,912.5 Z"/></g>
<g><path style="opacity:1" fill="#dc4325" d="M 1487.5,912.5 C 1562.17,912.5 1636.83,912.5 1711.5,912.5C 1711.5,926.167 1711.5,939.833 1711.5,953.5C 1685.33,953.169 1659.33,953.502 1633.5,954.5C 1633.5,1014.5 1633.5,1074.5 1633.5,1134.5C 1610.83,1134.5 1588.17,1134.5 1565.5,1134.5C 1565.5,1074.17 1565.5,1013.83 1565.5,953.5C 1539.5,953.5 1513.5,953.5 1487.5,953.5C 1487.5,939.833 1487.5,926.167 1487.5,912.5 Z"/></g>
<g><path style="opacity:1" fill="#dc4225" d="M 1431.5,912.5 C 1431.5,986.167 1431.5,1059.83 1431.5,1133.5C 1409.5,1133.5 1387.5,1133.5 1365.5,1133.5C 1365.5,1059.83 1365.5,986.167 1365.5,912.5C 1387.5,912.5 1409.5,912.5 1431.5,912.5 Z"/></g>
<g><path style="opacity:1" fill="#dd4325" d="M 1194.5,973.5 C 1194.5,1012.83 1194.5,1052.17 1194.5,1091.5C 1231.17,1091.5 1267.83,1091.5 1304.5,1091.5C 1304.5,1105.5 1304.5,1119.5 1304.5,1133.5C 1245.5,1133.5 1186.5,1133.5 1127.5,1133.5C 1127.5,1059.83 1127.5,986.167 1127.5,912.5C 1149.83,912.5 1172.17,912.5 1194.5,912.5C 1194.5,932.833 1194.5,953.167 1194.5,973.5 Z"/></g>
<g><path style="opacity:1" fill="#dc4325" d="M 1015.5,911.5 C 1040.66,912.498 1065.99,912.831 1091.5,912.5C 1091.5,926.167 1091.5,939.833 1091.5,953.5C 1055.5,953.5 1019.5,953.5 983.5,953.5C 983.5,967.5 983.5,981.5 983.5,995.5C 1016.66,996.498 1050,996.832 1083.5,996.5C 1083.5,1010.5 1083.5,1024.5 1083.5,1038.5C 1049.17,1038.5 1014.83,1038.5 980.5,1038.5C 980.5,1070.17 980.5,1101.83 980.5,1133.5C 958.5,1133.5 936.5,1133.5 914.5,1133.5C 914.5,1059.5 914.5,985.5 914.5,911.5C 948.167,911.5 981.833,911.5 1015.5,911.5 Z"/></g>
<g><path style="opacity:1" fill="#dd4325" d="M 639.5,911.5 C 661.833,911.5 684.167,911.5 706.5,911.5C 706.042,962.19 706.542,1012.86 708,1063.5C 709.831,1076.33 716.998,1084.5 729.5,1088C 746.115,1093.26 762.448,1092.6 778.5,1086C 786.974,1081.22 792.14,1074.05 794,1064.5C 795.453,1013.52 795.953,962.522 795.5,911.5C 819.5,911.5 843.5,911.5 867.5,911.5C 867.667,955.835 867.5,1000.17 867,1044.5C 866.179,1056.23 864.845,1067.89 863,1079.5C 859.159,1094.34 850.992,1106.17 838.5,1115C 825.064,1125.59 809.731,1131.26 792.5,1132C 765.494,1133.97 738.494,1133.97 711.5,1132C 694.389,1129.61 678.723,1123.61 664.5,1114C 648.612,1099.38 640.445,1081.22 640,1059.5C 639.5,1010.17 639.333,960.834 639.5,911.5 Z"/></g>
<g><path style="opacity:1" fill="#dd4325" d="M 430.5,995.5 C 460.995,996.498 491.662,996.831 522.5,996.5C 522.5,968.5 522.5,940.5 522.5,912.5C 544.167,912.5 565.833,912.5 587.5,912.5C 587.5,986.167 587.5,1059.83 587.5,1133.5C 565.5,1133.5 543.5,1133.5 521.5,1133.5C 521.5,1101.83 521.5,1070.17 521.5,1038.5C 491.167,1038.5 460.833,1038.5 430.5,1038.5C 430.5,1070.17 430.5,1101.83 430.5,1133.5C 408.167,1133.5 385.833,1133.5 363.5,1133.5C 363.5,1059.5 363.5,985.5 363.5,911.5C 385.833,911.5 408.167,911.5 430.5,911.5C 430.5,939.5 430.5,967.5 430.5,995.5 Z"/></g>
<g><path style="opacity:1" fill="#e6701a" d="M 1015.5,911.5 C 1041.17,911.5 1066.83,911.5 1092.5,911.5C 1092.83,925.677 1092.5,939.677 1091.5,953.5C 1091.5,939.833 1091.5,926.167 1091.5,912.5C 1065.99,912.831 1040.66,912.498 1015.5,911.5 Z"/></g>
<g><path style="opacity:1" fill="#b9a22c" d="M 1203.5,769.5 C 1198.73,770.889 1193.73,771.556 1188.5,771.5C 1193.27,770.111 1198.27,769.444 1203.5,769.5 Z"/></g>
<g><path style="opacity:1" fill="#988737" d="M 1024.5,748.5 C 1024.5,757.167 1024.5,765.833 1024.5,774.5C 1011.66,774.829 998.989,774.495 986.5,773.5C 998.833,773.5 1011.17,773.5 1023.5,773.5C 1023.17,764.983 1023.51,756.65 1024.5,748.5 Z"/></g>
<g><path style="opacity:1" fill="#baa32d" d="M 1238.5,765.5 C 1233.73,766.889 1228.73,767.556 1223.5,767.5C 1228.27,766.111 1233.27,765.444 1238.5,765.5 Z"/></g>
<g><path style="opacity:1" fill="#b8a130" d="M 1253.5,763.5 C 1248.73,764.889 1243.73,765.556 1238.5,765.5C 1243.27,764.111 1248.27,763.444 1253.5,763.5 Z"/></g>
<g><path style="opacity:1" fill="#ac9735" d="M 826.5,761.5 C 831.731,761.444 836.731,762.111 841.5,763.5C 836.269,763.556 831.269,762.889 826.5,761.5 Z"/></g>
<g><path style="opacity:1" fill="#b9a22c" d="M 1176.5,647.5 C 1171.73,648.889 1166.73,649.556 1161.5,649.5C 1166.27,648.111 1171.27,647.444 1176.5,647.5 Z"/></g>
<g><path style="opacity:1" fill="#fbda01" d="M 983.5,654.5 C 997.323,655.496 1011.32,655.829 1025.5,655.5C 1025.5,661.833 1025.5,668.167 1025.5,674.5C 1025.04,699.165 1024.7,723.831 1024.5,748.5C 1023.51,756.65 1023.17,764.983 1023.5,773.5C 1011.17,773.5 998.833,773.5 986.5,773.5C 977.833,773.5 969.167,773.5 960.5,773.5C 920.652,771.726 880.985,768.392 841.5,763.5C 836.731,762.111 831.731,761.444 826.5,761.5C 810.993,760.249 795.66,757.915 780.5,754.5C 802.618,714.528 830.285,678.695 863.5,647C 884.519,648.068 905.519,649.735 926.5,652C 945.491,653.124 964.491,653.958 983.5,654.5 Z"/></g>
<g><path style="opacity:1" fill="#fbda01" d="M 1098.5,773.5 C 1075.17,773.87 1051.83,774.204 1028.5,774.5C 1028.99,734.83 1029.65,695.163 1030.5,655.5C 1040.19,655.658 1049.86,655.325 1059.5,654.5C 1076.84,654.382 1094.18,653.882 1111.5,653C 1128.16,651.59 1144.82,650.423 1161.5,649.5C 1166.73,649.556 1171.73,648.889 1176.5,647.5C 1181.45,646.441 1186.45,646.274 1191.5,647C 1221.61,676.063 1246.78,708.897 1267,745.5C 1269.07,748.971 1270.57,752.638 1271.5,756.5C 1213.96,764.872 1156.3,770.538 1098.5,773.5 Z"/></g>
<g><path style="opacity:1" fill="#ad9735" d="M 850.5,639.5 C 855.731,639.444 860.731,640.111 865.5,641.5C 860.269,641.556 855.269,640.889 850.5,639.5 Z"/></g>
<g><path style="opacity:1" fill="#fbd902" d="M 1263.5,634.5 C 1266.52,634.335 1269.52,634.502 1272.5,635C 1325.75,656.66 1374.09,685.994 1417.5,723C 1371.42,737.603 1324.42,747.937 1276.5,754C 1255.79,713.918 1229.45,677.918 1197.5,646C 1219.59,642.394 1241.59,638.561 1263.5,634.5 Z"/></g>
<g><path style="opacity:1" fill="#fbd902" d="M 766.5,630.5 C 797.101,636.211 827.768,641.378 858.5,646C 825.615,677.365 798.282,712.865 776.5,752.5C 773.216,753.657 769.882,753.824 766.5,753C 728.415,746.153 690.749,737.486 653.5,727C 646.212,725.183 639.212,722.683 632.5,719.5C 672.762,683.357 717.428,653.691 766.5,630.5 Z"/></g>
<g><path style="opacity:1" fill="#fbd902" d="M 1377.5,606.5 C 1434.46,621.321 1489.13,642.155 1541.5,669C 1504.02,692.16 1464.02,709.493 1421.5,721C 1378.78,684.51 1331.44,655.01 1279.5,632.5C 1297.41,628.021 1315.41,623.855 1333.5,620C 1348.42,615.968 1363.09,611.468 1377.5,606.5 Z"/></g>
<g><path style="opacity:1" fill="#fad903" d="M 668.5,604.5 C 698.469,613.805 728.802,621.972 759.5,629C 711.024,652.888 666.691,682.721 626.5,718.5C 593.94,707.814 562.607,694.314 532.5,678C 525.564,674.06 518.897,669.727 512.5,665C 562.91,640.624 614.91,620.457 668.5,604.5 Z"/></g>
<g><path style="opacity:1" fill="#bea72c" d="M 854.5,567.5 C 847.399,569.228 840.066,570.228 832.5,570.5C 839.601,568.772 846.934,567.772 854.5,567.5 Z"/></g>
<g><path style="opacity:1" fill="#fbd902" d="M 865.5,641.5 C 860.731,640.111 855.731,639.444 850.5,639.5C 792.212,632.844 735.212,620.51 679.5,602.5C 729.694,588.105 780.694,577.439 832.5,570.5C 840.066,570.228 847.399,569.228 854.5,567.5C 1009.26,547.989 1162.93,555.156 1315.5,589C 1334.71,593.22 1353.71,598.22 1372.5,604C 1298.42,626.293 1222.75,640.293 1145.5,646C 1061.81,652.276 978.139,651.943 894.5,645C 884.763,643.996 875.096,642.829 865.5,641.5 Z"/></g>
<g><path style="opacity:1" fill="#38356a" d="M 1021.5,1224.5 C 1022.83,1224.5 1024.17,1224.5 1025.5,1224.5C 1025.17,1234.35 1025.51,1244.01 1026.5,1253.5C 1026.5,1258.83 1026.5,1264.17 1026.5,1269.5C 1107.95,1269.59 1188.95,1275.59 1269.5,1287.5C 1270.88,1288.8 1272.38,1288.8 1274,1287.5C 1274.37,1288.42 1274.87,1289.25 1275.5,1290C 1274.07,1290.47 1272.9,1291.3 1272,1292.5C 1270.99,1291.66 1269.82,1291.33 1268.5,1291.5C 1203.51,1282.06 1138.17,1276.4 1072.5,1274.5C 1057.34,1273.5 1042.01,1273.17 1026.5,1273.5C 1026.17,1282.02 1026.51,1290.35 1027.5,1298.5C 1027.89,1329.83 1028.22,1361.17 1028.5,1392.5C 1080.52,1393.1 1132.35,1396.43 1184,1402.5C 1191.44,1399.25 1197.6,1394.25 1202.5,1387.5C 1203.55,1387.35 1204.55,1387.52 1205.5,1388C 1200.32,1393.01 1195.32,1398.18 1190.5,1403.5C 1191.69,1404.43 1193.02,1404.76 1194.5,1404.5C 1219.19,1407.71 1243.86,1411.04 1268.5,1414.5C 1270.17,1414.5 1271.83,1414.5 1273.5,1414.5C 1273.5,1415.83 1273.5,1417.17 1273.5,1418.5C 1269.66,1417.66 1265.99,1417.66 1262.5,1418.5C 1238.45,1414.83 1214.45,1411.16 1190.5,1407.5C 1185.73,1406.11 1180.73,1405.44 1175.5,1405.5C 1102.68,1397.79 1029.68,1395.29 956.5,1398C 935.15,1399.39 913.817,1400.89 892.5,1402.5C 887.269,1402.44 882.269,1403.11 877.5,1404.5C 873.069,1404.23 868.735,1404.56 864.5,1405.5C 859.269,1405.44 854.269,1406.11 849.5,1407.5C 843.123,1407.79 836.79,1408.46 830.5,1409.5C 828.958,1408.84 827.291,1408.17 825.5,1407.5C 826.602,1406.82 827.602,1406.16 828.5,1405.5C 837.536,1404.72 846.536,1403.56 855.5,1402C 849.63,1396.3 843.964,1390.46 838.5,1384.5C 838.897,1383.47 839.563,1383.31 840.5,1384C 844.5,1388 848.5,1392 852.5,1396C 853.448,1396.48 854.448,1396.65 855.5,1396.5C 857.562,1398.56 859.895,1400.23 862.5,1401.5C 916.315,1395.35 970.315,1392.35 1024.5,1392.5C 1023.8,1358.17 1023.14,1323.83 1022.5,1289.5C 1022.5,1284.17 1022.5,1278.83 1022.5,1273.5C 1004.99,1273.17 987.659,1273.5 970.5,1274.5C 956.79,1274.61 943.123,1275.27 929.5,1276.5C 919.301,1276.43 909.301,1277.1 899.5,1278.5C 895.833,1278.5 892.167,1278.5 888.5,1278.5C 882.729,1279.11 877.396,1278.45 872.5,1276.5C 874.735,1276.79 876.735,1276.46 878.5,1275.5C 915.442,1272.48 952.442,1270.48 989.5,1269.5C 1000.5,1269.5 1011.5,1269.5 1022.5,1269.5C 1022.82,1264.64 1022.49,1259.97 1021.5,1255.5C 1021.5,1245.17 1021.5,1234.83 1021.5,1224.5 Z"/></g>
<g><path style="opacity:1" fill="#d0b623" d="M 929.5,1276.5 C 919.699,1277.9 909.699,1278.57 899.5,1278.5C 909.301,1277.1 919.301,1276.43 929.5,1276.5 Z"/></g>
<g><path style="opacity:1" fill="#fbd902" d="M 1175.5,1405.5 C 1180.27,1406.89 1185.27,1407.56 1190.5,1407.5C 1214.45,1411.16 1238.45,1414.83 1262.5,1418.5C 1297.27,1425.11 1331.6,1433.78 1365.5,1444.5C 1341.6,1452.06 1317.27,1458.23 1292.5,1463C 1147.25,1492.32 1001.25,1497.82 854.5,1479.5C 850.081,1478.03 845.414,1477.36 840.5,1477.5C 788.205,1471.24 736.872,1460.91 686.5,1446.5C 684.594,1445.52 682.594,1444.52 680.5,1443.5C 681.602,1442.82 682.602,1442.16 683.5,1441.5C 728.221,1427.83 773.888,1417.83 820.5,1411.5C 830.4,1410.89 840.066,1409.56 849.5,1407.5C 854.731,1407.56 859.731,1406.89 864.5,1405.5C 868.735,1404.56 873.069,1404.23 877.5,1404.5C 882.731,1404.56 887.731,1403.89 892.5,1402.5C 913.817,1400.89 935.15,1399.39 956.5,1398C 1029.68,1395.29 1102.68,1397.79 1175.5,1405.5 Z"/></g>
<g><path style="opacity:1" fill="#b6a02e" d="M 892.5,1402.5 C 887.731,1403.89 882.731,1404.56 877.5,1404.5C 882.269,1403.11 887.269,1402.44 892.5,1402.5 Z"/></g>
<g><path style="opacity:1" fill="#5b505a" d="M 1175.5,1405.5 C 1180.73,1405.44 1185.73,1406.11 1190.5,1407.5C 1185.27,1407.56 1180.27,1406.89 1175.5,1405.5 Z"/></g>
<g><path style="opacity:1" fill="#b29c31" d="M 864.5,1405.5 C 859.731,1406.89 854.731,1407.56 849.5,1407.5C 854.269,1406.11 859.269,1405.44 864.5,1405.5 Z"/></g>
<g><path style="opacity:1" fill="#c8af27" d="M 849.5,1407.5 C 840.066,1409.56 830.4,1410.89 820.5,1411.5C 823.656,1410.57 826.989,1409.9 830.5,1409.5C 836.79,1408.46 843.123,1407.79 849.5,1407.5 Z"/></g>
<g><path style="opacity:1" fill="#bfa72e" d="M 683.5,1441.5 C 682.602,1442.16 681.602,1442.82 680.5,1443.5C 682.594,1444.52 684.594,1445.52 686.5,1446.5C 682.926,1446.31 679.593,1445.31 676.5,1443.5C 678.608,1442.06 680.941,1441.39 683.5,1441.5 Z"/></g>
<g><path style="opacity:1" fill="#c1a92c" d="M 840.5,1477.5 C 845.414,1477.36 850.081,1478.03 854.5,1479.5C 849.586,1479.64 844.919,1478.97 840.5,1477.5 Z"/></g>
<g><path style="opacity:1" fill="#c2a92b" d="M 1213.5,1481.5 C 1208.73,1482.89 1203.73,1483.56 1198.5,1483.5C 1203.27,1482.11 1208.27,1481.44 1213.5,1481.5 Z"/></g>
<g><path style="opacity:1" fill="#bca52b" d="M 1189.5,1484.5 C 1184.73,1485.89 1179.73,1486.56 1174.5,1486.5C 1179.27,1485.11 1184.27,1484.44 1189.5,1484.5 Z"/></g>
<g><path style="opacity:1" fill="#3e3868" d="M 1470.5,1498.5 C 1469.13,1498.14 1468.13,1497.31 1467.5,1496C 1466.69,1493.24 1465.69,1490.57 1464.5,1488C 1460.7,1487.88 1457.36,1489.05 1454.5,1491.5C 1457.93,1501.3 1461.27,1511.13 1464.5,1521C 1464.16,1522.03 1463.5,1522.53 1462.5,1522.5C 1459.38,1511.79 1456.04,1501.12 1452.5,1490.5C 1452.83,1489.83 1453.17,1489.17 1453.5,1488.5C 1457.17,1487.17 1460.83,1485.83 1464.5,1484.5C 1467.06,1488.84 1469.06,1493.51 1470.5,1498.5 Z"/></g>
<g><path style="opacity:1" fill="#2d2f6e" d="M 574.5,1571.5 C 572.388,1569.66 570.054,1567.99 567.5,1566.5C 571.86,1555.43 575.193,1544.09 577.5,1532.5C 578.497,1532.53 579.164,1532.03 579.5,1531C 582.575,1522.44 585.241,1513.78 587.5,1505C 587.167,1503.83 586.833,1502.67 586.5,1501.5C 579.843,1499.17 573.177,1496.84 566.5,1494.5C 567.123,1491.88 567.123,1489.21 566.5,1486.5C 566.47,1485.5 566.97,1484.84 568,1484.5C 587.463,1491.27 606.963,1497.93 626.5,1504.5C 627.023,1507.51 626.523,1510.51 625,1513.5C 624.481,1514.52 623.647,1515.18 622.5,1515.5C 614.875,1512.96 607.208,1510.62 599.5,1508.5C 592.975,1529.57 586.142,1550.57 579,1571.5C 577.384,1572.8 575.884,1572.8 574.5,1571.5 Z"/></g>
<g><path style="opacity:1" fill="#2d2f6e" d="M 1470.5,1498.5 C 1470.5,1498.83 1470.5,1499.17 1470.5,1499.5C 1475.37,1519.63 1481.37,1539.46 1488.5,1559C 1487.57,1560.08 1486.9,1561.24 1486.5,1562.5C 1483.51,1564.07 1480.51,1564.74 1477.5,1564.5C 1474.23,1555.2 1471.07,1545.87 1468,1536.5C 1467.65,1534.82 1466.65,1533.82 1465,1533.5C 1454.5,1537 1444,1540.5 1433.5,1544C 1432.24,1544.42 1431.58,1545.25 1431.5,1546.5C 1430.78,1546.08 1430.28,1545.42 1430,1544.5C 1432.13,1555.24 1435.3,1565.74 1439.5,1576C 1438.75,1576.67 1438.41,1577.5 1438.5,1578.5C 1435.01,1580.11 1431.35,1581.11 1427.5,1581.5C 1419.77,1556.31 1411.44,1531.31 1402.5,1506.5C 1406.43,1504.35 1410.6,1502.69 1415,1501.5C 1420.3,1511.56 1424.13,1522.23 1426.5,1533.5C 1438.37,1529.43 1450.37,1525.76 1462.5,1522.5C 1463.5,1522.53 1464.16,1522.03 1464.5,1521C 1461.27,1511.13 1457.93,1501.3 1454.5,1491.5C 1457.36,1489.05 1460.7,1487.88 1464.5,1488C 1465.69,1490.57 1466.69,1493.24 1467.5,1496C 1468.13,1497.31 1469.13,1498.14 1470.5,1498.5 Z"/></g>
<g><path style="opacity:1" fill="#3e3868" d="M 566.5,1486.5 C 567.123,1489.21 567.123,1491.88 566.5,1494.5C 573.177,1496.84 579.843,1499.17 586.5,1501.5C 586.833,1502.67 587.167,1503.83 587.5,1505C 585.241,1513.78 582.575,1522.44 579.5,1531C 579.164,1532.03 578.497,1532.53 577.5,1532.5C 580.092,1523.06 583.092,1513.72 586.5,1504.5C 579.318,1501.38 571.985,1498.55 564.5,1496C 563.798,1492.59 564.465,1489.42 566.5,1486.5 Z"/></g>
<g><path style="opacity:1" fill="#4a4064" d="M 1470.5,1499.5 C 1477.67,1519.66 1484.67,1539.99 1491.5,1560.5C 1489.98,1561.56 1488.31,1562.23 1486.5,1562.5C 1486.9,1561.24 1487.57,1560.08 1488.5,1559C 1481.37,1539.46 1475.37,1519.63 1470.5,1499.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 639.5,1508.5 C 653.042,1511.63 666.375,1515.46 679.5,1520C 692.87,1530.74 695.037,1543.58 686,1558.5C 678.068,1568.12 667.901,1571.29 655.5,1568C 650.446,1566.49 645.446,1565.15 640.5,1564C 637.78,1572.38 635.446,1580.88 633.5,1589.5C 629.453,1588.98 625.453,1588.15 621.5,1587C 620.484,1586.48 619.818,1585.65 619.5,1584.5C 626.489,1559.21 633.156,1533.87 639.5,1508.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1384.5,1510.5 C 1385.5,1510.5 1386.5,1510.5 1387.5,1510.5C 1394,1536.48 1400.16,1562.48 1406,1588.5C 1401.91,1589.9 1397.74,1590.73 1393.5,1591C 1377.31,1576.65 1360.98,1562.48 1344.5,1548.5C 1344.17,1549 1343.83,1549.5 1343.5,1550C 1348.41,1567.05 1352.74,1584.21 1356.5,1601.5C 1351.83,1602.5 1347.17,1603.5 1342.5,1604.5C 1336,1578.5 1329.83,1552.5 1324,1526.5C 1327.62,1525.29 1331.28,1524.29 1335,1523.5C 1352,1538.17 1369,1552.83 1386,1567.5C 1382.71,1549.85 1378.55,1532.35 1373.5,1515C 1373.91,1514.05 1374.57,1513.39 1375.5,1513C 1378.74,1512.59 1381.74,1511.76 1384.5,1510.5 Z"/></g>
<g><path style="opacity:1" fill="#35336b" d="M 849.5,1522.5 C 852.976,1521.36 856.642,1521.19 860.5,1522C 863.167,1527 865.833,1532 868.5,1537C 865.442,1537.46 862.442,1537.12 859.5,1536C 856.024,1531.52 852.69,1527.02 849.5,1522.5 Z"/></g>
<g><path style="opacity:1" fill="#f5d40b" d="M 650.5,1524.5 C 656.902,1525.52 663.235,1527.02 669.5,1529C 675.364,1532.57 677.53,1537.73 676,1544.5C 674.311,1552.36 669.478,1556.36 661.5,1556.5C 655.73,1555.64 650.064,1554.31 644.5,1552.5C 644.167,1552 643.833,1551.5 643.5,1551C 646.072,1542.21 648.405,1533.38 650.5,1524.5 Z"/></g>
<g><path style="opacity:1" fill="#32326c" d="M 1143.5,1527.5 C 1146.57,1527.18 1149.57,1527.52 1152.5,1528.5C 1149.33,1534.17 1146.17,1539.83 1143,1545.5C 1139.54,1546.79 1136.04,1546.79 1132.5,1545.5C 1134.57,1540.13 1136.74,1534.79 1139,1529.5C 1140.62,1528.9 1142.12,1528.23 1143.5,1527.5 Z"/></g>
<g><path style="opacity:1" fill="#2b2e6e" d="M 1306.5,1601.5 C 1306.5,1600.83 1306.5,1600.17 1306.5,1599.5C 1303.28,1578.38 1299.28,1557.38 1294.5,1536.5C 1294.82,1535.35 1295.48,1534.52 1296.5,1534C 1299.37,1532.72 1302.2,1532.56 1305,1533.5C 1309.92,1558.09 1315.08,1582.59 1320.5,1607C 1317.01,1608.62 1313.35,1609.46 1309.5,1609.5C 1309.69,1606.19 1308.69,1603.52 1306.5,1601.5 Z"/></g>
<g><path style="opacity:1" fill="#453c65" d="M 577.5,1532.5 C 575.193,1544.09 571.86,1555.43 567.5,1566.5C 570.054,1567.99 572.388,1569.66 574.5,1571.5C 571.689,1571.17 569.022,1570.34 566.5,1569C 565.941,1568.28 565.608,1567.44 565.5,1566.5C 568.938,1554.85 572.938,1543.51 577.5,1532.5 Z"/></g>
<g><path style="opacity:1" fill="#35336b" d="M 879.5,1533.5 C 883.163,1533.95 886.83,1534.45 890.5,1535C 894.833,1539.33 899.167,1543.67 903.5,1548C 899.449,1548.52 895.449,1548.18 891.5,1547C 889.689,1544.02 887.356,1541.52 884.5,1539.5C 881.696,1541.14 879.029,1542.97 876.5,1545C 872.459,1545.83 868.459,1545.66 864.5,1544.5C 869.745,1541.06 874.745,1537.39 879.5,1533.5 Z"/></g>
<g><path style="opacity:1" fill="#2d2f6e" d="M 1248.5,1622.5 C 1245.55,1623.01 1242.72,1623.01 1240,1622.5C 1230.82,1606.81 1221.66,1591.14 1212.5,1575.5C 1213.17,1571.32 1211.67,1569.99 1208,1571.5C 1209.89,1588.87 1212.39,1606.21 1215.5,1623.5C 1215.39,1624.44 1215.06,1625.28 1214.5,1626C 1212.26,1626.05 1210.59,1626.88 1209.5,1628.5C 1207.86,1628.29 1206.36,1628.62 1205,1629.5C 1200.04,1602.98 1195.88,1576.31 1192.5,1549.5C 1196.98,1548.79 1201.48,1548.12 1206,1547.5C 1208.03,1547.35 1209.7,1548.02 1211,1549.5C 1221.01,1566.87 1231.51,1583.87 1242.5,1600.5C 1246.05,1587.9 1249.38,1575.24 1252.5,1562.5C 1253.6,1561 1254.6,1559.34 1255.5,1557.5C 1256.58,1552.42 1257.91,1547.42 1259.5,1542.5C 1263.08,1540.81 1266.91,1539.81 1271,1539.5C 1272.11,1539.59 1273.11,1539.92 1274,1540.5C 1278.05,1565.48 1281.88,1590.48 1285.5,1615.5C 1282.14,1615.62 1278.81,1615.95 1275.5,1616.5C 1272.96,1599.85 1270.46,1583.19 1268,1566.5C 1267.73,1562.87 1266.06,1561.87 1263,1563.5C 1258.28,1583.68 1253.45,1603.35 1248.5,1622.5 Z"/></g>
<g><path style="opacity:1" fill="#2c2f6e" d="M 777.5,1540.5 C 779.308,1541.92 779.975,1543.92 779.5,1546.5C 777.523,1555.7 776.189,1565.04 775.5,1574.5C 787.153,1576.26 798.819,1577.93 810.5,1579.5C 811.568,1580.43 812.901,1580.77 814.5,1580.5C 815.672,1570.13 817.172,1559.79 819,1549.5C 822.418,1548.73 825.918,1548.73 829.5,1549.5C 825.646,1574.81 821.98,1600.14 818.5,1625.5C 814.821,1625.28 811.154,1624.94 807.5,1624.5C 809.334,1613.17 810.834,1601.83 812,1590.5C 811.667,1591.5 811.333,1592.5 811,1593.5C 810.722,1592.58 810.222,1591.92 809.5,1591.5C 806.455,1591.49 803.455,1591.16 800.5,1590.5C 798.821,1589.06 796.821,1588.06 794.5,1587.5C 787.189,1586.11 779.856,1585.28 772.5,1585C 769.903,1595.66 767.903,1606.49 766.5,1617.5C 762.812,1617.22 759.145,1616.72 755.5,1616C 759.822,1590.92 763.822,1565.75 767.5,1540.5C 770.833,1540.5 774.167,1540.5 777.5,1540.5 Z"/></g>
<g><path style="opacity:1" fill="#463d65" d="M 1431.5,1546.5 C 1434.92,1556.27 1438.26,1566.1 1441.5,1576C 1441.25,1577.75 1440.25,1578.58 1438.5,1578.5C 1438.41,1577.5 1438.75,1576.67 1439.5,1576C 1435.3,1565.74 1432.13,1555.24 1430,1544.5C 1430.28,1545.42 1430.78,1546.08 1431.5,1546.5 Z"/></g>
<g><path style="opacity:1" fill="#9f8c39" d="M 777.5,1540.5 C 777.5,1540.17 777.5,1539.83 777.5,1539.5C 778.5,1539.5 779.5,1539.5 780.5,1539.5C 780.802,1542.06 780.468,1544.39 779.5,1546.5C 779.975,1543.92 779.308,1541.92 777.5,1540.5 Z"/></g>
<g><path style="opacity:1" fill="#3d3868" d="M 1248.5,1622.5 C 1253.45,1603.35 1258.28,1583.68 1263,1563.5C 1266.06,1561.87 1267.73,1562.87 1268,1566.5C 1270.46,1583.19 1272.96,1599.85 1275.5,1616.5C 1278.81,1615.95 1282.14,1615.62 1285.5,1615.5C 1281.88,1590.48 1278.05,1565.48 1274,1540.5C 1273.11,1539.92 1272.11,1539.59 1271,1539.5C 1266.91,1539.81 1263.08,1540.81 1259.5,1542.5C 1257.91,1547.42 1256.58,1552.42 1255.5,1557.5C 1254.6,1559.34 1253.6,1561 1252.5,1562.5C 1254.32,1554.87 1255.99,1547.21 1257.5,1539.5C 1263.75,1538.11 1270.08,1537.44 1276.5,1537.5C 1280.07,1563.84 1283.74,1590.18 1287.5,1616.5C 1283.65,1617.03 1279.82,1617.69 1276,1618.5C 1275.05,1618.09 1274.39,1617.43 1274,1616.5C 1271.63,1598.97 1268.63,1581.64 1265,1564.5C 1259.55,1583.63 1255.05,1602.96 1251.5,1622.5C 1250.5,1622.5 1249.5,1622.5 1248.5,1622.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 871.5,1552.5 C 903.481,1551.31 918.314,1566.65 916,1598.5C 912.572,1624.6 897.739,1636.76 871.5,1635C 855.795,1630.63 846.295,1620.46 843,1604.5C 840.167,1587.31 844.667,1572.47 856.5,1560C 861.045,1556.39 866.045,1553.89 871.5,1552.5 Z"/></g>
<g><path style="opacity:1" fill="#2f306d" d="M 1131.5,1554.5 C 1136.17,1554.5 1140.83,1554.5 1145.5,1554.5C 1147.83,1581.17 1150.17,1607.83 1152.5,1634.5C 1147.51,1634.92 1142.51,1635.25 1137.5,1635.5C 1135.55,1608.5 1133.55,1581.5 1131.5,1554.5 Z"/></g>
<g><path style="opacity:1" fill="#393669" d="M 1306.5,1601.5 C 1308.69,1603.52 1309.69,1606.19 1309.5,1609.5C 1313.35,1609.46 1317.01,1608.62 1320.5,1607C 1315.08,1582.59 1309.92,1558.09 1305,1533.5C 1302.2,1532.56 1299.37,1532.72 1296.5,1534C 1295.48,1534.52 1294.82,1535.35 1294.5,1536.5C 1299.28,1557.38 1303.28,1578.38 1306.5,1599.5C 1301.31,1577.4 1296.64,1555.06 1292.5,1532.5C 1297.12,1531.51 1301.78,1530.85 1306.5,1530.5C 1311.83,1556.83 1317.17,1583.17 1322.5,1609.5C 1317.85,1610.47 1313.19,1610.97 1308.5,1611C 1307.39,1607.95 1306.72,1604.78 1306.5,1601.5 Z"/></g>
<g><path style="opacity:1" fill="#30306d" d="M 1099.5,1557.5 C 1104.17,1557.5 1108.83,1557.5 1113.5,1557.5C 1113.26,1558.79 1113.6,1559.79 1114.5,1560.5C 1115.29,1586.18 1116.29,1611.84 1117.5,1637.5C 1113.83,1637.5 1110.17,1637.5 1106.5,1637.5C 1105.5,1637.5 1104.5,1637.5 1103.5,1637.5C 1103.78,1635.59 1103.45,1633.92 1102.5,1632.5C 1102.26,1623.16 1101.92,1613.83 1101.5,1604.5C 1094.5,1604.5 1087.5,1604.5 1080.5,1604.5C 1074.83,1604.5 1069.17,1604.5 1063.5,1604.5C 1063.19,1608.04 1063.52,1611.38 1064.5,1614.5C 1064.5,1620.5 1064.5,1626.5 1064.5,1632.5C 1064.5,1634.83 1064.5,1637.17 1064.5,1639.5C 1061.29,1639.19 1058.29,1639.52 1055.5,1640.5C 1053.83,1640.5 1052.17,1640.5 1050.5,1640.5C 1049.68,1613.49 1048.68,1586.49 1047.5,1559.5C 1052.17,1559.5 1056.83,1559.5 1061.5,1559.5C 1061.91,1565.16 1062.24,1570.83 1062.5,1576.5C 1062.5,1582.17 1062.5,1587.83 1062.5,1593.5C 1066.37,1593.81 1070.04,1593.48 1073.5,1592.5C 1082.5,1592.5 1091.5,1592.5 1100.5,1592.5C 1100.44,1580.82 1100.11,1569.16 1099.5,1557.5 Z"/></g>
<g><path style="opacity:1" fill="#938339" d="M 1099.5,1557.5 C 1104.31,1556.51 1109.31,1556.18 1114.5,1556.5C 1114.5,1557.83 1114.5,1559.17 1114.5,1560.5C 1113.6,1559.79 1113.26,1558.79 1113.5,1557.5C 1108.83,1557.5 1104.17,1557.5 1099.5,1557.5 Z"/></g>
<g><path style="opacity:1" fill="#30316d" d="M 1017.5,1614.5 C 1022.17,1614.5 1026.83,1614.5 1031.5,1614.5C 1031.5,1615.83 1031.5,1617.17 1031.5,1618.5C 1025.73,1633.74 1014.56,1641.4 998,1641.5C 973.074,1638.56 960.908,1624.39 961.5,1599C 962.792,1571.37 977.125,1558.03 1004.5,1559C 1020.82,1561.82 1030.16,1571.32 1032.5,1587.5C 1027.82,1587.67 1023.15,1587.5 1018.5,1587C 1014.44,1574.4 1005.78,1569.4 992.5,1572C 984.507,1575.33 979.341,1581.16 977,1589.5C 976.333,1596.17 976.333,1602.83 977,1609.5C 981.172,1625 991.005,1630.83 1006.5,1627C 1012.14,1624.53 1015.81,1620.36 1017.5,1614.5 Z"/></g>
<g><path style="opacity:1" fill="#f8d707" d="M 873.5,1565.5 C 894.538,1565.04 904.038,1575.38 902,1596.5C 900.247,1613.93 890.747,1622.43 873.5,1622C 863.622,1618.77 858.122,1611.93 857,1601.5C 855.112,1588.83 858.612,1578 867.5,1569C 869.727,1568.06 871.727,1566.89 873.5,1565.5 Z"/></g>
<g><path style="opacity:1" fill="#3f3967" d="M 1212.5,1575.5 C 1211.69,1574.57 1210.85,1573.57 1210,1572.5C 1209.83,1573.33 1209.67,1574.17 1209.5,1575C 1212.96,1592.39 1215.63,1609.89 1217.5,1627.5C 1214.83,1627.83 1212.17,1628.17 1209.5,1628.5C 1210.59,1626.88 1212.26,1626.05 1214.5,1626C 1215.06,1625.28 1215.39,1624.44 1215.5,1623.5C 1212.39,1606.21 1209.89,1588.87 1208,1571.5C 1211.67,1569.99 1213.17,1571.32 1212.5,1575.5 Z"/></g>
<g><path style="opacity:1" fill="#3e3868" d="M 777.5,1539.5 C 777.5,1539.83 777.5,1540.17 777.5,1540.5C 774.167,1540.5 770.833,1540.5 767.5,1540.5C 763.822,1565.75 759.822,1590.92 755.5,1616C 759.145,1616.72 762.812,1617.22 766.5,1617.5C 767.903,1606.49 769.903,1595.66 772.5,1585C 779.856,1585.28 787.189,1586.11 794.5,1587.5C 796.821,1588.06 798.821,1589.06 800.5,1590.5C 791.198,1588.95 781.865,1587.62 772.5,1586.5C 771.058,1597.49 769.724,1608.49 768.5,1619.5C 764.766,1619.68 761.099,1619.34 757.5,1618.5C 756.791,1617.6 755.791,1617.26 754.5,1617.5C 754.5,1616.17 754.5,1614.83 754.5,1613.5C 758.058,1588.48 761.725,1563.48 765.5,1538.5C 769.5,1538.83 773.5,1539.17 777.5,1539.5 Z"/></g>
<g><path style="opacity:1" fill="#32316c" d="M 696.5,1589.5 C 704.472,1589.64 707.972,1593.64 707,1601.5C 704.103,1606.15 699.937,1607.65 694.5,1606C 688.674,1599.62 689.341,1594.12 696.5,1589.5 Z"/></g>
<g><path style="opacity:1" fill="#948439" d="M 1062.5,1576.5 C 1063.49,1581.64 1063.82,1586.97 1063.5,1592.5C 1066.83,1592.5 1070.17,1592.5 1073.5,1592.5C 1070.04,1593.48 1066.37,1593.81 1062.5,1593.5C 1062.5,1587.83 1062.5,1582.17 1062.5,1576.5 Z"/></g>
<g><path style="opacity:1" fill="#3b3769" d="M 820.5,1622.5 C 820.028,1624.53 819.028,1626.2 817.5,1627.5C 813.481,1627.35 809.481,1627.02 805.5,1626.5C 806.833,1614.83 808.167,1603.17 809.5,1591.5C 810.222,1591.92 810.722,1592.58 811,1593.5C 811.333,1592.5 811.667,1591.5 812,1590.5C 810.834,1601.83 809.334,1613.17 807.5,1624.5C 811.154,1624.94 814.821,1625.28 818.5,1625.5C 821.98,1600.14 825.646,1574.81 829.5,1549.5C 825.918,1548.73 822.418,1548.73 819,1549.5C 817.172,1559.79 815.672,1570.13 814.5,1580.5C 812.901,1580.77 811.568,1580.43 810.5,1579.5C 811.649,1579.21 812.316,1578.38 812.5,1577C 814.007,1567.12 815.674,1557.29 817.5,1547.5C 822.087,1547.11 826.754,1547.11 831.5,1547.5C 827.927,1572.51 824.26,1597.51 820.5,1622.5 Z"/></g>
<g><path style="opacity:1" fill="#857841" d="M 1017.5,1614.5 C 1022.31,1613.51 1027.31,1613.18 1032.5,1613.5C 1032.78,1615.41 1032.45,1617.08 1031.5,1618.5C 1031.5,1617.17 1031.5,1615.83 1031.5,1614.5C 1026.83,1614.5 1022.17,1614.5 1017.5,1614.5 Z"/></g>
<g><path style="opacity:1" fill="#7e7145" d="M 1080.5,1604.5 C 1075.36,1605.49 1070.03,1605.82 1064.5,1605.5C 1064.5,1608.5 1064.5,1611.5 1064.5,1614.5C 1063.52,1611.38 1063.19,1608.04 1063.5,1604.5C 1069.17,1604.5 1074.83,1604.5 1080.5,1604.5 Z"/></g>
<g><path style="opacity:1" fill="#72664b" d="M 754.5,1613.5 C 754.5,1614.83 754.5,1616.17 754.5,1617.5C 755.791,1617.26 756.791,1617.6 757.5,1618.5C 756.167,1618.5 754.833,1618.5 753.5,1618.5C 753.216,1616.59 753.549,1614.92 754.5,1613.5 Z"/></g>
<g><path style="opacity:1" fill="#a79335" d="M 820.5,1622.5 C 820.5,1624.5 820.5,1626.5 820.5,1628.5C 819.209,1628.74 818.209,1628.4 817.5,1627.5C 819.028,1626.2 820.028,1624.53 820.5,1622.5 Z"/></g>
<g><path style="opacity:1" fill="#675e50" d="M 1102.5,1632.5 C 1103.45,1633.92 1103.78,1635.59 1103.5,1637.5C 1104.5,1637.5 1105.5,1637.5 1106.5,1637.5C 1105.43,1638.43 1104.1,1638.77 1102.5,1638.5C 1102.5,1636.5 1102.5,1634.5 1102.5,1632.5 Z"/></g>
<g><path style="opacity:1" fill="#857840" d="M 1064.5,1632.5 C 1065.47,1634.95 1065.81,1637.61 1065.5,1640.5C 1062.17,1640.5 1058.83,1640.5 1055.5,1640.5C 1058.29,1639.52 1061.29,1639.19 1064.5,1639.5C 1064.5,1637.17 1064.5,1634.83 1064.5,1632.5 Z"/></g>
</svg>
</file>

<file path="scripts/createAdmin.js">
// scripts/createAdmin.js
import admin from 'firebase-admin';
import { readFileSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// ====================================
// INITIALIZE FIREBASE ADMIN SDK
// ====================================
const serviceAccount = JSON.parse(
  readFileSync(join(__dirname, 'serviceAccountKey.json'), 'utf8')
);

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: `https://${serviceAccount.project_id}.firebaseio.com`
});

const db = admin.firestore();
const auth = admin.auth();

// ====================================
// CONFIG - THAY I THNG TIN NY
// ====================================
const ADMIN_CONFIG = {
  uid: 'nxd50HYmtQXkaezI4c8b1bkhDug2', // UID t Firebase Auth
  email: 'admin@huflit.edu.vn',          //  THAY email tht ca bn
  password: 'Admin@123456',            //  THAY password mnh
  displayName: 'Super Admin',
  role: 'super_admin',
  permissions: [
    'manage_users',
    'manage_exams',
    'manage_grammar',
    'manage_vocabulary',
    'view_logs',
    'manage_admins'
  ],
  status: 'active',
  disabled: false
};

// ====================================
// MAIN FUNCTION
// ====================================
async function createSuperAdmin() {
  try {
    console.log(' Starting admin creation process...\n');

    // ====================================
    // 1. Check if user exists in Auth
    // ====================================
    let userExists = false;
    try {
      const existingUser = await auth.getUser(ADMIN_CONFIG.uid);
      userExists = true;
      console.log(' User already exists in Firebase Auth');
      console.log(`   Current email: ${existingUser.email}`);
    } catch (error) {
      if (error.code === 'auth/user-not-found') {
        console.log(' User not found, will create new user');
      } else {
        throw error;
      }
    }

    // ====================================
    // 2. Create or Update Auth User
    // ====================================
    if (!userExists) {
      console.log(' Creating Firebase Auth user...');
      
      await auth.createUser({
        uid: ADMIN_CONFIG.uid,
        email: ADMIN_CONFIG.email,
        password: ADMIN_CONFIG.password,
        displayName: ADMIN_CONFIG.displayName,
        emailVerified: true,
        disabled: false
      });
      
      console.log(' Firebase Auth user created');
      console.log(`    Email: ${ADMIN_CONFIG.email}`);
      console.log(`    UID: ${ADMIN_CONFIG.uid}`);
    } else {
      console.log(' Updating existing Firebase Auth user...');
      
      await auth.updateUser(ADMIN_CONFIG.uid, {
        email: ADMIN_CONFIG.email,
        displayName: ADMIN_CONFIG.displayName,
        emailVerified: true,
        disabled: false,
        password: ADMIN_CONFIG.password
      });
      
      console.log(' Firebase Auth user updated');
      console.log(' Password updated');
    }

    // ====================================
    // 3. Create Admin Document in Firestore
    // ====================================
    console.log('\n Creating admin document in Firestore...');
    
    const adminData = {
      email: ADMIN_CONFIG.email,
      role: ADMIN_CONFIG.role,
      permissions: ADMIN_CONFIG.permissions,
      status: ADMIN_CONFIG.status,
      disabled: ADMIN_CONFIG.disabled,
      createdAt: admin.firestore.FieldValue.serverTimestamp(),
      createdBy: 'script',
      updatedAt: admin.firestore.FieldValue.serverTimestamp()
    };

    await db.collection('admin_accounts').doc(ADMIN_CONFIG.uid).set(adminData, { merge: true });
    
    console.log(' Admin document created in Firestore');
    console.log(`    Collection: admin_accounts`);
    console.log(`    Document ID: ${ADMIN_CONFIG.uid}`);

    // ====================================
    // 4. Set Custom Claims (Optional)
    // ====================================
    console.log('\n Setting custom claims...');
    
    await auth.setCustomUserClaims(ADMIN_CONFIG.uid, {
      admin: true,
      role: ADMIN_CONFIG.role,
      permissions: ADMIN_CONFIG.permissions
    });
    
    console.log(' Custom claims set');

    // ====================================
    // 5. Verify creation
    // ====================================
    console.log('\n Verifying...');
    
    const adminDoc = await db.collection('admin_accounts').doc(ADMIN_CONFIG.uid).get();
    if (adminDoc.exists) {
      console.log(' Admin document verified in Firestore');
    }
    
    const userRecord = await auth.getUser(ADMIN_CONFIG.uid);
    console.log(' Auth user verified');
    console.log(`   Email verified: ${userRecord.emailVerified}`);

    // ====================================
    // 6. Summary
    // ====================================
    console.log('\n' + '='.repeat(60));
    console.log(' SUPER ADMIN CREATED SUCCESSFULLY!');
    console.log('='.repeat(60));
    console.log('\n Admin Details:');
    console.log(`   Email:       ${ADMIN_CONFIG.email}`);
    console.log(`   Password:    ${ADMIN_CONFIG.password}`);
    console.log(`   UID:         ${ADMIN_CONFIG.uid}`);
    console.log(`   Role:        ${ADMIN_CONFIG.role}`);
    console.log(`   Status:      ${ADMIN_CONFIG.status}`);
    console.log(`   Permissions: ${ADMIN_CONFIG.permissions.join(', ')}`);
    console.log('\n Next Steps:');
    console.log('   1. Go to: http://localhost:5173/admin/login');
    console.log(`   2. Login with: ${ADMIN_CONFIG.email}`);
    console.log(`   3. Password: ${ADMIN_CONFIG.password}`);
    console.log('\n  IMPORTANT:');
    console.log('   - Change password after first login!');
    console.log('   - Delete /admin/setup route from AdminApp.jsx');
    console.log('   - Keep serviceAccountKey.json secure (already in .gitignore)');
    console.log('='.repeat(60) + '\n');

    process.exit(0);
  } catch (error) {
    console.error('\n ERROR:', error.message);
    if (error.code) {
      console.error(`   Error code: ${error.code}`);
    }
    console.error('\n Troubleshooting:');
    console.error('   1. Check if serviceAccountKey.json is valid');
    console.error('   2. Check Firebase project permissions');
    console.error('   3. Make sure UID format is correct');
    console.error('\nFull error:', error);
    process.exit(1);
  }
}

// ====================================
// RUN SCRIPT
// ====================================
console.log(' Firebase Admin Script');
console.log(' Project: huflit-test-4ce25\n');

createSuperAdmin();
</file>

<file path="scripts/createFirstAdmin.js">
// scripts/createAdmin.js
import admin from 'firebase-admin';
import { readFileSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';
import dotenv from 'dotenv';

// Load env
dotenv.config();

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// ====================================
// INITIALIZE FIREBASE ADMIN SDK
// ====================================
const serviceAccount = JSON.parse(
  readFileSync(join(__dirname, 'serviceAccountKey.json'), 'utf8')
);

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: `https://${serviceAccount.project_id}.firebaseio.com`
});

const db = admin.firestore();
const auth = admin.auth();

// ====================================
// CONFIG - THAY I THNG TIN NY
// ====================================
const ADMIN_CONFIG = {
  uid: 'nxd50HYmtQXkaezI4c8b1bkhDug2', // UID t Firebase Auth
  email: 'admin@huflit.edu.vn',          //  THAY email tht
  password: 'Admin@123456',            //  THAY password mnh
  displayName: 'Super Admin',
  role: 'super_admin',
  permissions: [
    'manage_users',
    'manage_exams',
    'manage_grammar',
    'manage_vocabulary',
    'view_logs',
    'manage_admins'
  ],
  status: 'active',
  disabled: false
};

// ====================================
// MAIN FUNCTION
// ====================================
async function createSuperAdmin() {
  try {
    console.log(' Starting admin creation process...\n');

    // ====================================
    // 1. Check if user exists in Auth
    // ====================================
    let userExists = false;
    try {
      await auth.getUser(ADMIN_CONFIG.uid);
      userExists = true;
      console.log(' User already exists in Firebase Auth');
    } catch (error) {
      if (error.code === 'auth/user-not-found') {
        console.log(' User not found, will create new user');
      } else {
        throw error;
      }
    }

    // ====================================
    // 2. Create or Update Auth User
    // ====================================
    if (!userExists) {
      console.log(' Creating Firebase Auth user...');
      
      await auth.createUser({
        uid: ADMIN_CONFIG.uid,
        email: ADMIN_CONFIG.email,
        password: ADMIN_CONFIG.password,
        displayName: ADMIN_CONFIG.displayName,
        emailVerified: true,
        disabled: false
      });
      
      console.log(' Firebase Auth user created');
      console.log(`    Email: ${ADMIN_CONFIG.email}`);
      console.log(`    UID: ${ADMIN_CONFIG.uid}`);
    } else {
      console.log(' Updating existing Firebase Auth user...');
      
      await auth.updateUser(ADMIN_CONFIG.uid, {
        email: ADMIN_CONFIG.email,
        displayName: ADMIN_CONFIG.displayName,
        emailVerified: true,
        disabled: false
      });
      
      // Update password if needed
      if (ADMIN_CONFIG.password) {
        await auth.updateUser(ADMIN_CONFIG.uid, {
          password: ADMIN_CONFIG.password
        });
        console.log(' Password updated');
      }
      
      console.log(' Firebase Auth user updated');
    }

    // ====================================
    // 3. Create Admin Document in Firestore
    // ====================================
    console.log('\n Creating admin document in Firestore...');
    
    const adminData = {
      email: ADMIN_CONFIG.email,
      role: ADMIN_CONFIG.role,
      permissions: ADMIN_CONFIG.permissions,
      status: ADMIN_CONFIG.status,
      disabled: ADMIN_CONFIG.disabled,
      createdAt: admin.firestore.FieldValue.serverTimestamp(),
      createdBy: 'script',
      updatedAt: admin.firestore.FieldValue.serverTimestamp()
    };

    await db.collection('admin_accounts').doc(ADMIN_CONFIG.uid).set(adminData);
    
    console.log(' Admin document created in Firestore');
    console.log(`    Collection: admin_accounts`);
    console.log(`    Document ID: ${ADMIN_CONFIG.uid}`);

    // ====================================
    // 4. Set Custom Claims (Optional)
    // ====================================
    console.log('\n Setting custom claims...');
    
    await auth.setCustomUserClaims(ADMIN_CONFIG.uid, {
      admin: true,
      role: ADMIN_CONFIG.role,
      permissions: ADMIN_CONFIG.permissions
    });
    
    console.log(' Custom claims set');

    // ====================================
    // 5. Summary
    // ====================================
    console.log('\n' + '='.repeat(60));
    console.log(' SUPER ADMIN CREATED SUCCESSFULLY!');
    console.log('='.repeat(60));
    console.log('\n Admin Details:');
    console.log(`   Email:       ${ADMIN_CONFIG.email}`);
    console.log(`   Password:    ${ADMIN_CONFIG.password}`);
    console.log(`   UID:         ${ADMIN_CONFIG.uid}`);
    console.log(`   Role:        ${ADMIN_CONFIG.role}`);
    console.log(`   Status:      ${ADMIN_CONFIG.status}`);
    console.log(`   Permissions: ${ADMIN_CONFIG.permissions.join(', ')}`);
    console.log('\n Next Steps:');
    console.log('   1. Go to: http://localhost:5173/admin/login');
    console.log(`   2. Login with: ${ADMIN_CONFIG.email}`);
    console.log(`   3. Password: ${ADMIN_CONFIG.password}`);
    console.log('\n  IMPORTANT: Change password after first login!');
    console.log('='.repeat(60) + '\n');

    process.exit(0);
  } catch (error) {
    console.error('\n ERROR:', error.message);
    console.error('\nFull error:', error);
    process.exit(1);
  }
}

// ====================================
// RUN SCRIPT
// ====================================
createSuperAdmin();
</file>

<file path="scripts/migrateData.js">
import { initializeApp } from 'firebase/app';
import { 
  getFirestore, 
  collection, 
  setDoc, 
  doc, 
  serverTimestamp 
} from 'firebase/firestore';

const firebaseConfig = {
  apiKey: "AIzaSyC5HDCOZFBzI-t-ysuJ88YMHP9q_LxcNcQ",
  authDomain: "huflit-test-4ce25.firebaseapp.com",
  projectId: "huflit-test-4ce25",
  storageBucket: "huflit-test-4ce25.firebasestorage.app",
  messagingSenderId: "839404304249",
  appId: "1:839404304249:web:c9cc8830cd6b42bafc21a8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Import d liu t file
import EXAM_DATA from '../src/data/examData.js';

async function migrateExamData() {
  try {
    console.log(' Bt u migrate d liu exam...');

    const examCollection = collection(db, 'examData');
    let totalDocs = 0;

    // Duyt qua tt c exams
    for (const [examKey, examData] of Object.entries(EXAM_DATA)) {
      console.log(` Processing ${examKey}...`);

      // Lu exam metadata
      await setDoc(doc(examCollection, examKey), {
        id: examKey,
        title: examData.title || 'Exam',
        description: examData.description || '',
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      });

      // Lu tng part
      if (examData.parts) {
        for (const [partKey, partData] of Object.entries(examData.parts)) {
          const partDocId = `${examKey}_${partKey}`;
          
          await setDoc(doc(examCollection, partDocId), {
            examId: examKey,
            partId: partKey,
            title: partData.title || `Part ${partKey}`,
            description: partData.description || '',
            type: partData.type || 'listening',
            script: partData.script || '',
            questions: partData.questions || [],
            questionsCount: partData.questions?.length || 0,
            createdAt: serverTimestamp(),
            updatedAt: serverTimestamp(),
          });

          totalDocs++;
          console.log(`   ${partDocId} uploaded`);
        }
      }
    }

    console.log(`\n Migrate thnh cng! Tng ${totalDocs} documents  c upload.`);
    process.exit(0);
  } catch (error) {
    console.error(' Li khi migrate:', error);
    process.exit(1);
  }
}

migrateExamData();
</file>

<file path="scripts/uploadAllData.js">
/**
 * Upload ALL Data (Exam, Vocabulary, Grammar) to Firebase
 * File: scripts/uploadAllData.js
 * Run: node scripts/uploadAllData.js
 * Or add to package.json: "upload:all": "node scripts/uploadAllData.js"
 * 
 * NO SHEBANG - Windows Compatible!
 */

import admin from 'firebase-admin';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ============================================
// Initialize Firebase
// ============================================

const serviceAccountPath = path.join(__dirname, 'serviceAccountKey.json');

if (!fs.existsSync(serviceAccountPath)) {
  console.error('\n ERROR: serviceAccountKey.json not found!');
  console.error(' Expected: scripts/serviceAccountKey.json\n');
  console.error(' How to fix:');
  console.error('   1. Go to Firebase Console');
  console.error('   2. Project Settings  Service Accounts');
  console.error('   3. Click "Generate New Private Key"');
  console.error('   4. Save it as: scripts/serviceAccountKey.json\n');
  process.exit(1);
}

const serviceAccount = JSON.parse(fs.readFileSync(serviceAccountPath, 'utf8'));

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  projectId: 'huflit-test-4ce25'
});

const db = admin.firestore();

// ============================================
// Import Data - With Error Handling
// ============================================

let EXAM_DATA = {};
let VOCABULARY_DATA = {};
let GRAMMAR_DATA = {};

try {
  console.log(' Loading data files...\n');
  
  try {
    const examModule = await import('../src/data/examData.js');
    EXAM_DATA = examModule.EXAM_DATA || examModule.default || {};
    if (Object.keys(EXAM_DATA).length > 0) {
      console.log(' Exam data loaded:', Object.keys(EXAM_DATA).length, 'exams');
    } else {
      console.log('  Exam data is empty');
    }
  } catch (e) {
    console.log('  Could not load exam data:', e.message);
  }

  try {
    const vocabModule = await import('../src/data/vocabularyData.js');
    VOCABULARY_DATA = vocabModule.VOCABULARY_DATA || vocabModule.default || {};
    if (Object.keys(VOCABULARY_DATA).length > 0) {
      console.log(' Vocabulary data loaded:', Object.keys(VOCABULARY_DATA).length, 'levels');
    } else {
      console.log('  Vocabulary data is empty');
    }
  } catch (e) {
    console.log('  Could not load vocabulary data:', e.message);
  }

  try {
    const grammarModule = await import('../src/data/grammarData.js');
    GRAMMAR_DATA = grammarModule.GRAMMAR_DATA || grammarModule.default || {};
    if (Object.keys(GRAMMAR_DATA).length > 0) {
      console.log(' Grammar data loaded:', Object.keys(GRAMMAR_DATA).length, 'levels');
    } else {
      console.log('  Grammar data is empty');
    }
  } catch (e) {
    console.log('  Could not load grammar data:', e.message);
  }

  if (Object.keys(EXAM_DATA).length === 0 && Object.keys(VOCABULARY_DATA).length === 0 && Object.keys(GRAMMAR_DATA).length === 0) {
    throw new Error('No data loaded! Check your data files.');
  }

} catch (error) {
  console.error('\n Fatal error loading data:', error.message);
  process.exit(1);
}

// ============================================
// Utility Functions
// ============================================

function cleanData(obj, maxDepth = 3, currentDepth = 0) {
  if (currentDepth > maxDepth) return '[Data truncated]';
  if (obj === null || obj === undefined) return null;
  if (typeof obj !== 'object') return obj;

  if (Array.isArray(obj)) {
    return obj.map(item => cleanData(item, maxDepth, currentDepth + 1)).filter(item => item !== null);
  }

  const cleaned = {};
  for (const [key, value] of Object.entries(obj)) {
    if (value !== undefined && value !== null) {
      cleaned[key] = cleanData(value, maxDepth, currentDepth + 1);
    }
  }
  return cleaned;
}

function logSection(title) {
  console.log(`\n${''.repeat(70)}`);
  console.log(`  ${title}`);
  console.log(`${''.repeat(70)}\n`);
}

function logSuccess(msg, details = '') {
  console.log(`   ${msg}${details ? ` - ${details}` : ''}`);
}

function logInfo(msg) {
  console.log(`    ${msg}`);
}

function logError(msg) {
  console.log(`   ${msg}`);
}

// ============================================
// Upload Exam Data
// ============================================

async function uploadExamData() {
  logSection(' Uploading Exam Data');

  if (!EXAM_DATA || Object.keys(EXAM_DATA).length === 0) {
    logInfo('No exam data to upload');
    return 0;
  }

  let totalParts = 0;

  for (const [examId, examData] of Object.entries(EXAM_DATA)) {
    console.log(`   ${examId}:`);

    try {
      // Upload exam metadata
      await db.collection('examData').doc(examId).set(
        cleanData({
          id: examId,
          title: examData.title || examId,
          description: examData.description || '',
          type: 'exam',
          partsCount: Object.keys(examData.parts || {}).length,
          createdAt: new Date()
        }),
        { merge: true }
      );
      logSuccess(`${examId} metadata`);

      // Upload parts
      if (examData.parts) {
        for (const [partId, partData] of Object.entries(examData.parts)) {
          const docId = `${examId}__${partId}`;
          const questionCount = (partData.questions || []).length;

          await db.collection('examData').doc(docId).set(
            cleanData({
              examId,
              partId,
              title: partData.title || partId,
              description: partData.description || '',
              type: 'part',
              testType: partData.testType || 'listening',
              script: partData.script || '',
              content: partData.content || '',
              questions: partData.questions || [],
              questionsCount: questionCount,
              createdAt: new Date()
            }),
            { merge: true }
          );

          totalParts++;
          logSuccess(`${partId}`, `${questionCount} questions`);
        }
      }
    } catch (error) {
      logError(`${examId}: ${error.message}`);
    }
  }

  console.log(`\n   Total exam parts: ${totalParts}`);
  return totalParts;
}

// ============================================
// Upload Vocabulary Data
// ============================================

async function uploadVocabularyData() {
  logSection(' Uploading Vocabulary Data');

  if (!VOCABULARY_DATA || Object.keys(VOCABULARY_DATA).length === 0) {
    logInfo('No vocabulary data to upload');
    return 0;
  }

  let totalCategories = 0;
  let totalWords = 0;

  for (const [levelId, levelData] of Object.entries(VOCABULARY_DATA)) {
    console.log(`   Level: ${levelId}`);

    try {
      // Upload level metadata
      await db.collection('vocabularyData').doc(levelId).set(
        cleanData({
          id: levelId,
          level: levelData.level || levelId,
          type: 'level',
          categoriesCount: Object.keys(levelData.categories || {}).length,
          createdAt: new Date()
        }),
        { merge: true }
      );
      logSuccess(`${levelId} metadata`);

      // Upload categories
      if (levelData.categories) {
        for (const [catId, catData] of Object.entries(levelData.categories)) {
          const docId = `${levelId}__${catId}`;
          const wordCount = (catData.words || []).length;

          await db.collection('vocabularyData').doc(docId).set(
            cleanData({
              level: levelId,
              levelName: levelData.level,
              categoryId: catId,
              title: catData.title || catId,
              description: catData.description || '',
              type: 'category',
              wordsCount: wordCount,
              words: (catData.words || []).map(w => ({
                id: w.id,
                word: w.word,
                pronunciation: w.pronunciation || '',
                definition: w.definition,
                example: w.example || '',
                vietnamese: w.vietnamese,
                alternatives: w.alternatives || []
              })),
              createdAt: new Date()
            }),
            { merge: true }
          );

          totalCategories++;
          totalWords += wordCount;
          logSuccess(`${catData.title}`, `${wordCount} words`);
        }
      }
    } catch (error) {
      logError(`${levelId}: ${error.message}`);
    }
  }

  console.log(`\n   Total categories: ${totalCategories} | Total words: ${totalWords}`);
  return { categories: totalCategories, words: totalWords };
}

// ============================================
// Upload Grammar Data
// ============================================

async function uploadGrammarData() {
  logSection(' Uploading Grammar Data');

  if (!GRAMMAR_DATA || Object.keys(GRAMMAR_DATA).length === 0) {
    logInfo('No grammar data to upload');
    return 0;
  }

  let totalTopics = 0;
  let totalLessons = 0;
  let totalExercises = 0;

  for (const [levelId, levelData] of Object.entries(GRAMMAR_DATA)) {
    console.log(`   Level: ${levelId}`);

    try {
      // Upload level metadata
      await db.collection('grammarData').doc(levelId).set(
        cleanData({
          id: levelId,
          level: levelData.level || levelId,
          description: levelData.description || '',
          type: 'level',
          topicsCount: Object.keys(levelData.topics || {}).length,
          createdAt: new Date()
        }),
        { merge: true }
      );
      logSuccess(`${levelId} metadata`);

      // Upload topics
      if (levelData.topics) {
        for (const [topicId, topicData] of Object.entries(levelData.topics)) {
          const docId = `${levelId}__${topicId}`;

          const cleanLessons = (topicData.lessons || [])
            .map(lesson => ({
              lessonId: lesson.lessonId || '',
              title: lesson.title || '',
              duration: lesson.duration || '',
              content: (lesson.content || '').substring(0, 5000),
              examples: lesson.examples || []
            }))
            .filter(l => l.title);

          const cleanExercises = (topicData.exercises || [])
            .map(ex => ({
              exerciseId: ex.exerciseId || '',
              type: ex.type || '',
              difficulty: ex.difficulty || 'Easy',
              question: ex.question || '',
              options: ex.options || [],
              correctAnswer: ex.correctAnswer || '',
              hints: ex.hints || [],
              explanation: ex.explanation || ''
            }))
            .filter(e => e.question);

          await db.collection('grammarData').doc(docId).set(
            cleanData({
              level: levelId,
              levelName: levelData.level,
              topicId,
              title: topicData.title || topicId,
              description: topicData.description || '',
              difficulty: topicData.difficulty || 'Beginner',
              icon: topicData.icon || '',
              type: 'topic',
              lessonsCount: cleanLessons.length,
              exercisesCount: cleanExercises.length,
              lessons: cleanLessons,
              exercises: cleanExercises,
              vocabulary: topicData.vocabulary || [],
              createdAt: new Date()
            }),
            { merge: true }
          );

          totalTopics++;
          totalLessons += cleanLessons.length;
          totalExercises += cleanExercises.length;
          logSuccess(`${topicData.title}`, `${cleanLessons.length}L ${cleanExercises.length}E`);
        }
      }
    } catch (error) {
      logError(`${levelId}: ${error.message}`);
    }
  }

  console.log(`\n   Total topics: ${totalTopics} | Lessons: ${totalLessons} | Exercises: ${totalExercises}`);
  return { topics: totalTopics, lessons: totalLessons, exercises: totalExercises };
}

// ============================================
// Upload Statistics
// ============================================

async function uploadStatistics(examStats, vocabStats, grammarStats) {
  logSection(' Uploading Statistics');

  try {
    const stats = {
      exam: {
        totalParts: examStats || 0
      },
      vocabulary: {
        totalCategories: vocabStats.categories || 0,
        totalWords: vocabStats.words || 0
      },
      grammar: {
        totalTopics: grammarStats.topics || 0,
        totalLessons: grammarStats.lessons || 0,
        totalExercises: grammarStats.exercises || 0
      },
      updatedAt: new Date()
    };

    await db.collection('metadata').doc('allStatistics').set(stats, { merge: true });

    logSuccess('Statistics updated');
    console.log(`    Exam parts: ${stats.exam.totalParts}`);
    console.log(`    Vocabulary categories: ${stats.vocabulary.totalCategories} (${stats.vocabulary.totalWords} words)`);
    console.log(`    Grammar topics: ${stats.grammar.totalTopics} (${stats.grammar.totalLessons}L ${stats.grammar.totalExercises}E)`);
  } catch (error) {
    logError(`Statistics: ${error.message}`);
  }
}

// ============================================
// Main
// ============================================

async function main() {
  logSection(' Firebase - Upload All Data (HUFLIT)');
  logInfo('Uploading Exam, Vocabulary, and Grammar data...');

  try {
    const examParts = await uploadExamData();
    const vocabData = await uploadVocabularyData();
    const grammarData = await uploadGrammarData();
    await uploadStatistics(examParts, vocabData, grammarData);

    logSection(' Upload Complete!');
    console.log(`\n All data successfully uploaded to Firebase Firestore!\n`);
    console.log(` View your data:`);
    console.log(`   https://console.firebase.google.com/u/0/project/huflit-test-4ce25/firestore\n`);
    console.log(` Summary:`);
    console.log(`    Exam data: ${examParts} parts`);
    console.log(`    Vocabulary: ${vocabData.categories} categories, ${vocabData.words} words`);
    console.log(`    Grammar: ${grammarData.topics} topics, ${grammarData.lessons} lessons, ${grammarData.exercises} exercises\n`);

    process.exit(0);
  } catch (error) {
    logSection(' Upload Failed!');
    console.error('\n Fatal error:', error.message);
    console.error(error.stack);
    process.exit(1);
  } finally {
    // Close Firebase connection
    await admin.app().delete();
  }
}

// Run
main();
</file>

<file path="scripts/uploadData.js">

</file>

<file path="scripts/uploadGrammarData.js">
#!/usr/bin/env node

/**
 * Upload Grammar Data to Firebase Firestore
 * File: scripts/uploadGrammarData.js
 * Run: node scripts/uploadGrammarData.js
 * Or add to package.json: "upload:grammar": "node scripts/uploadGrammarData.js"
 */

import admin from 'firebase-admin';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import { GRAMMAR_DATA, COMMON_MISTAKES, STUDY_TIPS, REAL_WORLD_EXAMPLES, GRAMMAR_QUIZZES } from '../src/data/grammarData.js';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ============================================
// Configuration
// ============================================

const FIREBASE_CONFIG = {
  projectId: 'huflit-test-4ce25',
  databaseURL: 'https://huflit-test-4ce25.firebaseio.com'
};

const SERVICE_ACCOUNT_PATH = path.join(__dirname, 'serviceAccountKey.json');

// ============================================
// Initialize Firebase
// ============================================

function initializeFirebase() {
  if (!fs.existsSync(SERVICE_ACCOUNT_PATH)) {
    console.error('\n ERROR: serviceAccountKey.json not found!');
    console.error(` Expected path: ${SERVICE_ACCOUNT_PATH}\n`);
    console.error(' Steps to fix:');
    console.error('   1. Go to Firebase Console');
    console.error('   2. Project Settings  Service Accounts');
    console.error('   3. Click "Generate New Private Key"');
    console.error('   4. Save it as: scripts/serviceAccountKey.json\n');
    process.exit(1);
  }

  try {
    const serviceAccount = JSON.parse(fs.readFileSync(SERVICE_ACCOUNT_PATH, 'utf8'));
    
    admin.initializeApp({
      credential: admin.credential.cert(serviceAccount),
      projectId: FIREBASE_CONFIG.projectId
    });

    console.log(' Firebase initialized successfully\n');
    return admin.firestore();
  } catch (error) {
    console.error(' Firebase initialization failed:', error.message);
    process.exit(1);
  }
}

// ============================================
// Utility Functions
// ============================================

function logSection(title) {
  console.log(`\n${''.repeat(70)}`);
  console.log(`  ${title}`);
  console.log(`${''.repeat(70)}\n`);
}

function logSuccess(msg, details = '') {
  console.log(`   ${msg}${details ? ` - ${details}` : ''}`);
}

function logInfo(msg) {
  console.log(`    ${msg}`);
}

function logError(msg) {
  console.log(`   ${msg}`);
}

function logWarning(msg) {
  console.log(`    ${msg}`);
}

function cleanData(obj, maxDepth = 3, currentDepth = 0) {
  if (currentDepth > maxDepth) return '[Data truncated]';
  if (obj === null || obj === undefined) return null;
  if (typeof obj !== 'object') return obj;
  
  if (Array.isArray(obj)) {
    return obj
      .map(item => cleanData(item, maxDepth, currentDepth + 1))
      .filter(item => item !== null);
  }

  const cleaned = {};
  for (const [key, value] of Object.entries(obj)) {
    if (value !== undefined && value !== null) {
      cleaned[key] = cleanData(value, maxDepth, currentDepth + 1);
    }
  }
  return cleaned;
}

function truncateString(str, maxLength = 5000) {
  if (typeof str !== 'string') return str;
  return str.length > maxLength ? str.substring(0, maxLength) + '...' : str;
}

// ============================================
// Upload Grammar Data
// ============================================

async function uploadGrammarTopics(db) {
  logSection(' Uploading Grammar Topics');

  let totalTopics = 0;
  let totalLessons = 0;
  let totalExercises = 0;

  for (const [levelKey, levelData] of Object.entries(GRAMMAR_DATA)) {
    const level = levelData.level || levelKey;
    console.log(`\n   Level: ${level}`);

    try {
      const topics = levelData.topics || {};

      for (const [topicKey, topicData] of Object.entries(topics)) {
        const docId = `${level}_${topicData.id}`;

        // Process lessons
        const lessons = (topicData.lessons || []).map(lesson => ({
          lessonId: lesson.lessonId || '',
          title: lesson.title || '',
          duration: lesson.duration || '',
          content: truncateString(lesson.content || ''),
          examples: (lesson.examples || []).slice(0, 10), // Limit to 10 examples
          // Omit vocabulary field to save space
        }));

        // Process exercises
        const exercises = (topicData.exercises || []).map(exercise => ({
          exerciseId: exercise.exerciseId || '',
          type: exercise.type || 'multiple_choice',
          difficulty: exercise.difficulty || 'Easy',
          question: exercise.question || '',
          options: (exercise.options || []).slice(0, 6),
          correctAnswer: exercise.correctAnswer || '',
          hints: exercise.hints || [],
          explanation: truncateString(exercise.explanation || '', 1000),
        }));

        // Upload topic
        const topicDoc = {
          level: level,
          levelKey: levelKey,
          topicId: topicData.id,
          title: topicData.title || '',
          description: topicData.description || '',
          difficulty: topicData.difficulty || 'Beginner',
          icon: topicData.icon || '',
          lessonsCount: lessons.length,
          exercisesCount: exercises.length,
          lessons: lessons,
          exercises: exercises,
          createdAt: new Date(),
          updatedAt: new Date(),
          // Metadata
          type: 'grammar_topic',
          searchKeywords: [
            (topicData.title || '').toLowerCase(),
            (level).toLowerCase(),
            (topicData.difficulty || 'beginner').toLowerCase()
          ]
        };

        await db.collection('grammarData').doc(docId).set(cleanData(topicDoc), { merge: true });

        totalTopics++;
        totalLessons += lessons.length;
        totalExercises += exercises.length;

        logSuccess(
          `${topicData.title}`,
          `${lessons.length} lessons, ${exercises.length} exercises`
        );
      }
    } catch (error) {
      logError(`Failed to upload ${level} topics: ${error.message}`);
    }
  }

  console.log(`\n   Summary:`);
  console.log(`      Topics: ${totalTopics}`);
  console.log(`      Lessons: ${totalLessons}`);
  console.log(`      Exercises: ${totalExercises}`);

  return { totalTopics, totalLessons, totalExercises };
}

// ============================================
// Upload Common Mistakes
// ============================================

async function uploadCommonMistakes(db) {
  logSection('  Uploading Common Mistakes');

  if (!COMMON_MISTAKES || COMMON_MISTAKES.length === 0) {
    logWarning('No common mistakes data found');
    return 0;
  }

  try {
    const mistakes = COMMON_MISTAKES.map((mistake, index) => ({
      id: mistake.id || `mistake_${index}`,
      mistake: mistake.mistake || '',
      correct: mistake.correct || '',
      explanation: truncateString(mistake.explanation || '', 2000),
      topic: mistake.topic || '',
      createdAt: new Date(),
      type: 'common_mistake'
    }));

    for (const mistake of mistakes) {
      await db.collection('grammarData').doc(`mistake_${mistake.id}`).set(
        cleanData(mistake),
        { merge: true }
      );
    }

    logSuccess(`${mistakes.length} common mistakes uploaded`);
    return mistakes.length;
  } catch (error) {
    logError(`Failed to upload common mistakes: ${error.message}`);
    return 0;
  }
}

// ============================================
// Upload Study Tips
// ============================================

async function uploadStudyTips(db) {
  logSection(' Uploading Study Tips');

  if (!STUDY_TIPS || STUDY_TIPS.length === 0) {
    logWarning('No study tips data found');
    return 0;
  }

  try {
    const tips = STUDY_TIPS.map((tip, index) => ({
      id: tip.id || `tip_${index}`,
      title: tip.title || '',
      description: truncateString(tip.description || '', 2000),
      relatedTopics: tip.relatedTopics || [],
      createdAt: new Date(),
      type: 'study_tip'
    }));

    for (const tip of tips) {
      await db.collection('grammarData').doc(`tip_${tip.id}`).set(
        cleanData(tip),
        { merge: true }
      );
    }

    logSuccess(`${tips.length} study tips uploaded`);
    return tips.length;
  } catch (error) {
    logError(`Failed to upload study tips: ${error.message}`);
    return 0;
  }
}

// ============================================
// Upload Real World Examples
// ============================================

async function uploadRealWorldExamples(db) {
  logSection(' Uploading Real World Examples');

  if (!REAL_WORLD_EXAMPLES || REAL_WORLD_EXAMPLES.length === 0) {
    logWarning('No real world examples found');
    return 0;
  }

  try {
    const examples = REAL_WORLD_EXAMPLES.map((example, index) => ({
      id: example.id || `example_${index}`,
      context: example.context || '',
      original: example.original || '',
      explanation: truncateString(example.explanation || '', 2000),
      topic: example.topic || '',
      createdAt: new Date(),
      type: 'real_world_example'
    }));

    for (const example of examples) {
      await db.collection('grammarData').doc(`example_${example.id}`).set(
        cleanData(example),
        { merge: true }
      );
    }

    logSuccess(`${examples.length} real world examples uploaded`);
    return examples.length;
  } catch (error) {
    logError(`Failed to upload real world examples: ${error.message}`);
    return 0;
  }
}

// ============================================
// Upload Grammar Quizzes
// ============================================

async function uploadGrammarQuizzes(db) {
  logSection(' Uploading Grammar Quizzes');

  if (!GRAMMAR_QUIZZES || GRAMMAR_QUIZZES.length === 0) {
    logWarning('No grammar quizzes found');
    return 0;
  }

  try {
    const quizzes = GRAMMAR_QUIZZES.map((quiz, index) => ({
      id: quiz.quizId || `quiz_${index}`,
      quizId: quiz.quizId || `quiz_${index}`,
      title: quiz.title || '',
      difficulty: quiz.difficulty || 'Beginner',
      duration: quiz.duration || 0,
      passingScore: quiz.passingScore || 70,
      topics: quiz.topics || [],
      questions: (quiz.questions || []).map(q => ({
        id: q.id || '',
        question: q.question || '',
        type: q.type || 'multiple_choice',
        options: q.options || [],
        explanation: truncateString(q.explanation || '', 1000)
      })).slice(0, 50), // Limit to 50 questions
      questionsCount: (quiz.questions || []).length,
      createdAt: new Date(),
      type: 'grammar_quiz'
    }));

    for (const quiz of quizzes) {
      await db.collection('grammarData').doc(`quiz_${quiz.id}`).set(
        cleanData(quiz),
        { merge: true }
      );
    }

    logSuccess(`${quizzes.length} grammar quizzes uploaded`);
    return quizzes.length;
  } catch (error) {
    logError(`Failed to upload grammar quizzes: ${error.message}`);
    return 0;
  }
}

// ============================================
// Upload Statistics
// ============================================

async function uploadStatistics(db, stats) {
  logSection(' Uploading Statistics');

  try {
    const statistics = {
      grammarTopics: stats.totalTopics || 0,
      grammarLessons: stats.totalLessons || 0,
      grammarExercises: stats.totalExercises || 0,
      commonMistakes: stats.commonMistakes || 0,
      studyTips: stats.studyTips || 0,
      realWorldExamples: stats.realWorldExamples || 0,
      grammarQuizzes: stats.grammarQuizzes || 0,
      updatedAt: new Date(),
      uploadedAt: new Date()
    };

    await db.collection('metadata').doc('grammarStatistics').set(
      statistics,
      { merge: true }
    );

    logSuccess('Statistics metadata uploaded');
    console.log(`\n   Data Summary:`);
    console.log(`      Topics: ${statistics.grammarTopics}`);
    console.log(`      Lessons: ${statistics.grammarLessons}`);
    console.log(`      Exercises: ${statistics.grammarExercises}`);
    console.log(`      Common Mistakes: ${statistics.commonMistakes}`);
    console.log(`      Study Tips: ${statistics.studyTips}`);
    console.log(`      Real World Examples: ${statistics.realWorldExamples}`);
    console.log(`      Quizzes: ${statistics.grammarQuizzes}\n`);

    return statistics;
  } catch (error) {
    logError(`Failed to upload statistics: ${error.message}`);
  }
}

// ============================================
// Main Upload Function
// ============================================

async function main() {
  logSection(' Firebase Grammar Data Upload');
  
  console.log(' Initializing Firebase...\n');
  const db = initializeFirebase();

  try {
    const stats = {
      totalTopics: 0,
      totalLessons: 0,
      totalExercises: 0,
      commonMistakes: 0,
      studyTips: 0,
      realWorldExamples: 0,
      grammarQuizzes: 0
    };

    // Upload all data
    const topicStats = await uploadGrammarTopics(db);
    stats.totalTopics = topicStats.totalTopics;
    stats.totalLessons = topicStats.totalLessons;
    stats.totalExercises = topicStats.totalExercises;

    stats.commonMistakes = await uploadCommonMistakes(db);
    stats.studyTips = await uploadStudyTips(db);
    stats.realWorldExamples = await uploadRealWorldExamples(db);
    stats.grammarQuizzes = await uploadGrammarQuizzes(db);

    // Upload statistics
    await uploadStatistics(db, stats);

    logSection(' Upload Complete!');
    console.log(` All grammar data successfully uploaded to Firebase Firestore!\n`);
    console.log(` View your data:`);
    console.log(`   https://console.firebase.google.com/u/0/project/${FIREBASE_CONFIG.projectId}/firestore\n`);
    console.log(` Collection: grammarData`);
    console.log(`   Documents: ${Object.keys(GRAMMAR_DATA).reduce((sum, level) => sum + Object.keys(GRAMMAR_DATA[level].topics || {}).length, 0)} topics\n`);

    process.exit(0);
  } catch (error) {
    logSection(' Upload Failed!');
    console.error('\n Fatal error:', error.message);
    console.error(error);
    process.exit(1);
  } finally {
    await admin.app().delete();
  }
}

// Run the upload
main();
</file>

<file path="scripts/uploadRealData.js">
#!/usr/bin/env node

/**
 * Upload REAL Data from Local Files to Firebase
 * File: scripts/uploadRealData.js
 * Run: npm run upload:real
 */

import admin from 'firebase-admin';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ============================================
// Initialize Firebase
// ============================================
const serviceAccountPath = path.join(__dirname, 'serviceAccountKey.json');

if (!fs.existsSync(serviceAccountPath)) {
  console.error('\n ERROR: serviceAccountKey.json not found!');
  console.error(' Expected: scripts/serviceAccountKey.json\n');
  process.exit(1);
}

const serviceAccount = JSON.parse(fs.readFileSync(serviceAccountPath, 'utf8'));

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  projectId: 'huflit-test-4ce25'
});

const db = admin.firestore();

// ============================================
// Import Real Data
// ============================================

// Dynamically import data files
let EXAM_DATA = {};
let VOCABULARY_DATA = {};
let GRAMMAR_DATA = {};

try {
  const examModule = await import('../src/data/examData.js');
  EXAM_DATA = examModule.EXAM_DATA || examModule.default || {};
  console.log(' Exam data loaded');
} catch (e) {
  console.warn('  Could not load exam data:', e.message);
}

try {
  const vocabModule = await import('../src/data/vocabularyData.js');
  VOCABULARY_DATA = vocabModule.VOCABULARY_DATA || vocabModule.default || {};
  console.log(' Vocabulary data loaded');
} catch (e) {
  console.warn('  Could not load vocabulary data:', e.message);
}

try {
  const grammarModule = await import('../src/data/grammarData.js');
  GRAMMAR_DATA = grammarModule.GRAMMAR_DATA || grammarModule.default || {};
  console.log(' Grammar data loaded');
} catch (e) {
  console.warn('  Could not load grammar data:', e.message);
}

// ============================================
// Utility Functions
// ============================================

function cleanData(obj) {
  if (obj === null || obj === undefined) return null;
  if (Array.isArray(obj)) {
    return obj.map(item => cleanData(item)).filter(item => item !== null);
  }
  if (typeof obj !== 'object') return obj;
  
  const cleaned = {};
  for (const [key, value] of Object.entries(obj)) {
    if (value !== undefined && value !== null) {
      if (typeof value === 'object') {
        cleaned[key] = cleanData(value);
      } else {
        cleaned[key] = value;
      }
    }
  }
  return cleaned;
}

function logSection(title) {
  console.log(`\n${'='.repeat(60)}`);
  console.log(title);
  console.log(`${'='.repeat(60)}`);
}

function logSuccess(msg) {
  console.log(`   ${msg}`);
}

function logInfo(msg) {
  console.log(`    ${msg}`);
}

function logError(msg) {
  console.log(`   ${msg}`);
}

// ============================================
// Upload Functions
// ============================================

async function uploadExamData() {
  logSection(' Uploading Exam Data');

  if (!EXAM_DATA || Object.keys(EXAM_DATA).length === 0) {
    logInfo('No exam data to upload');
    return 0;
  }

  let totalParts = 0;

  for (const [examId, examData] of Object.entries(EXAM_DATA)) {
    console.log(`\n   ${examId}:`);

    try {
      // Upload exam metadata
      await db.collection('examData').doc(examId).set(
        cleanData({
          id: examId,
          title: examData.title || examId,
          description: examData.description || '',
          type: 'exam',
          createdAt: new Date()
        }),
        { merge: true }
      );
      logSuccess(`${examId} metadata`);

      // Upload parts
      if (examData.parts) {
        for (const [partId, partData] of Object.entries(examData.parts)) {
          const docId = `${examId}__${partId}`;

          await db.collection('examData').doc(docId).set(
            cleanData({
              examId,
              partId,
              title: partData.title || partId,
              description: partData.description || '',
              type: 'part',
              testType: partData.testType || 'listening',
              script: partData.script || '',
              content: partData.content || '',
              questions: partData.questions || [],
              questionsCount: (partData.questions || []).length,
              createdAt: new Date()
            }),
            { merge: true }
          );

          totalParts++;
          logSuccess(`${partId} (${(partData.questions || []).length} questions)`);
        }
      }
    } catch (error) {
      logError(`${examId}: ${error.message}`);
    }
  }

  console.log(`\n Total exam parts uploaded: ${totalParts}`);
  return totalParts;
}

async function uploadVocabularyData() {
  logSection(' Uploading Vocabulary Data');

  if (!VOCABULARY_DATA || Object.keys(VOCABULARY_DATA).length === 0) {
    logInfo('No vocabulary data to upload');
    return 0;
  }

  let totalCategories = 0;

  for (const [levelId, levelData] of Object.entries(VOCABULARY_DATA)) {
    console.log(`\n   Level: ${levelId}`);

    try {
      // Upload level metadata
      await db.collection('vocabularyData').doc(levelId).set(
        cleanData({
          id: levelId,
          level: levelData.level || levelId,
          type: 'level',
          categoriesCount: Object.keys(levelData.categories || {}).length,
          createdAt: new Date()
        }),
        { merge: true }
      );
      logSuccess(`${levelId} metadata`);

      // Upload categories
      if (levelData.categories) {
        for (const [catId, catData] of Object.entries(levelData.categories)) {
          const docId = `${levelId}__${catId}`;

          await db.collection('vocabularyData').doc(docId).set(
            cleanData({
              level: levelId,
              levelName: levelData.level,
              categoryId: catId,
              title: catData.title || catId,
              description: catData.description || '',
              type: 'category',
              wordsCount: (catData.words || []).length,
              words: (catData.words || []).map(w => ({
                id: w.id,
                word: w.word,
                pronunciation: w.pronunciation || '',
                definition: w.definition,
                example: w.example || '',
                vietnamese: w.vietnamese,
                alternatives: w.alternatives || []
              })),
              createdAt: new Date()
            }),
            { merge: true }
          );

          totalCategories++;
          logSuccess(`${catData.title} (${(catData.words || []).length} words)`);
        }
      }
    } catch (error) {
      logError(`${levelId}: ${error.message}`);
    }
  }

  console.log(`\n Total vocabulary categories uploaded: ${totalCategories}`);
  return totalCategories;
}

async function uploadGrammarData() {
  logSection(' Uploading Grammar Data');

  if (!GRAMMAR_DATA || Object.keys(GRAMMAR_DATA).length === 0) {
    logInfo('No grammar data to upload');
    return 0;
  }

  let totalTopics = 0;

  for (const [levelId, levelData] of Object.entries(GRAMMAR_DATA)) {
    console.log(`\n   Level: ${levelId}`);

    try {
      // Upload level metadata
      await db.collection('grammarData').doc(levelId).set(
        cleanData({
          id: levelId,
          level: levelData.level || levelId,
          description: levelData.description || '',
          type: 'level',
          topicsCount: Object.keys(levelData.topics || {}).length,
          createdAt: new Date()
        }),
        { merge: true }
      );
      logSuccess(`${levelId} metadata`);

      // Upload topics
      if (levelData.topics) {
        for (const [topicId, topicData] of Object.entries(levelData.topics)) {
          const docId = `${levelId}__${topicId}`;

          const cleanLessons = (topicData.lessons || [])
            .map(lesson => ({
              lessonId: lesson.lessonId || '',
              title: lesson.title || '',
              duration: lesson.duration || '',
              content: (lesson.content || '').substring(0, 5000),
              examples: lesson.examples || []
            }))
            .filter(l => l.title);

          const cleanExercises = (topicData.exercises || [])
            .map(ex => ({
              exerciseId: ex.exerciseId || '',
              type: ex.type || '',
              difficulty: ex.difficulty || 'Easy',
              question: ex.question || '',
              options: ex.options || [],
              correctAnswer: ex.correctAnswer || '',
              hints: ex.hints || [],
              explanation: ex.explanation || ''
            }))
            .filter(e => e.question);

          await db.collection('grammarData').doc(docId).set(
            cleanData({
              level: levelId,
              levelName: levelData.level,
              topicId,
              title: topicData.title || topicId,
              description: topicData.description || '',
              difficulty: topicData.difficulty || 'Beginner',
              icon: topicData.icon || '',
              type: 'topic',
              lessonsCount: cleanLessons.length,
              exercisesCount: cleanExercises.length,
              lessons: cleanLessons,
              exercises: cleanExercises,
              vocabulary: topicData.vocabulary || [],
              createdAt: new Date()
            }),
            { merge: true }
          );

          totalTopics++;
          logSuccess(`${topicData.title} (${cleanLessons.length} lessons, ${cleanExercises.length} exercises)`);
        }
      }
    } catch (error) {
      logError(`${levelId}: ${error.message}`);
    }
  }

  console.log(`\n Total grammar topics uploaded: ${totalTopics}`);
  return totalTopics;
}

async function uploadMetadata() {
  logSection(' Uploading Statistics');

  try {
    const stats = {
      totalExams: Object.keys(EXAM_DATA).length,
      totalExamParts: Object.values(EXAM_DATA).reduce(
        (acc, exam) => acc + Object.keys(exam.parts || {}).length, 0
      ),
      totalVocabularyLevels: Object.keys(VOCABULARY_DATA).length,
      totalVocabularyCategories: Object.values(VOCABULARY_DATA).reduce(
        (acc, level) => acc + Object.keys(level.categories || {}).length, 0
      ),
      totalVocabularyWords: Object.values(VOCABULARY_DATA).reduce((acc, level) => {
        return acc + Object.values(level.categories || {}).reduce(
          (catAcc, cat) => catAcc + (cat.words || []).length, 0
        );
      }, 0),
      totalGrammarLevels: Object.keys(GRAMMAR_DATA).length,
      totalGrammarTopics: Object.values(GRAMMAR_DATA).reduce(
        (acc, level) => acc + Object.keys(level.topics || {}).length, 0
      ),
      updatedAt: new Date()
    };

    await db.collection('metadata').doc('statistics').set(stats, { merge: true });
    
    logSuccess('Statistics updated');
    console.log(`    Exams: ${stats.totalExams}`);
    console.log(`    Exam Parts: ${stats.totalExamParts}`);
    console.log(`    Vocabulary Categories: ${stats.totalVocabularyCategories}`);
    console.log(`    Vocabulary Words: ${stats.totalVocabularyWords}`);
    console.log(`    Grammar Topics: ${stats.totalGrammarTopics}`);
  } catch (error) {
    logError(`Statistics: ${error.message}`);
  }
}

// ============================================
// Main
// ============================================

async function main() {
  logSection(' Firebase Real Data Upload');
  logInfo('This will upload ALL your local data to Firebase');

  try {
    console.log('\n Loading data files...\n');

    const exams = await uploadExamData();
    const vocab = await uploadVocabularyData();
    const grammar = await uploadGrammarData();
    await uploadMetadata();

    logSection(' Upload Complete!');
    console.log(`\n Summary:`);
    console.log(`    Exam parts: ${exams}`);
    console.log(`    Vocabulary categories: ${vocab}`);
    console.log(`    Grammar topics: ${grammar}`);
    console.log(`\n All data successfully uploaded to Firebase Firestore!`);
    console.log(`\n View your data:`);
    console.log(`   https://console.firebase.google.com/u/0/project/huflit-test-4ce25/firestore\n`);

    process.exit(0);
  } catch (error) {
    console.error('\n Fatal error:', error.message);
    console.error(error);
    process.exit(1);
  }
}

main();
</file>

<file path="scripts/uploadvocabularyData.js">
#!/usr/bin/env node

/**
 * Upload Vocabulary Data to Firebase
 * File: scripts/uploadvocabularyData.js
 * Run: node scripts/uploadvocabularyData.js
 * or add to package.json: "upload:vocabulary": "node scripts/uploadvocabularyData.js"
 */

import admin from 'firebase-admin';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ============================================
// Initialize Firebase
// ============================================
const serviceAccountPath = path.join(__dirname, 'serviceAccountKey.json');

if (!fs.existsSync(serviceAccountPath)) {
  console.error('\n ERROR: serviceAccountKey.json not found!');
  console.error(' Expected: scripts/serviceAccountKey.json\n');
  process.exit(1);
}

const serviceAccount = JSON.parse(fs.readFileSync(serviceAccountPath, 'utf8'));

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  projectId: 'huflit-test-4ce25'
});

const db = admin.firestore();

// ============================================
// Import Real Vocabulary Data
// ============================================
let VOCABULARY_DATA = {};

try {
  const vocabModule = await import('../src/data/vocabularyData.js');
  VOCABULARY_DATA = vocabModule.VOCABULARY_DATA || vocabModule.default || {};
  console.log(' Vocabulary data loaded');
} catch (e) {
  console.error(' Could not load vocabulary data:', e.message);
  process.exit(1);
}

if (Object.keys(VOCABULARY_DATA).length === 0) {
  console.error(' No vocabulary data found in vocabularyData.js');
  process.exit(1);
}

// ============================================
// Utility Functions
// ============================================
function cleanData(obj) {
  if (obj === null || obj === undefined) return null;
  if (Array.isArray(obj)) {
    return obj.map(item => cleanData(item)).filter(item => item !== null);
  }
  if (typeof obj !== 'object') return obj;
  
  const cleaned = {};
  for (const [key, value] of Object.entries(obj)) {
    if (value !== undefined && value !== null) {
      if (typeof value === 'object') {
        cleaned[key] = cleanData(value);
      } else {
        cleaned[key] = value;
      }
    }
  }
  return cleaned;
}

function logSection(title) {
  console.log(`\n${'='.repeat(60)}`);
  console.log(title);
  console.log(`${'='.repeat(60)}`);
}

function logSuccess(msg) {
  console.log(`   ${msg}`);
}

function logInfo(msg) {
  console.log(`    ${msg}`);
}

function logError(msg) {
  console.log(`   ${msg}`);
}

// ============================================
// Upload Functions
// ============================================
async function uploadVocabularyLevels() {
  logSection(' Uploading Vocabulary Levels');

  let totalLevels = 0;

  for (const [levelId, levelData] of Object.entries(VOCABULARY_DATA)) {
    console.log(`\n   Level: ${levelId}`);

    try {
      // Upload level metadata
      await db.collection('vocabularyData').doc(levelId).set(
        cleanData({
          id: levelId,
          level: levelData.level || levelId,
          description: levelData.description || '',
          type: 'level',
          categoriesCount: Object.keys(levelData.categories || {}).length,
          createdAt: new Date()
        }),
        { merge: true }
      );
      logSuccess(`${levelId} metadata`);

      totalLevels++;
    } catch (error) {
      logError(`${levelId}: ${error.message}`);
    }
  }

  console.log(`\n Total vocabulary levels uploaded/updated: ${totalLevels}`);
  return totalLevels;
}

async function uploadVocabularyCategories() {
  logSection(' Uploading Vocabulary Categories');

  let totalCategories = 0;

  for (const [levelId, levelData] of Object.entries(VOCABULARY_DATA)) {
    if (!levelData.categories) continue;

    for (const [catId, catData] of Object.entries(levelData.categories)) {
      const docId = `${levelId}__${catId}`;

      try {
        // Clean words array
        const cleanWords = (catData.words || []).map(word => ({
          id: word.id,
          word: word.word || '',
          pronunciation: word.pronunciation || '',
          definition: word.definition || '',
          example: word.example || '',
          vietnamese: word.vietnamese || '',
          alternatives: word.alternatives || []
        })).filter(w => w.word); // Only keep if word exists

        await db.collection('vocabularyData').doc(docId).set(
          cleanData({
            level: levelId,
            levelName: levelData.level,
            categoryId: catId,
            title: catData.title || catId,
            description: catData.description || '',
            type: 'category',
            wordsCount: cleanWords.length,
            words: cleanWords,
            createdAt: new Date()
          }),
          { merge: true }
        );

        totalCategories++;
        logSuccess(`${catData.title || catId} (${cleanWords.length} words)`);
      } catch (error) {
        logError(`${docId}: ${error.message}`);
      }
    }
  }

  console.log(`\n Total vocabulary categories uploaded/updated: ${totalCategories}`);
  return totalCategories;
}

async function uploadVocabularyMetadata() {
  logSection(' Uploading Vocabulary Statistics');

  try {
    let totalWords = 0;
    let totalCategories = 0;
    let totalLevels = Object.keys(VOCABULARY_DATA).length;

    for (const levelData of Object.values(VOCABULARY_DATA)) {
      for (const catData of Object.values(levelData.categories || {})) {
        totalCategories++;
        totalWords += (catData.words || []).length;
      }
    }

    const stats = {
      totalLevels,
      totalCategories,
      totalWords,
      updatedAt: new Date()
    };

    await db.collection('metadata').doc('vocabularyStats').set(stats, { merge: true });
    
    logSuccess('Vocabulary statistics updated');
    console.log(`    Levels: ${totalLevels}`);
    console.log(`    Categories: ${totalCategories}`);
    console.log(`    Words: ${totalWords}`);
  } catch (error) {
    logError(`Statistics: ${error.message}`);
  }
}

// ============================================
// Main
// ============================================
async function main() {
  logSection(' Firebase Vocabulary Data Upload');
  logInfo('This will upload ALL vocabulary data to Firebase');

  try {
    console.log('\n Loading vocabulary data...\n');

    const levels = await uploadVocabularyLevels();
    const categories = await uploadVocabularyCategories();
    await uploadVocabularyMetadata();

    logSection(' Upload Complete!');
    console.log(`\n Summary:`);
    console.log(`    Levels: ${levels}`);
    console.log(`    Categories: ${categories}`);
    console.log(`\n All vocabulary data successfully uploaded to Firebase Firestore!`);
    console.log(`\n View your data:`);
    console.log(`   https://console.firebase.google.com/u/0/project/huflit-test-4ce25/firestore (collection: vocabularyData)\n`);

    process.exit(0);
  } catch (error) {
    console.error('\n Fatal error:', error.message);
    process.exit(1);
  }
}

main();
</file>

<file path="src/admin/components/AdminLogsViewer.jsx">

</file>

<file path="src/admin/components/ExamManagement.jsx">

</file>

<file path="src/admin/components/GrammarManagement.jsx">

</file>

<file path="src/admin/components/UserManagement.jsx">

</file>

<file path="src/admin/components/VocabularyManagement.jsx">

</file>

<file path="src/admin/config/adminAuth.js">
// src/admin/config/adminAuth.js
import { 
  signInWithEmailAndPassword, 
  signOut,
  setPersistence,
  browserLocalPersistence 
} from 'firebase/auth';
import { doc, getDoc } from 'firebase/firestore';
import { auth, db } from '../../config/firebase';

/**
 * Kim tra user c phi admin khng
 */
export const checkAdminRole = async (uid) => {
  try {
    //  Sa collection name t 'admins'  'admin_accounts'
    const adminRef = doc(db, 'admin_accounts', uid);
    const adminSnap = await getDoc(adminRef);
    
    if (!adminSnap.exists()) {
      return { isAdmin: false, error: 'Khng c quyn admin' };
    }
    
    const adminData = adminSnap.data();
    
    // Kim tra admin c b disable khng
    if (adminData.disabled || adminData.status !== 'active') {
      return { isAdmin: false, error: 'Ti khon admin  b kha' };
    }
    
    return { 
      isAdmin: true, 
      adminData: {
        uid,
        email: adminData.email,
        role: adminData.role || 'admin',
        permissions: adminData.permissions || [],
        status: adminData.status,
        createdAt: adminData.createdAt
      }
    };
  } catch (error) {
    console.error(' Error checking admin role:', error);
    return { isAdmin: false, error: error.message };
  }
};

/**
 * ng nhp admin
 */
export const adminSignIn = async (email, password) => {
  try {
    // Set persistence
    await setPersistence(auth, browserLocalPersistence);
    
    // ng nhp
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    
    // Kim tra quyn admin
    const { isAdmin, adminData, error } = await checkAdminRole(user.uid);
    
    if (!isAdmin) {
      // Nu khng phi admin, ng xut lun
      await signOut(auth);
      throw new Error(error || 'Khng c quyn truy cp Admin');
    }
    
    console.log(' Admin signed in:', adminData.email);
    
    return { 
      success: true, 
      admin: adminData 
    };
  } catch (error) {
    console.error(' Admin sign in error:', error);
    return { 
      success: false, 
      error: error.message 
    };
  }
};

/**
 * ng xut admin
 */
export const adminSignOut = async () => {
  try {
    await signOut(auth);
    console.log(' Admin signed out');
    return { success: true };
  } catch (error) {
    console.error(' Admin sign out error:', error);
    return { success: false, error: error.message };
  }
};
</file>

<file path="src/admin/hooks/useAdminAuth.js">
// src/admin/hooks/useAdminAuth.js
import { useState, useEffect } from 'react';
import { onAuthStateChanged } from 'firebase/auth';
import { auth } from '../../config/firebase';
import { checkAdminRole, adminSignIn, adminSignOut } from '../config/adminAuth';

export const useAdminAuth = () => {
  const [admin, setAdmin] = useState(null);
  const [isAdmin, setIsAdmin] = useState(false);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, async (user) => {
      if (!user) {
        setAdmin(null);
        setIsAdmin(false);
        setLoading(false);
        return;
      }

      // Kim tra quyn admin
      const { isAdmin: hasAdminRole, adminData, error: checkError } = 
        await checkAdminRole(user.uid);

      if (hasAdminRole) {
        setAdmin(adminData);
        setIsAdmin(true);
        setError(null);
      } else {
        setAdmin(null);
        setIsAdmin(false);
        setError(checkError);
        // T ng ng xut nu khng phi admin
        await adminSignOut();
      }
      
      setLoading(false);
    });

    return unsubscribe;
  }, []);

  const signIn = async (email, password) => {
    setLoading(true);
    setError(null);
    
    const result = await adminSignIn(email, password);
    
    if (result.success) {
      setAdmin(result.admin);
      setIsAdmin(true);
    } else {
      setError(result.error);
    }
    
    setLoading(false);
    return result;
  };

  const signOut = async () => {
    setLoading(true);
    const result = await adminSignOut();
    
    if (result.success) {
      setAdmin(null);
      setIsAdmin(false);
      setError(null);
    }
    
    setLoading(false);
    return result;
  };

  return {
    admin,
    isAdmin,
    loading,
    error,
    signIn,
    signOut
  };
};

export default useAdminAuth;
</file>

<file path="src/admin/services/adminCloudFunctionService.js">

</file>

<file path="src/admin/services/adminManagementService.js">

</file>

<file path="src/App.css">

</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/Auth/AuthModal.jsx">
import React, { useState } from 'react';
import { X, Mail, Lock, User, Eye, EyeOff, Loader } from 'lucide-react';
import { useAuth } from '../../contexts/AuthContext';

const AuthModal = ({ onClose }) => {
  const [isLogin, setIsLogin] = useState(true);
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const [formData, setFormData] = useState({
    email: '',
    password: '',
    displayName: '',
  });

  const { signin, signup, signInWithGoogle, error, clearError } = useAuth();

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value,
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    clearError();

    try {
      if (isLogin) {
        await signin(formData.email, formData.password);
      } else {
        await signup(formData.email, formData.password, formData.displayName);
      }
      onClose();
    } catch (err) {
      console.error('Auth error:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleGoogleSignIn = async () => {
    setLoading(true);
    clearError();

    try {
      await signInWithGoogle();
      onClose();
    } catch (err) {
      console.error('Google sign-in error:', err);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
        {/* Header */}
        <div className="bg-gradient-to-r from-orange-500 to-orange-600 px-6 py-4 flex items-center justify-between">
          <h2 className="text-2xl font-bold text-white">
            {isLogin ? ' ng Nhp' : ' ng K'}
          </h2>
          <button
            onClick={onClose}
            className="text-white hover:bg-orange-700 p-2 rounded-lg transition-all"
            aria-label="Close"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* Content */}
        <div className="p-6">
          {/* Error Message */}
          {error && (
            <div className="mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 rounded text-sm">
              <p className="font-semibold"> Li</p>
              <p>{error}</p>
            </div>
          )}

          {/* Form */}
          <form onSubmit={handleSubmit} className="space-y-4">
            {/* Email Input */}
            <div className="relative">
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                Email
              </label>
              <div className="relative">
                <Mail className="absolute left-3 top-3.5 w-5 h-5 text-gray-400" />
                <input
                  type="email"
                  name="email"
                  value={formData.email}
                  onChange={handleInputChange}
                  placeholder="your@email.com"
                  required
                  className="w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 transition-all"
                />
              </div>
            </div>

            {/* Display Name Input (Only for signup) */}
            {!isLogin && (
              <div className="relative">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Tn hin th
                </label>
                <div className="relative">
                  <User className="absolute left-3 top-3.5 w-5 h-5 text-gray-400" />
                  <input
                    type="text"
                    name="displayName"
                    value={formData.displayName}
                    onChange={handleInputChange}
                    placeholder="Tn ca bn"
                    className="w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 transition-all"
                  />
                </div>
              </div>
            )}

            {/* Password Input */}
            <div className="relative">
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                Mt khu
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-3.5 w-5 h-5 text-gray-400" />
                <input
                  type={showPassword ? 'text' : 'password'}
                  name="password"
                  value={formData.password}
                  onChange={handleInputChange}
                  placeholder=""
                  required
                  className="w-full pl-10 pr-12 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 transition-all"
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-3.5 text-gray-400 hover:text-gray-600"
                >
                  {showPassword ? (
                    <EyeOff className="w-5 h-5" />
                  ) : (
                    <Eye className="w-5 h-5" />
                  )}
                </button>
              </div>
            </div>

            {/* Submit Button */}
            <button
              type="submit"
              disabled={loading}
              className="w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 disabled:from-gray-400 disabled:to-gray-500 text-white font-bold py-3 rounded-lg transition-all duration-200 flex items-center justify-center gap-2"
            >
              {loading && <Loader className="w-4 h-4 animate-spin" />}
              {isLogin ? 'ng Nhp' : 'ng K'}
            </button>
          </form>

          {/* Divider */}
          <div className="relative my-6">
            <div className="absolute inset-0 flex items-center">
              <div className="w-full border-t-2 border-gray-300"></div>
            </div>
            <div className="relative flex justify-center text-sm">
              <span className="px-2 bg-white text-gray-600 font-semibold">HOC</span>
            </div>
          </div>

          {/* Google Sign In */}
          <button
            type="button"
            onClick={handleGoogleSignIn}
            disabled={loading}
            className="w-full border-2 border-gray-300 hover:border-orange-500 text-gray-700 font-bold py-3 rounded-lg transition-all duration-200 flex items-center justify-center gap-3 disabled:opacity-50"
          >
            <svg
              className="w-5 h-5"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4" />
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853" />
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05" />
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335" />
            </svg>
            <span>Google</span>
          </button>

          {/* Toggle Sign In/Sign Up */}
          <div className="mt-6 text-center">
            <p className="text-gray-600 text-sm">
              {isLogin ? 'Cha c ti khon? ' : ' c ti khon? '}
              <button
                type="button"
                onClick={() => {
                  setIsLogin(!isLogin);
                  clearError();
                  setFormData({ email: '', password: '', displayName: '' });
                }}
                className="text-orange-600 hover:text-orange-700 font-bold transition-all"
              >
                {isLogin ? 'ng k ngay' : 'ng nhp'}
              </button>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AuthModal;
</file>

<file path="src/components/Auth/ClerkAuth.jsx">
import React from 'react';
import {
  SignedIn,
  SignedOut,
  SignInButton,
  SignUpButton,
  UserButton,
} from '@clerk/clerk-react';
import { LogIn, UserPlus } from 'lucide-react';

export default function ClerkAuth() {
  return (
    <div className="flex items-center">
      <SignedOut>
        <div className="flex items-center gap-2 sm:gap-3">
          {/* Sign In Button */}
          <SignInButton mode="modal">
            <button className="group relative overflow-hidden px-4 sm:px-5 py-2 sm:py-2.5 bg-white rounded-xl font-semibold text-sm sm:text-base text-gray-700 transition-all duration-300 shadow-sm hover:shadow-lg border border-orange-200/50 hover:border-orange-300 hover:scale-105">
              {/* Gradient overlay on hover */}
              <div className="absolute inset-0 bg-gradient-to-r from-orange-400/10 to-amber-400/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
              
              <div className="relative flex items-center gap-2">
                <LogIn className="w-4 h-4 transition-transform duration-300 group-hover:scale-110" />
                <span className="hidden sm:inline">ng Nhp</span>
                <span className="sm:hidden">ng Nhp</span>
              </div>
            </button>
          </SignInButton>

          {/* Sign Up Button */}
          <SignUpButton mode="modal">
            <button className="group relative overflow-hidden px-4 sm:px-5 py-2 sm:py-2.5 rounded-xl font-semibold text-sm sm:text-base text-white transition-all duration-300 shadow-md hover:shadow-xl hover:scale-105">
              {/* Gradient background */}
              <div className="absolute inset-0 bg-gradient-to-r from-orange-500 via-amber-500 to-orange-500 bg-size-200 bg-pos-0 group-hover:bg-pos-100 transition-all duration-500"></div>
              
              {/* Shine effect */}
              <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-700"></div>
              
              <div className="relative flex items-center gap-2">
                <UserPlus className="w-4 h-4 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-12" />
                <span className="hidden sm:inline">ng K</span>
                <span className="sm:hidden">ng K</span>
              </div>
            </button>
          </SignUpButton>
        </div>
      </SignedOut>

      <SignedIn>
        <div className="group relative">
          {/* Decorative glow */}
          <div className="absolute -inset-1 bg-gradient-to-r from-orange-400 to-amber-400 rounded-2xl blur opacity-0 group-hover:opacity-30 transition-opacity duration-500"></div>
          
          {/* User button container */}
          <div className="relative flex items-center gap-3 px-3 sm:px-4 py-2 bg-gradient-to-r from-white to-amber-50 rounded-xl shadow-sm border border-orange-200/50 transition-all duration-300 group-hover:shadow-lg">
            <UserButton 
              appearance={{
                elements: {
                  avatarBox: 'w-9 h-9 sm:w-10 sm:h-10 ring-2 ring-orange-200 ring-offset-2 transition-all duration-300 hover:ring-orange-400',
                  userButtonPopoverCard: 'shadow-2xl border-orange-100',
                  userButtonPopoverActionButton: 'hover:bg-orange-50',
                }
              }}
              afterSignOutUrl="/"
            />
            
            {/* Welcome indicator */}
            <div className="hidden sm:flex items-center gap-2">
              <div className="w-2 h-2 rounded-full bg-gradient-to-r from-orange-500 to-amber-500 animate-pulse shadow-sm"></div>
              <span className="text-sm font-medium text-gray-700">Profile</span>
            </div>
          </div>
        </div>
      </SignedIn>
    </div>
  );
}
</file>

<file path="src/components/Auth/CombinedAuth.jsx">
import React from 'react';
import ClerkAuth from './ClerkAuth';
import FirebaseAuthButtons from './FirebaseAuthButtons';
import { useClerkAuthentication } from '../../hooks/useClerkAuth';
import { useFirebaseAuth } from '../../hooks/useFirebaseAuth';

export default function CombinedAuth() {
  const clerkAuth = useClerkAuthentication();
  const firebaseAuth = useFirebaseAuth();

  // Nu  ng nhp bng Clerk, ch hin th Clerk
  if (clerkAuth.isSignedIn) {
    return (
      <div className="flex items-center gap-2">
        <ClerkAuth />
        <div className="hidden sm:flex items-center gap-1.5 px-3 py-1.5 bg-orange-50 rounded-lg border border-orange-200">
          <span className="text-xs font-semibold text-orange-700">Clerk</span>
        </div>
      </div>
    );
  }

  // Nu  ng nhp bng Firebase, ch hin th Firebase
  if (firebaseAuth.isSignedIn) {
    return (
      <div className="flex items-center gap-2">
        <FirebaseAuthButtons />
        <div className="hidden sm:flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 rounded-lg border border-blue-200">
          <span className="text-xs font-semibold text-blue-700">Firebase</span>
        </div>
      </div>
    );
  }

  // Cha ng nhp - Hin th c 2 option
  return (
    <div className="flex items-center gap-2 sm:gap-3">
      {/* Clerk Auth Buttons */}
      <ClerkAuth />
      
      {/* Divider */}
      <div className="h-8 w-px bg-gray-300"></div>
      
      {/* Firebase Google Sign In */}
      <FirebaseAuthButtons />
    </div>
  );
}
</file>

<file path="src/components/Auth/FirebaseAuthButtons.jsx">
import React, { useState, useEffect, useRef } from 'react';
import { LogOut, User as UserIcon, CheckCircle, ChevronDown, Loader2 } from 'lucide-react';
import { useFirebaseAuth } from '../../hooks/useFirebaseAuth';

// Google Logo SVG Component (Gi nguyn)
const GoogleLogo = () => (
 <svg className="w-5 h-5" viewBox="0 0 24 24">
  <path
   fill="#4285F4"
   d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
  />
  <path
   fill="#34A853"
   d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
  />
  <path
   fill="#FBBC05"
   d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
  />
  <path
   fill="#EA4335"
   d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
  />
 </svg>
);

export default function FirebaseAuthButtons() {
 const { user, isSignedIn, loading, signInWithGoogle, signOut } = useFirebaseAuth();
 const [showDropdown, setShowDropdown] = useState(false);
 const dropdownRef = useRef(null);

 // X l click ngoi  ng dropdown
 useEffect(() => {
  const handleClickOutside = (event) => {
   if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
    setShowDropdown(false);
   }
  };
  document.addEventListener('mousedown', handleClickOutside);
  return () => document.removeEventListener('mousedown', handleClickOutside);
 }, []);

 const handleSignIn = async () => {
  // Logik ng nhp c gi li
  const result = await signInWithGoogle();
  if (result.success) {
   console.log(' ng nhp Firebase thnh cng!');
  } else {
   console.error(' ng nhp tht bi:', result.error);
  }
 };

 const handleSignOut = async () => {
  // Logik ng xut c gi li
  const result = await signOut();
  if (result.success) {
   console.log(' ng xut thnh cng!');
   setShowDropdown(false);
  }
 };

 // ----------------------------------------------------------------------
 // Signed Out State (Cha ng nhp) - Nt Google Sign In
 // ----------------------------------------------------------------------
 if (!isSignedIn) {
  return (
   <button
    onClick={handleSignIn}
    disabled={loading}
    className="group relative overflow-hidden px-4 sm:px-6 py-2 sm:py-2.5 bg-white rounded-full font-bold text-sm sm:text-base text-gray-700 transition-all duration-300 shadow-lg hover:shadow-xl border border-gray-200 hover:border-blue-500/50 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed disabled:shadow-md"
   >
    {/* Gradient background on hover for "pop" effect */}
    <div className="absolute inset-0 bg-gradient-to-r from-blue-50/50 via-white to-red-50/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-full"></div>
    
    <div className="relative flex items-center gap-2 sm:gap-3">
     {loading ? (
      <Loader2 className="w-5 h-5 text-blue-600 animate-spin" />
     ) : (
      <GoogleLogo />
     )}
     <span className="hidden sm:inline font-bold">ng nhp vi Google</span>
     <span className="sm:hidden font-bold">Google</span>
    </div>
   </button>
  );
 }

 // ----------------------------------------------------------------------
 // Signed In State ( ng nhp) - User Profile Widget
 // ----------------------------------------------------------------------
 const displayName = user?.displayName || user?.email?.split('@')[0] || 'User';
 const userInitial = displayName[0]?.toUpperCase() || 'U';

 return (
  <div className="relative" ref={dropdownRef}>
   {/* User Button */}
   <button
    onClick={() => setShowDropdown(!showDropdown)}
    className="flex items-center gap-2 sm:gap-3 px-2 py-1 bg-white rounded-full shadow-lg border border-blue-100/70 hover:shadow-xl transition-all duration-300 hover:border-blue-400/50 focus:outline-none focus:ring-4 focus:ring-blue-100"
   >
    {/* Avatar */}
    <div className="w-10 h-10 rounded-full ring-2 ring-white/50 ring-offset-1 ring-offset-blue-400/50 transition-all duration-300 overflow-hidden bg-gradient-to-br from-blue-400 to-purple-500 shadow-md">
     {user?.photoURL ? (
      <img
       src={user.photoURL}
       alt={displayName}
       className="w-full h-full object-cover"
      />
     ) : (
      <div className="w-full h-full flex items-center justify-center text-white font-bold text-lg">
       {userInitial}
      </div>
     )}
    </div>

    {/* Name & Dropdown Icon */}
    <div className='hidden sm:flex items-center gap-1.5'>
     <span className="text-sm font-bold text-gray-800 truncate max-w-[100px]">{displayName}</span>
     <ChevronDown className={`w-4 h-4 text-gray-500 transition-transform duration-300 ${showDropdown ? 'rotate-180' : ''}`} />
    </div>
   </button>

   {/* Dropdown Menu */}
   {showDropdown && (
    <div className="absolute right-0 mt-3 w-64 md:w-72 bg-white rounded-xl shadow-2xl border border-blue-200/50 py-2 z-50 origin-top-right transform scale-100 opacity-100 transition-all duration-300">
     {/* User Info Header */}
     <div className="px-4 py-3 border-b border-gray-100 bg-blue-50/50">
      <div className="flex items-center gap-2 mb-2">
       <GoogleLogo />
       <span className="text-xs font-semibold text-white bg-gradient-to-r from-blue-500 to-purple-500 px-2 py-0.5 rounded-full shadow-sm">
         ng nhp
       </span>
      </div>
      <p className="text-base font-extrabold text-gray-900 truncate">
       {user?.displayName || 'Ti khon ca bn'}
      </p>
      <p className="text-xs text-gray-500 truncate mt-1">
       {user?.email}
      </p>
     </div>

     {/* Menu Items */}
     <div className="py-1">
      {/* Profile Link */}
      <button
       className="w-full px-4 py-3 text-left text-sm font-medium text-gray-700 hover:bg-blue-50 transition-colors flex items-center gap-3"
       onClick={() => { setShowDropdown(false); /* Thm logic chuyn trang Profile  y */ }}
      >
       <UserIcon className="w-5 h-5 text-blue-600" />
       Thng tin c nhn
      </button>
      
      {/* Sign Out Button */}
      <button
       onClick={handleSignOut}
       disabled={loading}
       className="w-full px-4 py-3 text-left text-sm font-medium text-red-600 hover:bg-red-50 transition-colors flex items-center gap-3 border-t border-gray-100 mt-1"
      >
       <LogOut className="w-5 h-5" />
       {loading ? 'ang x l...' : 'ng xut'}
      </button>
     </div>
    </div>
   )}
  </div>
 );
}
</file>

<file path="src/components/Chat/ChatApp.jsx">
import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';
import { Send, Trash2, Users, MessageCircle, X, Menu, Smile } from 'lucide-react';
  
// Gi nh bn  import Socket.IO Client  mi trng ny
// const { io } = await import('socket.io-client'); // hoc import { io } from 'socket.io-client';

const SOCKET_URL = import.meta.env.VITE_SOCKET_URL || 'http://localhost:5000';
const TYPING_TIMEOUT = 3000; // 3 giy khng g s dng trng thi 'typing'

// --- Helper functions (Cng nn c tch ra file ring nu app ln) ---

const getCurrentUserId = (user) => user?.id || user?.uid || 'currentUser';
const getCurrentUserName = (user) => user?.name || user?.email?.split('@')[0] || user?.username || 'Bn';

const formatTime = (timestamp) => {
  if (!timestamp) return '';
  const date = new Date(timestamp);
  const diffInHours = (new Date() - date) / (1000 * 60 * 60);

  // Hin th gi-pht nu trong 24h, ngc li hin th c ngy
  if (diffInHours < 24) {
    return date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
  } else {
    return date.toLocaleDateString('vi-VN', { 
      day: '2-digit', 
      month: '2-digit', 
      hour: '2-digit', 
      minute: '2-digit' 
    });
  }
};

// --- Sub Component: Message Bubble (Tch ra  trnh re-render) ---

const MessageBubble = React.memo(({ msg, isCurrentUser, currentUserId, onDeleteMessage, showAvatar }) => {
  if (msg.isSystem) {
    return (
      <div className="w-full flex justify-center animate-messageSlideIn">
        <div className="relative bg-gradient-to-r from-purple-100 to-pink-100 backdrop-blur-sm text-gray-700 px-6 py-2.5 rounded-full text-sm shadow-md border border-purple-200 max-w-sm">
          <span className="font-semibold"> {msg.content}</span>
        </div>
      </div>
    );
  }

  return (
    <div
      className={`flex ${isCurrentUser ? 'justify-end' : 'justify-start'} animate-messageSlideIn`}
    >
      <div className={`flex gap-3 max-w-[85%] sm:max-w-[75%] md:max-w-[65%] ${isCurrentUser ? 'flex-row-reverse' : 'flex-row'}`}>
        
        {/* Avatar */}
        {!isCurrentUser && (
          <div className={`flex-shrink-0 ${showAvatar ? 'visible' : 'invisible'}`}>
            <div className="relative">
              <div className="w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 via-pink-400 to-indigo-500 flex items-center justify-center text-white font-bold shadow-lg ring-2 ring-white">
                {msg.sender.charAt(0).toUpperCase()}
              </div>
            </div>
          </div>
        )}

        {/* Message Content */}
        <div className="flex flex-col gap-1.5">
          {showAvatar && !isCurrentUser && (
            <span className="text-xs font-bold text-gray-600 ml-3">
              {msg.sender}
            </span>
          )}
          
          <div className="relative group">
            <div
              className={`relative px-5 py-3.5 rounded-3xl shadow-lg transition-all duration-300 hover:shadow-xl ${
                isCurrentUser
                  ? 'bg-gradient-to-br from-purple-600 via-pink-500 to-indigo-600 text-white rounded-br-lg'
                  : 'bg-white text-gray-800 rounded-bl-lg border-2 border-purple-100'
              }`}
            >
              <p className="text-sm sm:text-base break-words whitespace-pre-wrap leading-relaxed">
                {msg.content}
              </p>
              <p className={`text-xs mt-2 flex items-center gap-1 ${isCurrentUser ? 'text-purple-100' : 'text-gray-400'}`}>
                {formatTime(msg.timestamp)}
                {isCurrentUser && <span className="ml-1"></span>}
              </p>
            </div>

            {/* Action buttons (Delete) */}
            {isCurrentUser && (
              <div className={`absolute -left-12 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-all duration-300`}>
                <button
                  onClick={() => onDeleteMessage(msg.id)}
                  className="p-2.5 bg-red-50 hover:bg-red-100 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200"
                  title="Xa tin nhn"
                >
                  <Trash2 className="w-4 h-4 text-red-500" />
                </button>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
});

// --- Main Component ---

const ChatApp = ({ user }) => {
  const [messages, setMessages] = useState([]);
  const [inputValue, setInputValue] = useState('');
  const [onlineUsers, setOnlineUsers] = useState([]);
  const [isConnected, setIsConnected] = useState(false);
  const [loading, setLoading] = useState(true);
  const [showUsersList, setShowUsersList] = useState(false);
  const [typingUsers, setTypingUsers] = useState({}); // { 'userId': 'userName' }
  
  const socketRef = useRef(null);
  const typingTimerRef = useRef(null);
  const messagesEndRef = useRef(null);

  // Dng useMemo  ch tnh ton li khi user thay i
  const currentUserId = useMemo(() => getCurrentUserId(user), [user]);
  const currentUserName = useMemo(() => getCurrentUserName(user), [user]);

  // Dng useCallback  trnh vic hm b to li mi ln re-render
  const scrollToBottom = useCallback(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, []);

  // Cun xung cui khi messages thay i
  useEffect(() => {
    scrollToBottom();
  }, [messages, scrollToBottom]);

  // --- Socket.IO Connection & Events (Cleaned up) ---
  useEffect(() => {
    let ioInstance;
    
    const initSocket = async () => {
      try {
        const { io } = await import('socket.io-client');
        
        ioInstance = io(SOCKET_URL, {
          reconnection: true,
          reconnectionDelay: 1000,
          reconnectionAttempts: 10,
        });

        socketRef.current = ioInstance;

        // 1. Load Messages (Initial)
        const loadMessages = async () => {
          try {
            const res = await fetch(`${SOCKET_URL}/api/chat/messages`);
            const data = await res.json();
            if (data.success) {
              setMessages(data.data || []);
            }
          } catch (err) {
            console.error(' Error loading messages:', err);
          } finally {
            setLoading(false);
          }
        };
        loadMessages();
        
        // 2. Event Listeners
        ioInstance.on('connect', () => {
          setIsConnected(true);
          console.log(' Connected to chat server');
          
          const userData = { userId: currentUserId, userName: currentUserName, avatar: user?.avatar || '' };
          ioInstance.emit('user-join', userData);
        });

        ioInstance.on('receive-message', (message) => {
          setMessages(prev => [...prev, message]);
        });

        ioInstance.on('user-joined', ({ user: joinedUser, users: activeUsers }) => {
          setOnlineUsers(activeUsers);
          setMessages(prev => [...prev, {
            id: Date.now() + Math.random(), // m bo ID h thng l duy nht
            isSystem: true,
            content: `${joinedUser.userName}  tham gia`,
            timestamp: new Date(),
          }]);
        });

        ioInstance.on('user-left', ({ users: activeUsers }) => {
          setOnlineUsers(activeUsers);
          setMessages(prev => [...prev, {
            id: Date.now() + Math.random(),
            isSystem: true,
            content: 'Mt ngi dng  ri phng',
            timestamp: new Date(),
          }]);
        });

        ioInstance.on('message-deleted', (messageId) => {
          setMessages(prev => prev.filter(msg => msg.id !== messageId));
        });

        ioInstance.on('user-typing', ({ userId, userName }) => {
          if (userId !== currentUserId) {
            setTypingUsers(prev => ({ ...prev, [userId]: userName }));
          }
        });

        ioInstance.on('user-stop-typing', ({ userId }) => {
          setTypingUsers(prev => {
            const newState = { ...prev };
            delete newState[userId];
            return newState;
          });
        });

        ioInstance.on('disconnect', () => setIsConnected(false));
        ioInstance.on('connect_error', (error) => {
          console.error(' Connection error:', error);
          setLoading(false);
        });
        
      } catch (error) {
        console.error(' Socket.IO initialization error:', error);
        setLoading(false);
      }
    };

    initSocket();

    return () => {
      if (ioInstance) {
        ioInstance.off('connect');
        ioInstance.off('receive-message');
        ioInstance.off('user-joined');
        ioInstance.off('user-left');
        ioInstance.off('message-deleted');
        ioInstance.off('user-typing');
        ioInstance.off('user-stop-typing');
        ioInstance.off('disconnect');
        ioInstance.off('connect_error');
        ioInstance.disconnect();
      }
    };
  }, [currentUserId, currentUserName, user]); // Ph thuc vo user info

  // --- Handlers (Use useCallback) ---

  const handleSendMessage = useCallback((e) => {
    e.preventDefault();
    const content = inputValue.trim();
    if (!content || !isConnected || !socketRef.current) return;

    const messageData = { content, sender: currentUserName, senderId: currentUserId };
    socketRef.current.emit('send-message', messageData);
    setInputValue('');
    
    // m bo trng thi typing dng li ngay sau khi gi
    clearTimeout(typingTimerRef.current);
    socketRef.current.emit('stop-typing', { userId: currentUserId });
    typingTimerRef.current = null;
  }, [inputValue, isConnected, currentUserName, currentUserId]);

  const handleDeleteMessage = useCallback((messageId) => {
    if (!socketRef.current) return;
    // Server s kim tra quyn trc khi xa
    socketRef.current.emit('delete-message', messageId); 
  }, []);

  const handleInputChange = (e) => {
    const value = e.target.value;
    setInputValue(value);

    if (!isConnected || !socketRef.current) return;

    // Logic Typing Indicator
    if (value.length > 0) {
      if (!typingTimerRef.current) {
        // Bt u g
        socketRef.current.emit('typing', { userId: currentUserId, userName: currentUserName });
      } else {
        //  g, xa timer c
        clearTimeout(typingTimerRef.current);
      }

      // Thit lp timer mi
      typingTimerRef.current = setTimeout(() => {
        socketRef.current.emit('stop-typing', { userId: currentUserId });
        typingTimerRef.current = null;
      }, TYPING_TIMEOUT);

    } else if (typingTimerRef.current) {
      // Xa ht ch
      clearTimeout(typingTimerRef.current);
      socketRef.current.emit('stop-typing', { userId: currentUserId });
      typingTimerRef.current = null;
    }
  };

  // --- Rendering Helpers ---
  
  const typingUsersList = useMemo(() => {
    const names = Object.values(typingUsers);
    if (names.length === 0) return '';
    if (names.length === 1) return `${names[0]} ang g...`;
    if (names.length === 2) return `${names.join(' v ')} ang g...`;
    return 'Mt s ngi ang g...';
  }, [typingUsers]);
  
  // --- JSX ---

  if (loading) {
    // ... (Loading state gi nguyn)
    return (
      <div className="flex items-center justify-center h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-indigo-50">
        <div className="text-center">
          <div className="relative">
            <div className="w-20 h-20 border-4 border-transparent border-t-purple-600 border-r-pink-500 border-b-indigo-600 rounded-full animate-spin mx-auto mb-6"></div>
            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
              <MessageCircle className="w-10 h-10 text-purple-600 animate-pulse" />
            </div>
          </div>
          <p className="text-gray-800 text-xl font-bold mb-2">ang kt ni chat...</p>
          <p className="text-gray-500 text-sm">Sp xong ri! </p>
        </div>
      </div>
    );
  }

  return (
    <div className="flex h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-indigo-50 overflow-hidden relative">
      {/* Floating particles background (Tch CSS ra file ring) */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        <div className="absolute w-2 h-2 bg-purple-300 rounded-full animate-float" style={{top: '10%', left: '10%', animationDelay: '0s'}}></div>
        {/* ... Thm cc phn t khc nu cn ... */}
      </div>

      {/* Sidebar Overlay */}
      {showUsersList && (
        <div 
          className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden animate-fadeIn"
          onClick={() => setShowUsersList(false)}
        />
      )}

      {/* Users sidebar (B cc gi nguyn, responsive tt) */}
      <div className={`
        fixed lg:relative inset-y-0 left-0 z-50
        w-80 sm:w-96 lg:w-80 xl:w-96
        bg-white/95 backdrop-blur-xl shadow-2xl lg:shadow-xl
        transform transition-all duration-500 ease-out
        ${showUsersList ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}
        flex flex-col
        border-r border-purple-100
      `}>
        {/* Sidebar Header */}
        <div className="relative p-5 bg-gradient-to-br from-purple-600 via-pink-500 to-indigo-600 text-white overflow-hidden">
          <div className="absolute inset-0 bg-white/10 backdrop-blur-sm"></div>
          <div className="relative flex items-center justify-between">
            <div>
              <h3 className="font-bold text-xl flex items-center gap-2 mb-1">
                <div className="p-2 bg-white/20 rounded-xl backdrop-blur-sm"><Users className="w-5 h-5" /></div>
                ang Online
              </h3>
              <p className="text-sm text-purple-100">{onlineUsers.length} ngi ang hot ng</p>
            </div>
            <button
              onClick={() => setShowUsersList(false)}
              className="lg:hidden p-2 bg-white/20 hover:bg-white/30 rounded-xl transition-all duration-200"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>

        {/* Users List */}
        <div className="flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin">
          {onlineUsers.length > 0 ? (
            onlineUsers.map((u, idx) => (
              <div 
                key={u.socketId} 
                className="group relative p-4 bg-gradient-to-br from-white to-purple-50 rounded-2xl border border-purple-100 hover:border-purple-300 hover:shadow-lg transition-all duration-300 cursor-pointer transform hover:-translate-y-1"
                style={{ animation: `slideIn 0.4s ease-out ${idx * 0.05}s both` }} // Tng tc  animation
              >
                <div className="flex items-center gap-3">
                  <div className="relative">
                    <div className="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 via-pink-500 to-indigo-500 flex items-center justify-center text-white text-xl shadow-lg">
                      {u.avatar}
                    </div>
                    <span className="absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full animate-pulse"></span>
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="font-bold text-gray-800 truncate group-hover:text-purple-600 text-base">
                      {u.userName} {u.userId === currentUserId && '(Bn)'}
                    </p>
                    <div className="flex items-center gap-1.5 text-xs text-green-600 font-medium">
                      <span className="w-2 h-2 bg-green-500 rounded-full absolute"></span>
                      ang hot ng
                    </div>
                  </div>
                </div>
              </div>
            ))
          ) : (
            <div className="flex flex-col items-center justify-center h-full text-gray-400 py-20">
              <div className="w-24 h-24 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full flex items-center justify-center mb-4">
                <Users className="w-12 h-12 text-purple-400" />
              </div>
              <p className="text-base font-semibold text-gray-600">Cha c ai online</p>
            </div>
          )}
        </div>
      </div>

      {/* Chat section */}
      <div className="relative flex-1 flex flex-col min-w-0">
        {/* Header with glassmorphism */}
        <div className="relative bg-gradient-to-r from-purple-600 via-pink-500 to-indigo-600 text-white p-4 shadow-xl flex items-center justify-between overflow-hidden z-10">
          <div className="absolute inset-0 bg-white/10 backdrop-blur-lg"></div>
          
          <div className="relative flex items-center gap-3 min-w-0 flex-1">
            {/* Mobile Menu Button */}
            <button
              onClick={() => setShowUsersList(true)}
              className="lg:hidden p-2.5 bg-white/20 hover:bg-white/30 rounded-xl transition-all duration-200 backdrop-blur-sm"
            >
              <Menu className="w-5 h-5" />
            </button>
            <div className="min-w-0 flex-1">
              <h1 className="text-xl sm:text-2xl font-bold flex items-center gap-3 truncate mb-0.5">
                <span className="bg-gradient-to-r from-white to-purple-100 bg-clip-text text-transparent">Global Chat</span>
              </h1>
              {/* Typing Indicator */}
              <p className={`text-sm flex items-center gap-2 ${typingUsersList ? 'text-green-200' : 'text-purple-100'}`}>
                <span className={`w-2.5 h-2.5 rounded-full ${isConnected ? 'bg-green-400 shadow-lg shadow-green-400/50 animate-pulse' : 'bg-red-400'}`}></span>
                {typingUsersList || (isConnected ? `${onlineUsers.length} ngi online` : 'ang kt ni...')}
              </p>
            </div>
          </div>
          
          <button
            onClick={() => setShowUsersList(!showUsersList)}
            className="hidden lg:flex items-center gap-2 bg-white/20 hover:bg-white/30 px-5 py-2.5 rounded-xl transition-all duration-200 backdrop-blur-sm font-semibold"
          >
            <Users className="w-5 h-5" />
            {onlineUsers.length}
          </button>
        </div>

        {/* Messages container */}
        <div className="relative flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 min-h-0 scrollbar-thin">
          {messages.length === 0 ? (
            <div className="flex items-center justify-center h-full">
              <div className="text-center animate-fadeIn">
                <div className="w-32 h-32 bg-gradient-to-br from-purple-100 via-pink-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                  <MessageCircle className="w-16 h-16 text-purple-500" />
                </div>
                <p className="text-gray-700 text-xl font-bold mb-2">Cha c tin nhn no</p>
                <p className="text-gray-500 text-base">Hy l ngi u tin bt u tr chuyn! </p>
              </div>
            </div>
          ) : (
            messages.map((msg, index) => {
              const isMsgFromCurrentUser = msg.senderId === currentUserId;
              const prevMsg = messages[index - 1];
              // n avatar nu tin nhn trc  cng l ca ngi gi ny v khng phi tin h thng
              const shouldShowAvatar = !prevMsg || prevMsg.senderId !== msg.senderId || prevMsg.isSystem;
              
              return (
                <MessageBubble
                  key={msg.id}
                  msg={msg}
                  isCurrentUser={isMsgFromCurrentUser}
                  currentUserId={currentUserId}
                  onDeleteMessage={handleDeleteMessage}
                  showAvatar={shouldShowAvatar}
                />
              );
            })
          )}
          <div ref={messagesEndRef} />
        </div>

        {/* Enhanced Input section */}
        <div className="relative bg-white/80 backdrop-blur-xl border-t border-purple-200 p-4 shadow-2xl z-10">
          <form onSubmit={handleSendMessage} className="flex gap-3 items-end">
            <div className="flex-1 relative">
              <textarea
                value={inputValue}
                onChange={handleInputChange} // Dng handler mi
                onKeyDown={(e) => {
                  if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage(e);
                  }
                }}
                placeholder={isConnected ? "Nhp tin nhn ca bn..." : "ang kt ni li..."}
                disabled={!isConnected}
                rows={1}
                className="w-full border-2 border-purple-200 rounded-2xl px-5 pr-16 py-3.5 text-base focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed transition-all duration-200 shadow-md resize-none"
                style={{minHeight: '50px', maxHeight: '120px'}}
              />
              
              {/* Quick action buttons (Emoji, Attachment) */}
              <div className="absolute right-3 bottom-3 flex gap-2">
                <button type="button" className="p-2 hover:bg-purple-50 rounded-lg transition-colors" title="Emoji">
                  <Smile className="w-5 h-5 text-gray-400 hover:text-purple-500" />
                </button>
              </div>
            </div>
            
            <button
              type="submit"
              disabled={!isConnected || !inputValue.trim()}
              className="p-4 bg-gradient-to-br from-purple-600 via-pink-500 to-indigo-600 hover:from-purple-700 hover:via-pink-600 hover:to-indigo-700 disabled:from-gray-400 disabled:to-gray-400 disabled:cursor-not-allowed text-white rounded-2xl font-semibold transition-all duration-200 shadow-lg hover:shadow-xl disabled:shadow-none transform hover:scale-105 active:scale-95 disabled:transform-none"
            >
              <Send className="w-5 h-5" />
            </button>
          </form>
          
          {!isConnected && (
            <div className="flex items-center gap-2 text-red-500 text-sm mt-3 bg-red-50 px-4 py-2.5 rounded-xl shadow-md animate-pulse">
              <span className="w-2 h-2 bg-red-500 rounded-full"></span>
              ang kt ni li ti my ch...
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default ChatApp;
</file>

<file path="src/components/common/Badge.jsx">
export const Badge = ({ children, variant = 'default', size = 'sm' }) => {
    const variants = {
        default: 'bg-indigo-100 text-indigo-800',
        success: 'bg-green-100 text-green-800',
        warning: 'bg-amber-100 text-amber-800',
        gray: 'bg-gray-100 text-gray-600',
    };

    const sizes = {
        sm: 'text-xs px-2.5 py-1',
        md: 'text-sm px-3.5 py-1.5',
    };

    return (
        <span className={`rounded-full font-medium inline-flex items-center ${variants[variant]} ${sizes[size]}`}>
            {children}
        </span>
    );
};
</file>

<file path="src/components/common/Button.jsx">
export const Button = ({ 
    variant = 'primary', 
    size = 'md', 
    children, 
    icon: Icon, 
    fullWidth, 
    disabled, 
    className = '',
    ...props 
}) => {
    const variants = {
        primary: 'bg-indigo-600 text-white hover:bg-indigo-700 active:bg-indigo-800 focus:ring-indigo-500',
        secondary: 'bg-gray-100 text-gray-800 hover:bg-gray-200 active:bg-gray-300 focus:ring-gray-400 border border-gray-200',
        danger: 'bg-red-600 text-white hover:bg-red-700 active:bg-red-800 focus:ring-red-500',
        success: 'bg-green-600 text-white hover:bg-green-700 active:bg-green-800 focus:ring-green-500',
        ghost: 'bg-transparent text-gray-700 hover:bg-gray-100 active:bg-gray-200 focus:ring-gray-300 border border-transparent',
    };

    const sizes = {
        sm: 'px-3 py-2 text-sm',
        md: 'px-4 py-2.5 text-base',
        lg: 'px-6 py-3 text-lg',
    };

    return (
        <button
            className={`
                inline-flex items-center justify-center gap-2 font-semibold
                transition-all rounded-xl disabled:opacity-50 disabled:cursor-not-allowed
                focus:outline-none focus:ring-4 focus:ring-opacity-50
                ${variants[variant]} ${sizes[size]} ${fullWidth ? 'w-full' : ''} ${className}
            `}
            disabled={disabled}
            {...props}
        >
            {Icon && <Icon className="w-5 h-5" />}
            {children}
        </button>
    );
};
</file>

<file path="src/components/common/Card.jsx">
export const Card = ({ children, className = '', elevated = false }) => (
    <div
        className={`
            bg-white rounded-2xl border border-gray-100
            ${elevated ? 'shadow-xl hover:shadow-2xl transition-shadow' : 'shadow-md'}
            ${className}
        `}
    >
        {children}
    </div>
);
</file>

<file path="src/components/common/CollapsibleSection.jsx">
import React from 'react';
import { ChevronDown, ChevronUp } from 'lucide-react';

export const CollapsibleSection = ({ 
  title, 
  icon: Icon, 
  isOpen, 
  onToggle, 
  children,
  variant = 'default' 
}) => {
  const variants = {
    default: 'border-orange-200 hover:border-orange-300',
    info: 'border-blue-200 hover:border-blue-300',
    controls: 'border-purple-200 hover:border-purple-300'
  };

  return (
    <div className="mb-3 sm:mb-4">
      <button
        onClick={onToggle}
        className={`w-full flex items-center justify-between p-2.5 sm:p-3 md:p-4 bg-white/95 backdrop-blur-sm rounded-xl shadow-md border-2 ${variants[variant]} transition-all hover:shadow-lg group`}
        aria-expanded={isOpen}
      >
        <span className="text-sm sm:text-base md:text-lg font-bold text-gray-900 flex items-center gap-2">
          {Icon && <Icon className="w-4 h-4 sm:w-5 sm:h-5 text-orange-600" />}
          {title}
        </span>
        {isOpen ? (
          <ChevronUp className="w-4 h-4 sm:w-5 sm:h-5 text-orange-600 group-hover:scale-110 transition-transform" />
        ) : (
          <ChevronDown className="w-4 h-4 sm:w-5 sm:h-5 text-orange-600 group-hover:scale-110 transition-transform" />
        )}
      </button>
      
      {isOpen && (
        <div className="mt-2 animate-slideDown">
          {children}
        </div>
      )}
    </div>
  );
};
export default CollapsibleSection;
</file>

<file path="src/components/common/InfoCard.jsx">
import React from 'react';

export const InfoCard = ({ icon: Icon, title, items, variant = 'default' }) => {
  const variants = {
    default: { bg: 'bg-orange-50/95', border: 'border-orange-200', text: 'text-orange-600' },
    info: { bg: 'bg-blue-50/95', border: 'border-blue-200', text: 'text-blue-600' },
    warning: { bg: 'bg-yellow-50/95', border: 'border-yellow-200', text: 'text-yellow-600' },
    success: { bg: 'bg-green-50/95', border: 'border-green-200', 'text': 'text-green-600' }
  };

  const style = variants[variant];

  return (
    <div className={`p-2.5 sm:p-3 md:p-4 ${style.bg} backdrop-blur-sm rounded-xl shadow-md border-2 ${style.border}`}>
      <h3 className="text-sm sm:text-base md:text-lg font-bold text-gray-900 mb-2 flex items-center gap-2">
        {Icon && <Icon className={`w-4 h-4 sm:w-5 sm:h-5 ${style.text}`} />}
        {title}
      </h3>
      <ul className="space-y-1.5 text-gray-800 text-xs sm:text-sm">
        {items.map((item, index) => (
          <li key={index} className="flex items-start gap-2">
            <span className={`${style.text} font-bold mt-0.5 flex-shrink-0`}></span>
            <span className="flex-1">{item}</span>
          </li>
        ))}
      </ul>
    </div>
  );
};
export default InfoCard;
</file>

<file path="src/components/common/LoadingSpinner.css">
/* Earth Loader Styles */
.earth-loader {
  position: relative;
  width: 6rem;
  height: 6rem;
  background-color: #3344c1;
  border-radius: 50%;
  overflow: hidden;
  border: 3px solid white;
  box-shadow: inset 0 0.5em rgba(255, 255, 255, 0.25),
              inset 0 -0.5em rgba(0, 0, 0, 0.25);
  animation: startround 1s;
  animation-iteration-count: 1;
}

@media (min-width: 640px) {
  .earth-loader {
    width: 7.5rem;
    height: 7.5rem;
  }
}

@media (min-width: 768px) {
  .earth-loader {
    width: 8.5rem;
    height: 8.5rem;
  }
}

/* Land Mass Positions */
.land-mass-1 {
  position: absolute;
  bottom: -2em;
  width: 7em;
  height: auto;
  animation: round1 5s infinite linear 0.75s;
}

.land-mass-2 {
  position: absolute;
  top: -3em;
  width: 7em;
  height: auto;
  animation: round1 5s infinite linear;
}

.land-mass-3 {
  position: absolute;
  top: -2.5em;
  width: 7em;
  height: auto;
  animation: round2 5s infinite linear;
}

.land-mass-4 {
  position: absolute;
  bottom: -2.2em;
  width: 7em;
  height: auto;
  animation: round2 5s infinite linear 0.75s;
}

/* Animations */
@keyframes startround {
  0% {
    filter: brightness(500%);
    box-shadow: none;
  }
  75% {
    filter: brightness(500%);
    box-shadow: none;
  }
  100% {
    filter: brightness(100%);
    box-shadow: inset 0 0.5em rgba(255, 255, 255, 0.25),
                inset 0 -0.5em rgba(0, 0, 0, 0.25);
  }
}

@keyframes round1 {
  0% {
    left: -2em;
    opacity: 1;
    transform: skewX(0deg) rotate(0deg);
  }
  30% {
    left: -6em;
    opacity: 1;
    transform: skewX(-25deg) rotate(25deg);
  }
  31% {
    left: -6em;
    opacity: 0;
    transform: skewX(-25deg) rotate(25deg);
  }
  35% {
    left: 7em;
    opacity: 0;
    transform: skewX(25deg) rotate(-25deg);
  }
  45% {
    left: 7em;
    opacity: 1;
    transform: skewX(25deg) rotate(-25deg);
  }
  100% {
    left: -2em;
    opacity: 1;
    transform: skewX(0deg) rotate(0deg);
  }
}

@keyframes round2 {
  0% {
    left: 5em;
    opacity: 1;
    transform: skewX(0deg) rotate(0deg);
  }
  75% {
    left: -7em;
    opacity: 1;
    transform: skewX(-25deg) rotate(25deg);
  }
  76% {
    left: -7em;
    opacity: 0;
    transform: skewX(-25deg) rotate(25deg);
  }
  77% {
    left: 8em;
    opacity: 0;
    transform: skewX(25deg) rotate(-25deg);
  }
  80% {
    left: 8em;
    opacity: 1;
    transform: skewX(25deg) rotate(-25deg);
  }
  100% {
    left: 5em;
    opacity: 1;
    transform: skewX(0deg) rotate(0deg);
  }
}

/* Accessibility */
@media (prefers-reduced-motion: reduce) {
  .earth-loader,
  .land-mass-1,
  .land-mass-2,
  .land-mass-3,
  .land-mass-4 {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
  }
}
</file>

<file path="src/components/common/StatBox.jsx">
import { TrendingUp, ArrowRight } from 'lucide-react';
import { Card } from './Card';

export const StatBox = ({ label, value, icon: Icon, trend }) => (
    <Card className="p-6" elevated>
        <div className="flex items-center justify-between">
            <div>
                <p className="text-gray-500 text-sm font-medium mb-1 uppercase tracking-wider">{label}</p>
                <p className="text-4xl font-extrabold text-gray-900">{value}</p>
            </div>
            {Icon && (
                <div className="p-3 bg-indigo-50 rounded-full">
                    <Icon className="w-8 h-8 text-indigo-600" />
                </div>
            )}
        </div>
        {trend !== undefined && (
            <p className={`text-sm mt-3 flex items-center ${trend > 0 ? 'text-green-600' : 'text-gray-500'}`}>
                {trend > 0 ? <TrendingUp className="w-4 h-4 mr-1" /> : <ArrowRight className="w-4 h-4 mr-1" />}
                <span className="font-semibold">{Math.abs(trend)}%</span> trong thng ny
            </p>
        )}
    </Card>
);
</file>

<file path="src/components/ConfettiEffect.jsx">
import React from 'react';

const ConfettiEffect = ({ count = 50 }) => {
  return (
    <>
      {[...Array(count)].map((_, i) => (
        <div
          key={i}
          className="confetti-piece animate-confetti"
          style={{
            left: `${Math.random() * 100}%`,
            top: `${Math.random() * 100}%`,
            backgroundColor: ['#3B82F6', '#8B5CF6', '#EC4899', '#10B981', '#F59E0B'][
              Math.floor(Math.random() * 5)
            ],
            animationDelay: `${Math.random() * 0.5}s`,
            transform: `rotate(${Math.random() * 360}deg)`,
          }}
        />
      ))}
    </>
  );
};

export default ConfettiEffect;
</file>

<file path="src/components/Display/Readingdisplay.jsx">
import React, { useState, useMemo, memo } from 'react';
import { ChevronDown, ChevronUp, BookOpen, Lightbulb, Zap, Mail, Globe, Clock, User, ArrowRight, MessageCircle, FileText, Calendar, Users, CheckCircle2, AlertCircle, Info } from 'lucide-react';

/**
 * ==========================================
 * READING DISPLAY - ENTERPRISE PROFESSIONAL
 * ==========================================
 * Corporate Design System
 * - Premium color palette
 * - Sophisticated typography
 * - Professional spacing & layout
 * - Enterprise micro-interactions
 */

// ==========================================
// PART 6: TEXT COMPLETION DISPLAY
// ==========================================
const Part6Content = memo(({ data }) => {
  const [expandedPart, setExpandedPart] = useState(true);

  if (!data || !data.text || !data.questions) {
    return <p className="text-red-600 text-sm font-medium">Invalid data format</p>;
  }

  const { text, questions } = data;
  const fillQuestions = questions.filter(q => q.type === "fill");
  
  let displayText = text;
  fillQuestions.forEach(question => {
    const blank = `(${question.id})`;
    const marker = `**${question.id}**`;
    displayText = displayText.replace(blank, marker);
  });

  const splitParts = displayText.split(/\*\*(\d+)\*\*/);

  const renderContent = () => (
    <div className="text-slate-700 leading-[1.8] text-[15.5px] font-[450]">
      {splitParts.map((part, index) => {
        if (index % 2 === 0) {
          return <span key={index} className="text-slate-800">{part}</span>;
        } else {
          const questionId = part;
          return (
            <span
              key={index}
              className="inline-flex mx-0.5 px-3.5 py-2
                bg-gradient-to-b from-amber-50 to-amber-50/80 
                border border-amber-300/60 rounded-lg 
                text-amber-900 font-semibold text-xs
                shadow-sm hover:shadow-md hover:border-amber-400/80
                transition-all duration-200 cursor-pointer
                ring-1 ring-amber-200/40"
            >
              [{questionId}]
            </span>
          );
        }
      })}
    </div>
  );

  return (
    <div className="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
      <button
        onClick={() => setExpandedPart(!expandedPart)}
        className="w-full px-6 py-5 flex items-center justify-between hover:bg-slate-50/50 transition-colors border-b border-slate-200 group"
      >
        <div className="flex items-center gap-4 text-left flex-1">
          <div className="flex-shrink-0 w-10 h-10 
            bg-gradient-to-br from-slate-900 to-slate-800 rounded-lg 
            flex items-center justify-center shadow-lg">
            <span className="text-white font-bold text-base">6</span>
          </div>
          
          <div>
            <h2 className="text-lg font-semibold text-slate-900">{data.title}</h2>
            <p className="text-sm text-slate-600 mt-1 font-[450]">{data.description}</p>
          </div>
        </div>
        
        <div className="flex-shrink-0 text-slate-400 group-hover:text-slate-900 transition-colors">
          {expandedPart ? (
            <ChevronUp className="w-5 h-5" />
          ) : (
            <ChevronDown className="w-5 h-5" />
          )}
        </div>
      </button>

      {expandedPart && (
        <div className="px-6 py-6 space-y-6 animate-in fade-in duration-200">
          <div className="bg-gradient-to-br from-slate-50 to-slate-50/70 rounded-lg p-5 border border-slate-200 shadow-sm">
            <div className="flex items-center gap-2.5 mb-3.5 pb-3 border-b border-slate-200">
              <div className="p-2 bg-slate-900/10 rounded-lg">
                <BookOpen className="w-4 h-4 text-slate-900" strokeWidth={2.2} />
              </div>
              <p className="font-semibold text-slate-900 text-sm">Reading Text</p>
            </div>
            {renderContent()}
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="bg-gradient-to-br from-blue-50 to-blue-50/60 rounded-lg p-4 border border-blue-200/50 shadow-xs hover:shadow-sm transition-shadow">
              <p className="text-xs font-semibold text-blue-900 mb-2 flex items-center gap-2">
                <Zap className="w-3.5 h-3.5" /> Instructions
              </p>
              <p className="text-xs text-blue-800 leading-relaxed font-[450]">Select the correct answer (A, B, C, or D) to fill in each blank space.</p>
            </div>
            
            <div className="bg-gradient-to-br from-emerald-50 to-emerald-50/60 rounded-lg p-4 border border-emerald-200/50 shadow-xs hover:shadow-sm transition-shadow">
              <p className="text-xs font-semibold text-emerald-900 mb-2 flex items-center gap-2">
                <Lightbulb className="w-3.5 h-3.5" /> Tip
              </p>
              <p className="text-xs text-emerald-800 leading-relaxed font-[450]">Read the entire text to understand the context before answering.</p>
            </div>
          </div>
        </div>
      )}
    </div>
  );
});

Part6Content.displayName = 'Part6Content';

// ==========================================
// PART 7: WEBSITE + EMAIL DISPLAY
// ==========================================
const Part7Content = memo(({ data }) => {
  const parseText = (inputText) => {
    try {
      if (!inputText || typeof inputText !== 'string') {
        return { website: null, email: null };
      }

      const trimmed = inputText.trim();
      if (trimmed.length === 0) {
        return { website: null, email: null };
      }

      let websiteContent = [];
      let emailData = { headers: {}, body: [] };
      const hasSeparator = trimmed.includes('---');
      
      if (hasSeparator) {
        const parts = trimmed.split('---');
        
        if (parts[0]) {
          websiteContent = parts[0].trim().split('\n');
        }
        
        if (parts[1]) {
          const emailLines = parts[1].trim().split('\n');
          let isHeaderSection = true;
          
          for (let line of emailLines) {
            line = line.trim();
            
            if (line === '**Email Message**' || line === 'Email Message') {
              continue;
            }
            
            if (line.startsWith('**To:**') || line.startsWith('To:')) {
              emailData.headers.to = line.replace(/\*\*?To:\*\*?\s*/, '').trim();
            }
            else if (line.startsWith('**From:**') || line.startsWith('From:')) {
              emailData.headers.from = line.replace(/\*\*?From:\*\*?\s*/, '').trim();
            }
            else if (line.startsWith('**Date:**') || line.startsWith('Date:')) {
              emailData.headers.date = line.replace(/\*\*?Date:\*\*?\s*/, '').trim();
            }
            else if (line.startsWith('**Subject:**') || line.startsWith('Subject:')) {
              emailData.headers.subject = line.replace(/\*\*?Subject:\*\*?\s*/, '').trim();
              isHeaderSection = false;
            }
            else if (!isHeaderSection && line.length > 0) {
              emailData.body.push(line);
            }
            else if (!isHeaderSection) {
              emailData.body.push('');
            }
          }
        }
      } else {
        const lines = trimmed.split('\n');
        let isEmailSection = false;
        
        for (let line of lines) {
          line = line.trim();
          
          if (line.startsWith('To:') || line.startsWith('**To:**')) {
            isEmailSection = true;
            emailData.headers.to = line.replace(/\*\*?To:\*\*?\s*/, '').trim();
          }
          else if (line.startsWith('From:') || line.startsWith('**From:**')) {
            emailData.headers.from = line.replace(/\*\*?From:\*\*?\s*/, '').trim();
          }
          else if (line.startsWith('Date:') || line.startsWith('**Date:**')) {
            emailData.headers.date = line.replace(/\*\*?Date:\*\*?\s*/, '').trim();
          }
          else if (line.startsWith('Subject:') || line.startsWith('**Subject:**')) {
            emailData.headers.subject = line.replace(/\*\*?Subject:\*\*?\s*/, '').trim();
          }
          else if (line.length > 0) {
            if (isEmailSection) {
              emailData.body.push(line);
            } else {
              websiteContent.push(line);
            }
          } else if (isEmailSection) {
            emailData.body.push('');
          }
        }
      }
      
      return {
        website: websiteContent.length > 0 ? websiteContent : null,
        email: Object.keys(emailData.headers).length > 0 ? emailData : null
      };
    } catch (error) {
      console.error('Error parsing text:', error);
      return { website: null, email: null };
    }
  };

  const { website, email } = parseText(data?.text || '');

  if (!website && !email) {
    return (
      <div className="bg-slate-50 border border-slate-300 rounded-lg p-8 text-center">
        <p className="text-slate-600 text-sm font-medium">No content to display</p>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      {website && <WebsiteDisplay content={website} />}
      {email && <EmailDisplay emailData={email} />}
    </div>
  );
});

Part7Content.displayName = 'Part7Content';

// ==========================================
// WEBSITE DISPLAY COMPONENT
// ==========================================
function WebsiteDisplay({ content }) {
  if (!content || content.length === 0) return null;

  let url = '';
  let title = '';
  let subtitle = '';
  let sections = [];
  let currentSection = { title: '', items: [], text: [] };

  content.forEach((line, idx) => {
    if (line.startsWith('http') && !url) {
      url = line;
    }
    else if (!title && line.includes('**') && idx < 3) {
      title = line.replace(/\*\*/g, '');
    }
    else if (!subtitle && title && line.length > 0 && idx < 5) {
      subtitle = line.replace(/\*\*/g, '');
    }
    else if (line.startsWith('**') && line.endsWith('**')) {
      if (currentSection.title || currentSection.items.length > 0 || currentSection.text.length > 0) {
        sections.push({ ...currentSection });
      }
      currentSection = { title: line.replace(/\*\*/g, ''), items: [], text: [] };
    }
    else if (/^\d+\.\s/.test(line)) {
      const match = line.match(/^(\d+)\.\s(.+)$/);
      if (match) {
        currentSection.items.push(match[2].replace(/\*\*/g, ''));
      }
    }
    else if (line.length > 0) {
      currentSection.text.push(line.replace(/\*\*/g, ''));
    }
  });

  if (currentSection.title || currentSection.items.length > 0 || currentSection.text.length > 0) {
    sections.push(currentSection);
  }

  return (
    <div className="bg-white border border-slate-200 shadow-md rounded-xl overflow-hidden">
      {/* Browser Bar */}
      <div className="bg-gradient-to-b from-slate-100 to-slate-100/80 border-b border-slate-300 px-4 py-3">
        <div className="flex items-center gap-3">
          <div className="flex gap-1.5">
            <div className="w-2.5 h-2.5 rounded-full bg-red-500 shadow-sm"></div>
            <div className="w-2.5 h-2.5 rounded-full bg-yellow-400 shadow-sm"></div>
            <div className="w-2.5 h-2.5 rounded-full bg-green-500 shadow-sm"></div>
          </div>
          <div className="flex-1 bg-white border border-slate-300 rounded-md px-3 py-2 flex items-center gap-2 shadow-xs">
            <Globe className="w-3.5 h-3.5 text-slate-600" />
            <span className="text-xs text-slate-700 truncate font-medium">{url || 'https://www.example.com'}</span>
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="bg-white/95 p-8">
        {title && (
          <div className="text-center mb-8 pb-6 border-b border-slate-200">
            <h1 className="text-3xl font-bold text-slate-900 mb-3">
              {title}
            </h1>
            {subtitle && (
              <p className="text-base text-slate-600 italic font-[450] mt-2">
                {subtitle}
              </p>
            )}
          </div>
        )}

        <div className="space-y-8">
          {sections.map((section, idx) => (
            <div key={idx}>
              {section.title && (
                <h2 className="text-xl font-semibold text-slate-900 mb-4 pb-2 border-l-4 border-slate-900 pl-4">
                  {section.title}
                </h2>
              )}
              
              {section.text.length > 0 && (
                <div className="space-y-4 mb-5">
                  {section.text.map((para, pIdx) => (
                    <p key={pIdx} className="text-base text-slate-700 leading-[1.75] font-[450]">
                      {para}
                    </p>
                  ))}
                </div>
              )}

              {section.items.length > 0 && (
                <div className="space-y-3">
                  {section.items.map((item, iIdx) => (
                    <div key={iIdx} className="flex gap-4 items-start bg-slate-50/60 p-4 rounded-lg border border-slate-200 hover:border-slate-300 transition-colors">
                      <div className="flex-shrink-0 w-6 h-6 rounded-full bg-slate-900 text-white flex items-center justify-center text-xs font-bold shadow-sm">
                        {iIdx + 1}
                      </div>
                      <p className="flex-1 text-base text-slate-800 leading-relaxed pt-0.5 font-[450]">
                        {item}
                      </p>
                    </div>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// ==========================================
// EMAIL DISPLAY COMPONENT
// ==========================================
function EmailDisplay({ emailData }) {
  if (!emailData || !emailData.headers) return null;

  const getInitial = (text) => {
    return text ? text.charAt(0).toUpperCase() : '?';
  };

  const getName = (email) => {
    if (!email) return '';
    const match = email.match(/^([^@]+)@/);
    if (match) {
      return match[1].split(/[._-]/).map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
      ).join(' ');
    }
    return email;
  };

  const getAvatarColor = (email) => {
    const colors = [
      'from-slate-900 to-slate-800',
      'from-blue-700 to-blue-600',
      'from-purple-700 to-purple-600',
      'from-indigo-700 to-indigo-600',
      'from-slate-700 to-slate-600',
      'from-slate-800 to-slate-700',
    ];
    const index = (email?.charCodeAt(0) || 0) % colors.length;
    return colors[index];
  };

  const senderName = getName(emailData.headers.from);
  const senderInitial = getInitial(senderName);
  const avatarColor = getAvatarColor(emailData.headers.from);

  return (
    <div className="bg-white border border-slate-200 shadow-md rounded-xl overflow-hidden">
      {/* Header */}
      <div className="bg-gradient-to-r from-slate-50 to-white border-b border-slate-200 px-6 py-4 flex items-center justify-between">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-slate-900 rounded-lg flex items-center justify-center shadow-md">
            <Mail className="w-5 h-5 text-white" />
          </div>
          <div>
            <h2 className="text-base font-semibold text-slate-900">Email</h2>
            <p className="text-xs text-slate-600 hidden md:block font-[450]">Message</p>
          </div>
        </div>
      </div>

      <div className="p-6">
        <div className="bg-white border border-slate-200 shadow-sm rounded-lg overflow-hidden">
          
          {/* Subject Bar */}
          {emailData.headers.subject && (
            <div className="bg-gradient-to-r from-slate-900 to-slate-800 px-6 py-5">
              <div className="flex items-start gap-3">
                <Mail className="w-5 h-5 text-white mt-0.5 flex-shrink-0" />
                <div className="flex-1 min-w-0">
                  <div className="text-xs font-semibold text-slate-300 uppercase tracking-wider mb-2">
                    Subject
                  </div>
                  <h3 className="text-lg font-semibold text-white leading-tight break-words">
                    {emailData.headers.subject}
                  </h3>
                </div>
              </div>
            </div>
          )}

          {/* Sender Info */}
          <div className="bg-slate-50/50 border-b border-slate-200 px-6 py-5">
            <div className="flex items-start gap-4">
              <div className="flex-shrink-0">
                <div className={`w-12 h-12 bg-gradient-to-br ${avatarColor} rounded-lg flex items-center justify-center shadow-sm`}>
                  <span className="text-white font-bold text-base">
                    {senderInitial}
                  </span>
                </div>
              </div>

              <div className="flex-1 min-w-0">
                <h4 className="text-base font-semibold text-slate-900 mb-1 truncate">
                  {senderName}
                </h4>
                <p className="text-sm text-slate-600 font-[450] truncate mb-3">
                  {emailData.headers.from}
                </p>

                <div className="space-y-2.5">
                  {emailData.headers.to && (
                    <div className="flex items-center gap-2.5 text-xs bg-white px-3 py-2 rounded-md border border-slate-200 w-fit">
                      <User className="w-3.5 h-3.5 text-slate-600 flex-shrink-0" />
                      <span className="text-slate-700 font-semibold">To:</span>
                      <span className="text-slate-800 font-[450] truncate">{emailData.headers.to}</span>
                    </div>
                  )}
                  {emailData.headers.date && (
                    <div className="flex items-center gap-2.5 text-xs bg-white px-3 py-2 rounded-md border border-slate-200 w-fit">
                      <Clock className="w-3.5 h-3.5 text-slate-600 flex-shrink-0" />
                      <span className="text-slate-700 font-[450]">{emailData.headers.date}</span>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>

          {/* Body */}
          <div className="bg-white px-8 py-8 min-h-[220px]">
            <div className="max-w-3xl">
              <div className="space-y-4 text-slate-700">
                {emailData.body.map((line, idx) => (
                  line === '' ? (
                    <div key={idx} className="h-2"></div>
                  ) : (
                    <p key={idx} className="text-base leading-relaxed text-slate-700 font-[450]">
                      {line}
                    </p>
                  )
                ))}
              </div>
            </div>
          </div>

          {/* Footer */}
          <div className="bg-slate-50 border-t border-slate-200 px-6 py-4 flex items-center justify-between flex-wrap gap-3">
            <div className="flex items-center gap-2.5">
              <button className="px-5 py-2.5 bg-slate-900 hover:bg-slate-800 text-white rounded-lg font-medium text-sm shadow-sm hover:shadow-md transition-all flex items-center gap-2">
                <Mail className="w-4 h-4" />
                <span>Reply</span>
              </button>
              <button className="px-5 py-2.5 bg-white hover:bg-slate-50 text-slate-700 border border-slate-300 rounded-lg font-medium text-sm shadow-xs hover:shadow-sm transition-all">
                Forward
              </button>
            </div>
            <div className="flex items-center gap-2 text-xs text-slate-600">
              <div className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
              <span>End of message</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// ==========================================
// PART 8: CHAT/MESSAGE THREADS
// ==========================================
const Part8Content = memo(({ data }) => {
  const parseText = (inputText) => {
    try {
      if (!inputText || typeof inputText !== 'string') {
        return [];
      }

      const trimmed = inputText.trim();
      if (trimmed.length === 0) {
        return [];
      }

      const sections = [];
      const lines = trimmed.split('\n');
      
      let currentSection = { type: 'text', content: [] };
      let chatMeta = { platform: '', date: '', participants: '' };
      
      for (let i = 0; i < lines.length; i++) {
        let line = lines[i];
        if (!line) continue;
        
        line = line.trim();
        if (!line) continue;

        if (line.match(/^\*\*.*Thread\*\*$/i) || 
            line.match(/^\*\*.*Conversation\*\*$/i) ||
            line.match(/^\*\*.*Chat\*\*$/i) ||
            line.match(/^\*\*.*Messages?\*\*$/i)) {
          
          if (currentSection.content && currentSection.content.length > 0) {
            sections.push(currentSection);
            currentSection = { type: 'text', content: [] };
          }

          const headerTitle = line.replace(/\*\*/g, '').trim();
          sections.push({ 
            type: 'chat-header', 
            title: headerTitle,
          });
          continue;
        }

        if (line.startsWith('**Date:**')) {
          const dateMatch = line.match(/\*\*Date:\*\*\s*(.+)/);
          if (dateMatch) {
            chatMeta.date = dateMatch[1].trim();
            
            if (currentSection.type === 'textmessage' && currentSection.messages?.length > 0) {
              sections.push(currentSection);
              sections.push({ type: 'date-separator', date: chatMeta.date });
              currentSection = { type: 'textmessage', messages: [], meta: { ...chatMeta } };
            } else {
              sections.push({ type: 'date-separator', date: chatMeta.date });
            }
          }
          continue;
        }

        if (line.startsWith('**Participants:**')) {
          const participantsMatch = line.match(/\*\*Participants:\*\*\s*(.+)/);
          if (participantsMatch) {
            chatMeta.participants = participantsMatch[1].trim();
          }
          continue;
        }

        const textMsgMatch = line.match(/^([A-Za-z0-9\s.]+?)\s*\((\d{1,2}:\d{2})\):\s*(.+)$/);
        
        if (textMsgMatch && textMsgMatch[1] && textMsgMatch[2] && textMsgMatch[3]) {
          if (currentSection.type !== 'textmessage') {
            if (currentSection.content && currentSection.content.length > 0) {
              sections.push(currentSection);
            }
            currentSection = { 
              type: 'textmessage', 
              messages: [], 
              meta: { ...chatMeta } 
            };
          }
          
          currentSection.messages.push({
            sender: textMsgMatch[1].trim(),
            time: textMsgMatch[2],
            message: textMsgMatch[3]
          });
        } else {
          if (currentSection.type === 'textmessage' && currentSection.messages && currentSection.messages.length > 0) {
            sections.push(currentSection);
            currentSection = { type: 'text', content: [] };
          }
          
          currentSection.content.push(line);
        }
      }
      
      if (currentSection.type === 'textmessage' && currentSection.messages && currentSection.messages.length > 0) {
        sections.push(currentSection);
      } else if (currentSection.content && currentSection.content.length > 0) {
        sections.push(currentSection);
      }
      
      return sections.filter(s => s.type !== 'text' || s.content.some(c => c.length > 0));
    } catch (error) {
      console.error('Error parsing text:', error);
      return [];
    }
  };

  const renderTextMessages = (section) => {
    if (!section?.messages || !Array.isArray(section.messages) || section.messages.length === 0) {
      return null;
    }

    const uniqueSenders = Array.from(new Set(section.messages.map(msg => msg.sender)));
    const groupedMessages = [];
    let currentGroup = null;

    section.messages.forEach((msg) => {
      if (!currentGroup || currentGroup.sender !== msg.sender) {
        currentGroup = { sender: msg.sender, messages: [msg] };
        groupedMessages.push(currentGroup);
      } else {
        currentGroup.messages.push(msg);
      }
    });

    const senderColors = {};
    const colors = [
      { name: 'text-slate-900', bubble: 'bg-slate-900 text-white', received: 'bg-slate-100 text-slate-900' },
      { name: 'text-blue-700', bubble: 'bg-blue-700 text-white', received: 'bg-slate-100 text-slate-900' },
      { name: 'text-purple-700', bubble: 'bg-purple-700 text-white', received: 'bg-slate-100 text-slate-900' },
    ];
    
    uniqueSenders.forEach((sender, index) => {
      senderColors[sender] = colors[index % colors.length];
    });
    
    const firstSender = section.messages[0]?.sender;
    
    return (
      <div className="bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden">
        
        <div className="px-5 py-4 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-white flex flex-wrap items-center justify-between gap-3">
          <div className="flex items-center gap-3">
            <Users className="w-4 h-4 text-slate-600" />
            <p className="text-slate-800 font-semibold text-sm truncate">
              {section.meta?.participants || 'Conversation'}
            </p>
          </div>
          {section.meta?.date && (
            <div className="flex items-center gap-2 text-slate-600 text-xs font-[450]">
              <Calendar className="w-3.5 h-3.5" />
              <span>{section.meta.date}</span>
            </div>
          )}
        </div>

        <div className="p-5 space-y-4 max-h-[500px] overflow-y-auto">
          {groupedMessages.map((group, groupIdx) => {
            const colorScheme = senderColors[group.sender] || colors[0];
            const isFirstSender = group.sender === firstSender;
            
            return (
              <div key={groupIdx} className="flex flex-col">
                <div className={`mb-2 flex items-center gap-2 ${isFirstSender ? 'justify-end' : 'justify-start'}`}>
                  <span className={`text-xs font-semibold ${colorScheme.name}`}>
                    {group.sender}
                  </span>
                </div>

                <div className={`flex ${isFirstSender ? 'justify-end' : 'justify-start'}`}>
                  <div className="space-y-2 max-w-[80%]">
                    {group.messages.map((msg, msgIdx) => (
                      <div key={msgIdx} className={`flex ${isFirstSender ? 'justify-end' : 'justify-start'}`}>
                        <div 
                          className={`px-4 py-3 rounded-lg shadow-xs text-sm leading-relaxed break-words transition-all font-[450] ${
                            isFirstSender ? colorScheme.bubble : colorScheme.received
                          }`}
                          style={{
                            borderTopRightRadius: isFirstSender && msgIdx === 0 ? '4px' : '10px',
                            borderTopLeftRadius: !isFirstSender && msgIdx === 0 ? '4px' : '10px',
                            borderBottomRightRadius: isFirstSender && msgIdx === group.messages.length - 1 ? '4px' : '10px',
                            borderBottomLeftRadius: !isFirstSender && msgIdx === group.messages.length - 1 ? '4px' : '10px',
                          }}
                        >
                          {msg.message}
                        </div>
                      </div>
                    ))}
                    
                    <div className={`mt-2 ${isFirstSender ? 'text-right' : 'text-left'}`}>
                      <span className="text-xs text-slate-600 font-[450]">
                        {group.messages[group.messages.length - 1]?.time}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );
  };

  const renderChatHeader = (section) => {
    let gradientFrom = 'from-slate-900';
    let gradientTo = 'to-slate-800';
    
    const titleLower = section.title.toLowerCase();
    
    if (titleLower.includes('linkedin')) {
      gradientFrom = 'from-blue-700';
      gradientTo = 'to-blue-600';
    } else if (titleLower.includes('whatsapp')) {
      gradientFrom = 'from-green-700';
      gradientTo = 'to-green-600';
    }

    return (
      <div className="bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden mb-6">
        <div className={`bg-gradient-to-r ${gradientFrom} ${gradientTo} px-6 py-5`}>
          <div className="flex items-center gap-4">
            <div className="p-2.5 rounded-lg bg-white/20 flex-shrink-0">
              <MessageCircle className="w-5 h-5 text-white" />
            </div>
            
            <div className="flex-1 min-w-0">
              <h2 className="text-white font-semibold text-lg truncate">
                {section.title}
              </h2>
              <p className="text-white/70 text-xs font-[450] mt-1 hidden md:block">
                Professional chat conversation
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  };

  const renderDateSeparator = (section) => (
    <div className="flex items-center gap-3.5 my-4">
      <div className="flex-1 h-px bg-slate-300"></div>
      <div className="flex items-center gap-2 bg-slate-50 px-4 py-2 rounded-full shadow-xs border border-slate-200">
        <Calendar className="w-3.5 h-3.5 text-slate-600" />
        <span className="text-xs font-semibold text-slate-700">{section.date}</span>
      </div>
      <div className="flex-1 h-px bg-slate-300"></div>
    </div>
  );

  const renderText = (section) => (
    <div className="bg-white rounded-lg shadow-md border border-slate-200 p-6">
      <div className="space-y-4">
        {Array.isArray(section.content) && section.content.map((line, idx) => (
          <p key={idx} className="text-slate-800 leading-relaxed text-base font-[450]">
            {line}
          </p>
        ))}
      </div>
    </div>
  );

  const sections = parseText(data?.text || '');

  if (!sections || sections.length === 0) {
    return (
      <div className="bg-slate-50 rounded-lg shadow-md border border-slate-200 p-8 text-center">
        <FileText className="w-8 h-8 text-slate-400 mx-auto mb-3" />
        <p className="text-slate-700 font-semibold text-sm">No content to display</p>
      </div>
    );
  }

  return (
    <div className="space-y-5">
      {sections.map((section, idx) => {
        if (!section) return null;
        
        if (section.type === 'chat-header') {
          return <div key={idx}>{renderChatHeader(section)}</div>;
        } else if (section.type === 'textmessage') {
          return <div key={idx}>{renderTextMessages(section)}</div>;
        } else if (section.type === 'date-separator') {
          return <div key={idx}>{renderDateSeparator(section)}</div>;
        } else {
          return <div key={idx}>{renderText(section)}</div>;
        }
      })}
    </div>
  );
});

Part8Content.displayName = 'Part8Content';

// ==========================================
// PLAIN TEXT DISPLAY - PROFESSIONAL
// ==========================================
const PlainTextContent = memo(({ data }) => {
  const text = data?.text || '';
  const wordCount = text.trim().split(/\s+/).length;
  const readingTime = Math.ceil(wordCount / 200);
  const paragraphs = text.trim().split('\n\n').filter(p => p.trim());

  return (
    <div className="space-y-6 w-full">
      {/* Header */}
      <div className="space-y-5">
        <div className="flex items-start gap-4">
          <div className="p-3 rounded-lg bg-slate-900/10 shadow-sm border border-slate-200/50">
            <BookOpen className="w-5 h-5 text-slate-900" strokeWidth={2.2} />
          </div>
          <div className="flex-1 min-w-0">
            <h2 className="text-2xl font-bold text-slate-900">{data?.title || 'Reading'}</h2>
            <p className="text-sm text-slate-600 mt-1.5 font-[450]">{data?.description || ''}</p>
          </div>
        </div>

        {/* Stats */}
        <div className="grid grid-cols-3 gap-3.5">
          <div className="bg-gradient-to-br from-blue-50 to-blue-50/70 rounded-lg p-4 border border-blue-200/50 shadow-xs hover:shadow-sm transition-shadow">
            <p className="text-xs font-semibold text-blue-900 uppercase tracking-wider">Words</p>
            <p className="text-2xl font-bold text-blue-900 mt-2">{wordCount.toLocaleString()}</p>
          </div>
          <div className="bg-gradient-to-br from-amber-50 to-amber-50/70 rounded-lg p-4 border border-amber-200/50 shadow-xs hover:shadow-sm transition-shadow">
            <p className="text-xs font-semibold text-amber-900 uppercase tracking-wider">Time</p>
            <p className="text-2xl font-bold text-amber-900 mt-2">~{readingTime}m</p>
          </div>
          <div className="bg-gradient-to-br from-purple-50 to-purple-50/70 rounded-lg p-4 border border-purple-200/50 shadow-xs hover:shadow-sm transition-shadow">
            <p className="text-xs font-semibold text-purple-900 uppercase tracking-wider">Paragraphs</p>
            <p className="text-2xl font-bold text-purple-900 mt-2">{paragraphs.length}</p>
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="bg-white rounded-xl border border-slate-200 shadow-md overflow-hidden">
        
        {/* Header Bar */}
        <div className="px-6 py-5 bg-gradient-to-r from-slate-50 via-white to-slate-50 border-b border-slate-200 flex items-center justify-between">
          <div>
            <p className="text-base font-semibold text-slate-900">
              Reading Content
            </p>
            <p className="text-xs text-slate-600 mt-1 font-[450]">Professional reading material</p>
          </div>
          <div className="hidden md:flex w-10 h-10 rounded-lg bg-slate-900 flex items-center justify-center shadow-md">
            <BookOpen className="w-5 h-5 text-white" strokeWidth={2.2} />
          </div>
        </div>

        {/* Body */}
        <div className="p-6 md:p-8 max-h-[60rem] overflow-y-auto">
          <div className="space-y-6">
            {paragraphs.map((paragraph, idx) => (
              <div key={idx} className="flex gap-5 group">
                {/* Line Number */}
                <div className="hidden md:flex items-start pt-1">
                  <span className="text-xs font-semibold text-slate-500 bg-slate-100 group-hover:bg-slate-200 rounded px-3 py-1.5 h-fit flex-shrink-0 transition-colors duration-200 w-8 text-center">
                    {idx + 1}
                  </span>
                </div>
                
                {/* Paragraph */}
                <p className="text-base leading-[1.8] text-slate-800 break-words group-hover:text-slate-900 transition-colors duration-200 font-[450]">
                  {paragraph}
                </p>
              </div>
            ))}
          </div>
        </div>

        {/* Footer */}
        <div className="px-6 py-4 bg-gradient-to-r from-slate-50 to-white border-t border-slate-200 flex items-center justify-between flex-wrap gap-3">
          <div className="flex items-center gap-2.5">
            <div className="w-1.5 h-1.5 rounded-full bg-green-600 animate-pulse"></div>
            <span className="text-xs text-slate-700 font-semibold">Ready to read</span>
          </div>
          <div className="text-xs text-slate-600 font-[450]">
            {wordCount} words  {paragraphs.length} paragraphs
          </div>
        </div>
      </div>

      {/* Reading Tips */}
      <div className="bg-gradient-to-br from-blue-50/80 to-blue-50 rounded-lg border border-blue-200/50 p-5 shadow-xs hover:shadow-sm transition-shadow">
        <div className="flex items-start gap-3.5">
          <div className="p-2.5 bg-blue-900 rounded-lg flex-shrink-0">
            <Lightbulb className="w-4 h-4 text-white" />
          </div>
          <div>
            <h3 className="font-semibold text-blue-900 text-sm mb-2.5">Professional Reading Tips</h3>
            <ul className="text-xs text-blue-800 space-y-2 font-[450]">
              <li className="flex gap-2.5"><span className="text-blue-700 font-bold"></span> <span>Read methodically and focus on each paragraph's key concepts</span></li>
              <li className="flex gap-2.5"><span className="text-blue-700 font-bold"></span> <span>Annotate important terms and critical information</span></li>
              <li className="flex gap-2.5"><span className="text-blue-700 font-bold"></span> <span>Maintain comprehension even with unfamiliar terminology</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
});

PlainTextContent.displayName = 'PlainTextContent';

// ==========================================
// MAIN COMPONENT
// ==========================================
const ReadingDisplay = memo(({ data }) => {
  const contentType = useMemo(() => {
    if (!data) return 'empty';

    if (data.text && data.questions && 
        data.questions.some(q => q.type === 'fill')) {
      return 'part6';
    }

    if (data.text && (data.text.includes('---') || data.text.includes('To:') || data.text.includes('From:'))) {
      return 'part7';
    }

    if (data.text && (data.text.match(/\(\d{1,2}:\d{2}\)/) || data.text.includes('**Chat') || data.text.includes('**Message'))) {
      return 'part8';
    }

    return 'plain';
  }, [data]);

  if (!data) {
    return (
      <div className="bg-gradient-to-br from-slate-50 to-white rounded-lg border border-slate-200 shadow-md p-10 text-center">
        <BookOpen className="w-8 h-8 text-slate-400 mx-auto mb-4" strokeWidth={1.8} />
        <p className="text-slate-900 font-semibold text-base">No Content</p>
        <p className="text-slate-600 text-sm mt-2 font-[450]">Select a section to view content</p>
      </div>
    );
  }

  return (
    <div className="animate-in fade-in duration-300 w-full">
      {contentType === 'part6' && <Part6Content data={data} />}
      {contentType === 'part7' && <Part7Content data={data} />}
      {contentType === 'part8' && <Part8Content data={data} />}
      {contentType === 'plain' && <PlainTextContent data={data} />}
    </div>
  );
});

ReadingDisplay.displayName = 'ReadingDisplay';

export default ReadingDisplay;
</file>

<file path="src/components/Display/ReadingPart6Display.jsx">
import React, { useState } from 'react';
import { ChevronDown, ChevronUp, BookOpen, Lightbulb, Zap } from 'lucide-react';

/**
 * Component hin th  bi Reading Part 6 (Text Completion)
 *  ti u ha cho Mobile-First, giao din hin i, kch thc ch ph hp.
 */
const Part6Display = ({ part6 = null }) => {
 const [expandedPart, setExpandedPart] = useState(true);

 // --- 1. X l trng hp khng c d liu ---
 if (!part6) {
  return (
   <div className="bg-red-50 rounded-xl shadow-md border border-red-200 p-4 text-center">
    <p className="text-red-700 font-semibold text-sm flex items-center justify-center gap-2">
     <Zap className="w-4 h-4" /> Khng tm thy d liu Part 6
    </p>
   </div>
  );
 }

 // --- 2. Hm render ni dung vn bn ---
 const renderContent = (part6Data) => {
  if (!part6Data || !part6Data.text || !part6Data.questions) {
   return <p className="text-red-600 text-sm">D liu vn bn khng hp l</p>;
  }

  const { text, questions } = part6Data;
  
  const fillQuestions = questions.filter(q => q.type === "fill");
  
  let displayText = text;
  // Thay th cc blank placeholder (v d: (131)) bng marker (**131**)
  fillQuestions.forEach(question => {
   const blank = `(${question.id})`;
   const marker = `**${question.id}**`;
   displayText = displayText.replace(blank, marker);
  });

  // Tch vn bn ti cc marker (**ID**)
  const splitParts = displayText.split(/\*\*(\d+)\*\*/);

  return (
   <div className="text-gray-700 leading-relaxed whitespace-pre-wrap text-sm">
    {splitParts.map((part, index) => {
     // Phn text thng thng
     if (index % 2 === 0) {
      return <span key={index} className="text-gray-800">{part}</span>;
     } 
     // Phn ch trng (Question ID)
     else {
      const questionId = part; // y l ID dng chui (v d: "131")
      return (
       <span
        key={index}
        className="inline-block mx-1.5 px-3 py-0.5 
         bg-amber-50 border-2 border-amber-400 rounded-lg 
         text-amber-900 font-extrabold text-xs shadow-inner 
         md:text-sm"
       >
        ({questionId})
       </span>
      );
     }
    })}
   </div>
  );
 };

 // --- 3. Component chnh ---
 return (
  <div className="bg-white rounded-xl shadow-lg border border-slate-100 overflow-hidden">
   
   {/* Part Header (Collapse/Expand Button) */}
   <button
    onClick={() => setExpandedPart(!expandedPart)}
    className="w-full p-4 md:p-5 flex items-center justify-between hover:bg-slate-50 transition-colors border-b border-gray-100"
   >
    <div className="flex items-center gap-3 md:gap-4 text-left flex-1">
     {/* Icon/Badge */}
     <div className="flex-shrink-0 w-8 h-8 md:w-10 md:h-10 
      bg-gradient-to-br from-blue-600 to-blue-500 rounded-full 
      flex items-center justify-center shadow-md">
      <span className="text-white font-black text-sm md:text-base">P6</span>
     </div>
     
     {/* Title and Description */}
     <div>
      <h2 className="text-base font-bold text-gray-900 md:text-lg">{part6.title}</h2>
      <p className="text-xs text-gray-500 md:text-sm">{part6.description}</p>
     </div>
    </div>
    
    {/* Expand/Collapse Icon */}
    <div className="flex-shrink-0">
     {expandedPart ? (
      <ChevronUp className="w-5 h-5 text-blue-500" />
     ) : (
      <ChevronDown className="w-5 h-5 text-gray-400" />
     )}
    </div>
   </button>

   {/* Part Content */}
   {expandedPart && (
    <div className="px-4 py-4 space-y-4 md:px-6 md:py-6 md:space-y-6">
     
     {/* Vn bn gc ca Part 6 */}
     <div className="bg-white rounded-lg p-4 border border-slate-200 shadow-inner">
      <div className="flex items-center gap-2 mb-3 border-b pb-2">
       <BookOpen className="w-4 h-4 text-blue-500" />
       <p className="font-bold text-blue-800 text-sm">Vn bn (Text Completion)</p>
      </div>
      {renderContent(part6)}
     </div>

     {/* Tips Section */}
     <div className="grid grid-cols-1 gap-3 md:grid-cols-2 md:gap-4">
      {/* Hng dn */}
      <div className
       ="bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500 shadow-sm">
       <p className="text-sm font-bold text-blue-900 mb-0.5 flex items-center gap-1">
        <Zap className="w-4 h-4" /> Hng dn
       </p>
       <p className="text-xs text-blue-800 md:text-sm">Chn t/cm thch hp (t A, B, C, hoc D)  in vo cc ch trng.</p>
      </div>
      
      {/* Mo */}
      <div className
       ="bg-amber-50 rounded-lg p-3 border-l-4 border-amber-500 shadow-sm">
       <p className="text-sm font-bold text-amber-900 mb-0.5 flex items-center gap-1">
        <Lightbulb className="w-4 h-4" /> Mo lm bi
       </p>
       <p className="text-xs text-amber-800 md:text-sm">c nhanh ton b vn bn  hiu ng cnh trc khi tp trung vo tng cu hi.</p>
      </div>
     </div>
    </div>
   )}
  </div>
 );
};

export default Part6Display;
</file>

<file path="src/components/Display/ReadingPart7Display.jsx">
// ReadingPart7Display.jsx
import React from 'react';
import { Mail, Globe, Clock, User, ArrowRight } from 'lucide-react';

/**
 * Component hin th text  bi Reading Part 7
 * H tr: Website/Advertisement pha trn, Email pha di
 */
export default function ReadingPart7Display({ text = '' }) {
  
  const parseText = (inputText) => {
    try {
      if (!inputText || typeof inputText !== 'string') {
        return { website: null, email: null };
      }

      const trimmed = inputText.trim();
      if (trimmed.length === 0) {
        return { website: null, email: null };
      }

      // Split by separator "---" or detect email section by "To:"
      let websiteContent = [];
      let emailData = { headers: {}, body: [] };
      
      // Check if there's a separator
      const hasSeparator = trimmed.includes('---');
      
      if (hasSeparator) {
        // Split by separator
        const parts = trimmed.split('---');
        
        // First part is website
        if (parts[0]) {
          websiteContent = parts[0].trim().split('\n');
        }
        
        // Second part is email
        if (parts[1]) {
          const emailLines = parts[1].trim().split('\n');
          let isHeaderSection = true;
          
          for (let line of emailLines) {
            line = line.trim();
            
            // Skip "Email Message" header
            if (line === '**Email Message**' || line === 'Email Message') {
              continue;
            }
            
            // Parse email headers
            if (line.startsWith('**To:**') || line.startsWith('To:')) {
              emailData.headers.to = line.replace(/\*\*?To:\*\*?\s*/, '').trim();
            }
            else if (line.startsWith('**From:**') || line.startsWith('From:')) {
              emailData.headers.from = line.replace(/\*\*?From:\*\*?\s*/, '').trim();
            }
            else if (line.startsWith('**Date:**') || line.startsWith('Date:')) {
              emailData.headers.date = line.replace(/\*\*?Date:\*\*?\s*/, '').trim();
            }
            else if (line.startsWith('**Subject:**') || line.startsWith('Subject:')) {
              emailData.headers.subject = line.replace(/\*\*?Subject:\*\*?\s*/, '').trim();
              isHeaderSection = false; // After subject, body starts
            }
            // Email body content
            else if (!isHeaderSection && line.length > 0) {
              emailData.body.push(line);
            }
            else if (!isHeaderSection) {
              emailData.body.push(''); // Preserve empty lines
            }
          }
        }
      } else {
        // Fallback: detect by "To:" keyword
        const lines = trimmed.split('\n');
        let isEmailSection = false;
        
        for (let line of lines) {
          line = line.trim();
          
          if (line.startsWith('To:') || line.startsWith('**To:**')) {
            isEmailSection = true;
            emailData.headers.to = line.replace(/\*\*?To:\*\*?\s*/, '').trim();
          }
          else if (line.startsWith('From:') || line.startsWith('**From:**')) {
            emailData.headers.from = line.replace(/\*\*?From:\*\*?\s*/, '').trim();
          }
          else if (line.startsWith('Date:') || line.startsWith('**Date:**')) {
            emailData.headers.date = line.replace(/\*\*?Date:\*\*?\s*/, '').trim();
          }
          else if (line.startsWith('Subject:') || line.startsWith('**Subject:**')) {
            emailData.headers.subject = line.replace(/\*\*?Subject:\*\*?\s*/, '').trim();
          }
          else if (line.length > 0) {
            if (isEmailSection) {
              emailData.body.push(line);
            } else {
              websiteContent.push(line);
            }
          } else if (isEmailSection) {
            emailData.body.push('');
          }
        }
      }
      
      return {
        website: websiteContent.length > 0 ? websiteContent : null,
        email: Object.keys(emailData.headers).length > 0 ? emailData : null
      };
    } catch (error) {
      console.error('Error parsing text:', error);
      return { website: null, email: null };
    }
  };

  const { website, email } = parseText(text);

  // Debug log
  console.log('Parsed data:', { 
    hasWebsite: !!website, 
    hasEmail: !!email,
    emailHeaders: email?.headers 
  });

  if (!website && !email) {
    return (
      <div className="bg-gray-50 border-2 border-gray-300 rounded p-8 text-center">
        <p className="text-gray-500 text-sm">Khng c ni dung  hin th.</p>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {website && <WebsiteDisplay content={website} />}
      {email && <EmailDisplay emailData={email} />}
    </div>
  );
}

/**
 * Component hin th Website/Advertisement
 */
function WebsiteDisplay({ content }) {
  if (!content || content.length === 0) return null;

  // Parse website content
  let url = '';
  let title = '';
  let subtitle = '';
  let sections = [];
  let currentSection = { title: '', items: [], text: [] };

  content.forEach((line, idx) => {
    // URL detection
    if (line.startsWith('http') && !url) {
      url = line;
    }
    // Main title
    else if (!title && line.includes('**') && idx < 3) {
      title = line.replace(/\*\*/g, '');
    }
    // Subtitle
    else if (!subtitle && title && line.length > 0 && idx < 5) {
      subtitle = line.replace(/\*\*/g, '');
    }
    // Section headers
    else if (line.startsWith('**') && line.endsWith('**')) {
      if (currentSection.title || currentSection.items.length > 0 || currentSection.text.length > 0) {
        sections.push({ ...currentSection });
      }
      currentSection = { title: line.replace(/\*\*/g, ''), items: [], text: [] };
    }
    // Numbered lists
    else if (/^\d+\.\s/.test(line)) {
      const match = line.match(/^(\d+)\.\s(.+)$/);
      if (match) {
        currentSection.items.push(match[2].replace(/\*\*/g, ''));
      }
    }
    // Regular text
    else if (line.length > 0) {
      currentSection.text.push(line.replace(/\*\*/g, ''));
    }
  });

  if (currentSection.title || currentSection.items.length > 0 || currentSection.text.length > 0) {
    sections.push(currentSection);
  }

  return (
    <div className="bg-white border-2 border-gray-300 shadow-md">
      {/* Browser Bar */}
      <div className="bg-gradient-to-b from-gray-100 to-gray-200 border-b border-gray-400 px-3 py-2.5">
        <div className="flex items-center gap-2">
          <div className="flex gap-1.5">
            <div className="w-3 h-3 rounded-full bg-red-500 border border-red-600 shadow-sm"></div>
            <div className="w-3 h-3 rounded-full bg-yellow-400 border border-yellow-500 shadow-sm"></div>
            <div className="w-3 h-3 rounded-full bg-green-500 border border-green-600 shadow-sm"></div>
          </div>
          <div className="flex-1 bg-white border border-gray-300 rounded-md px-3 py-1.5 flex items-center gap-2 shadow-sm">
            <Globe className="w-3.5 h-3.5 text-gray-500" />
            <span className="text-xs text-gray-700 truncate font-medium">{url || 'http://www.globalexectravel.com'}</span>
          </div>
          <button className="w-7 h-7 bg-gray-300 hover:bg-gray-400 rounded flex items-center justify-center border border-gray-400 shadow-sm transition-colors">
            <span className="text-gray-700 font-bold text-xs"></span>
          </button>
        </div>
      </div>

      {/* Website Content */}
      <div className="bg-white p-6 md:p-10">
        {/* Header */}
        {title && (
          <div className="text-center mb-6 pb-5 border-b-2 border-gray-300">
            <h1 className="text-2xl md:text-3xl font-bold text-gray-900 mb-2">
              {title}
            </h1>
            {subtitle && (
              <p className="text-sm md:text-base text-gray-700 italic mt-2">
                {subtitle}
              </p>
            )}
          </div>
        )}

        {/* Sections */}
        <div className="space-y-6">
          {sections.map((section, idx) => (
            <div key={idx}>
              {section.title && (
                <h2 className="text-lg md:text-xl font-bold text-gray-900 mb-3 border-l-4 border-blue-600 pl-3">
                  {section.title}
                </h2>
              )}
              
              {/* Text paragraphs */}
              {section.text.length > 0 && (
                <div className="space-y-3 mb-4">
                  {section.text.map((para, pIdx) => (
                    <p key={pIdx} className="text-sm md:text-base text-gray-800 leading-relaxed">
                      {para}
                    </p>
                  ))}
                </div>
              )}

              {/* Numbered items */}
              {section.items.length > 0 && (
                <div className="space-y-3">
                  {section.items.map((item, iIdx) => (
                    <div key={iIdx} className="flex gap-3 items-start bg-blue-50 p-3 rounded-lg border-l-4 border-blue-500">
                      <span className="flex-shrink-0 w-7 h-7 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold shadow-sm">
                        {iIdx + 1}
                      </span>
                      <p className="flex-1 text-sm md:text-base text-gray-800 leading-relaxed pt-1">
                        {item}
                      </p>
                    </div>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

/**
 * Component hin th Email - Giao din p v hin i
 */
/**
 * Component hin th Email - Giao din p v hin i (Optimized for mobile)
 */
function EmailDisplay({ emailData }) {
  if (!emailData || !emailData.headers) return null;

  // Extract first letter for avatar
  const getInitial = (text) => {
    return text ? text.charAt(0).toUpperCase() : '?';
  };

  // Extract name from email
  const getName = (email) => {
    if (!email) return '';
    const match = email.match(/^([^@]+)@/);
    if (match) {
      return match[1].split(/[._-]/).map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
      ).join(' ');
    }
    return email;
  };

  // Generate random color for avatar
  const getAvatarColor = (email) => {
    const colors = [
      'from-blue-500 to-blue-700',
      'from-purple-500 to-purple-700',
      'from-pink-500 to-pink-700',
      'from-indigo-500 to-indigo-700',
      'from-teal-500 to-teal-700',
      'from-green-500 to-green-700',
    ];
    const index = (email?.charCodeAt(0) || 0) % colors.length;
    return colors[index];
  };

  const senderName = getName(emailData.headers.from);
  const senderInitial = getInitial(senderName);
  const avatarColor = getAvatarColor(emailData.headers.from);

  return (
    <div className="bg-gradient-to-br from-gray-50 to-gray-100 shadow-2xl overflow-hidden border border-gray-200">
      {/* Email Client Header - Compact Design */}
      <div className="bg-white border-b border-gray-200">
        <div className="px-4 md:px-6 py-3 flex items-center justify-between">
          <div className="flex items-center gap-2 md:gap-3">
            <div className="w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-md">
              <Mail className="w-4 h-4 md:w-5 md:h-5 text-white" />
            </div>
            <div>
              <h2 className="text-sm md:text-lg font-bold text-gray-900">Email</h2>
              <p className="text-xs text-gray-500 hidden md:block">Inbox Message</p>
            </div>
          </div>
        </div>
      </div>

      {/* Email Message Container */}
      <div className="p-3 md:p-6">
        <div className="bg-white shadow-lg overflow-hidden border border-gray-200">
          
          {/* Email Subject Banner - Compact */}
          {emailData.headers.subject && (
            <div className="bg-gradient-to-r from-blue-600 to-blue-700 px-4 md:px-6 py-3 md:py-5">
              <div className="flex items-start gap-2 md:gap-3">
                <Mail className="w-4 h-4 md:w-6 md:h-6 text-white mt-0.5 md:mt-1 flex-shrink-0" />
                <div className="flex-1 min-w-0">
                  <div className="text-xs font-semibold text-blue-200 uppercase tracking-wide mb-0.5 md:mb-1">
                    Subject
                  </div>
                  <h3 className="text-base md:text-xl lg:text-2xl font-bold text-white leading-tight break-words">
                    {emailData.headers.subject}
                  </h3>
                </div>
              </div>
            </div>
          )}

          {/* Email Header Information - Compact */}
          <div className="bg-gradient-to-b from-gray-50 to-white border-b-2 border-gray-200 px-4 md:px-6 py-3 md:py-5">
            <div className="flex items-start gap-3 md:gap-4">
              {/* Avatar - Smaller on mobile */}
              <div className="flex-shrink-0">
                <div className={`w-10 h-10 md:w-14 md:h-14 bg-gradient-to-br ${avatarColor} rounded-full flex items-center justify-center shadow-lg ring-2 md:ring-4 ring-white`}>
                  <span className="text-white font-bold text-base md:text-xl">
                    {senderInitial}
                  </span>
                </div>
              </div>

              {/* Sender Details - Responsive */}
              <div className="flex-1 min-w-0">
                <div className="mb-2 md:mb-3">
                  <h4 className="text-sm md:text-lg font-bold text-gray-900 mb-0.5 md:mb-1 truncate">
                    {senderName}
                  </h4>
                  <p className="text-xs md:text-sm text-gray-600 font-medium truncate">
                    {emailData.headers.from}
                  </p>
                </div>

                {/* To and Date Info - Stack on mobile */}
                <div className="space-y-1.5 md:space-y-2">
                  {emailData.headers.to && (
                    <div className="flex items-center gap-1.5 md:gap-2 text-xs md:text-sm overflow-hidden">
                      <div className="flex items-center gap-1.5 md:gap-2 bg-blue-50 px-2 md:px-3 py-1 md:py-1.5 rounded-md border border-blue-200 min-w-0">
                        <User className="w-3 h-3 md:w-4 md:h-4 text-blue-600 flex-shrink-0" />
                        <span className="text-gray-600 font-medium flex-shrink-0">To:</span>
                        <span className="text-gray-900 font-semibold truncate">{emailData.headers.to}</span>
                      </div>
                    </div>
                  )}
                  {emailData.headers.date && (
                    <div className="flex items-center gap-1.5 md:gap-2 text-xs md:text-sm">
                      <div className="flex items-center gap-1.5 md:gap-2 bg-gray-100 px-2 md:px-3 py-1 md:py-1.5 rounded-md border border-gray-200">
                        <Clock className="w-3 h-3 md:w-4 md:h-4 text-gray-600 flex-shrink-0" />
                        <span className="text-gray-700 font-medium">{emailData.headers.date}</span>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>

          {/* Email Body - Optimized font sizes */}
          <div className="bg-white px-4 md:px-8 lg:px-10 py-5 md:py-8 lg:py-10 min-h-[200px]">
            <div className="max-w-3xl">
              <div className="space-y-3 md:space-y-4 text-gray-800">
                {emailData.body.map((line, idx) => (
                  line === '' ? (
                    <div key={idx} className="h-2 md:h-4"></div>
                  ) : (
                    <p key={idx} className="text-sm md:text-base leading-relaxed text-gray-700">
                      {line}
                    </p>
                  )
                ))}
              </div>
            </div>
          </div>

          {/* Email Footer Actions - Compact on mobile */}
          <div className="bg-gradient-to-b from-gray-50 to-gray-100 border-t-2 border-gray-200 px-4 md:px-6 py-3 md:py-5">
            <div className="flex items-center justify-between flex-wrap gap-2 md:gap-4">
              <div className="flex items-center gap-2 md:gap-3">
                <button className="group px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg font-semibold text-xs md:text-sm shadow-md hover:shadow-lg transition-all flex items-center gap-1.5 md:gap-2">
                  <Mail className="w-3 h-3 md:w-4 md:h-4" />
                  <span>Reply</span>
                  <ArrowRight className="w-3 h-3 md:w-4 md:h-4 group-hover:translate-x-1 transition-transform hidden md:inline" />
                </button>
                <button className="px-4 md:px-6 py-2 md:py-3 bg-white hover:bg-gray-50 text-gray-700 border-2 border-gray-300 rounded-lg font-semibold text-xs md:text-sm shadow-sm hover:shadow-md transition-all">
                  Forward
                </button>
              </div>
              <div className="flex items-center gap-1.5 md:gap-2 text-xs text-gray-500">
                <div className="w-1.5 h-1.5 md:w-2 md:h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span className="hidden md:inline">End of message</span>
                <span className="md:hidden">End</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Display/ReadingPart8Display.jsx">
// ReadingPart8Display.jsx
import React from 'react';
import { MessageCircle, FileText, Calendar, Users, Zap } from 'lucide-react';

/**
 * Component hin th text  bi Reading Part 8 (Multiple Texts/Chat Threads)
 *  ti u ha cho Mobile-First, giao din hin i (Chat UI), kch thc ch ph hp.
 */
export default function ReadingPart8Display({ text = '', type = 'general' }) {
 
 const parseText = (inputText) => {
  try {
   if (!inputText || typeof inputText !== 'string') {
    return [];
   }

   const trimmed = inputText.trim();
   if (trimmed.length === 0) {
    return [];
   }

   const sections = [];
   const lines = trimmed.split('\n');
   
   let currentSection = { type: 'text', content: [] };
   let chatMeta = { platform: '', date: '', participants: '' };
   let hasHeader = false;
   
   for (let i = 0; i < lines.length; i++) {
    let line = lines[i];
    if (!line) continue;
    
    line = line.trim();
    if (!line) continue;

    // ===== Detect chat header title =====
    if (line.match(/^\*\*.*Thread\*\*$/i) || 
      line.match(/^\*\*.*Conversation\*\*$/i) ||
      line.match(/^\*\*.*Chat\*\*$/i) ||
      line.match(/^\*\*.*Messages?\*\*$/i)) {
     
     // Flush previous section if it's not empty
     if (currentSection.content && currentSection.content.length > 0) {
      sections.push(currentSection);
      currentSection = { type: 'text', content: [] };
     }

     const headerTitle = line.replace(/\*\*/g, '').trim();
     sections.push({ 
      type: 'chat-header', 
      title: headerTitle,
     });
     hasHeader = true;
     continue;
    }

    // Detect date header
    if (line.startsWith('**Date:**')) {
     const dateMatch = line.match(/\*\*Date:\*\*\s*(.+)/);
     if (dateMatch) {
      chatMeta.date = dateMatch[1].trim();
      
      // Nu ang trong tin nhn v c tin nhn, kt thc khi tin nhn v chn Date Separator
      if (currentSection.type === 'textmessage' && currentSection.messages?.length > 0) {
       sections.push(currentSection);
       sections.push({ type: 'date-separator', date: chatMeta.date });
       // Bt u khi tin nhn mi vi meta mi
       currentSection = { type: 'textmessage', messages: [], meta: { ...chatMeta } };
      } else {
       sections.push({ type: 'date-separator', date: chatMeta.date });
      }
     }
     continue;
    }

    // Detect participants
    if (line.startsWith('**Participants:**')) {
     const participantsMatch = line.match(/\*\*Participants:\*\*\s*(.+)/);
     if (participantsMatch) {
      chatMeta.participants = participantsMatch[1].trim();
     }
     continue;
    }

    // Detect text message format: "Name (Time): Message" 
    const textMsgMatch = line.match(/^([A-Za-z0-9\s.]+?)\s*\((\d{1,2}:\d{2})\):\s*(.+)$/);
    
    if (textMsgMatch && textMsgMatch[1] && textMsgMatch[2] && textMsgMatch[3]) {
     if (currentSection.type !== 'textmessage') {
      // Flush previous text section
      if (currentSection.content && currentSection.content.length > 0) {
       sections.push(currentSection);
      }
      currentSection = { 
       type: 'textmessage', 
       messages: [], 
       meta: { ...chatMeta } 
      };
     }
     
     currentSection.messages.push({
      sender: textMsgMatch[1].trim(),
      time: textMsgMatch[2],
      message: textMsgMatch[3]
     });
    } else {
     // Regular text line
     // Nu ang trong khi tin nhn, kt thc n
     if (currentSection.type === 'textmessage' && currentSection.messages && currentSection.messages.length > 0) {
      sections.push(currentSection);
      currentSection = { type: 'text', content: [] };
     }
     
     // Thm dng text vo khi text hin ti
     currentSection.content.push(line);
    }
   }
   
   // Flush the last section
   if (currentSection.type === 'textmessage' && currentSection.messages && currentSection.messages.length > 0) {
    sections.push(currentSection);
   } else if (currentSection.content && currentSection.content.length > 0) {
    sections.push(currentSection);
   }
   
   return sections.filter(s => s.type !== 'text' || s.content.some(c => c.length > 0));
  } catch (error) {
   console.error('Error parsing text:', error);
   return [];
  }
 };

 const renderTextMessages = (section) => {
  if (!section?.messages || !Array.isArray(section.messages) || section.messages.length === 0) {
   return null;
  }

  // Ly ra tt c tn ngi gi duy nht
  const uniqueSenders = Array.from(new Set(section.messages.map(msg => msg.sender)));
  
  // Nhm tin nhn lin tip t cng mt ngi
  const groupedMessages = [];
  let currentGroup = null;

  section.messages.forEach((msg) => {
   if (!currentGroup || currentGroup.sender !== msg.sender) {
    currentGroup = { sender: msg.sender, messages: [msg] };
    groupedMessages.push(currentGroup);
   } else {
    currentGroup.messages.push(msg);
   }
  });

  // Xc nh mu cho tng ngi (c th dng hash map thay cho mng  mu sc lun n nh)
  const senderColors = {};
  const colors = [
   { bg: 'bg-blue-500', text: 'text-white', name: 'text-blue-600', badge: 'bg-blue-100' },
   { bg: 'bg-purple-500', text: 'text-white', name: 'text-purple-600', badge: 'bg-purple-100' },
   { bg: 'bg-emerald-500', text: 'text-white', name: 'text-emerald-600', badge: 'bg-emerald-100' },
  ];
  
  uniqueSenders.forEach((sender, index) => {
   senderColors[sender] = colors[index % colors.length];
  });
  
  // Gi nh ngi gi u tin l ngi "My Message" (bn phi)
  const firstSender = section.messages[0]?.sender;
  
  return (
   <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden text-sm">
    
    {/* Metadata Header (Gn hn trn di ng) */}
    <div className="px-4 py-2 border-b border-gray-100 bg-gray-50 flex flex-wrap items-center justify-between gap-2">
     <div className="flex items-center gap-2">
      <Users className="w-4 h-4 text-gray-500" />
      <p className="text-gray-700 font-semibold text-xs md:text-sm truncate">
       {section.meta?.participants || 'Group Conversation'}
      </p>
     </div>
     {section.meta?.date && (
      <div className="flex items-center gap-1 text-gray-500 text-xs">
       <Calendar className="w-3 h-3" />
       <span className="font-medium">{section.meta.date}</span>
      </div>
     )}
    </div>

    {/* Messages Container */}
    <div className="p-4 space-y-4 max-h-[500px] overflow-y-auto md:p-6 md:space-y-6">
     {groupedMessages.map((group, groupIdx) => {
      const colorScheme = senderColors[group.sender] || colors[0];
      // Xc nh ngi gi ny c phi l ngi gi u tin (gi nh l ngi dng hin ti/bn phi)
      const isFirstSender = group.sender === firstSender; 
      const bubbleAlign = isFirstSender ? 'justify-end' : 'justify-start';
      
      return (
       <div key={groupIdx} className="flex flex-col">
        
        {/* Tn ngi gi */}
        <div className={`mb-1 flex items-center gap-2 ${isFirstSender ? 'justify-end' : 'justify-start'}`}>
         <span className={`text-xs font-bold ${colorScheme.name} md:text-sm`}>
          {group.sender}
         </span>
        </div>

        {/* Cc tin nhn trong nhm */}
        <div className={`flex ${bubbleAlign}`}>
         <div className="space-y-1 max-w-[85%] md:max-w-[75%]">
          {group.messages.map((msg, msgIdx) => (
           <div key={msgIdx} className={`flex ${isFirstSender ? 'justify-end' : 'justify-start'}`}>
            <div 
             className={`px-4 py-2 rounded-xl shadow-md ${isFirstSender ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-800'} break-words transition-all duration-150`}
             style={{
              // To hiu ng "ui" tin nhn
              borderTopRightRadius: isFirstSender && msgIdx === 0 ? '4px' : '12px',
              borderTopLeftRadius: !isFirstSender && msgIdx === 0 ? '4px' : '12px',
              borderBottomLeftRadius: isFirstSender && msgIdx === group.messages.length - 1 ? '12px' : '4px',
              borderBottomRightRadius: !isFirstSender && msgIdx === group.messages.length - 1 ? '12px' : '4px',
             }}
            >
             <p className="text-sm leading-relaxed">{msg.message}</p>
            </div>
           </div>
          ))}
          
          {/* Thi gian ch hin th sau tin nhn cui cng trong nhm */}
          <div className={`mt-0.5 ${isFirstSender ? 'text-right' : 'text-left'}`}>
           <span className="text-xs text-gray-500 font-medium">
            {group.messages[group.messages.length - 1]?.time}
           </span>
          </div>

         </div>
        </div>
       </div>
      );
     })}
    </div>
   </div>
  );
 };
 
 const renderChatHeader = (section) => {
  // T ng detect icon v mu sc da trn title
  let Icon = MessageCircle;
  let gradientFrom = 'from-green-600';
  let gradientTo = 'to-emerald-500';
  let iconBg = 'bg-green-500';
  
  const titleLower = section.title.toLowerCase();
  
  // Logic detection cho cc nn tng chat ni ting
  if (titleLower.includes('linkedin')) {
   Icon = () => (
    <svg className="w-5 h-5 text-white md:w-6 md:h-6" fill="currentColor" viewBox="0 0 24 24">
     <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
    </svg>
   );
   gradientFrom = 'from-[#0077B5]';
   gradientTo = 'to-[#005885]';
   iconBg = 'bg-[#0077B5]';
  } else if (titleLower.includes('whatsapp')) {
   Icon = () => (
    <svg className="w-5 h-5 text-white md:w-6 md:h-6" fill="currentColor" viewBox="0 0 24 24">
     <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
    </svg>
   );
   gradientFrom = 'from-[#25D366]';
   gradientTo = 'to-[#128C7E]';
   iconBg = 'bg-[#25D366]';
  } else if (titleLower.includes('slack')) {
   Icon = () => (
    <svg className="w-5 h-5 text-white md:w-6 md:h-6" fill="currentColor" viewBox="0 0 24 24">
     <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
    </svg>
   );
   gradientFrom = 'from-[#4A154B]';
   gradientTo = 'to-[#36C5F0]';
   iconBg = 'bg-[#4A154B]';
  } else if (titleLower.includes('messenger') || titleLower.includes('facebook')) {
   Icon = MessageCircle;
   gradientFrom = 'from-[#0084FF]';
   gradientTo = 'to-[#00C6FF]';
   iconBg = 'bg-[#0084FF]';
  } else if (titleLower.includes('telegram')) {
   Icon = () => (
    <svg className="w-5 h-5 text-white md:w-6 md:h-6" fill="currentColor" viewBox="0 0 24 24">
     <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
    </svg>
   );
   gradientFrom = 'from-[#0088cc]';
   gradientTo = 'to-[#229ED9]';
   iconBg = 'bg-[#0088cc]';
  }

  return (
   <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mb-4 md:mb-6">
    <div className={`bg-gradient-to-r ${gradientFrom} ${gradientTo} px-4 py-3 md:px-6 md:py-4`}>
     <div className="flex items-center gap-3 md:gap-4">
      {/* Icon vi hiu ng p */}
      <div className={`${iconBg} p-2 rounded-lg shadow-md flex-shrink-0`}>
       <Icon />
      </div>
      
      {/* Title */}
      <div className="flex-1 min-w-0">
       <h2 className="text-white font-bold text-lg tracking-tight truncate md:text-xl drop-shadow">
        {section.title}
       </h2>
       <p className="text-white/80 text-xs font-medium mt-0.5 hidden md:block">
        Professional Communication Thread
       </p>
      </div>
     </div>
    </div>
   </div>
  );
 };

 const renderDateSeparator = (section) => (
  <div className="flex items-center gap-3 my-3">
   <div className="flex-1 h-[1px] bg-gradient-to-r from-transparent via-gray-300 to-gray-300"></div>
   <div className="flex items-center gap-1 bg-gray-100 px-3 py-1 rounded-full shadow-sm">
    <Calendar className="w-3 h-3 text-gray-500" />
    <span className="text-xs font-semibold text-gray-600">{section.date}</span>
   </div>
   <div className="flex-1 h-[1px] bg-gradient-to-l from-transparent via-gray-300 to-gray-300"></div>
  </div>
 );

 const renderText = (section) => (
  <div className="bg-white rounded-xl shadow-md border border-gray-200 p-4 md:p-6">
   <div className="space-y-3">
    {Array.isArray(section.content) && section.content.map((line, idx) => (
     <p key={idx} className="text-gray-800 leading-relaxed text-sm md:text-base">
      {line}
     </p>
    ))}
   </div>
  </div>
 );

 const sections = parseText(text);

 if (!sections || sections.length === 0) {
  return (
   <div className="bg-gray-50 rounded-xl shadow-lg border border-gray-200 p-6 text-center">
    <FileText className="w-8 h-8 text-gray-400 mx-auto mb-3" />
    <p className="text-gray-500 font-semibold text-sm">Khng c ni dung  hin th.</p>
   </div>
  );
 }

 return (
  <div className="space-y-4 md:space-y-6 reading-part8-container">
   {sections.map((section, idx) => {
    if (!section) return null;
    
    if (section.type === 'chat-header') {
     return <div key={idx}>{renderChatHeader(section)}</div>;
    } else if (section.type === 'textmessage') {
     return <div key={idx}>{renderTextMessages(section)}</div>;
    } else if (section.type === 'date-separator') {
     return <div key={idx}>{renderDateSeparator(section)}</div>;
    } else {
     return <div key={idx}>{renderText(section)}</div>;
    }
   })}
  </div>
 );
}
</file>

<file path="src/components/FullExam/components/ExamScreen/ExamScreen.jsx">
/* src/components/FullExam/components/ExamScreen/ExamScreen.jsx */

import React, { memo, useMemo } from 'react';
import { AlertCircle, ChevronLeft, ChevronRight, Flag, ArrowRight } from 'lucide-react';
import ContentDisplay from '../../../Display/ContentDisplay';
import { COLORS } from '../../constants/colors';
import { EXAM_STRUCTURE } from '../../constants/examConfig';
import { QuestionCard } from './QuestionCard';
import { PartNavigation } from '../Navigation/PartNavigation';

/**
 * Main Exam Screen - Display questions and handle answers
 * Responsible for:
 * - Showing exam content (listening/reading)
 * - Rendering questions
 * - Handling answer selection
 * - Navigation between parts
 */
export const ExamScreen = memo(({
  examData,
  section,              // 'listening' or 'reading'
  part,                 // Current part number
  answers,              // Object: { "listening-part1-q1": 0, ... }
  onSelectAnswer,       // (questionNum, optionIndex) => void
  onNavigatePart,       // (newPart) => void
  onNextSection,        // () => void
  onSubmit,             // () => void
  onAudioStart,         // () => void
  onAudioEnd,           // () => void
  isLastListeningPart,  // boolean
  isLastReadingPart,    // boolean
  playedParts = [],     // Array of played listening parts
  isAudioPlaying = false,
}) => {
  const cfg = EXAM_STRUCTURE[section];

  // Get current part data
  const partData = useMemo(() => {
    if (!examData?.parts) return null;
    const partKey = `part${part}`;
    return examData.parts[partKey] || null;
  }, [examData, part]);

  if (!partData) {
    return (
      <div className="max-w-7xl mx-auto px-8 py-12">
        <div className="text-center py-20">
          <AlertCircle className="w-12 h-12 text-slate-400 mx-auto mb-4" />
          <p className="text-slate-600">Loading part data...</p>
        </div>
      </div>
    );
  }

  // Calculate question range
  const partNumber = part;
  const startQuestion = ((partNumber - (section === 'listening' ? 1 : 5)) * cfg.questionsPerPart) + 1;
  const endQuestion = startQuestion + cfg.questionsPerPart - 1;

  return (
    <div className="max-w-7xl mx-auto px-8 py-6 space-y-6 pb-32">
      {/* Content Display (Audio/Reading) */}
      {section === 'listening' ? (
        <div className="relative z-20">
          <ContentDisplay
            partData={partData}
            selectedPart={`part${part}`}
            currentQuestionIndex={0}
            testType={section}
            examId="exam1"
            isPartPlayed={playedParts.includes(part)}
            onAudioStart={onAudioStart}
            onAudioEnd={onAudioEnd}
          />
        </div>
      ) : (
        <div className="bg-white rounded-lg border border-slate-200 p-8">
          <h3 className="text-lg font-bold text-slate-900 mb-4">
            Reading Content
          </h3>
          <ContentDisplay
            partData={partData}
            selectedPart={`part${part}`}
            currentQuestionIndex={0}
            testType={section}
            examId="exam1"
            isPartPlayed={false}
            onAudioStart={() => {}}
            onAudioEnd={() => {}}
          />
        </div>
      )}

      {/* Questions Section */}
      <div className="bg-white rounded-lg p-6 border border-slate-200">
        <h3 className="font-bold text-lg mb-6 text-slate-900">
          Part {partNumber}: Questions {startQuestion}  {endQuestion}
        </h3>

        {/* Questions List */}
        <div className="space-y-4">
          {partData?.questions && partData.questions.length > 0 ? (
            partData.questions.map((question, idx) => {
              const questionNum = idx + 1;
              const questionKey = `${section}-part${part}-q${questionNum}`;
              const selectedAnswer = answers[questionKey];

              return (
                <QuestionCard
                  key={questionKey}
                  question={question}
                  questionNum={questionNum}
                  selectedAnswer={selectedAnswer}
                  onAnswerSelect={(optionIndex) => onSelectAnswer(questionNum, optionIndex)}
                  questionKey={questionKey}
                />
              );
            })
          ) : (
            <div className="text-center py-8 text-slate-600">
              <AlertCircle className="w-12 h-12 mx-auto mb-4 opacity-50" />
              <p>No questions available for this part</p>
            </div>
          )}
        </div>
      </div>

      {/* Part Navigation */}
      <PartNavigation
        currentPart={part}
        totalParts={cfg.parts}
        startPartNumber={section === 'listening' ? 1 : 5}
        answers={answers}
        section={section}
        questionsPerPart={cfg.questionsPerPart}
        onPartChange={onNavigatePart}
        playedParts={section === 'listening' ? playedParts : []}
        isAudioPlaying={isAudioPlaying}
      />

      {/* Navigation Buttons */}
      <div className="flex gap-4">
        {/* Previous Part Button */}
        <button
          onClick={() => {
            const minPart = section === 'listening' ? 1 : 5;
            if (part > minPart && !isAudioPlaying) {
              onNavigatePart(part - 1);
            }
          }}
          disabled={part === (section === 'listening' ? 1 : 5) || isAudioPlaying}
          className="flex-1 py-4 rounded-lg font-bold flex items-center justify-center gap-2 disabled:opacity-50 text-white transition-all duration-200"
          style={{ backgroundColor: COLORS.blue }}
        >
          <ChevronLeft className="w-5 h-5" />
          <span>Previous Part</span>
        </button>

        {/* Next/Submit Button */}
        {isLastReadingPart ? (
          <button
            onClick={onSubmit}
            disabled={isAudioPlaying}
            className="flex-1 py-4 rounded-lg font-bold flex items-center justify-center gap-2 text-white transition-all duration-200 disabled:opacity-50"
            style={{ backgroundColor: '#DC2626' }}
          >
            <Flag className="w-5 h-5" />
            <span>Submit Test</span>
          </button>
        ) : isLastListeningPart ? (
          <button
            onClick={onNextSection}
            disabled={isAudioPlaying}
            className="flex-1 py-4 rounded-lg font-bold flex items-center justify-center gap-2 text-white transition-all duration-200 disabled:opacity-50"
            style={{ backgroundColor: COLORS.orange }}
          >
            <ArrowRight className="w-5 h-5" />
            <span>Go to Reading</span>
          </button>
        ) : (
          <button
            onClick={() => {
              if (!isAudioPlaying) {
                onNavigatePart(part + 1);
              }
            }}
            disabled={isAudioPlaying}
            className="flex-1 py-4 rounded-lg font-bold flex items-center justify-center gap-2 text-white transition-all duration-200 disabled:opacity-50"
            style={{ backgroundColor: COLORS.blue }}
          >
            <span>Next Part</span>
            <ChevronRight className="w-5 h-5" />
          </button>
        )}
      </div>
    </div>
  );
});

ExamScreen.displayName = 'ExamScreen';
export default ExamScreen;
</file>

<file path="src/components/FullExam/components/ExamScreen/QuestionCard.jsx">
/* src/components/FullExam/components/ExamScreen/QuestionCard.jsx */

import React, { memo } from 'react';
import { CheckCircle, Circle } from 'lucide-react';

/**
 * Question Card - Display a single question with options
 * Shows:
 * - Question text
 * - 4 answer options
 * - Selection state (highlighted if selected)
 * - Checkmark when selected
 */
export const QuestionCard = memo(({
  question,
  questionNum,
  selectedAnswer,
  onAnswerSelect,
  questionKey,
}) => {
  if (!question) {
    return null;
  }

  const options = question.options || [];
  const correct = question.correct;

  return (
    <div className="bg-white border border-slate-200 rounded-lg p-6 hover:border-slate-300 transition-colors">
      {/* Question Header */}
      <div className="mb-6">
        <p className="text-sm font-semibold text-slate-600 mb-2">
          Question {questionNum}
        </p>
        <p className="text-base font-semibold text-slate-900">
          {question.question || 'No question text'}
        </p>
        
        {question.hint && (
          <p className="text-sm text-slate-600 mt-2 italic">
            Hint: {question.hint}
          </p>
        )}
      </div>

      {/* Answer Options */}
      <div className="space-y-3">
        {options && options.length > 0 ? (
          options.map((option, idx) => (
            <OptionButton
              key={`${questionKey}-option-${idx}`}
              option={option}
              optionIndex={idx}
              isSelected={selectedAnswer === idx}
              onSelect={() => onAnswerSelect(idx)}
              optionLabel={String.fromCharCode(65 + idx)} // A, B, C, D
            />
          ))
        ) : (
          <p className="text-slate-600 text-sm">No options available</p>
        )}
      </div>

      {/* Selection Indicator */}
      {selectedAnswer !== undefined && (
        <div className="mt-4 pt-4 border-t border-slate-200">
          <p className="text-xs text-emerald-600 font-semibold">
             Answer selected: {String.fromCharCode(65 + selectedAnswer)}
          </p>
        </div>
      )}
    </div>
  );
});

QuestionCard.displayName = 'QuestionCard';

/**
 * Option Button - Individual answer option
 */
const OptionButton = memo(({
  option,
  optionIndex,
  isSelected,
  onSelect,
  optionLabel,
}) => {
  return (
    <button
      onClick={onSelect}
      className={`
        w-full p-4 rounded-lg border-2 text-left transition-all duration-150
        flex items-start gap-4 hover:border-blue-400
        ${isSelected
          ? 'border-blue-600 bg-blue-50'
          : 'border-slate-200 bg-white hover:bg-slate-50'
        }
      `}
    >
      {/* Icon */}
      <div className="flex-shrink-0 mt-0.5">
        {isSelected ? (
          <CheckCircle className="w-6 h-6 text-blue-600" />
        ) : (
          <Circle className="w-6 h-6 text-slate-400" />
        )}
      </div>

      {/* Option Content */}
      <div className="flex-1">
        <div className="font-semibold text-slate-900 mb-1">
          {optionLabel}. {option}
        </div>
      </div>

      {/* Selection Indicator */}
      {isSelected && (
        <div className="flex-shrink-0 text-blue-600 font-bold text-sm">
          Selected
        </div>
      )}
    </button>
  );
});

OptionButton.displayName = 'OptionButton';

export default QuestionCard;
</file>

<file path="src/components/FullExam/components/ExamSetup/ExamSetup.jsx">
/* src/components/FullExam/components/ExamSetup/ExamSetup.jsx */

import React, { useState, memo } from 'react';
import { Play, BookOpen, Clock, Users } from 'lucide-react';
import StepIndicator from '../../StepIndicator';
import { COLORS } from '../../constants/colors';
import { EXAM_MODES } from '../../constants/examConfig';
import { EXAM_LIST } from '../../../../data/examData';

/**
 * Exam Setup Screen - User selects exam and starts
 * Shows available exams with info
 */
export const ExamSetup = memo(({ onStartExam }) => {
  const [selectedExam, setSelectedExam] = useState('exam1');
  const [isStarting, setIsStarting] = useState(false);

  const handleStartExam = async () => {
    setIsStarting(true);
    try {
      onStartExam?.(selectedExam);
    } finally {
      setIsStarting(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
      {/* Header */}
      <div className="bg-white border-b border-slate-200 shadow-sm">
        <div className="max-w-7xl mx-auto px-8 py-8">
          <h1 className="text-4xl font-black text-slate-900 mb-2">
            HUFLIT Proficiency Assessment
          </h1>
          <p className="text-lg text-slate-600">
            Comprehensive English Proficiency Test
          </p>
        </div>
      </div>

      {/* Step Indicator */}
      <div className="bg-white border-b border-slate-200 px-8 py-6">
        <div className="max-w-7xl mx-auto">
          <StepIndicator currentMode="setup" />
        </div>
      </div>

      {/* Main Content */}
      <div className="max-w-7xl mx-auto px-8 py-12">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Sidebar - Exam Info */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-lg border border-slate-200 p-6 sticky top-8">
              <h2 className="text-xl font-bold text-slate-900 mb-6">Test Information</h2>

              <div className="space-y-6">
                {/* Listening */}
                <div>
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 rounded-full flex items-center justify-center" style={{ backgroundColor: COLORS.blue }}>
                      <span className="text-white font-bold"></span>
                    </div>
                    <div>
                      <p className="font-bold text-slate-900">Listening</p>
                      <p className="text-sm text-slate-600">30 minutes</p>
                    </div>
                  </div>
                  <p className="text-sm text-slate-600 ml-13">
                    4 parts, 20 questions
                  </p>
                </div>

                {/* Reading */}
                <div>
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 rounded-full flex items-center justify-center" style={{ backgroundColor: COLORS.orange }}>
                      <span className="text-white font-bold"></span>
                    </div>
                    <div>
                      <p className="font-bold text-slate-900">Reading</p>
                      <p className="text-sm text-slate-600">60 minutes</p>
                    </div>
                  </div>
                  <p className="text-sm text-slate-600 ml-13">
                    4 parts, 40 questions
                  </p>
                </div>

                {/* Total */}
                <div className="border-t border-slate-200 pt-6">
                  <div className="flex items-center gap-3">
                    <Clock className="w-5 h-5 text-slate-600" />
                    <div>
                      <p className="text-sm text-slate-600">Total Time</p>
                      <p className="font-bold text-slate-900">1 hour 30 minutes</p>
                    </div>
                  </div>
                </div>

                {/* Note */}
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <p className="text-sm text-blue-900">
                    <strong>Note:</strong> Once you start, you cannot go back to previous listening parts.
                  </p>
                </div>
              </div>
            </div>
          </div>

          {/* Main - Exam Selection */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-lg border border-slate-200 p-8">
              <h2 className="text-2xl font-bold text-slate-900 mb-8">
                Select an Exam to Begin
              </h2>

              <div className="space-y-4 mb-8">
                {EXAM_LIST && EXAM_LIST.length > 0 ? (
                  EXAM_LIST.map((exam) => (
                    <label
                      key={exam.id}
                      className={`
                        flex items-start p-6 rounded-lg border-2 cursor-pointer
                        transition-all duration-200
                        ${selectedExam === exam.id
                          ? 'border-blue-500 bg-blue-50'
                          : 'border-slate-200 bg-white hover:border-slate-300'
                        }
                      `}
                    >
                      <input
                        type="radio"
                        name="exam"
                        value={exam.id}
                        checked={selectedExam === exam.id}
                        onChange={(e) => setSelectedExam(e.target.value)}
                        className="w-5 h-5 mt-1 cursor-pointer"
                        style={{ accentColor: COLORS.blue }}
                      />
                      <div className="ml-4 flex-1">
                        <div className="flex items-center gap-2 mb-1">
                          <h3 className="text-lg font-bold text-slate-900">
                            {exam.title || `Exam ${exam.id}`}
                          </h3>
                          <span className="px-3 py-1 bg-blue-100 text-blue-900 text-xs font-bold rounded-full">
                            NEW
                          </span>
                        </div>
                        <p className="text-sm text-slate-600 mb-3">
                          {exam.description || 'A complete proficiency assessment covering all skill areas'}
                        </p>
                        <div className="flex gap-6 text-xs text-slate-600">
                          <span> {exam.questions || 60} questions</span>
                          <span> {exam.duration || 90} minutes</span>
                          {exam.difficulty && <span> {exam.difficulty} level</span>}
                        </div>
                      </div>
                    </label>
                  ))
                ) : (
                  <div className="text-center py-12">
                    <BookOpen className="w-12 h-12 text-slate-400 mx-auto mb-4" />
                    <p className="text-slate-600">No exams available</p>
                  </div>
                )}
              </div>

              {/* Instructions */}
              <div className="bg-amber-50 border border-amber-200 rounded-lg p-6 mb-8">
                <h4 className="font-bold text-amber-900 mb-3">Before You Start:</h4>
                <ul className="space-y-2 text-sm text-amber-900">
                  <li> Make sure you have a quiet environment</li>
                  <li> Ensure your internet connection is stable</li>
                  <li> You can save and resume your test (auto-saved)</li>
                  <li> Use arrow keys ( ) to navigate parts</li>
                  <li> Use number keys (1-4) to select answers</li>
                </ul>
              </div>

              {/* Start Button */}
              <div className="flex gap-4">
                <button
                  onClick={handleStartExam}
                  disabled={isStarting || !selectedExam}
                  className="flex-1 py-4 rounded-lg font-bold text-white transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50"
                  style={{ backgroundColor: isStarting ? '#ccc' : COLORS.blue }}
                >
                  {isStarting ? (
                    <>
                      <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
                      <span>Starting...</span>
                    </>
                  ) : (
                    <>
                      <Play className="w-5 h-5" />
                      <span>Start Test</span>
                    </>
                  )}
                </button>
              </div>

              {/* Footer Note */}
              <div className="mt-8 pt-8 border-t border-slate-200 text-center text-sm text-slate-600">
                <Users className="w-4 h-4 inline mr-2" />
                <span>Trusted by thousands of English learners worldwide</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
});

ExamSetup.displayName = 'ExamSetup';
export default ExamSetup;
</file>

<file path="src/components/FullExam/components/Header/AutosaveIndicator.jsx">
import React, { useState, useEffect, memo } from 'react';
import { CheckCircle, AlertCircle, WifiOff, RefreshCw } from 'lucide-react';

export const AutosaveIndicator = memo(({ 
  isSaving, 
  lastSaved, 
  isOnline, 
  saveError 
}) => {
  const [showSaved, setShowSaved] = useState(false);

  useEffect(() => {
    if (!isSaving && lastSaved) {
      setShowSaved(true);
      const timer = setTimeout(() => setShowSaved(false), 2000);
      return () => clearTimeout(timer);
    }
  }, [isSaving, lastSaved]);

  if (saveError) {
    return (
      <div className="flex items-center gap-1.5 text-xs font-semibold text-red-600">
        <AlertCircle className="w-3.5 h-3.5 animate-pulse" />
        <span>Save failed</span>
      </div>
    );
  }

  if (!isOnline) {
    return (
      <div className="flex items-center gap-1.5 text-xs font-semibold text-amber-600">
        <WifiOff className="w-3.5 h-3.5" />
        <span>Offline (draft saved)</span>
      </div>
    );
  }

  if (isSaving) {
    return (
      <div className="flex items-center gap-1.5 text-xs font-semibold text-slate-600">
        <RefreshCw className="w-3.5 h-3.5 animate-spin" />
        <span>Saving</span>
      </div>
    );
  }

  if (showSaved) {
    return (
      <div className="flex items-center gap-1.5 text-xs font-semibold text-emerald-600 animate-pulse">
        <CheckCircle className="w-3.5 h-3.5" />
        <span>Saved</span>
      </div>
    );
  }

  return null;
});

AutosaveIndicator.displayName = 'AutosaveIndicator';
export default AutosaveIndicator;
</file>

<file path="src/components/FullExam/components/Header/Timer.jsx">
import React, { memo } from 'react';
import { Clock } from 'lucide-react';
import { formatTime } from '../../utils/examHelpers';

export const Timer = memo(({ timeLeft, isWarning = false }) => {
  return (
    <div className={`flex items-center gap-2 font-bold ${isWarning ? 'text-red-600' : 'text-slate-900'}`}>
      <Clock className={`w-5 h-5 ${isWarning ? 'animate-pulse' : ''}`} />
      <span className="text-lg tabular-nums">{formatTime(timeLeft)}</span>
    </div>
  );
});

Timer.displayName = 'Timer';
export default Timer;
</file>

<file path="src/components/FullExam/components/Modals/SubmitModal.jsx">
import React, { memo } from 'react';
import { AlertTriangle, Clock, Flag } from 'lucide-react';

export const SubmitModal = memo(({ 
  visible, 
  unansweredCount, 
  saveError, 
  isOnline,
  isSubmitting,
  onConfirm, 
  onCancel 
}) => {
  if (!visible) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-lg shadow-2xl max-w-sm w-full p-8">
        <div className="flex items-center gap-3 mb-4">
          <AlertTriangle className="w-6 h-6 text-yellow-600" />
          <h2 className="text-2xl font-bold text-slate-900">Submit Test?</h2>
        </div>

        {unansweredCount > 0 && (
          <div className="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <p className="text-sm font-semibold text-yellow-900 mb-2"> Incomplete Answers</p>
            <p className="text-sm text-yellow-800">
              You still have <strong>{unansweredCount} unanswered question{unansweredCount !== 1 ? 's' : ''}</strong>.
            </p>
            <p className="text-xs text-yellow-700 mt-2">
              Unanswered questions will count as incorrect.
            </p>
          </div>
        )}

        {saveError && (
          <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
            <p className="text-sm font-semibold text-red-900 mb-2"> Save Error</p>
            <p className="text-xs text-red-800">
              {saveError} {isOnline ? 'Please check your connection.' : 'You are offline.'}
            </p>
          </div>
        )}

        <p className="text-slate-600 mb-6 text-sm">
          You are about to submit your answers. You cannot make changes after submission.
        </p>

        <div className="space-y-3">
          <button
            onClick={onConfirm}
            disabled={isSubmitting}
            className="w-full py-3 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50"
          >
            {isSubmitting ? (
              <>
                <Clock className="w-4 h-4 animate-spin" />
                <span>Submitting...</span>
              </>
            ) : (
              <>
                <Flag className="w-4 h-4" />
                <span>Yes, Submit</span>
              </>
            )}
          </button>
          <button
            onClick={onCancel}
            disabled={isSubmitting}
            className="w-full py-3 bg-slate-200 text-slate-900 rounded-lg font-bold hover:bg-slate-300 transition-colors disabled:opacity-50"
          >
            Continue Testing
          </button>
        </div>
      </div>
    </div>
  );
});

SubmitModal.displayName = 'SubmitModal';
export default SubmitModal;
</file>

<file path="src/components/FullExam/components/Navigation/PartNavigation.jsx">
/* src/components/FullExam/components/Navigation/PartNavigation.jsx */

import React, { memo } from 'react';
import { CheckCircle, Circle, Lock, AlertCircle } from 'lucide-react';

/**
 * Part Navigation - Select which part to work on
 * Shows all parts with:
 * - Answered questions count
 * - Completion status
 * - Lock status (can't go back to listening parts)
 */
export const PartNavigation = memo(({
  currentPart,
  totalParts,
  startPartNumber,        // 1 for listening, 5 for reading
  answers,                // All answers object
  section,                // 'listening' or 'reading'
  questionsPerPart,       // Questions per part
  onPartChange,           // (newPart) => void
  playedParts = [],       // Array of played listening parts (for listening only)
  isAudioPlaying = false,
}) => {
  const canNavigateToListening = section === 'listening';

  return (
    <div className="bg-white rounded-lg border border-slate-200 p-6">
      <h3 className="font-bold text-lg text-slate-900 mb-4">
        {section === 'listening' ? 'Listening Parts' : 'Reading Parts'}
      </h3>

      <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
        {Array.from({ length: totalParts }, (_, idx) => {
          const partNumber = startPartNumber + idx;
          const answerCount = countAnswersInPart(answers, section, partNumber, questionsPerPart);
          const isCompleted = answerCount === questionsPerPart;
          const isCurrent = partNumber === currentPart;
          const isLocked = section === 'listening' && playedParts.includes(partNumber) && !isCurrent;

          return (
            <PartButton
              key={partNumber}
              partNumber={partNumber}
              isCurrent={isCurrent}
              isCompleted={isCompleted}
              isLocked={isLocked}
              answerCount={answerCount}
              totalQuestions={questionsPerPart}
              onSelect={() => {
                if (!isLocked && !isAudioPlaying) {
                  onPartChange(partNumber);
                }
              }}
              disabled={isLocked || isAudioPlaying}
            />
          );
        })}
      </div>

      {/* Legend */}
      <div className="mt-6 pt-6 border-t border-slate-200 flex items-center gap-6 text-xs">
        <div className="flex items-center gap-2">
          <CheckCircle className="w-4 h-4 text-emerald-600" />
          <span>Completed</span>
        </div>
        <div className="flex items-center gap-2">
          <Circle className="w-4 h-4 text-blue-600" />
          <span>Current</span>
        </div>
        <div className="flex items-center gap-2">
          <AlertCircle className="w-4 h-4 text-amber-600" />
          <span>In Progress</span>
        </div>
        <div className="flex items-center gap-2">
          <Lock className="w-4 h-4 text-slate-400" />
          <span>Locked</span>
        </div>
      </div>

      {/* Help Text */}
      {section === 'listening' && (
        <div className="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
          <p className="text-xs text-amber-900">
            <strong>Note:</strong> Once you finish a listening part, you cannot return to it. Make sure all answers are ready before moving on.
          </p>
        </div>
      )}
    </div>
  );
});

PartNavigation.displayName = 'PartNavigation';

/**
 * Part Button - Individual part selector
 */
const PartButton = memo(({
  partNumber,
  isCurrent,
  isCompleted,
  isLocked,
  answerCount,
  totalQuestions,
  onSelect,
  disabled,
}) => {
  let bgColor = 'bg-white border-slate-200';
  let textColor = 'text-slate-900';
  let icon = <Circle className="w-5 h-5" />;

  if (isLocked) {
    bgColor = 'bg-slate-100 border-slate-300';
    textColor = 'text-slate-400';
    icon = <Lock className="w-5 h-5" />;
  } else if (isCompleted) {
    bgColor = 'bg-emerald-50 border-emerald-300';
    textColor = 'text-emerald-900';
    icon = <CheckCircle className="w-5 h-5 text-emerald-600" />;
  } else if (isCurrent) {
    bgColor = 'bg-blue-50 border-blue-600';
    textColor = 'text-blue-900';
    icon = <div className="w-5 h-5 rounded-full bg-blue-600" />;
  } else if (answerCount > 0) {
    bgColor = 'bg-amber-50 border-amber-300';
    textColor = 'text-amber-900';
    icon = <AlertCircle className="w-5 h-5 text-amber-600" />;
  }

  return (
    <button
      onClick={onSelect}
      disabled={disabled}
      className={`
        p-3 rounded-lg border-2 transition-all duration-150
        flex flex-col items-center gap-2
        disabled:cursor-not-allowed
        ${bgColor}
        ${disabled ? 'opacity-50' : 'hover:border-blue-400 hover:shadow-sm'}
      `}
    >
      {/* Icon */}
      <div className={`flex-shrink-0 ${textColor}`}>
        {icon}
      </div>

      {/* Part Number */}
      <div className={`font-bold text-sm ${textColor}`}>
        Part {partNumber}
      </div>

      {/* Answer Count */}
      <div className={`text-xs font-semibold ${textColor}`}>
        {answerCount}/{totalQuestions}
      </div>

      {/* Status Badge */}
      {isCompleted && (
        <div className="text-xs text-emerald-600 font-bold"> Done</div>
      )}
      {isCurrent && (
        <div className="text-xs text-blue-600 font-bold">Current</div>
      )}
      {isLocked && (
        <div className="text-xs text-slate-400 font-bold">Locked</div>
      )}
    </button>
  );
});

PartButton.displayName = 'PartButton';

/**
 * Count answers in a specific part
 */
function countAnswersInPart(answers, section, part, questionsPerPart) {
  let count = 0;
  for (let q = 1; q <= questionsPerPart; q++) {
    const key = `${section}-part${part}-q${q}`;
    if (answers[key] !== undefined) {
      count++;
    }
  }
  return count;
}

export default PartNavigation;
</file>

<file path="src/components/FullExam/components/Results/BreakdownChart.jsx">
/* src/components/FullExam/components/Results/BreakdownChart.jsx */

import React, { memo } from 'react';
import { COLORS } from '../../constants/colors';

/**
 * Breakdown Chart - Show Listening vs Reading scores
 */
export const BreakdownChart = memo(({ results }) => {
  if (!results) return null;

  const { listening, reading } = results;

  return (
    <div className="bg-white rounded-lg border border-slate-200 p-8">
      <h3 className="font-bold text-lg text-slate-900 mb-6">Score Breakdown</h3>

      <div className="space-y-6">
        {/* Listening */}
        <div>
          <div className="flex justify-between items-center mb-2">
            <div className="flex items-center gap-2">
              <span className="text-sm font-semibold text-slate-700">Listening</span>
              <span className="text-xs text-slate-500">({listening.correct}/20)</span>
            </div>
            <span className="text-sm font-bold text-slate-900">
              {listening.points.toFixed(1)} / 100
            </span>
          </div>
          <div className="w-full h-4 bg-slate-200 rounded-full overflow-hidden">
            <div
              className="h-full transition-all duration-500"
              style={{
                width: `${(listening.correct / 20) * 100}%`,
                backgroundColor: COLORS.blue,
              }}
            />
          </div>
          <p className="text-xs text-slate-500 mt-1">
            {listening.percentage.toFixed(1)}% correct
          </p>
        </div>

        {/* Reading */}
        <div>
          <div className="flex justify-between items-center mb-2">
            <div className="flex items-center gap-2">
              <span className="text-sm font-semibold text-slate-700">Reading</span>
              <span className="text-xs text-slate-500">({reading.correct}/40)</span>
            </div>
            <span className="text-sm font-bold text-slate-900">
              {reading.points.toFixed(1)} / 100
            </span>
          </div>
          <div className="w-full h-4 bg-slate-200 rounded-full overflow-hidden">
            <div
              className="h-full transition-all duration-500"
              style={{
                width: `${(reading.correct / 40) * 100}%`,
                backgroundColor: COLORS.orange,
              }}
            />
          </div>
          <p className="text-xs text-slate-500 mt-1">
            {reading.percentage.toFixed(1)}% correct
          </p>
        </div>
      </div>

      {/* Summary Stats */}
      <div className="mt-6 pt-6 border-t border-slate-200 grid grid-cols-3 gap-4">
        <div className="text-center">
          <p className="text-xs text-slate-600 mb-1">Total Correct</p>
          <p className="text-lg font-bold text-slate-900">
            {results.totalCorrect}/60
          </p>
        </div>
        <div className="text-center border-l border-r border-slate-200">
          <p className="text-xs text-slate-600 mb-1">Accuracy</p>
          <p className="text-lg font-bold text-slate-900">
            {((results.totalCorrect / 60) * 100).toFixed(1)}%
          </p>
        </div>
        <div className="text-center">
          <p className="text-xs text-slate-600 mb-1">Level</p>
          <p className="text-lg font-bold" style={{ color: results.cefr.color }}>
            {results.cefr.level}
          </p>
        </div>
      </div>
    </div>
  );
});

BreakdownChart.displayName = 'BreakdownChart';
export default BreakdownChart;
</file>

<file path="src/components/FullExam/components/Results/ExamErrorBoundary.jsx">
/* src/components/FullExam/errors/ExamErrorBoundary.jsx */

import React from 'react';
import { AlertTriangle, RotateCcw } from 'lucide-react';

/**
 * Error Boundary for Exam Component
 * Catches errors and displays user-friendly message
 * Allows recovery without full page reload
 */
export class ExamErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasError: false,
      error: null,
      errorInfo: null,
      errorCount: 0,
    };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error('Exam Error:', error, errorInfo);
    
    this.setState(prevState => ({
      error,
      errorInfo,
      errorCount: prevState.errorCount + 1,
    }));

    // Log to monitoring service (e.g., Sentry, LogRocket)
    // logErrorToService(error, errorInfo);
  }

  handleReset = () => {
    // Clear local storage if corrupted
    try {
      localStorage.removeItem('exam-progress-draft');
    } catch (err) {
      console.error('Failed to clear storage:', err);
    }

    // Reset error boundary
    this.setState({
      hasError: false,
      error: null,
      errorInfo: null,
    });

    // Reload page
    window.location.reload();
  };

  handleGoHome = () => {
    window.location.href = '/';
  };

  render() {
    if (this.state.hasError) {
      const isDevelopment = process.env.NODE_ENV === 'development';

      return (
        <div className="min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-8">
          <div className="bg-white rounded-xl shadow-2xl max-w-lg w-full p-8">
            {/* Error Icon */}
            <div className="flex justify-center mb-6">
              <div className="w-20 h-20 rounded-full bg-red-100 flex items-center justify-center">
                <AlertTriangle className="w-10 h-10 text-red-600" />
              </div>
            </div>

            {/* Error Title */}
            <h1 className="text-2xl font-black text-red-900 text-center mb-2">
              Something Went Wrong
            </h1>

            {/* Error Message */}
            <p className="text-red-800 text-center mb-4">
              We encountered an unexpected error during your exam. Your progress has been automatically saved to your device.
            </p>

            {/* Error Details (Development Only) */}
            {isDevelopment && this.state.error && (
              <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                <p className="text-xs font-mono text-red-900 break-words">
                  <strong>Error:</strong> {this.state.error.toString()}
                </p>
                {this.state.errorInfo && (
                  <details className="mt-2">
                    <summary className="cursor-pointer text-xs font-bold text-red-900">
                      Stack Trace
                    </summary>
                    <pre className="text-xs overflow-auto mt-2 text-red-800">
                      {this.state.errorInfo.componentStack}
                    </pre>
                  </details>
                )}
              </div>
            )}

            {/* What You Can Do */}
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
              <p className="text-sm font-bold text-blue-900 mb-2">What you can do:</p>
              <ul className="text-sm text-blue-900 space-y-1">
                <li> Your answers are saved locally</li>
                <li> Try reloading the page</li>
                <li> Clear your browser cache if issues persist</li>
                <li> Use a different browser if available</li>
              </ul>
            </div>

            {/* Action Buttons */}
            <div className="space-y-3">
              <button
                onClick={this.handleReset}
                className="w-full py-3 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition-colors flex items-center justify-center gap-2"
              >
                <RotateCcw className="w-5 h-5" />
                <span>Try Again</span>
              </button>

              <button
                onClick={this.handleGoHome}
                className="w-full py-3 bg-slate-200 text-slate-900 rounded-lg font-bold hover:bg-slate-300 transition-colors"
              >
                Go Home
              </button>
            </div>

            {/* Help Text */}
            <p className="text-xs text-slate-600 text-center mt-6">
              If the problem persists, please contact support at support@huflit.edu.vn
            </p>

            {/* Error Count Warning */}
            {this.state.errorCount > 2 && (
              <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <p className="text-xs text-yellow-900">
                  <strong> Multiple errors detected.</strong> Please reload the page or clear your browser cache.
                </p>
              </div>
            )}
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ExamErrorBoundary;
</file>

<file path="src/components/FullExam/components/Results/PartResults.jsx">
/* src/components/FullExam/components/Results/PartResults.jsx */

import React, { memo } from 'react';
import { COLORS } from '../../constants/colors';

/**
 * Part Results - Show results for each part
 */
export const PartResults = memo(({ partResults }) => {
  if (!partResults) return null;

  return (
    <div className="bg-white rounded-lg border border-slate-200 p-8 mb-8">
      <h3 className="font-bold text-lg text-slate-900 mb-6">Part-by-Part Results</h3>

      {/* Listening Parts */}
      <div className="mb-8">
        <h4 className="font-semibold text-slate-900 mb-3 text-sm uppercase tracking-wide">
          Listening Parts
        </h4>
        <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
          {[1, 2, 3, 4].map((p) => (
            <PartResultCard
              key={`listening-${p}`}
              label={`Listening ${p}`}
              score={partResults.listeningByPart[p] || 0}
              maxScore={5}
              color={COLORS.blue}
            />
          ))}
        </div>
      </div>

      {/* Reading Parts */}
      <div>
        <h4 className="font-semibold text-slate-900 mb-3 text-sm uppercase tracking-wide">
          Reading Parts
        </h4>
        <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
          {[1, 2, 3, 4].map((p) => (
            <PartResultCard
              key={`reading-${p}`}
              label={`Reading ${p}`}
              score={partResults.readingByPart[p] || 0}
              maxScore={10}
              color={COLORS.orange}
            />
          ))}
        </div>
      </div>
    </div>
  );
});

PartResults.displayName = 'PartResults';

/**
 * Single Part Result Card
 */
const PartResultCard = memo(({ label, score, maxScore, color }) => {
  const percentage = (score / maxScore) * 100;
  const isExcellent = percentage >= 80;
  const isGood = percentage >= 60;
  const isFair = percentage >= 40;

  let statusColor = '#DC2626'; // Red
  let statusText = 'Needs Work';

  if (isExcellent) {
    statusColor = '#059669'; // Green
    statusText = 'Excellent';
  } else if (isGood) {
    statusColor = '#0066CC'; // Blue
    statusText = 'Good';
  } else if (isFair) {
    statusColor = '#FF8C42'; // Orange
    statusText = 'Fair';
  }

  return (
    <div className="p-4 rounded-lg border border-slate-200 text-center bg-slate-50">
      <p className="text-sm font-bold text-slate-900 mb-2">{label}</p>

      {/* Score Display */}
      <div className="mb-3">
        <p className="text-2xl font-black" style={{ color }}>
          {score}/{maxScore}
        </p>
      </div>

      {/* Progress Bar */}
      <div className="w-full h-2 bg-slate-200 rounded-full overflow-hidden mb-2">
        <div
          className="h-full transition-all"
          style={{ width: `${percentage}%`, backgroundColor: color }}
        />
      </div>

      {/* Status */}
      <p className="text-xs font-bold text-white rounded px-2 py-1 inline-block" style={{ backgroundColor: statusColor }}>
        {statusText}
      </p>

      {/* Percentage */}
      <p className="text-xs text-slate-600 mt-2">
        {percentage.toFixed(0)}%
      </p>
    </div>
  );
});

PartResultCard.displayName = 'PartResultCard';

export default PartResults;
</file>

<file path="src/components/FullExam/components/Results/ResultsScreen.jsx">
/* src/components/FullExam/components/Results/ResultsScreen.jsx */

import React, { memo, useMemo } from 'react';
import { Trophy, TrendingUp, Target, RotateCcw, ChevronLeft, AlertCircle } from 'lucide-react';
import StepIndicator from '../../StepIndicator';
import { COLORS } from '../../constants/colors';
import { calculateFullResults, getResultsByPart } from '../../utils/examHelpers';
import { ScoreDisplay } from './ScoreDisplay';
import { BreakdownChart } from './BreakdownChart';
import { PartResults } from './PartResults';

/**
 * Results Screen - Display exam results and scores
 * Shows:
 * - Overall score and CEFR level
 * - Section breakdown (Listening vs Reading)
 * - Part-by-part results
 * - Strengths and weaknesses
 */
export const ResultsScreen = memo(({
  examData,
  answers,
  onRetry,
  onExit,
}) => {
  if (!examData) {
    return (
      <div className="min-h-screen bg-slate-50 flex items-center justify-center p-8">
        <div className="text-center">
          <AlertCircle className="w-12 h-12 text-slate-400 mx-auto mb-4" />
          <p className="text-slate-600">Loading results...</p>
        </div>
      </div>
    );
  }

  // Calculate results
  const results = useMemo(() => calculateFullResults(examData, answers), [examData, answers]);
  const partResults = useMemo(() => getResultsByPart(examData, answers), [examData, answers]);

  // Find strongest and weakest parts
  const allParts = [
    { name: 'Listening 1', score: partResults.listeningByPart[1] || 0, max: 5, section: 'listening' },
    { name: 'Listening 2', score: partResults.listeningByPart[2] || 0, max: 5, section: 'listening' },
    { name: 'Listening 3', score: partResults.listeningByPart[3] || 0, max: 5, section: 'listening' },
    { name: 'Listening 4', score: partResults.listeningByPart[4] || 0, max: 5, section: 'listening' },
    { name: 'Reading 1', score: partResults.readingByPart[1] || 0, max: 10, section: 'reading' },
    { name: 'Reading 2', score: partResults.readingByPart[2] || 0, max: 10, section: 'reading' },
    { name: 'Reading 3', score: partResults.readingByPart[3] || 0, max: 10, section: 'reading' },
    { name: 'Reading 4', score: partResults.readingByPart[4] || 0, max: 10, section: 'reading' },
  ];

  const weakest = allParts.reduce((a, b) => (a.score / a.max < b.score / b.max) ? a : b);
  const strongest = allParts.reduce((a, b) => (a.score / a.max > b.score / b.max) ? a : b);

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      {/* Header */}
      <div className="bg-white border-b border-slate-200 shadow-sm">
        <div className="max-w-7xl mx-auto px-8 py-8">
          <h1 className="text-4xl font-black text-slate-900">Test Results</h1>
          <p className="text-lg text-slate-600 mt-2">
            HUFLIT Proficiency Assessment - Score Report
          </p>
        </div>
      </div>

      {/* Step Indicator */}
      <div className="bg-white border-b border-slate-200 px-8 py-6">
        <div className="max-w-7xl mx-auto">
          <StepIndicator currentMode="results" listeningComplete={true} />
        </div>
      </div>

      {/* Results Content */}
      <div className="max-w-7xl mx-auto px-8 py-12">
        {/* Completion Message */}
        <div className="bg-white rounded-lg border-2 border-emerald-200 bg-emerald-50 p-8 text-center mb-8">
          <Trophy className="w-16 h-16 text-emerald-600 mx-auto mb-4" />
          <h2 className="text-3xl font-black text-emerald-900 mb-2">Test Complete!</h2>
          <p className="text-emerald-800">
            Your test has been successfully submitted and graded.
          </p>
        </div>

        {/* Main Results Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
          {/* Overall Score */}
          <div className="lg:col-span-1">
            <ScoreDisplay results={results} />
          </div>

          {/* Section Breakdown */}
          <div className="lg:col-span-2">
            <BreakdownChart results={results} />
          </div>
        </div>

        {/* Performance Insights */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
          {/* Strengths */}
          <div className="bg-white rounded-lg border border-slate-200 p-6">
            <h3 className="font-bold text-lg text-slate-900 mb-4 flex items-center gap-2">
              <TrendingUp className="w-5 h-5 text-emerald-600" />
              Your Strengths
            </h3>
            <div className="p-4 bg-emerald-50 border border-emerald-200 rounded-lg">
              <p className="text-sm font-semibold text-emerald-900 mb-2">
                 {strongest.name}
              </p>
              <p className="text-xs text-emerald-800">
                Excellent performance: {strongest.score}/{strongest.max} correct
              </p>
              <div className="mt-2 w-full h-2 bg-emerald-200 rounded-full overflow-hidden">
                <div
                  className="h-full bg-emerald-600 transition-all"
                  style={{ width: `${(strongest.score / strongest.max) * 100}%` }}
                />
              </div>
            </div>
          </div>

          {/* Areas for Improvement */}
          <div className="bg-white rounded-lg border border-slate-200 p-6">
            <h3 className="font-bold text-lg text-slate-900 mb-4 flex items-center gap-2">
              <Target className="w-5 h-5 text-orange-600" />
              Areas for Improvement
            </h3>
            <div className="p-4 bg-orange-50 border border-orange-200 rounded-lg">
              <p className="text-sm font-semibold text-orange-900 mb-2">
                 {weakest.name}
              </p>
              <p className="text-xs text-orange-800">
                Focus on: {weakest.score}/{weakest.max} correct - Practice more in this area
              </p>
              <div className="mt-2 w-full h-2 bg-orange-200 rounded-full overflow-hidden">
                <div
                  className="h-full bg-orange-600 transition-all"
                  style={{ width: `${(weakest.score / weakest.max) * 100}%` }}
                />
              </div>
            </div>
          </div>
        </div>

        {/* Part-by-Part Results */}
        <PartResults partResults={partResults} />

        {/* Recommendations */}
        <div className="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
          <h3 className="font-bold text-lg text-blue-900 mb-4"> Recommendations</h3>
          <ul className="space-y-2 text-sm text-blue-900">
            {results.averageScore >= 75 ? (
              <>
                <li> Excellent proficiency level! You're ready for advanced English tasks.</li>
                <li> Focus on maintaining your skills and expanding vocabulary in specialized areas.</li>
              </>
            ) : results.averageScore >= 50 ? (
              <>
                <li> Good progress! Continue practicing to improve your overall proficiency.</li>
                <li> Focus especially on {weakest.name.toLowerCase()} - this is your growth area.</li>
                <li> Try to take more practice tests to reinforce your learning.</li>
              </>
            ) : (
              <>
                <li> Keep practicing! Regular exposure to English will help you improve.</li>
                <li> Consider focused study on {weakest.name.toLowerCase()}.</li>
                <li> Take practice tests regularly to track your progress.</li>
              </>
            )}
          </ul>
        </div>

        {/* Action Buttons */}
        <div className="flex gap-4">
          <button
            onClick={onRetry}
            className="flex-1 py-4 rounded-lg font-bold text-white transition-all duration-200 flex items-center justify-center gap-2"
            style={{ backgroundColor: COLORS.blue }}
          >
            <RotateCcw className="w-5 h-5" />
            <span>Take Test Again</span>
          </button>
          <button
            onClick={onExit}
            className="flex-1 py-4 rounded-lg font-bold text-slate-900 bg-slate-200 border border-slate-300 transition-all duration-200 flex items-center justify-center gap-2 hover:bg-slate-300"
          >
            <ChevronLeft className="w-5 h-5" />
            <span>Exit</span>
          </button>
        </div>
      </div>
    </div>
  );
});

ResultsScreen.displayName = 'ResultsScreen';
export default ResultsScreen;
</file>

<file path="src/components/FullExam/components/Results/ScoreDisplay.jsx">
/* src/components/FullExam/components/Results/ScoreDisplay.jsx */

import React, { memo } from 'react';
import { Award } from 'lucide-react';
export const ScoreDisplay = memo(({ results }) => {
  if (!results) return null;

  const { averageScore, cefr } = results;

  const score =
    typeof averageScore === 'number'
      ? averageScore
      : parseFloat(averageScore) || 0;

  return (
    <div
      className="bg-white rounded-lg border-t-4 p-8 text-center"
      style={{ borderTopColor: cefr.color }}
    >
      <p className="text-sm font-bold text-slate-600 uppercase tracking-wide mb-3">
        Overall Score
      </p>

      <div className="text-5xl font-black text-slate-900 mb-6">
        {score.toFixed(1)}
      </div>

      <div
        className="w-20 h-20 rounded-full flex items-center justify-center font-black text-white text-2xl shadow-lg mx-auto mb-4"
        style={{ backgroundColor: cefr.color }}
      >
        {cefr.level}
      </div>

      <p className="text-lg font-bold text-slate-900 mb-2">
        {cefr.label}
      </p>

      <p className="text-sm text-slate-600 mb-6">
        Score: {cefr.range}
      </p>

      <p className="text-sm text-slate-700 bg-slate-50 p-4 rounded-lg mb-4">
        {cefr.description}
      </p>

      <div className="mb-6">
        <p className="text-xs text-slate-600 mb-2">Performance</p>
        <div className="w-full h-3 bg-slate-200 rounded-full overflow-hidden">
          <div
            className="h-full transition-all duration-500"
            style={{
              width: `${Math.min(score, 100)}%`,
              backgroundColor: cefr.color,
            }}
          />
        </div>
      </div>

      <Award className="w-8 h-8 text-amber-500 mx-auto" />
    </div>
  );
});

ScoreDisplay.displayName = 'ScoreDisplay';
export default ScoreDisplay;
</file>

<file path="src/components/FullExam/components/Warnings/OfflineWarning.jsx">
import React, { memo } from 'react';
import { WifiOff } from 'lucide-react';

export const OfflineWarning = memo(({ isOnline }) => {
  if (isOnline) return null;

  return (
    <div className="bg-amber-50 border-l-4 border-amber-400 p-4 mb-4">
      <div className="flex">
        <div className="flex-shrink-0">
          <WifiOff className="h-5 w-5 text-amber-400" />
        </div>
        <div className="ml-3">
          <p className="text-sm font-medium text-amber-800">
            You are currently offline. Your answers are being saved to your device.
          </p>
        </div>
      </div>
    </div>
  );
});

OfflineWarning.displayName = 'OfflineWarning';
export default OfflineWarning;
</file>

<file path="src/components/FullExam/components/Warnings/TimeWarning.jsx">
import React, { memo } from 'react';
import { AlertTriangle, Clock } from 'lucide-react';
import { COLORS } from '../../constants/colors';

export const TimeWarning = memo(({ 
  visible, 
  section,
  isLastListeningPart,
  timeLeft 
}) => {
  if (!visible) return null;

  return (
    <div className="fixed top-24 left-1/2 transform -translate-x-1/2 z-40 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg shadow-lg max-w-sm w-full mx-4">
      <div className="flex items-start gap-3">
        <AlertTriangle className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
        <div className="flex-1">
          <p className="font-bold text-yellow-900 text-sm">
             You have 5 minutes left!
          </p>
          <p className="text-xs mt-1.5 text-yellow-800">
            {isLastListeningPart 
              ? 'This is your last listening part. After finishing, you will move to Reading.' 
              : 'This is your final section. After submitting, you cannot make changes.'}
          </p>
        </div>
      </div>
    </div>
  );
});

TimeWarning.displayName = 'TimeWarning';
export default TimeWarning;
</file>

<file path="src/components/FullExam/constants/colors.js">
/* src/components/FullExam/constants/colors.js */

export const COLORS = {
  blue: '#0066CC',
  darkBlue: '#004399',
  lightBlue: '#E6F2FF',
  orange: '#FF8C42',
  lightOrange: '#FFF3E6',
  slate: '#6B7280',
  success: '#059669',
  danger: '#DC2626',
  white: '#FFFFFF',
  warning: '#F59E0B',
  amber: '#F59E0B',
};

export const COLOR_THEMES = {
  primary: COLORS.blue,
  secondary: COLORS.orange,
  error: COLORS.danger,
  success: COLORS.success,
  warning: COLORS.warning,
};

// For part-by-part results
export const SECTION_COLORS = {
  listening: COLORS.blue,
  reading: COLORS.orange,
};
</file>

<file path="src/components/FullExam/constants/examConfig.js">
export const EXAM_STRUCTURE = {
  listening: {
    title: 'LISTENING',
    totalTime: 1800,
    parts: 4,
    questionsPerPart: 5,
    totalQuestions: 20,
    totalPoints: 100,
    pointsPerQuestion: 5,
  },
  reading: {
    title: 'READING',
    totalTime: 3600,
    parts: 4,
    questionsPerPart: 10,
    totalQuestions: 40,
    totalPoints: 100,
    pointsPerQuestion: 2.5,
  }
};

export const EXAM_MODES = {
  SETUP: 'setup',
  EXAM: 'exam',
  RESULTS: 'results'
};

export const EXAM_SECTIONS = {
  LISTENING: 'listening',
  READING: 'reading'
};
</file>

<file path="src/components/FullExam/constants/messages.js">
/* src/components/FullExam/constants/messages.js */

export const EXAM_MESSAGES = {
  SETUP: {
    TITLE: 'HUFLIT Proficiency Assessment',
    DESCRIPTION: 'Select an exam to begin your test',
    SELECT_EXAM: 'Choose Exam',
  },
  EXAM: {
    LISTENING: 'LISTENING',
    READING: 'READING',
    PART: 'Part',
  },
  WARNINGS: {
    TIME_LOW: 'You have 5 minutes remaining!',
    UNANSWERED_PREFIX: 'You have',
    UNANSWERED_SUFFIX: 'unanswered question(s)',
    UNANSWERED_NOTE: 'Unanswered questions will count as incorrect.',
    OFFLINE: 'You are offline - changes are saved locally',
    SAVE_ERROR: 'Failed to save your progress',
    LAST_LISTENING_PART: 'This is your last listening part. After finishing, you will move to Reading.',
    LAST_SECTION: 'This is your final section. After submitting, you cannot make changes.',
  },
  SUBMIT_MODAL: {
    TITLE: 'Submit Test?',
    DESCRIPTION: 'You are about to submit your answers. You cannot make changes after submission.',
    INCOMPLETE_ANSWERS: 'Incomplete Answers',
    SAVE_ERROR_TITLE: 'Save Error',
  },
  ACTIONS: {
    CONTINUE: 'Continue',
    SUBMIT: 'Submit Test',
    CONFIRM: 'Yes, Submit',
    CANCEL: 'Cancel',
    RETRY: 'Try Again',
    NEXT_PART: 'Next Part',
    PREVIOUS_PART: 'Previous Part',
    GO_TO_READING: 'Go to Reading',
    TAKE_AGAIN: 'Take Test Again',
    EXIT: 'Exit',
  },
  RESULTS: {
    TITLE: 'Test Complete!',
    SUBTITLE: 'HUFLIT Proficiency Assessment',
    OVERALL_SCORE: 'Overall Score',
    SCORE_BREAKDOWN: 'Score Breakdown',
    LISTENING: 'Listening',
    READING: 'Reading',
    YOUR_STRENGTHS: 'Your Strengths',
    IMPROVEMENTS: 'Areas for Improvement',
    PART_BY_PART: 'Part-by-Part Results',
    SAVED_MESSAGE: 'Your results have been saved',
  },
  ERRORS: {
    LOAD_EXAM: 'Failed to load exam. Please try again.',
    SUBMIT_FAILED: 'Failed to submit your test. Please check your connection.',
    INVALID_DATA: 'Invalid exam data. Please reload.',
  },
};

export const KEYBOARD_HINTS = {
  ARROW_LEFT: 'Arrow Left: Previous Part',
  ARROW_RIGHT: 'Arrow Right: Next Part',
  SPACE: 'Space: Pause/Resume',
  NUMBER: 'Number Keys (1-4): Select Answer',
};
</file>

<file path="src/components/FullExam/constants/timings.js">
/* src/components/FullExam/constants/timings.js */

export const EXAM_TIMINGS = {
  LISTENING: 1800,      // 30 minutes
  READING: 3600,        // 60 minutes
  WARNING: 300,         // 5 minutes
  AUTOSAVE: 30000,      // 30 seconds
};

export const ANIMATION_TIMINGS = {
  FAST: 150,
  NORMAL: 300,
  SLOW: 500,
  LONG: 1000,
};

export const DEBOUNCE_TIMINGS = {
  SAVE: 1000,
  INPUT: 300,
};
</file>

<file path="src/components/FullExam/hooks/useExamState.js">
/* src/components/FullExam/hooks/useExamState.js */

import { useReducer, useCallback } from 'react';
import { EXAM_MODES, EXAM_SECTIONS } from '../constants/examConfig';
import { EXAM_TIMINGS } from '../constants/timings';

/**
 * Action types for exam state management
 *  Centralized, testable, debuggable with Redux DevTools
 */
export const EXAM_ACTIONS = {
  // Navigation
  SET_MODE: 'SET_MODE',
  SET_SECTION: 'SET_SECTION',
  SET_PART: 'SET_PART',

  // Data
  SET_ANSWERS: 'SET_ANSWERS',
  ADD_ANSWER: 'ADD_ANSWER',
  SET_EXAM_DATA: 'SET_EXAM_DATA',
  SET_EXAM_ID: 'SET_EXAM_ID',

  // Timer
  SET_TIME_LEFT: 'SET_TIME_LEFT',
  TICK_TIMER: 'TICK_TIMER',
  PAUSE_TIMER: 'PAUSE_TIMER',
  RESUME_TIMER: 'RESUME_TIMER',

  // UI State
  MARK_PART_PLAYED: 'MARK_PART_PLAYED',
  SET_LOADING: 'SET_LOADING',

  // Reset
  RESET_EXAM: 'RESET_EXAM',
};

const INITIAL_STATE = {
  // Navigation
  mode: EXAM_MODES.SETUP,
  section: EXAM_SECTIONS.LISTENING,
  part: 1,

  // Data
  answers: {},
  examId: 'exam1',
  examData: null,

  // Timer
  timeLeft: 0,
  isPaused: false,

  // UI
  playedListeningParts: new Set(),
  loading: false,
};

/**
 * Exam reducer function
 * Pure, predictable state transitions
 */
function examReducer(state, action) {
  switch (action.type) {
    // Navigation
    case EXAM_ACTIONS.SET_MODE:
      return { ...state, mode: action.payload };

    case EXAM_ACTIONS.SET_SECTION:
      return { ...state, section: action.payload };

    case EXAM_ACTIONS.SET_PART:
      return { ...state, part: action.payload };

    // Data
    case EXAM_ACTIONS.SET_ANSWERS:
      return { ...state, answers: action.payload };

    case EXAM_ACTIONS.ADD_ANSWER: {
      const { key, value } = action.payload;
      return {
        ...state,
        answers: { ...state.answers, [key]: value },
      };
    }

    case EXAM_ACTIONS.SET_EXAM_DATA:
      return { ...state, examData: action.payload, loading: false };

    case EXAM_ACTIONS.SET_EXAM_ID:
      return { ...state, examId: action.payload };

    // Timer
    case EXAM_ACTIONS.SET_TIME_LEFT:
      return { ...state, timeLeft: Math.max(0, action.payload) };

    case EXAM_ACTIONS.TICK_TIMER:
      return { ...state, timeLeft: Math.max(0, state.timeLeft - 1) };

    case EXAM_ACTIONS.PAUSE_TIMER:
      return { ...state, isPaused: true };

    case EXAM_ACTIONS.RESUME_TIMER:
      return { ...state, isPaused: false };

    // UI
    case EXAM_ACTIONS.MARK_PART_PLAYED: {
      const newSet = new Set(state.playedListeningParts);
      newSet.add(action.payload);
      return { ...state, playedListeningParts: newSet };
    }

    case EXAM_ACTIONS.SET_LOADING:
      return { ...state, loading: action.payload };

    // Reset
    case EXAM_ACTIONS.RESET_EXAM:
      return INITIAL_STATE;

    default:
      console.warn(`Unknown action type: ${action.type}`);
      return state;
  }
}

/**
 * Custom hook for exam state management
 * 
 *  Benefits:
 * - Single source of truth for state
 * - Easier to debug (can log all actions)
 * - Better performance (fewer re-renders)
 * - Testable actions
 * - Easy to add undo/redo
 * 
 * Usage:
 * const { state, setMode, setPart, addAnswer, ... } = useExamState();
 */
export const useExamState = () => {
  const [state, dispatch] = useReducer(examReducer, INITIAL_STATE);

  // Memoized action creators
  const actions = {
    // Navigation
    setMode: useCallback(
      (mode) => dispatch({ type: EXAM_ACTIONS.SET_MODE, payload: mode }),
      []
    ),

    setSection: useCallback(
      (section) => dispatch({ type: EXAM_ACTIONS.SET_SECTION, payload: section }),
      []
    ),

    setPart: useCallback(
      (part) => dispatch({ type: EXAM_ACTIONS.SET_PART, payload: part }),
      []
    ),

    // Data
    setAnswers: useCallback(
      (answers) => dispatch({ type: EXAM_ACTIONS.SET_ANSWERS, payload: answers }),
      []
    ),

    addAnswer: useCallback(
      (key, value) => dispatch({ type: EXAM_ACTIONS.ADD_ANSWER, payload: { key, value } }),
      []
    ),

    setExamData: useCallback(
      (data) => dispatch({ type: EXAM_ACTIONS.SET_EXAM_DATA, payload: data }),
      []
    ),

    setExamId: useCallback(
      (id) => dispatch({ type: EXAM_ACTIONS.SET_EXAM_ID, payload: id }),
      []
    ),

    // Timer
    setTimeLeft: useCallback(
      (time) => dispatch({ type: EXAM_ACTIONS.SET_TIME_LEFT, payload: time }),
      []
    ),

    tickTimer: useCallback(
      () => dispatch({ type: EXAM_ACTIONS.TICK_TIMER }),
      []
    ),

    pauseTimer: useCallback(
      () => dispatch({ type: EXAM_ACTIONS.PAUSE_TIMER }),
      []
    ),

    resumeTimer: useCallback(
      () => dispatch({ type: EXAM_ACTIONS.RESUME_TIMER }),
      []
    ),

    // UI
    markPartPlayed: useCallback(
      (part) => dispatch({ type: EXAM_ACTIONS.MARK_PART_PLAYED, payload: part }),
      []
    ),

    setLoading: useCallback(
      (loading) => dispatch({ type: EXAM_ACTIONS.SET_LOADING, payload: loading }),
      []
    ),

    // Reset
    reset: useCallback(
      () => dispatch({ type: EXAM_ACTIONS.RESET_EXAM }),
      []
    ),
  };

  return { state, ...actions };
};

/**
 * Selectors (optional, for better performance)
 */
export const selectExamMode = (state) => state.mode;
export const selectSection = (state) => state.section;
export const selectPart = (state) => state.part;
export const selectAnswers = (state) => state.answers;
export const selectTimeLeft = (state) => state.timeLeft;
export const selectIsTimerRunning = (state) => state.mode === EXAM_MODES.EXAM && !state.isPaused;
export const selectIsListeningComplete = (state) => state.section === EXAM_SECTIONS.READING;
</file>

<file path="src/components/FullExam/hooks/useExamTimer.js">
/* src/components/FullExam/hooks/useExamTimer.js */

import { useEffect, useRef } from 'react';
import { EXAM_TIMINGS } from '../constants/timings';

/**
 * Timer hook for exam countdown
 * 
 *  Benefits:
 * - Isolated timer logic (easy to test)
 * - Reusable in other components
 * - Callback pattern for side effects
 * - Proper cleanup (no memory leaks)
 * 
 * @param {Object} config
 * @param {boolean} config.isActive - Timer should run
 * @param {string} config.section - 'listening' or 'reading'
 * @param {number} config.timeLeft - Current time in seconds
 * @param {Function} config.onTick - Called every second
 * @param {Function} config.onWarning - Called when time <= 5 minutes
 * @param {Function} config.onComplete - Called when time reaches 0
 * @param {Function} config.onSectionChange - Called when switching sections
 */
export const useExamTimer = ({
  isActive = false,
  section = 'listening',
  timeLeft = 0,
  onTick,
  onWarning,
  onComplete,
  onSectionChange,
}) => {
  const warningTriggeredRef = useRef(false);
  const prevSectionRef = useRef(section);

  // Reset warning flag when section changes
  useEffect(() => {
    if (section !== prevSectionRef.current) {
      warningTriggeredRef.current = false;
      prevSectionRef.current = section;
    }
  }, [section]);

  // Main timer effect
  useEffect(() => {
    if (!isActive || timeLeft <= 0) return;

    // Only set timer if isActive
    const interval = setInterval(() => {
      // Call onTick to decrement time
      onTick?.();

      // Trigger warning at 5 minutes (once)
      if (timeLeft === EXAM_TIMINGS.WARNING + 1 && !warningTriggeredRef.current) {
        warningTriggeredRef.current = true;
        onWarning?.();
      }

      // Complete when reaching 0
      if (timeLeft === 1) {
        onComplete?.();
      }
    }, 1000);

    return () => {
      clearInterval(interval);
    };
  }, [isActive, timeLeft, onTick, onWarning, onComplete]);

  // Return hook utilities
  return {
    formattedTime: formatTimerDisplay(timeLeft),
    isWarningTime: timeLeft <= EXAM_TIMINGS.WARNING,
    isTimeAlmostUp: timeLeft <= 60, // Less than 1 minute
    isExpired: timeLeft === 0,
    percentageRemaining: (timeLeft / getMaxTimeForSection(section)) * 100,
  };
};

/**
 * Format timer display for show
 * @param {number} seconds
 * @returns {string} "MM:SS"
 */
function formatTimerDisplay(seconds) {
  if (seconds < 0) seconds = 0;
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

/**
 * Get max time for section
 */
function getMaxTimeForSection(section) {
  return section === 'listening' ? EXAM_TIMINGS.LISTENING : EXAM_TIMINGS.READING;
}

/**
 * Hook for updating time when section changes
 * Call this when transitioning between sections
 * 
 * Usage:
 * const { updateTimeForSection } = useTimerTransition();
 * 
 * useEffect(() => {
 *   updateTimeForSection(newSection);
 * }, [section]);
 */
export const useTimerTransition = () => {
  const transitionToSection = (section, onTimeUpdate) => {
    const newTime = section === 'listening' ? EXAM_TIMINGS.LISTENING : EXAM_TIMINGS.READING;
    onTimeUpdate?.(newTime);
  };

  return { transitionToSection };
};

/**
 * Advanced timer hook with progress tracking
 * For showing progress bar or percentage
 */
export const useTimerProgress = ({ 
  timeLeft, 
  maxTime,
  onMilestone, // Called at 25%, 50%, 75% progress
}) => {
  const prevPercentageRef = useRef(100);

  useEffect(() => {
    const percentage = (timeLeft / maxTime) * 100;
    const prevPercentage = prevPercentageRef.current;

    // Check if we've crossed a milestone
    if (onMilestone) {
      [75, 50, 25].forEach(milestone => {
        if (prevPercentage > milestone && percentage <= milestone) {
          onMilestone?.(milestone);
        }
      });
    }

    prevPercentageRef.current = percentage;
  }, [timeLeft, maxTime, onMilestone]);

  return {
    percentage: (timeLeft / maxTime) * 100,
    isInFinalQuarter: (timeLeft / maxTime) <= 0.25,
    isInFinalHalf: (timeLeft / maxTime) <= 0.5,
  };
};
</file>

<file path="src/components/FullExam/hooks/useKeyboardShortcuts.js">
/* src/components/FullExam/hooks/useKeyboardShortcuts.js */

import { useEffect } from 'react';

/**
 * Keyboard shortcuts for exam
 */
export const KEYBOARD_SHORTCUTS = {
  ARROW_LEFT: 'ArrowLeft',
  ARROW_RIGHT: 'ArrowRight',
  SPACE: ' ',
  NUMBER_1: '1',
  NUMBER_2: '2',
  NUMBER_3: '3',
  NUMBER_4: '4',
  ENTER: 'Enter',
  ESCAPE: 'Escape',
};

/**
 * Exam keyboard shortcuts hook
 * 
 *  Benefits:
 * - Isolated keyboard logic
 * - Easy to enable/disable
 * - Testable
 * - Good UX (power users love shortcuts)
 * 
 * @param {Object} config
 * @param {boolean} config.isActive - Enable keyboard shortcuts
 * @param {boolean} config.isAudioPlaying - Disable navigation when audio
 * @param {Function} config.onNavigatePrev - Arrow Left handler
 * @param {Function} config.onNavigateNext - Arrow Right handler
 * @param {Function} config.onTogglePause - Space handler
 * @param {Function} config.onSelectAnswer - Number keys (1-4)
 * @param {Function} config.onSubmit - Enter handler
 * @param {Function} config.onExit - Escape handler
 */
export const useKeyboardShortcuts = ({
  isActive = false,
  isAudioPlaying = false,
  onNavigatePrev,
  onNavigateNext,
  onTogglePause,
  onSelectAnswer,
  onSubmit,
  onExit,
}) => {
  useEffect(() => {
    if (!isActive) return;

    const handleKeyDown = (e) => {
      // ===== NAVIGATION =====
      // Arrow Left: Previous Part
      if (e.key === KEYBOARD_SHORTCUTS.ARROW_LEFT) {
        // Prevent default scroll behavior
        e.preventDefault();
        
        // Don't navigate while audio is playing
        if (!isAudioPlaying) {
          onNavigatePrev?.();
        }
      }

      // Arrow Right: Next Part
      if (e.key === KEYBOARD_SHORTCUTS.ARROW_RIGHT) {
        e.preventDefault();
        
        if (!isAudioPlaying) {
          onNavigateNext?.();
        }
      }

      // ===== CONTROL =====
      // Space: Pause/Resume
      if (e.key === KEYBOARD_SHORTCUTS.SPACE) {
        e.preventDefault();
        onTogglePause?.();
      }

      // Enter: Submit
      if (e.key === KEYBOARD_SHORTCUTS.ENTER && e.ctrlKey) {
        e.preventDefault();
        onSubmit?.();
      }

      // Escape: Exit (with confirmation)
      if (e.key === KEYBOARD_SHORTCUTS.ESCAPE) {
        e.preventDefault();
        onExit?.();
      }

      // ===== ANSWER SELECTION =====
      // Number keys 1-4: Select answer
      const numKey = parseInt(e.key);
      if (numKey >= 1 && numKey <= 4) {
        e.preventDefault();
        const answerIndex = numKey - 1; // Convert to 0-based index
        onSelectAnswer?.(answerIndex);
      }
    };

    // Add event listener
    document.addEventListener('keydown', handleKeyDown, { capture: false });

    // Cleanup
    return () => {
      document.removeEventListener('keydown', handleKeyDown);
    };
  }, [
    isActive,
    isAudioPlaying,
    onNavigatePrev,
    onNavigateNext,
    onTogglePause,
    onSelectAnswer,
    onSubmit,
    onExit,
  ]);
};

/**
 * Keyboard help overlay hook
 * Shows shortcut hints
 */
export const useKeyboardHelp = () => {
  const shortcuts = [
    {
      keys: ['', ''],
      description: 'Navigate between parts',
      available: true,
    },
    {
      keys: ['1', '2', '3', '4'],
      description: 'Select answer',
      available: true,
    },
    {
      keys: ['Space'],
      description: 'Pause/Resume',
      available: true,
    },
    {
      keys: ['Ctrl', 'Enter'],
      description: 'Submit test',
      available: true,
    },
    {
      keys: ['Esc'],
      description: 'Exit (confirm)',
      available: true,
    },
  ];

  return { shortcuts };
};

/**
 * Hook to detect if user is using keyboard
 */
export const useKeyboardDetection = () => {
  const [isUsingKeyboard, setIsUsingKeyboard] = React.useState(false);

  React.useEffect(() => {
    const handleKeyDown = () => {
      setIsUsingKeyboard(true);
    };

    const handleMouseMove = () => {
      setIsUsingKeyboard(false);
    };

    document.addEventListener('keydown', handleKeyDown);
    document.addEventListener('mousemove', handleMouseMove);

    return () => {
      document.removeEventListener('keydown', handleKeyDown);
      document.removeEventListener('mousemove', handleMouseMove);
    };
  }, []);

  return isUsingKeyboard;
};

/**
 * Prevent unintended key presses (like typing in input fields)
 */
export const shouldIgnoreKeyboardShortcut = (target) => {
  // Don't trigger shortcuts when typing in input/textarea
  const tagName = target?.tagName?.toLowerCase();
  const isEditable = target?.contentEditable === 'true';

  return tagName === 'input' || tagName === 'textarea' || isEditable;
};

/**
 * Usage example in component:
 * 
 * useKeyboardShortcuts({
 *   isActive: true,
 *   onNavigatePrev: () => setPart(p => Math.max(1, p - 1)),
 *   onNavigateNext: () => setPart(p => Math.min(4, p + 1)),
 *   onTogglePause: () => setIsPaused(!isPaused),
 *   onSelectAnswer: (index) => handleAnswerSelect(index),
 * });
 */
</file>

<file path="src/components/FullExam/hooks/useNetworkStatus.js">
/* src/components/FullExam/hooks/useNetworkStatus.js */

import { useState, useEffect, useCallback } from 'react';

/**
 * Network status hook
 * 
 *  Benefits:
 * - Centralized network status management
 * - Works offline (saves to localStorage)
 * - Easy to mock in tests
 * - Provides both status and utilities
 */
export const useNetworkStatus = () => {
  const [isOnline, setIsOnline] = useState(() => {
    // Check initial status
    return typeof navigator !== 'undefined' ? navigator.onLine : true;
  });

  const [connectionType, setConnectionType] = useState(null);

  useEffect(() => {
    // Handle online/offline events
    const handleOnline = () => {
      setIsOnline(true);
      console.log(' Back online');
    };

    const handleOffline = () => {
      setIsOnline(false);
      console.log(' Went offline');
    };

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  // Detect connection type (4G, WiFi, etc) if available
  useEffect(() => {
    const connection = navigator?.connection || navigator?.mozConnection || navigator?.webkitConnection;
    if (connection) {
      setConnectionType(connection.effectiveType);
      
      const handleChange = () => {
        setConnectionType(connection.effectiveType);
      };

      connection.addEventListener('change', handleChange);
      return () => connection.removeEventListener('change', handleChange);
    }
  }, []);

  const isSlowConnection = connectionType === '2g' || connectionType === '3g';

  return {
    isOnline,
    isOffline: !isOnline,
    connectionType,
    isSlowConnection,
  };
};

/**
 * Storage sync hook for offline support
 * Automatically persists answers when online/offline
 */
export const useOfflineStorage = (key = 'exam-draft', data) => {
  const [hasSyncedWithServer, setHasSyncedWithServer] = useState(false);
  const { isOnline } = useNetworkStatus();

  // Save to localStorage whenever data changes
  useEffect(() => {
    try {
      localStorage.setItem(key, JSON.stringify({
        data,
        timestamp: Date.now(),
        synced: false,
      }));
    } catch (err) {
      console.error('Failed to save to localStorage:', err);
    }
  }, [data, key]);

  // When back online, sync data
  useEffect(() => {
    if (isOnline && !hasSyncedWithServer) {
      // Attempt to sync with server
      setHasSyncedWithServer(true);
      // TODO: Call saveProgress API
    }
  }, [isOnline, hasSyncedWithServer]);

  // Restore from localStorage
  const restore = useCallback(() => {
    try {
      const stored = localStorage.getItem(key);
      if (stored) {
        const { data: restoredData, timestamp } = JSON.parse(stored);
        return { restoredData, timestamp };
      }
    } catch (err) {
      console.error('Failed to restore from localStorage:', err);
    }
    return { restoredData: null, timestamp: null };
  }, [key]);

  // Clear localStorage
  const clear = useCallback(() => {
    try {
      localStorage.removeItem(key);
    } catch (err) {
      console.error('Failed to clear localStorage:', err);
    }
  }, [key]);

  return {
    restore,
    clear,
    hasSyncedWithServer,
  };
};

/**
 * Network retry hook
 * Automatically retry failed operations when online
 */
export const useNetworkRetry = (asyncFn, onSuccess, onError) => {
  const { isOnline } = useNetworkStatus();
  const [isRetrying, setIsRetrying] = useState(false);
  const [error, setError] = useState(null);

  const executeWithRetry = useCallback(async (...args) => {
    try {
      setIsRetrying(true);
      setError(null);
      const result = await asyncFn(...args);
      onSuccess?.(result);
      return result;
    } catch (err) {
      setError(err);
      onError?.(err);
      throw err;
    } finally {
      setIsRetrying(false);
    }
  }, [asyncFn, onSuccess, onError]);

  // Auto-retry when coming back online
  useEffect(() => {
    if (isOnline && error && !isRetrying) {
      // Optionally auto-retry
      console.log('Network back up, ready to retry...');
    }
  }, [isOnline, error, isRetrying]);

  return {
    execute: executeWithRetry,
    isRetrying,
    error,
    hasError: !!error,
  };
};

/**
 * Detect if user is in a low-bandwidth situation
 * Useful for optimizing media loading
 */
export const useBandwidthDetection = () => {
  const { connectionType, isSlowConnection } = useNetworkStatus();
  const [saveDataRequested, setSaveDataRequested] = useState(false);

  useEffect(() => {
    const preferenceForSaveData = navigator?.connection?.saveData;
    setSaveDataRequested(preferenceForSaveData);
  }, []);

  return {
    isSlowConnection,
    saveDataRequested,
    shouldOptimizeMedia: isSlowConnection || saveDataRequested,
    connectionType,
  };
};

/**
 * Usage example:
 * 
 * const { isOnline, isOffline } = useNetworkStatus();
 * 
 * if (!isOnline) {
 *   return <OfflineWarning />;
 * }
 */
</file>

<file path="src/components/FullExam/StepIndicator.jsx">
import React, { memo } from 'react';

// ========================================
// ENHANCED STEP INDICATOR COMPONENT
// ========================================

/**
 * Enhanced StepIndicator - Beautiful, animated progress indicator
 * 
 * Features:
 * - Smooth animations & transitions
 * - Hover effects with tooltips
 * - Better visual hierarchy
 * - Responsive design
 * - Completed state with checkmark
 * - Current step highlight with glow
 */

const StepIndicator = memo(({ currentMode, listeningComplete = false }) => {
  const steps = [
    { id: 'setup', label: 'Select Exam', icon: '', description: 'Choose your exam' },
    { id: 'listening', label: 'Listening (30m)', icon: '', description: 'Listening section' },
    { id: 'reading', label: 'Reading (60m)', icon: '', description: 'Reading section' },
    { id: 'results', label: 'Results', icon: '', description: 'View your score' },
  ];

  let currentIndex = 0;
  if (currentMode === 'exam' && listeningComplete) currentIndex = 2;
  else if (currentMode === 'exam') currentIndex = 1;
  else if (currentMode === 'results') currentIndex = 3;

  return (
    <div className="mb-8 sm:mb-12">
      {/* Main Progress Container */}
      <div className="flex items-center justify-between gap-2 sm:gap-4">
        {steps.map((step, idx) => {
          const isCompleted = idx < currentIndex;
          const isCurrent = idx === currentIndex;
          const isPending = idx > currentIndex;

          return (
            <div key={step.id} className="flex items-center flex-1 group">
              {/* Step Circle */}
              <div className="relative">
                {/* Glow effect for current step */}
                {isCurrent && (
                  <div className="absolute inset-0 bg-blue-400 rounded-full blur-md opacity-40 animate-pulse" 
                    style={{ 
                      animation: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                      width: '52px',
                      height: '52px',
                      marginLeft: '-4px',
                      marginTop: '-4px'
                    }}
                  />
                )}

                {/* Step Button */}
                <button
                  disabled
                  className={`
                    relative w-12 h-12 sm:w-14 sm:h-14 rounded-full flex items-center justify-center 
                    font-bold text-lg sm:text-xl transition-all duration-500 ease-out
                    flex-shrink-0 cursor-default
                    ${isCompleted 
                      ? 'bg-gradient-to-br from-emerald-400 to-emerald-600 text-white shadow-lg shadow-emerald-500/50' 
                      : isCurrent 
                      ? 'bg-gradient-to-br from-blue-500 to-blue-700 text-white shadow-xl shadow-blue-500/50 scale-110' 
                      : 'bg-slate-100 text-slate-400 group-hover:bg-slate-200'
                    }
                  `}
                  title={step.description}
                >
                  <span className={`transition-all duration-300 ${isCurrent ? 'scale-110' : 'scale-100'}`}>
                    {isCompleted ? '' : step.icon}
                  </span>
                </button>
              </div>

              {/* Step Label */}
              <div className="ml-2 sm:ml-3 flex-1 min-w-0">
                <p className={`
                  text-xs sm:text-sm font-bold transition-all duration-300 truncate
                  ${isCompleted || isCurrent ? 'text-slate-900' : 'text-slate-400'}
                `}>
                  {step.label}
                </p>
                <p className={`
                  text-[10px] sm:text-xs mt-0.5 transition-colors duration-300 truncate
                  ${isCompleted || isCurrent ? 'text-slate-600' : 'text-slate-400'}
                `}>
                  {step.description}
                </p>
              </div>

              {/* Connector Line */}
              {idx < steps.length - 1 && (
                <div className="relative flex-1 mx-1 sm:mx-2 h-1 bg-slate-200 rounded-full overflow-hidden">
                  <div
                    className={`
                      h-full rounded-full transition-all duration-700 ease-out
                      ${idx < currentIndex
                        ? 'bg-gradient-to-r from-emerald-400 to-emerald-600 w-full shadow-sm shadow-emerald-400/50'
                        : idx === currentIndex
                        ? 'bg-gradient-to-r from-blue-400 to-blue-500 w-1/2 shadow-sm shadow-blue-400/50'
                        : 'bg-slate-200 w-0'
                      }
                    `}
                  />
                </div>
              )}
            </div>
          );
        })}
      </div>

      {/* Progress Stats Bar (Optional - Remove if not needed) */}
      <div className="mt-6 sm:mt-8 flex items-center justify-center gap-6">
        <div className="text-center">
          <p className="text-xs uppercase tracking-wider text-slate-500 font-bold mb-1">Progress</p>
          <p className="text-2xl font-black text-slate-900">{Math.round((currentIndex / steps.length) * 100)}%</p>
        </div>
        <div className="w-px h-12 bg-slate-200" />
        <div className="text-center">
          <p className="text-xs uppercase tracking-wider text-slate-500 font-bold mb-1">Step</p>
          <p className="text-2xl font-black text-slate-900">{currentIndex + 1} of {steps.length}</p>
        </div>
      </div>

      {/* Custom Animations */}
      <style jsx ={true}>{`
        @keyframes pulse {
          0%, 100% { opacity: 0.4; }
          50% { opacity: 0.6; }
        }
        
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateX(-10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
      `}</style>
    </div>
  );
});

StepIndicator.displayName = 'StepIndicator';

export default StepIndicator;

// ========================================
// ALTERNATIVE: Minimalist Version (if too fancy)
// ========================================

export const StepIndicatorMinimal = memo(({ currentMode, listeningComplete = false }) => {
  const steps = [
    { id: 'setup', label: 'Select Exam', icon: '' },
    { id: 'listening', label: 'Listening', icon: '' },
    { id: 'reading', label: 'Reading', icon: '' },
    { id: 'results', label: 'Results', icon: '' },
  ];

  let currentIndex = 0;
  if (currentMode === 'exam' && listeningComplete) currentIndex = 2;
  else if (currentMode === 'exam') currentIndex = 1;
  else if (currentMode === 'results') currentIndex = 3;

  return (
    <div className="mb-8 flex items-center justify-between gap-3">
      {steps.map((step, idx) => {
        const isCompleted = idx < currentIndex;
        const isCurrent = idx === currentIndex;

        return (
          <div key={step.id} className="flex items-center flex-1">
            {/* Circle */}
            <div className={`
              w-10 h-10 rounded-full flex items-center justify-center font-bold text-base flex-shrink-0
              transition-all duration-300
              ${isCompleted 
                ? 'bg-emerald-500 text-white' 
                : isCurrent 
                ? 'bg-blue-600 text-white shadow-lg scale-110' 
                : 'bg-slate-200 text-slate-400'
              }
            `}>
              {isCompleted ? '' : step.icon}
            </div>

            {/* Line */}
            {idx < steps.length - 1 && (
              <div className={`
                h-1 flex-1 mx-2 transition-colors duration-300
                ${idx < currentIndex ? 'bg-emerald-500' : 'bg-slate-200'}
              `} />
            )}
          </div>
        );
      })}
    </div>
  );
});

StepIndicatorMinimal.displayName = 'StepIndicatorMinimal';

// ========================================
// ALTERNATIVE: Vertical Version (for mobile)
// ========================================

export const StepIndicatorVertical = memo(({ currentMode, listeningComplete = false }) => {
  const steps = [
    { id: 'setup', label: 'Select Exam', icon: '', description: 'Choose your exam' },
    { id: 'listening', label: 'Listening (30m)', icon: '', description: 'Listen and answer' },
    { id: 'reading', label: 'Reading (60m)', icon: '', description: 'Read and answer' },
    { id: 'results', label: 'Results', icon: '', description: 'View your score' },
  ];

  let currentIndex = 0;
  if (currentMode === 'exam' && listeningComplete) currentIndex = 2;
  else if (currentMode === 'exam') currentIndex = 1;
  else if (currentMode === 'results') currentIndex = 3;

  return (
    <div className="mb-8">
      <div className="flex flex-col">
        {steps.map((step, idx) => {
          const isCompleted = idx < currentIndex;
          const isCurrent = idx === currentIndex;

          return (
            <div key={step.id} className="flex items-start">
              {/* Timeline Column */}
              <div className="flex flex-col items-center mr-4">
                {/* Step Circle */}
                <div className={`
                  w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg
                  transition-all duration-300
                  ${isCompleted 
                    ? 'bg-emerald-500 text-white' 
                    : isCurrent 
                    ? 'bg-blue-600 text-white shadow-lg' 
                    : 'bg-slate-200 text-slate-400'
                  }
                `}>
                  {isCompleted ? '' : step.icon}
                </div>

                {/* Vertical Line */}
                {idx < steps.length - 1 && (
                  <div className={`
                    w-1 h-12 mt-2
                    ${idx < currentIndex ? 'bg-emerald-500' : 'bg-slate-200'}
                  `} />
                )}
              </div>

              {/* Step Info */}
              <div className="pt-2 pb-8">
                <p className={`
                  font-bold transition-colors duration-300
                  ${isCompleted || isCurrent ? 'text-slate-900' : 'text-slate-400'}
                `}>
                  {step.label}
                </p>
                <p className={`
                  text-sm mt-1 transition-colors duration-300
                  ${isCompleted || isCurrent ? 'text-slate-600' : 'text-slate-400'}
                `}>
                  {step.description}
                </p>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
});

StepIndicatorVertical.displayName = 'StepIndicatorVertical';
</file>

<file path="src/components/FullExam/utils/answerKey.js">
/* src/components/FullExam/utils/answerKey.js */

/**
 * Generate consistent answer key format
 * Format: "{section}-part{part}-q{question}"
 * Example: "listening-part1-q1", "reading-part5-q3"
 * 
 *  Benefits:
 * - Avoid typos
 * - Easy to refactor (single source of truth)
 * - Searchable across codebase
 * - Type-safe
 */
export const generateAnswerKey = ({ section, part, question }) => {
  if (!section || part === undefined || question === undefined) {
    throw new Error(`Invalid answer key params: section=${section}, part=${part}, question=${question}`);
  }
  return `${section}-part${part}-q${question}`;
};

/**
 * Parse answer key back to components
 * Example: "listening-part1-q1"  { section: 'listening', part: 1, question: 1 }
 */
export const parseAnswerKey = (key) => {
  if (!key || typeof key !== 'string') {
    return null;
  }
  
  const match = key.match(/^(\w+)-part(\d+)-q(\d+)$/);
  if (!match) {
    console.warn(`Invalid answer key format: "${key}"`);
    return null;
  }
  
  return {
    section: match[1],
    part: parseInt(match[2], 10),
    question: parseInt(match[3], 10),
  };
};

/**
 * Check if a question is answered
 */
export const isQuestionAnswered = (answers, section, part, question) => {
  const key = generateAnswerKey({ section, part, question });
  return answers[key] !== undefined;
};

/**
 * Get answer for a question
 */
export const getQuestionAnswer = (answers, section, part, question) => {
  const key = generateAnswerKey({ section, part, question });
  return answers[key];
};

/**
 * Set answer for a question
 */
export const setQuestionAnswer = (answers, section, part, question, value) => {
  const key = generateAnswerKey({ section, part, question });
  return {
    ...answers,
    [key]: value,
  };
};

/**
 * Count answered questions in a section
 */
export const countAnsweredQuestions = (answers, section) => {
  return Object.keys(answers)
    .filter(key => key.startsWith(section))
    .length;
};

/**
 * Get all answers for a part
 */
export const getPartAnswers = (answers, section, part) => {
  const prefix = `${section}-part${part}-`;
  return Object.entries(answers)
    .filter(([key]) => key.startsWith(prefix))
    .reduce((acc, [key, value]) => {
      acc[key] = value;
      return acc;
    }, {});
};

/**
 * Clear answers for a section
 */
export const clearSectionAnswers = (answers, section) => {
  const result = { ...answers };
  Object.keys(result).forEach(key => {
    if (key.startsWith(section)) {
      delete result[key];
    }
  });
  return result;
};
</file>

<file path="src/components/FullExam/utils/examHelpers.js">
/* src/components/FullExam/utils/examHelpers.js */

import { EXAM_STRUCTURE } from '../constants/examConfig';

/**
 * Format seconds to MM:SS display
 * @param {number} seconds - Total seconds
 * @returns {string} "MM:SS" format
 */
export const formatTime = (seconds) => {
  if (typeof seconds !== 'number' || seconds < 0) return '00:00';
  
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
};

/**
 * Get configuration for a section
 */
export const getExamConfig = (section) => {
  return EXAM_STRUCTURE[section] || null;
};

/**
 * Calculate results for a section
 * @param {Object} examData - Exam data with parts and questions
 * @param {Object} answers - User answers { "listening-part1-q1": 0, ... }
 * @param {string} section - "listening" or "reading"
 * @returns {Object} { correct, points, percentage }
 */
export const calculateSectionResults = (examData, answers, section) => {
  if (!examData?.parts) {
    return { correct: 0, points: 0, percentage: 0, totalQuestions: 0 };
  }

  const cfg = EXAM_STRUCTURE[section];
  if (!cfg) return { correct: 0, points: 0, percentage: 0, totalQuestions: 0 };

  let correct = 0;
  let totalAnswered = 0;

  for (let p = 1; p <= cfg.parts; p++) {
    const partKey = `part${p}`;
    const part = examData.parts[partKey];

    if (!part?.questions) continue;

    part.questions.forEach((q, idx) => {
      const answerKey = `${section}-part${p}-q${idx + 1}`;
      const userAnswer = answers[answerKey];

      if (userAnswer !== undefined) {
        totalAnswered++;
        if (userAnswer === q.correct) {
          correct++;
        }
      }
    });
  }

  const points = correct * cfg.pointsPerQuestion;
  const percentage = (correct / cfg.totalQuestions) * 100;

  return { correct, points, percentage, totalAnswered, totalQuestions: cfg.totalQuestions };
};

/**
 * Calculate full exam results
 */
export const calculateFullResults = (examData, answers) => {
  const listening = calculateSectionResults(examData, answers, 'listening');
  const reading = calculateSectionResults(examData, answers, 'reading');

  const totalCorrect = listening.correct + reading.correct;
  const totalQuestions = listening.totalQuestions + reading.totalQuestions;
  const averageScore = ((totalCorrect / totalQuestions) * 100).toFixed(1);

  return {
    listening,
    reading,
    totalCorrect,
    totalQuestions,
    averageScore,
    cefr: getCEFRLevel(averageScore),
  };
};

/**
 * Get CEFR level from score
 * CEFR: Common European Framework of Reference
 */
export const getCEFRLevel = (score) => {
  const numScore = typeof score === 'string' ? parseFloat(score) : score;

  if (numScore >= 75) {
    return {
      level: 'C1',
      label: 'Advanced',
      color: '#059669',
      range: '75-100',
      description: 'Excellent proficiency',
    };
  }
  if (numScore >= 50) {
    return {
      level: 'B2',
      label: 'Upper Intermediate',
      color: '#0066CC',
      range: '50-74',
      description: 'Good proficiency',
    };
  }
  if (numScore >= 25) {
    return {
      level: 'B1',
      label: 'Intermediate',
      color: '#FF8C42',
      range: '25-49',
      description: 'Basic proficiency',
    };
  }
  if (numScore >= 15) {
    return {
      level: 'A2',
      label: 'Elementary',
      color: '#F59E0B',
      range: '15-24',
      description: 'Limited proficiency',
    };
  }
  
  return {
    level: 'A1',
    label: 'Beginner',
    color: '#DC2626',
    range: '0-14',
    description: 'Very limited proficiency',
  };
};

/**
 * Count unanswered questions in a section
 */
export const countUnansweredQuestions = (examData, answers, section) => {
  if (!examData?.parts) return 0;

  const cfg = EXAM_STRUCTURE[section];
  if (!cfg) return 0;

  let unanswered = 0;

  for (let p = 1; p <= cfg.parts; p++) {
    const partKey = `part${p}`;
    const part = examData.parts[partKey];

    if (!part?.questions) continue;

    part.questions.forEach((_, idx) => {
      const answerKey = `${section}-part${p}-q${idx + 1}`;
      if (answers[answerKey] === undefined) {
        unanswered++;
      }
    });
  }

  return unanswered;
};

/**
 * Count total unanswered questions across all sections
 */
export const countTotalUnansweredQuestions = (examData, answers) => {
  const listeningUnanswered = countUnansweredQuestions(examData, answers, 'listening');
  const readingUnanswered = countUnansweredQuestions(examData, answers, 'reading');
  return listeningUnanswered + readingUnanswered;
};

/**
 * Get results breakdown by part
 */
export const getResultsByPart = (examData, answers) => {
  const results = {
    listeningByPart: {},
    readingByPart: {},
  };

  // Listening parts (1-4)
  for (let p = 1; p <= 4; p++) {
    const partKey = `part${p}`;
    const part = examData.parts[partKey];
    let correct = 0;

    if (part?.questions) {
      part.questions.forEach((q, idx) => {
        const answerKey = `listening-part${p}-q${idx + 1}`;
        if (answers[answerKey] === q.correct) {
          correct++;
        }
      });
    }

    results.listeningByPart[p] = correct;
  }

  // Reading parts (5-8)
  for (let p = 5; p <= 8; p++) {
    const partKey = `part${p}`;
    const part = examData.parts[partKey];
    let correct = 0;

    if (part?.questions) {
      part.questions.forEach((q, idx) => {
        const readingPart = p - 4;
        const answerKey = `reading-part${readingPart}-q${idx + 1}`;
        if (answers[answerKey] === q.correct) {
          correct++;
        }
      });
    }

    results.readingByPart[p - 4] = correct;
  }

  return results;
};

/**
 * Check if an answer is correct
 */
export const isAnswerCorrect = (question, selectedAnswerIndex) => {
  if (!question || selectedAnswerIndex === undefined) return false;
  return selectedAnswerIndex === question.correct;
};

/**
 * Calculate percentage
 */
export const calculatePercentage = (correct, total) => {
  if (total === 0) return 0;
  return (correct / total) * 100;
};
</file>

<file path="src/components/Grama/GrammarReview.jsx">
import React, { useState, useCallback, useMemo, useEffect, useRef } from 'react';
import {
  ChevronDown,
  BookOpen,
  Lightbulb,
  PlayCircle,
  XCircle,
  Search,
  Bookmark,
  BookmarkCheck,
  RotateCcw,
} from 'lucide-react';
import confetti from 'canvas-confetti';
import {
  getGrammarByLevel,
  searchLessons,
  getLessonIdsByLevel,
  getLessonIdsForTopicIds,
  GRAMMAR_QUIZZES,
  COMMON_MISTAKES,
  STUDY_TIPS,
  REAL_WORLD_EXAMPLES,
} from '../../data/grammarData';
import GrammarTopicPage from './GrammarTopicPage';
import '../styles/GrammarReview.css';

const LEVELS = ['Beginner', 'Intermediate', 'Advanced'];
const DIFFICULTIES = ['All', 'Easy', 'Medium', 'Hard'];
/* 3 tabs to reduce cognitive load (was 5) */
const TABS = [
  { id: 'topics', label: 'Topics', icon: '' },
  { id: 'practice', label: 'Practice', icon: '' },
  { id: 'quiz', label: 'Quizzes', icon: '' },
];
const PRACTICE_SECTIONS = [
  { id: 'mistakes', label: 'Mistakes', icon: '' },
  { id: 'tips', label: 'Tips', icon: '' },
  { id: 'examples', label: 'Examples', icon: '' },
];

const BOOKMARK_TIPS_KEY = 'grammar-bookmarked-tips';
const BOOKMARK_EXAMPLES_KEY = 'grammar-bookmarked-examples';

// Difficulty  "nng lng kin thc" (Easy=Emerald, Medium=Blue, Hard=Violet)
const getDifficultyStyles = (diff) => {
  const d = (diff || '').toLowerCase();
  if (d === 'beginner' || d === 'easy')
    return {
      badge: 'bg-emerald-100 text-emerald-800 border-emerald-200',
      buttonActive: 'bg-emerald-600 text-white border-emerald-600 shadow-sm',
      progress: 'from-emerald-500 to-emerald-600',
    };
  if (d === 'intermediate' || d === 'medium')
    return {
      badge: 'bg-sky-100 text-sky-800 border-sky-200',
      buttonActive: 'bg-sky-600 text-white border-sky-600 shadow-sm',
      progress: 'from-sky-500 to-sky-600',
    };
  if (d === 'advanced' || d === 'hard')
    return {
      badge: 'bg-violet-100 text-violet-800 border-violet-200',
      buttonActive: 'bg-violet-600 text-white border-violet-600 shadow-sm',
      progress: 'from-violet-500 to-violet-600',
    };
  return {
    badge: 'bg-slate-100 text-slate-700 border-slate-200',
    buttonActive: 'bg-grammar-primary text-white border-grammar-primary shadow-sm',
    progress: 'from-grammar-primary to-grammar-accent',
  };
};

// Soft shadow card (ni khi)
const cardClass =
  'bg-white rounded-xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-xl transition-all duration-200';
const cardClassInteractive = cardClass + ' hover:-translate-y-0.5 cursor-pointer';

const loadBookmarks = (key) => {
  try {
    const raw = localStorage.getItem(key);
    return raw ? new Set(JSON.parse(raw)) : new Set();
  } catch {
    return new Set();
  }
};
const saveBookmarks = (key, set) => {
  try {
    localStorage.setItem(key, JSON.stringify([...set]));
  } catch {}
};

// Hybrid search: filter by query + difficulty
const searchAll = (query, filterDifficulty) => {
  const q = query.trim().toLowerCase();
  const topicsRaw = q ? searchLessons(query) : [];
  const topicsDeduped = [...new Map((topicsRaw || []).map((r) => [r.id, { ...r, lesson: undefined }])).values()];
  let topics = topicsDeduped;
  if (filterDifficulty !== 'All') {
    topics = topics.filter((t) => t.difficulty === filterDifficulty);
  }

  const mistakes = q
    ? COMMON_MISTAKES.filter(
        (m) =>
          m.mistake.toLowerCase().includes(q) ||
          m.correct.toLowerCase().includes(q) ||
          m.explanation.toLowerCase().includes(q) ||
          m.topic.toLowerCase().includes(q)
      )
    : [];
  const tips = q
    ? STUDY_TIPS.filter(
        (t) =>
          t.title.toLowerCase().includes(q) ||
          t.description.toLowerCase().includes(q) ||
          t.relatedTopics.some((r) => r.toLowerCase().includes(q))
      )
    : [];
  const examples = q
    ? REAL_WORLD_EXAMPLES.filter(
        (e) =>
          e.context.toLowerCase().includes(q) ||
          e.original.toLowerCase().includes(q) ||
          e.explanation.toLowerCase().includes(q) ||
          e.topic.toLowerCase().includes(q)
      )
    : [];
  const quizzes = q
    ? GRAMMAR_QUIZZES.filter(
        (z) =>
          z.title.toLowerCase().includes(q) ||
          z.topics.some((t) => t.toLowerCase().includes(q)) ||
          z.difficulty.toLowerCase().includes(q)
      )
    : [];

  return { topics, mistakes, tips, examples, quizzes };
};

const fireConfetti = (full = true) => {
  confetti({
    particleCount: full ? 80 : 40,
    spread: full ? 60 : 45,
    origin: { y: 0.6 },
    colors: ['#00358E', '#FF7D00', '#2563eb'],
  });
};

const MILESTONES = [25, 50, 75, 100];

const GrammarReview = () => {
  const [selectedLevel, setSelectedLevel] = useState('Beginner');
  const [selectedTopic, setSelectedTopic] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterDifficulty, setFilterDifficulty] = useState('All');
  const [activeTab, setActiveTab] = useState('topics');
  const [completedLessons, setCompletedLessons] = useState([]);
  const [flippedMistakes, setFlippedMistakes] = useState(() => new Set());
  const [bookmarkedTips, setBookmarkedTips] = useState(() => loadBookmarks(BOOKMARK_TIPS_KEY));
  const [bookmarkedExamples, setBookmarkedExamples] = useState(() =>
    loadBookmarks(BOOKMARK_EXAMPLES_KEY)
  );
  const [activePracticeSection, setActivePracticeSection] = useState('mistakes');
  const [showFilters, setShowFilters] = useState(false);
  const [isScrolled, setIsScrolled] = useState(false);
  const [isLevelLoading, setIsLevelLoading] = useState(false);
  const mainRef = useRef(null);
  const scrollThrottleRef = useRef(null);
  const lastScrollYRef = useRef(0);
  const prevPctRef = useRef({ Beginner: 0, Intermediate: 0, Advanced: 0 });

  const grammarData = useMemo(() => getGrammarByLevel(selectedLevel), [selectedLevel]);

  /* Throttled scroll: rAF + update only when crossing threshold to avoid jank */
  useEffect(() => {
    const THRESHOLD = 24;
    const onScroll = () => {
      if (scrollThrottleRef.current) return;
      scrollThrottleRef.current = requestAnimationFrame(() => {
        const above = window.scrollY > THRESHOLD;
        if (above !== lastScrollYRef.current) {
          lastScrollYRef.current = above;
          setIsScrolled(above);
        }
        scrollThrottleRef.current = null;
      });
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
    return () => {
      window.removeEventListener('scroll', onScroll);
      if (scrollThrottleRef.current) cancelAnimationFrame(scrollThrottleRef.current);
    };
  }, []);

  useEffect(() => {
    setIsLevelLoading(true);
    const t = setTimeout(() => setIsLevelLoading(false), 400);
    return () => clearTimeout(t);
  }, [selectedLevel]);

  const progressPerLevel = useMemo(() => {
    return LEVELS.map((level) => {
      const lessonIds = getLessonIdsByLevel(level);
      const completed = completedLessons.filter((id) => lessonIds.includes(id)).length;
      const total = lessonIds.length;
      return {
        level,
        completed,
        total,
        pct: total > 0 ? Math.round((completed / total) * 100) : 0,
      };
    });
  }, [completedLessons]);

  const recommendedTopicId = useMemo(() => {
    if (!grammarData?.topics) return null;
    for (const [, topic] of Object.entries(grammarData.topics)) {
      const lessonIds = (topic.lessons || []).map((l) => l.lessonId);
      const done = lessonIds.filter((id) => completedLessons.includes(id)).length;
      if (done < lessonIds.length) return topic.id;
    }
    return null;
  }, [grammarData, completedLessons]);

  const hybridResults = useMemo(
    () => searchAll(searchQuery, filterDifficulty),
    [searchQuery, filterDifficulty]
  );

  const handleTopicSelect = useCallback((topic) => {
    setSelectedTopic((prev) => (prev?.id === topic.id ? null : topic));
  }, []);

  const handleLevelChange = useCallback((level) => {
    setSelectedLevel(level);
    setSelectedTopic(null);
    setSearchQuery('');
    setFilterDifficulty('All');
  }, []);

  const toggleMistakeFlip = useCallback((id) => {
    setFlippedMistakes((prev) => {
      const next = new Set(prev);
      if (next.has(id)) next.delete(id);
      else next.add(id);
      return next;
    });
  }, []);

  const toggleBookmarkTip = useCallback((id) => {
    setBookmarkedTips((prev) => {
      const next = new Set(prev);
      if (next.has(id)) next.delete(id);
      else next.add(id);
      saveBookmarks(BOOKMARK_TIPS_KEY, next);
      return next;
    });
  }, []);

  const toggleBookmarkExample = useCallback((id) => {
    setBookmarkedExamples((prev) => {
      const next = new Set(prev);
      if (next.has(id)) next.delete(id);
      else next.add(id);
      saveBookmarks(BOOKMARK_EXAMPLES_KEY, next);
      return next;
    });
  }, []);

  /* Micro-celebrations when crossing 25/50/75/100% (feedback loop) */
  useEffect(() => {
    progressPerLevel.forEach(({ level, pct }) => {
      const prev = prevPctRef.current[level] ?? 0;
      const hit = MILESTONES.find((m) => pct >= m && prev < m);
      if (hit) {
        fireConfetti(hit === 100);
      }
      prevPctRef.current[level] = pct;
    });
  }, [progressPerLevel]);

  const isEmptySearch =
    searchQuery.trim() &&
    hybridResults.topics.length === 0 &&
    hybridResults.mistakes.length === 0 &&
    hybridResults.tips.length === 0 &&
    hybridResults.examples.length === 0 &&
    hybridResults.quizzes.length === 0;

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-50 via-blue-50/30 to-grammar-blue-soft/50 p-3 sm:p-5 lg:p-6" ref={mainRef}>
      <div className="max-w-3xl mx-auto sm:max-w-4xl lg:max-w-[960px]">
        {/* Non-sticky: title, progress, level, search (reduces viewport steal) */}
        <header className="mb-4" role="banner">
          <h1 className="text-xl sm:text-2xl font-bold text-grammar-primary tracking-tight leading-tight">
             Grammar Review
          </h1>
          <p className="text-slate-700 text-sm sm:text-base mt-1 leading-relaxed">
            Master English grammar with interactive lessons
          </p>

          <div className={`${cardClass} p-4 mt-4 mb-4`}>
            <p className="text-xs font-semibold text-grammar-primary uppercase tracking-wide mb-3 leading-normal">
              Progress by level
            </p>
            <div className="flex gap-2 sm:gap-4">
              {progressPerLevel.map(({ level, completed, total, pct }) => {
                const style = getDifficultyStyles(level);
                return (
                  <div key={level} className="flex-1 min-w-0">
                    <div className="flex justify-between items-center mb-1">
                      <span
                        className={`text-xs font-semibold truncate leading-tight ${
                          selectedLevel === level ? 'text-grammar-primary' : 'text-slate-600'
                        }`}
                      >
                        {level === 'Beginner' ? 'Beg.' : level === 'Intermediate' ? 'Int.' : 'Adv.'}
                      </span>
                      <span className="text-xs font-bold text-grammar-accent tabular-nums">{pct}%</span>
                    </div>
                    <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                      <div
                        className={`h-full rounded-full bg-gradient-to-r ${style.progress} transition-all duration-500`}
                        style={{ width: `${pct}%` }}
                      />
                    </div>
                    <p className="text-xs text-slate-600 mt-0.5 leading-normal">{completed}/{total}</p>
                  </div>
                );
              })}
            </div>
          </div>

          <div className="flex flex-wrap gap-2" role="group" aria-label="Level">
            {LEVELS.map((level) => {
              const style = getDifficultyStyles(level);
              const isActive = selectedLevel === level;
              return (
                <button
                  key={level}
                  type="button"
                  onClick={() => handleLevelChange(level)}
                  aria-pressed={isActive}
                  className={`px-4 py-2.5 rounded-xl font-semibold text-sm min-h-[44px] min-w-[44px] border-2 transition-all ${
                    isActive ? style.buttonActive : 'bg-white border-slate-200 text-slate-800 hover:bg-slate-50 hover:border-slate-300'
                  }`}
                >
                  {level}
                </button>
              );
            })}
          </div>

          <div className="flex flex-col sm:flex-row sm:items-center gap-3 mt-4">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500 pointer-events-none" aria-hidden />
              <input
                type="text"
                placeholder="Search topics, mistakes, tips..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                aria-label="Search grammar"
                className="w-full pl-10 pr-4 py-3 min-h-[44px] rounded-xl bg-white text-slate-900 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-grammar-accent/50 shadow-[0_4px_14px_rgb(0,0,0,0.04)] transition-shadow text-sm leading-relaxed"
              />
            </div>
            {/* Progressive disclosure: Filters (difficulty) hidden by default */}
            <div className="flex items-center gap-2">
              <button
                type="button"
                onClick={() => setShowFilters((f) => !f)}
                className="flex items-center gap-2 px-4 py-3 min-h-[44px] rounded-xl bg-white border border-slate-200 text-slate-700 font-semibold text-sm hover:bg-slate-50 transition-colors"
                aria-expanded={showFilters}
                aria-label="Toggle filters"
              >
                <ChevronDown className={`w-4 h-4 transition-transform ${showFilters ? 'rotate-180' : ''}`} />
                Filters
              </button>
              {showFilters && (
                <div className="flex flex-wrap gap-2">
                  {DIFFICULTIES.map((diff) => {
                    const style = getDifficultyStyles(diff);
                    const isActive = filterDifficulty === diff;
                    return (
                      <button
                        key={diff}
                        type="button"
                        onClick={() => setFilterDifficulty(diff)}
                        className={`px-3 py-2 rounded-lg text-sm font-semibold min-h-[44px] min-w-[44px] border transition-all ${
                          isActive ? style.buttonActive : 'bg-white border-slate-200 text-slate-800 hover:bg-slate-50'
                        }`}
                      >
                        {diff}
                      </button>
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        </header>

        {/* Sticky: only tab bar (~52px) to maximize content space */}
        <nav
          className={`sticky top-0 z-20 -mx-3 px-3 sm:-mx-5 sm:px-5 lg:-mx-6 lg:px-6 py-0 mb-4 transition-shadow ${
            isScrolled ? 'bg-white/90 backdrop-blur-md shadow-[0_4px_20px_rgb(0,0,0,0.06)]' : 'bg-transparent'
          }`}
          aria-label="Sections"
        >
          <div className="flex gap-0 border-b border-slate-200" role="tablist">
            {TABS.map((tab) => (
              <button
                key={tab.id}
                type="button"
                role="tab"
                aria-selected={activeTab === tab.id}
                aria-controls={`grammar-panel-${tab.id}`}
                id={`grammar-tab-${tab.id}`}
                onClick={() => setActiveTab(tab.id)}
                className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 font-semibold text-sm border-b-[3px] -mb-px min-h-[44px] transition-colors ${
                  activeTab === tab.id
                    ? 'text-grammar-accent border-grammar-accent bg-transparent'
                    : 'text-slate-600 border-transparent hover:text-slate-800'
                }`}
              >
                <span aria-hidden>{tab.icon}</span>
                <span>{tab.label}</span>
              </button>
            ))}
          </div>
        </nav>

        <main role="main">
          <div
            id={`grammar-panel-${activeTab}`}
            role="tabpanel"
            aria-labelledby={`grammar-tab-${activeTab}`}
          >
            {/* Hybrid search results */}
            {searchQuery.trim() && (
              <div className="mb-6 space-y-6">
                <h2 className="text-lg font-bold text-grammar-primary flex items-center gap-2">
                  <Search className="w-5 h-5" />
                  Search results
                </h2>
                {hybridResults.topics.length > 0 && (
                  <section>
                    <h3 className="text-sm font-semibold text-slate-800 mb-2 leading-tight">Topics</h3>
                    <div className="flex flex-col gap-2">
                      {hybridResults.topics.slice(0, 5).map((topic) => (
                        <button
                          key={topic.id}
                          type="button"
                          onClick={() => {
                            setSelectedTopic(topic);
                            setActiveTab('topics');
                          }}
                          className={`${cardClassInteractive} p-3 text-left`}
                        >
                          <span className="font-semibold text-slate-900">{topic.title}</span>
                          <span className={`text-xs ml-2 px-2 py-0.5 rounded ${getDifficultyStyles(topic.difficulty).badge}`}>
                            {topic.difficulty}
                          </span>
                        </button>
                      ))}
                    </div>
                  </section>
                )}
                {hybridResults.mistakes.length > 0 && (
                  <section>
                    <h3 className="text-sm font-semibold text-slate-800 mb-2 leading-tight">Common mistakes</h3>
                    <div className="flex flex-col gap-2">
                      {hybridResults.mistakes.slice(0, 3).map((m) => (
                        <div key={m.id} className="bg-red-50 rounded-xl p-3 shadow-[0_4px_14px_rgb(0,0,0,0.04)] text-sm text-red-900">
                           {m.mistake}   {m.correct}
                        </div>
                      ))}
                    </div>
                  </section>
                )}
                {hybridResults.tips.length > 0 && (
                  <section>
                    <h3 className="text-sm font-semibold text-slate-800 mb-2 leading-tight">Tips</h3>
                    <div className="flex flex-col gap-2">
                      {hybridResults.tips.slice(0, 3).map((t) => (
                        <div key={t.id} className={`${cardClass} p-3`}>
                          <span className="font-semibold text-slate-900">{t.title}</span>
                        </div>
                      ))}
                    </div>
                  </section>
                )}
                {hybridResults.examples.length > 0 && (
                  <section>
                    <h3 className="text-sm font-semibold text-slate-800 mb-2 leading-tight">Examples</h3>
                    <div className="flex flex-col gap-2">
                      {hybridResults.examples.slice(0, 3).map((e) => (
                        <div key={e.id} className="bg-slate-50 rounded-xl p-3 shadow-[0_4px_14px_rgb(0,0,0,0.04)] text-sm font-mono text-slate-800">
                          &quot;{e.original}&quot;
                        </div>
                      ))}
                    </div>
                  </section>
                )}
                {hybridResults.quizzes.length > 0 && (
                  <section>
                    <h3 className="text-sm font-semibold text-slate-800 mb-2 leading-tight">Quizzes</h3>
                    <div className="flex flex-col gap-2">
                      {hybridResults.quizzes.slice(0, 3).map((z) => (
                        <div key={z.quizId} className="bg-grammar-accent/10 rounded-xl p-3 shadow-[0_4px_14px_rgb(0,0,0,0.04)] font-semibold text-grammar-primary">
                          {z.title}
                        </div>
                      ))}
                    </div>
                  </section>
                )}
                {isEmptySearch && (
                  <div className="flex flex-col items-center justify-center py-14 px-4 text-center">
                    <div className="w-20 h-20 rounded-full bg-grammar-blue-soft flex items-center justify-center text-4xl mb-5" aria-hidden>
                      
                    </div>
                    <h3 className="text-lg font-bold text-slate-800 mb-2 leading-tight">Nothing here yet</h3>
                    <p className="text-slate-700 text-sm leading-relaxed mb-5 max-w-xs">
                      No matches for your search. Try another word or clear filters to browse everything.
                    </p>
                    <button
                      type="button"
                      onClick={() => {
                        setSearchQuery('');
                        setFilterDifficulty('All');
                        setShowFilters(false);
                      }}
                      className="px-5 py-3 min-h-[44px] rounded-xl font-semibold text-white bg-grammar-primary hover:bg-grammar-primary-hover shadow-[0_4px_14px_rgb(0,53,142,0.25)] transition-all"
                    >
                      Clear filters
                    </button>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'topics' && selectedTopic && (
              <div className="animate-[slideDown_0.3s_ease-out]">
                <button
                  type="button"
                  onClick={() => setSelectedTopic(null)}
                  className="mb-4 inline-flex items-center gap-2 px-4 py-3 min-h-[44px] bg-white text-slate-800 font-semibold rounded-xl shadow-[0_4px_14px_rgb(0,0,0,0.06)] hover:shadow-lg hover:bg-slate-50 transition-all focus:outline-none focus:ring-2 focus:ring-grammar-accent focus:ring-offset-2"
                >
                   Back to Topics
                </button>
                <GrammarTopicPage
                  topic={selectedTopic}
                  completedLessons={completedLessons}
                  onLessonComplete={(lessonId) => {
                    setCompletedLessons((prev) =>
                      prev.includes(lessonId) ? prev.filter((id) => id !== lessonId) : [...prev, lessonId]
                    );
                  }}
                />
              </div>
            )}

            {activeTab === 'topics' && !selectedTopic && (
              <div className="flex flex-col gap-4">
                {isLevelLoading ? (
                  [...Array(4)].map((_, i) => (
                    <div key={i} className={`${cardClass} p-4 sm:p-5 animate-pulse min-h-[100px]`} role="status" aria-label="Loading">
                      <div className="flex items-center justify-between gap-4">
                        <div className="flex items-center gap-3 sm:gap-4 min-w-0 flex-1">
                          <div className="w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-slate-200 shrink-0" />
                          <div className="flex-1 space-y-2 min-w-0">
                            <div className="h-5 bg-slate-200 rounded w-3/4" />
                            <div className="h-4 bg-slate-100 rounded w-full" />
                            <div className="h-4 bg-slate-100 rounded w-2/3" />
                            <div className="h-6 w-20 bg-slate-100 rounded-lg mt-2" />
                          </div>
                        </div>
                        <div className="w-16 h-8 bg-slate-100 rounded-lg shrink-0" />
                      </div>
                    </div>
                  ))
                ) : (
                  grammarData &&
                  Object.entries(grammarData.topics).map(([, topic]) => {
                    const lessonIds = (topic.lessons || []).map((l) => l.lessonId);
                    const completedCount = lessonIds.filter((id) => completedLessons.includes(id)).length;
                    const isRecommended = recommendedTopicId === topic.id;
                    const diffStyle = getDifficultyStyles(topic.difficulty);
                    return (
                      <div
                        key={topic.id}
                        className={`${cardClassInteractive} overflow-hidden relative ${
                          isRecommended ? 'ring-2 ring-grammar-accent/40' : ''
                        }`}
                      >
                        {isRecommended && (
                          <div className="absolute top-0 right-0 bg-grammar-accent text-white text-xs font-bold px-3 py-1.5 rounded-bl-xl rounded-tr-xl z-10 flex items-center gap-1 shadow-md">
                            <RotateCcw className="w-3 h-3" />
                            Recommended next
                          </div>
                        )}
                        <button
                          type="button"
                          onClick={() => handleTopicSelect(topic)}
                          className="w-full flex items-center justify-between gap-4 p-4 sm:p-5 text-left hover:bg-slate-50/80 transition-colors rounded-xl"
                        >
                          <div className="flex items-center gap-3 sm:gap-4 min-w-0 flex-1">
                            <span className="text-2xl sm:text-3xl shrink-0">{topic.icon}</span>
                            <div className="min-w-0">
                              <h3 className="font-semibold text-slate-900 text-base sm:text-lg truncate">
                                {topic.title}
                              </h3>
                              <p className="text-slate-700 text-sm mt-0.5 line-clamp-2 leading-relaxed">
                                {topic.description}
                              </p>
                              <div className="flex items-center gap-2 mt-2">
                                <span
                                  className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-lg text-xs font-semibold ${
                                    completedCount === lessonIds.length && lessonIds.length > 0
                                      ? 'bg-emerald-100 text-emerald-800'
                                      : diffStyle.badge
                                  }`}
                                >
                                  {completedCount === lessonIds.length && lessonIds.length > 0 ? ' ' : ''}
                                  {completedCount}/{lessonIds.length} lessons
                                </span>
                              </div>
                            </div>
                          </div>
                          <div className="flex items-center gap-2 shrink-0">
                            <span className={`px-2.5 py-1 rounded-lg text-xs font-semibold border ${diffStyle.badge}`}>
                              {topic.difficulty}
                            </span>
                            <ChevronDown className="w-5 h-5 text-slate-500" />
                          </div>
                        </button>
                      </div>
                    );
                  })
                )}
              </div>
            )}

            {activeTab === 'practice' && (
              <div className="flex flex-col gap-4">
                <div className="flex gap-2 p-1 bg-slate-100 rounded-xl" role="tablist" aria-label="Practice type">
                  {PRACTICE_SECTIONS.map((sec) => (
                    <button
                      key={sec.id}
                      type="button"
                      onClick={() => setActivePracticeSection(sec.id)}
                      className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold text-sm min-h-[44px] transition-colors ${
                        activePracticeSection === sec.id
                          ? 'bg-white text-grammar-primary shadow-sm'
                          : 'text-slate-700 hover:text-slate-900'
                      }`}
                    >
                      <span aria-hidden>{sec.icon}</span>
                      {sec.label}
                    </button>
                  ))}
                </div>

                {activePracticeSection === 'mistakes' && (
              <>
                <p className="text-sm text-slate-700 leading-relaxed mb-2">
                  Think of the correct form first, then tap to reveal the answer (active recall).
                </p>
                <div className="flex flex-col gap-4">
                {COMMON_MISTAKES.map((mistake) => {
                  const isFlipped = flippedMistakes.has(mistake.id);
                  return (
                    <div
                      key={mistake.id}
                      className={`grammar-flashcard ${cardClass} overflow-hidden cursor-pointer select-none perspective-1000`}
                      style={{ perspective: '1000px' }}
                      onClick={() => toggleMistakeFlip(mistake.id)}
                      role="button"
                      tabIndex={0}
                      onKeyDown={(e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                          e.preventDefault();
                          toggleMistakeFlip(mistake.id);
                        }
                      }}
                      aria-label={isFlipped ? 'Hide answer' : 'Reveal correct form and explanation'}
                    >
                      <div
                        className={`grammar-flashcard-inner relative min-h-[140px] ${isFlipped ? 'is-flipped' : ''}`}
                      >
                        <div className="grammar-flashcard-front absolute inset-0 p-4 sm:p-5 flex flex-col justify-center">
                          <div className="flex gap-4">
                            <XCircle className="w-5 h-5 text-red-500 shrink-0 mt-0.5" />
                            <div className="min-w-0 flex-1">
                              <h3 className="font-semibold text-slate-800 text-sm mb-2">
                                Common mistake (tap to reveal answer):
                              </h3>
                              <p className="bg-red-50 border border-red-200 rounded-lg p-3 text-red-800 text-sm font-medium">
                                 {mistake.mistake}
                              </p>
                              <p className="text-xs text-slate-600 mt-2 leading-normal">Tap card to see correct form</p>
                            </div>
                          </div>
                        </div>
                        <div className="grammar-flashcard-back absolute inset-0 p-4 sm:p-5">
                          <div className="flex gap-4">
                            <XCircle className="w-5 h-5 text-red-500 shrink-0 mt-0.5" />
                            <div className="min-w-0 flex-1">
                              <h4 className="font-semibold text-slate-800 text-sm mb-1">Correct:</h4>
                              <p className="bg-emerald-50 border border-emerald-200 rounded-lg p-3 text-emerald-900 text-sm font-medium mb-3">
                                 {mistake.correct}
                              </p>
                              <h4 className="font-semibold text-slate-800 text-sm mb-1">Explanation:</h4>
                              <p className="text-slate-700 text-sm leading-relaxed">{mistake.explanation}</p>
                              <span className="inline-block mt-3 px-2.5 py-1 rounded-lg bg-slate-100 text-slate-700 border border-slate-200 text-xs font-semibold">
                                Topic: {mistake.topic}
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  );
                })}
                </div>
                </>
                )}

                {activePracticeSection === 'tips' && (
              <div className="flex flex-col gap-4">
                {STUDY_TIPS.map((tip) => {
                  const isBookmarked = bookmarkedTips.has(tip.id);
                  return (
                    <article
                      key={tip.id}
                      className={`${cardClass} p-4 sm:p-5 relative`}
                    >
                      <button
                        type="button"
                        onClick={(e) => {
                          e.stopPropagation();
                          toggleBookmarkTip(tip.id);
                        }}
                        className="absolute top-4 right-4 p-2.5 min-h-[44px] min-w-[44px] flex items-center justify-center rounded-lg hover:bg-slate-100 text-slate-600 hover:text-grammar-accent transition-colors"
                        aria-label={isBookmarked ? 'Remove from saved' : 'Save for later'}
                      >
                        {isBookmarked ? (
                          <BookmarkCheck className="w-5 h-5 text-grammar-accent" />
                        ) : (
                          <Bookmark className="w-5 h-5" />
                        )}
                      </button>
                      <div className="flex gap-4 pr-12">
                        <Lightbulb className="w-5 h-5 text-grammar-accent shrink-0 mt-0.5" />
                        <div className="min-w-0 flex-1">
                          <h3 className="font-semibold text-slate-900 text-base mb-2">{tip.title}</h3>
                          <p className="text-slate-600 text-sm leading-relaxed mb-3">{tip.description}</p>
                          <p className="text-xs font-semibold text-slate-600 mb-2 leading-normal">Related Topics:</p>
                          <div className="flex flex-wrap gap-2">
                            {tip.relatedTopics.map((topicId) => (
                              <span
                                key={topicId}
                                className="px-2.5 py-1 rounded-lg bg-slate-100 text-slate-700 border border-slate-200 text-xs font-medium capitalize"
                              >
                                {topicId.replace(/_/g, ' ')}
                              </span>
                            ))}
                          </div>
                        </div>
                      </div>
                    </article>
                  );
                })}
              </div>
                )}

                {activePracticeSection === 'examples' && (
              <div className="flex flex-col gap-4">
                {REAL_WORLD_EXAMPLES.map((example) => {
                  const isBookmarked = bookmarkedExamples.has(example.id);
                  return (
                    <article
                      key={example.id}
                      className={`${cardClass} p-4 sm:p-5 relative`}
                    >
                      <button
                        type="button"
                        onClick={(e) => {
                          e.stopPropagation();
                          toggleBookmarkExample(example.id);
                        }}
                        className="absolute top-4 right-4 p-2.5 min-h-[44px] min-w-[44px] flex items-center justify-center rounded-lg hover:bg-slate-100 text-slate-600 hover:text-grammar-accent transition-colors"
                        aria-label={isBookmarked ? 'Remove from saved' : 'Save for later'}
                      >
                        {isBookmarked ? (
                          <BookmarkCheck className="w-5 h-5 text-grammar-accent" />
                        ) : (
                          <Bookmark className="w-5 h-5" />
                        )}
                      </button>
                      <div className="pr-12">
                        <span className="inline-block px-2.5 py-1 rounded-lg bg-slate-100 text-slate-700 border border-slate-200 text-xs font-semibold mb-3">
                          {example.context}
                        </span>
                        <p className="text-xs font-semibold text-slate-600 mb-1">Example:</p>
                        <div className="bg-slate-50 rounded-lg p-3 shadow-[0_2px_8px_rgb(0,0,0,0.03)] font-mono text-sm text-slate-800 mb-3">
                          &quot;{example.original}&quot;
                        </div>
                        <p className="text-xs font-semibold text-slate-600 mb-1">Why:</p>
                        <p className="text-slate-600 text-sm leading-relaxed mb-3">{example.explanation}</p>
                        <span className="inline-block px-2.5 py-1 rounded-lg bg-slate-100 text-slate-700 border border-slate-200 text-xs font-semibold">
                          Topic: {example.topic}
                        </span>
                      </div>
                    </article>
                  );
                })}
              </div>
                )}
              </div>
            )}

            {activeTab === 'quiz' && (
              <div className="flex flex-col gap-4">
                {GRAMMAR_QUIZZES.map((quiz) => {
                  const quizLessonIds = getLessonIdsForTopicIds(quiz.topics);
                  const completedInQuiz = quizLessonIds.filter((id) => completedLessons.includes(id)).length;
                  const readiness = quizLessonIds.length > 0 ? completedInQuiz / quizLessonIds.length : 1;
                  const showWarning = readiness < 0.5 && quizLessonIds.length > 0;
                  return (
                    <article
                      key={quiz.quizId}
                      className={`${cardClassInteractive} p-4 sm:p-5`}
                    >
                      <div className="flex flex-wrap justify-between items-start gap-3 mb-4">
                        <div className="min-w-0">
                          <h3 className="font-semibold text-slate-900 text-base truncate">
                            {quiz.title}
                          </h3>
                          <p className="text-slate-700 text-sm leading-relaxed">
                            {quiz.questions.length} questions  {quiz.duration} mins
                          </p>
                        </div>
                        <span className={`px-2.5 py-1 rounded-lg text-xs font-semibold shrink-0 border ${getDifficultyStyles(quiz.difficulty).badge}`}>
                          {quiz.difficulty}
                        </span>
                      </div>
                      {showWarning && (
                        <div className="mb-4 p-3 rounded-lg bg-amber-50 border border-amber-200 text-amber-800 text-sm flex items-start gap-2">
                          <Lightbulb className="w-5 h-5 shrink-0 mt-0.5" />
                          <div>
                            <strong>Tip:</strong> You&apos;ve completed {completedInQuiz} of {quizLessonIds.length} lessons in topics covered by this quiz. Consider reviewing the related lessons first to improve your score.
                          </div>
                        </div>
                      )}
                      <div className="bg-slate-50 rounded-xl p-3 shadow-[0_2px_8px_rgb(0,0,0,0.03)] mb-4">
                        <p className="text-slate-700 text-sm font-semibold mb-2">Topics covered:</p>
                        <div className="flex flex-wrap gap-2">
                          {quiz.topics.map((t) => (
                            <span
                              key={t}
                              className="px-2.5 py-1 rounded-lg bg-white text-slate-700 border border-slate-200 text-xs font-medium shadow-sm"
                            >
                              {t}
                            </span>
                          ))}
                        </div>
                      </div>
                      <p className="text-sm text-amber-900 bg-amber-50 border border-amber-200 rounded-xl px-3 py-2 mb-4 font-semibold">
                        <span className="font-bold">Passing Score:</span> {quiz.passingScore}%
                      </p>
                      <button
                        type="button"
                        className="w-full flex items-center justify-center gap-2 py-3 bg-grammar-accent hover:bg-grammar-accent-hover text-white font-bold rounded-xl shadow-[0_4px_14px_rgb(255,125,0,0.3)] hover:shadow-lg transition-all focus:outline-none focus:ring-2 focus:ring-grammar-accent focus:ring-offset-2 min-h-[44px] active:scale-[0.98]"
                      >
                        <PlayCircle className="w-5 h-5" />
                        Start Quiz
                      </button>
                    </article>
                  );
                })}
              </div>
            )}
          </div>

        </main>
      </div>
    </div>
  );
};

export default GrammarReview;
</file>

<file path="src/components/Grama/GrammarTopicPage.jsx">
import React, { useState, useEffect, useCallback, useMemo, memo, lazy, Suspense } from 'react';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import rehypeRaw from 'rehype-raw';
import {
  ChevronDown,
  ChevronUp,
  BookOpen,
  Lightbulb,
  Award,
  CheckCircle,
  XCircle,
  Languages,
  Volume2,
  Star,
  Sparkles,
  Trophy,
  Target,
  Zap,
  Brain,
  Play,
  Check,
} from 'lucide-react';
import '../styles/GrammarTopicPage.css';

const ConfettiEffect = lazy(() => import('../ConfettiEffect'));

const ProgressBar = memo(({ percentage }) => (
  <div className="mt-6">
    <div className="flex items-center justify-between mb-2">
      <span className="text-sm font-medium text-slate-600">Your Progress</span>
      <span className="text-sm font-bold text-grammar-accent">{percentage}%</span>
    </div>
    <div className="w-full h-4 bg-slate-200 rounded-full overflow-hidden shadow-inner">
      <div
        className="h-full bg-gradient-to-r from-grammar-primary via-grammar-blue to-grammar-accent rounded-full transition-all duration-1000 ease-out relative"
        style={{ width: `${percentage}%` }}
      >
        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent animate-shimmer" />
      </div>
    </div>
  </div>
));
ProgressBar.displayName = 'ProgressBar';

const Badge = memo(({ type, icon: Icon, children }) => {
  const styles = {
    difficulty: 'bg-grammar-primary text-white',
    streak: 'bg-grammar-accent text-white',
    completion: 'bg-grammar-blue text-white',
    completed: 'bg-emerald-100 text-emerald-800 border border-emerald-200',
  };
  return (
    <span
      className={`inline-flex items-center gap-1.5 px-3.5 py-1.5 rounded-full text-xs font-semibold shadow-sm transition-transform hover:scale-105 ${styles[type]}`}
    >
      <Icon className="w-4 h-4 shrink-0" />
      {children}
    </span>
  );
});
Badge.displayName = 'Badge';

const ExampleCard = memo(({ example }) => (
  <div className="bg-white p-5 rounded-xl border-2 border-grammar-blue-light transition-all hover:border-grammar-blue hover:shadow-md hover:-translate-y-0.5">
    <div className="flex items-start gap-4 mb-4">
      <span className="text-4xl"></span>
      <div className="flex-1 min-w-0">
        <p className="font-semibold text-grammar-primary text-lg mb-2">{example.example}</p>
        <p className="text-slate-600 text-sm italic">{example.explanation}</p>
      </div>
    </div>
    <div className="p-3.5 bg-emerald-50 rounded-lg border border-emerald-200 mt-3.5 text-sm">
      <p className="font-semibold text-emerald-800 mb-1">{example.vietnamese.example}</p>
      <p className="text-slate-600">{example.vietnamese.explanation}</p>
    </div>
  </div>
));
ExampleCard.displayName = 'ExampleCard';

const Exercise = memo(({ exercise, index, result, onSubmit }) => {
  const [localAnswer, setLocalAnswer] = useState('');

  const handleInputBlur = useCallback(
    (e) => {
      const userAnswer = e.target.value.trim().toLowerCase();
      const correct = userAnswer === exercise.correctAnswer.toLowerCase();
      onSubmit(exercise.exerciseId, correct);
    },
    [exercise.exerciseId, exercise.correctAnswer, onSubmit]
  );

  const handleInputChange = useCallback((e) => setLocalAnswer(e.target.value), []);

  return (
    <div className="bg-white rounded-xl p-5 sm:p-6 border-2 border-grammar-blue-light transition-all hover:border-grammar-accent hover:shadow-md animate-[slideDown_0.3s_ease-out]">
      <div className="flex flex-wrap justify-between items-center gap-4 mb-6">
        <div className="flex items-center gap-4">
          <div className="w-10 h-10 rounded-full bg-grammar-accent text-white flex items-center justify-center font-bold text-base shrink-0 shadow-md">
            {index + 1}
          </div>
          <div>
            <h3 className="text-xl font-bold text-slate-800">
              {exercise.type.replace('_', ' ').toUpperCase()}
            </h3>
            <span className="text-sm text-slate-500">{exercise.difficulty}</span>
          </div>
        </div>

        {result !== undefined && (
          <div
            className={`inline-flex items-center gap-1.5 px-3.5 py-1.5 rounded-full text-sm font-semibold ${
              result ? 'bg-emerald-100 text-emerald-800' : 'bg-red-100 text-red-800'
            }`}
          >
            {result ? (
              <>
                <CheckCircle className="w-5 h-5" />
                <span>Correct! </span>
              </>
            ) : (
              <>
                <XCircle className="w-5 h-5" />
                <span>Try Again</span>
              </>
            )}
          </div>
        )}
      </div>

      <div className="p-4 rounded-lg bg-amber-50 border-2 border-amber-200 mb-4">
        <p className="text-lg font-medium text-slate-800">{exercise.question}</p>
      </div>

      {exercise.type === 'multiple_choice' ? (
        <div className="space-y-3">
          {exercise.options.map((option, idx) => (
            <label
              key={idx}
              className="flex items-center p-4 rounded-lg border-2 border-slate-200 bg-white cursor-pointer transition-colors hover:bg-grammar-blue-soft hover:border-grammar-blue"
            >
              <input
                type="radio"
                name={exercise.exerciseId}
                className="mr-4 w-5 h-5 accent-[#00358E]"
                onChange={() => onSubmit(exercise.exerciseId, option.isCorrect)}
              />
              <span className="text-slate-800 font-medium">{option.text}</span>
            </label>
          ))}
          {result !== undefined && (
            <div
              className={`mt-4 p-4 rounded-lg border-2 text-sm ${
                result
                  ? 'bg-emerald-50 border-emerald-200 text-emerald-800'
                  : 'bg-red-50 border-red-200 text-red-800'
              }`}
            >
              <p className="font-bold text-lg mb-2">
                {result ? ' Excellent!' : ' Learn from this:'}
              </p>
              <p>
                <strong>Explanation:</strong>{' '}
                {exercise.options.find((opt) => opt.isCorrect).explanation}
              </p>
            </div>
          )}
        </div>
      ) : (
        <div>
          <input
            type="text"
            value={localAnswer}
            onChange={handleInputChange}
            placeholder="Type your answer here..."
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-lg text-base bg-white transition-colors focus:outline-none focus:border-grammar-primary focus:ring-2 focus:ring-grammar-accent-soft placeholder:text-slate-400"
            onBlur={handleInputBlur}
          />
          {exercise.hints && (
            <div className="mt-4 p-4 bg-grammar-blue-soft border-2 border-grammar-blue-light rounded-lg text-sm">
              <p className="font-bold text-grammar-primary mb-3 flex items-center gap-2">
                <Lightbulb className="w-5 h-5 text-grammar-accent" />
                Hints:
              </p>
              <div className="space-y-2">
                {exercise.hints.map((hint, idx) => (
                  <p key={idx} className="text-slate-700 flex items-start gap-2">
                    <span className="text-grammar-accent"></span>
                    {hint}
                  </p>
                ))}
              </div>
            </div>
          )}
          {result !== undefined && (
            <div
              className={`mt-4 p-4 rounded-lg border-2 text-sm ${
                result
                  ? 'bg-emerald-50 border-emerald-200 text-emerald-800'
                  : 'bg-red-50 border-red-200 text-red-800'
              }`}
            >
              <p className="font-bold text-lg mb-2">
                {result
                  ? ' Perfect! Well done!'
                  : ` Incorrect. The correct answer is: ${exercise.correctAnswer}`}
              </p>
              <p>
                <strong>Explanation:</strong> {exercise.explanation}
              </p>
            </div>
          )}
        </div>
      )}
    </div>
  );
});
Exercise.displayName = 'Exercise';

const GrammarTopicPage = ({ topic, completedLessons = {}, onLessonComplete }) => {
  const [completedLessonsState, setCompletedLessons] = useState(completedLessons);
  const [exerciseResults, setExerciseResults] = useState({});
  const [activeLanguage, setActiveLanguage] = useState('English');
  const [expandedSections, setExpandedSections] = useState({});
  const [showConfetti, setShowConfetti] = useState(false);
  const [currentStreak, setCurrentStreak] = useState(() => {
    const saved = localStorage.getItem('learningStreak');
    return saved ? parseInt(saved, 10) : 0;
  });
  const [animatingLesson, setAnimatingLesson] = useState(null);

  useEffect(() => {
    localStorage.setItem('learningStreak', currentStreak.toString());
  }, [currentStreak]);

  useEffect(() => {
    if (showConfetti) {
      const t = setTimeout(() => setShowConfetti(false), 3000);
      return () => clearTimeout(t);
    }
  }, [showConfetti]);

  useEffect(() => {
    localStorage.setItem('completedLessons', JSON.stringify(completedLessonsState));
  }, [completedLessonsState]);

  const handleLessonComplete = useCallback(
    (lessonId) => {
      setCompletedLessons((prev) => {
        const isCompleted = prev[lessonId];
        const newState = { ...prev, [lessonId]: !isCompleted };
        if (!isCompleted) {
          setAnimatingLesson(lessonId);
          setCurrentStreak((s) => s + 1);
          setShowConfetti(true);
          setTimeout(() => setAnimatingLesson(null), 1000);
        }
        return newState;
      });
      if (onLessonComplete) onLessonComplete(lessonId);
    },
    [onLessonComplete]
  );

  const handleExerciseSubmit = useCallback((exerciseId, isCorrect) => {
    setExerciseResults((prev) => ({ ...prev, [exerciseId]: isCorrect }));
    if (isCorrect) setShowConfetti(true);
  }, []);

  const toggleSection = useCallback((id) => {
    setExpandedSections((prev) => ({ ...prev, [id]: !prev[id] }));
  }, []);

  const toggleLanguage = useCallback((lang) => setActiveLanguage(lang), []);

  const completionPercentage = useMemo(
    () =>
      Math.round(
        (Object.values(completedLessonsState).filter(Boolean).length / topic.lessons.length) * 100
      ),
    [completedLessonsState, topic.lessons.length]
  );

  const components = useMemo(
    () => ({
      h2: ({ children }) => (
        <h2 className="text-xl font-bold text-grammar-primary mb-3 mt-6 flex items-center gap-2">
          <span className="text-3xl"></span>
          {children}
        </h2>
      ),
      h3: ({ children }) => (
        <h3 className="text-lg font-semibold text-slate-800 mb-2 mt-5 flex items-center gap-2">
          <Sparkles className="w-5 h-5 text-grammar-accent shrink-0" />
          {children}
        </h3>
      ),
      p: ({ children }) => <p className="text-slate-600 leading-relaxed mb-3 text-[15px]">{children}</p>,
      ul: ({ children }) => <ul className="mb-3 pl-0 list-none">{children}</ul>,
      li: ({ children }) => (
        <li className="flex items-start gap-2 mb-2 text-sm text-slate-600">
          <span className="text-grammar-accent mt-0.5"></span>
          <span>{children}</span>
        </li>
      ),
      strong: ({ children }) => (
        <strong className="font-semibold text-grammar-primary bg-grammar-blue-soft px-1 rounded">
          {children}
        </strong>
      ),
      code: ({ children }) => (
        <code className="bg-grammar-blue-soft text-grammar-primary px-2 py-0.5 rounded text-sm font-mono border border-grammar-blue-light">
          {children}
        </code>
      ),
      blockquote: ({ children }) => (
        <blockquote className="border-l-4 border-grammar-accent bg-grammar-accent-soft pl-4 py-2 my-3 italic text-slate-700 rounded-r text-sm">
          <div className="flex items-start gap-2">
            <Lightbulb className="w-5 h-5 text-grammar-accent shrink-0 mt-0.5" />
            <div>{children}</div>
          </div>
        </blockquote>
      ),
    }),
    []
  );

  const getFilteredContent = useCallback((content, lang) => {
    if (lang === 'English') {
      return content.replace(/\*\*Vietnamese Translation \(.*?\):\*\*(.*?)(\n\*\*|$)/gs, '').trim();
    }
    return content
      .replace(/\*\*English:\*\*(.*?)(\n\*\*Vietnamese Translation \(.*?\):\*\*|$)/gs, '')
      .trim();
  }, []);

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-50 via-blue-50/30 to-grammar-blue-soft/50 p-4 sm:p-6 relative overflow-hidden">
      {/* Background blobs - lightweight */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none" aria-hidden>
        <div className="absolute top-0 -left-20 w-72 h-72 bg-grammar-primary/5 rounded-full blur-3xl" />
        <div className="absolute bottom-0 -right-20 w-96 h-96 bg-grammar-accent/5 rounded-full blur-3xl" />
      </div>

      {showConfetti && (
        <Suspense fallback={null}>
          <div className="grammar-confetti-container">
            {[...Array(40)].map((_, i) => (
              <div
                key={i}
                className="grammar-confetti-piece"
                style={{
                  left: `${Math.random() * 100}%`,
                  top: `${Math.random() * 40}%`,
                  backgroundColor: ['#00358E', '#FF7D00', '#2563eb', '#10b981', '#f59e0b'][
                    Math.floor(Math.random() * 5)
                  ],
                  animationDelay: `${Math.random() * 0.5}s`,
                }}
              />
            ))}
          </div>
        </Suspense>
      )}

      <div className="max-w-4xl mx-auto relative z-10">
        {/* Hero header */}
        <div className="bg-white rounded-2xl shadow-lg p-6 sm:p-8 mb-6 sm:mb-8 border-2 border-grammar-blue-light relative overflow-hidden">
          <div className="absolute top-0 right-0 w-32 h-32 bg-grammar-accent/10 rounded-full -mr-16 -mt-16" />
          <div className="flex flex-col sm:flex-row sm:items-start gap-6 relative z-10">
            <div className="text-6xl sm:text-7xl">{topic.icon}</div>
            <div className="flex-1 min-w-0">
              <h1 className="text-3xl sm:text-4xl font-extrabold text-grammar-primary mb-2">
                {topic.title}
              </h1>
              <p className="text-slate-600 text-base sm:text-lg mb-4 italic">{topic.description}</p>
              <div className="flex flex-wrap items-center gap-3">
                <Badge type="difficulty" icon={Target}>
                  {topic.difficulty}
                </Badge>
                <Badge type="streak" icon={Zap}>
                  {currentStreak} Streak
                </Badge>
                <Badge type="completion" icon={Trophy}>
                  {completionPercentage}% Complete
                </Badge>
              </div>
              <ProgressBar percentage={completionPercentage} />
            </div>
          </div>
        </div>

        {/* Lessons */}
        <section className="mb-8">
          <h2 className="flex items-center justify-center gap-3 text-xl sm:text-2xl font-bold text-white py-4 px-5 rounded-xl bg-gradient-to-r from-grammar-primary to-grammar-blue mb-6 shadow-md">
            <BookOpen className="w-7 h-7 sm:w-8 sm:h-8 shrink-0" />
            <span>Lessons  Bi Hc</span>
            <Sparkles className="w-7 h-7 sm:w-8 sm:h-8 shrink-0" />
          </h2>

          <div className="space-y-6">
            {topic.lessons.map((lesson, index) => (
              <article
                key={lesson.lessonId}
                className={`bg-white rounded-xl p-5 sm:p-6 border-2 border-grammar-blue-light transition-all hover:border-grammar-blue hover:shadow-md ${
                  animatingLesson === lesson.lessonId ? 'animate-pulse' : ''
                }`}
              >
                <div className="flex flex-wrap justify-between items-start gap-4 mb-6">
                  <div className="flex items-center gap-4">
                    <div className="w-10 h-10 rounded-full bg-grammar-primary text-white flex items-center justify-center font-bold text-base shrink-0 shadow-md">
                      {index + 1}
                    </div>
                    <div>
                      <h3 className="text-xl sm:text-2xl font-bold text-slate-800 mb-1">
                        {lesson.title}
                      </h3>
                      <span className="text-sm text-slate-500 flex items-center gap-2">
                        <Play className="w-4 h-4" />
                        {lesson.duration}
                      </span>
                    </div>
                  </div>
                  {completedLessonsState[lesson.lessonId] ? (
                    <Badge type="completed" icon={CheckCircle}>
                      Completed!
                    </Badge>
                  ) : (
                    <button
                      type="button"
                      onClick={() => handleLessonComplete(lesson.lessonId)}
                      className="inline-flex items-center justify-center gap-2 px-5 py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg shadow-md transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-grammar-accent focus:ring-offset-2"
                      aria-label="Mark lesson as complete"
                    >
                      <Check className="w-5 h-5" />
                      Mark Complete
                    </button>
                  )}
                </div>

                <div
                  className="flex bg-slate-100 rounded-xl p-1 mb-5 gap-1"
                  role="tablist"
                  aria-label="Content language"
                >
                  {['English', 'Vietnamese'].map((lang) => (
                    <button
                      key={lang}
                      type="button"
                      role="tab"
                      aria-selected={activeLanguage === lang}
                      onClick={() => toggleLanguage(lang)}
                      className={`flex-1 flex items-center justify-center gap-2 py-2.5 px-4 rounded-lg text-sm font-semibold min-h-[40px] transition-colors focus:outline-none focus:ring-2 focus:ring-grammar-primary ${
                        activeLanguage === lang
                          ? 'bg-grammar-primary text-white shadow'
                          : 'text-slate-600 hover:bg-white'
                      }`}
                      aria-label={`Switch to ${lang}`}
                    >
                      <Languages className="w-5 h-5 shrink-0" />
                      {lang === 'English' ? ' English' : ' Ting Vit'}
                    </button>
                  ))}
                </div>

                <div className="bg-gradient-to-br from-white to-grammar-blue-soft/30 p-5 rounded-xl border-2 border-grammar-blue-light mb-6 prose-grammar">
                  <ReactMarkdown
                    remarkPlugins={[remarkGfm]}
                    rehypePlugins={[rehypeRaw]}
                    components={components}
                  >
                    {getFilteredContent(lesson.content, activeLanguage)}
                  </ReactMarkdown>
                </div>

                {lesson.examples?.length > 0 && (
                  <div className="mt-6">
                    <h4 className="font-bold text-xl sm:text-2xl text-slate-800 mb-4 flex items-center gap-3">
                      <span className="w-10 h-10 rounded-full bg-grammar-accent flex items-center justify-center shrink-0">
                        <Lightbulb className="w-6 h-6 text-white" />
                      </span>
                      Examples  V D
                    </h4>
                    <div className="grid gap-4 sm:grid-cols-2">
                      {lesson.examples.map((ex, idx) => (
                        <ExampleCard key={idx} example={ex} />
                      ))}
                    </div>
                  </div>
                )}

                {lesson.subSections?.map((section, idx) => {
                  const sectionId = `${lesson.lessonId}-section-${idx}`;
                  const isOpen = expandedSections[sectionId];
                  return (
                    <div key={idx} className="mt-6 pt-6 border-t-2 border-slate-200">
                      <button
                        type="button"
                        onClick={() => toggleSection(sectionId)}
                        className="w-full flex justify-between items-center p-4 rounded-lg border-2 border-slate-200 bg-white hover:bg-grammar-blue-soft hover:border-grammar-blue transition-colors text-left min-h-[48px] focus:outline-none focus:ring-2 focus:ring-grammar-primary"
                        aria-expanded={isOpen}
                        aria-label={`Toggle ${section.title}`}
                      >
                        <span className="font-bold text-slate-800 flex items-center gap-3">
                          <Brain className="w-6 h-6 text-grammar-primary shrink-0" />
                          {section.title}
                        </span>
                        {isOpen ? (
                          <ChevronUp className="w-6 h-6 text-grammar-primary shrink-0" />
                        ) : (
                          <ChevronDown className="w-6 h-6 text-slate-400 shrink-0" />
                        )}
                      </button>
                      {isOpen && (
                        <div className="mt-3 p-4 rounded-lg border-2 border-grammar-blue-light bg-white">
                          <ReactMarkdown components={components}>{section.content}</ReactMarkdown>
                        </div>
                      )}
                    </div>
                  );
                })}
              </article>
            ))}
          </div>
        </section>

        {/* Exercises */}
        <section className="mb-8">
          <h2 className="flex items-center justify-center gap-3 text-xl sm:text-2xl font-bold text-white py-4 px-5 rounded-xl bg-gradient-to-r from-grammar-accent to-grammar-primary mb-6 shadow-md">
            <Award className="w-7 h-7 sm:w-8 sm:h-8 shrink-0" />
            <span>Exercises  Bi Tp</span>
            <Trophy className="w-7 h-7 sm:w-8 sm:h-8 shrink-0" />
          </h2>
          <div className="space-y-6">
            {topic.exercises.map((exercise, index) => (
              <Exercise
                key={exercise.exerciseId}
                exercise={exercise}
                index={index}
                result={exerciseResults[exercise.exerciseId]}
                onSubmit={handleExerciseSubmit}
              />
            ))}
          </div>
        </section>

        {/* Vocabulary */}
        <section className="mb-8">
          <h2 className="flex items-center justify-center gap-3 text-xl sm:text-2xl font-bold text-white py-4 px-5 rounded-xl bg-gradient-to-r from-grammar-blue to-grammar-primary mb-6 shadow-md">
            <Volume2 className="w-7 h-7 sm:w-8 sm:h-8 shrink-0" />
            <span>Vocabulary  T Vng</span>
            <Star className="w-7 h-7 sm:w-8 sm:h-8 shrink-0" />
          </h2>
          <div className="bg-white rounded-xl border-2 border-grammar-blue-light overflow-hidden shadow-sm">
            <div className="overflow-x-auto">
              <table className="w-full min-w-[320px]">
                <thead>
                  <tr className="bg-grammar-primary text-white">
                    <th className="px-4 py-3 text-left text-xs font-bold uppercase tracking-wide">
                      Word
                    </th>
                    <th className="px-4 py-3 text-left text-xs font-bold uppercase tracking-wide">
                      Meaning
                    </th>
                    <th className="px-4 py-3 text-left text-xs font-bold uppercase tracking-wide">
                      Example
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {topic.vocabulary.map((vocab, idx) => (
                    <tr
                      key={idx}
                      className="border-b border-slate-200 transition-colors hover:bg-grammar-blue-soft/50"
                    >
                      <td className="px-4 py-3">
                        <span className="inline-block px-2.5 py-1.5 rounded-md bg-emerald-100 text-emerald-800 font-semibold text-[15px]">
                          {vocab.word}
                        </span>
                      </td>
                      <td className="px-4 py-3 text-slate-700 font-medium text-sm sm:text-base">
                        {vocab.meaning}
                      </td>
                      <td className="px-4 py-3">
                        <code className="block mt-1 px-2.5 py-1.5 rounded bg-slate-100 text-slate-700 text-sm font-mono border border-slate-200 break-words">
                          {vocab.example}
                        </code>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </div>
  );
};

export default memo(GrammarTopicPage);
</file>

<file path="src/components/hooks/useAdvancedVoice.js">
import { useCallback, useRef, useEffect } from 'react';

/**
 * Advanced Voice Features Hook
 * - Text optimization
 * - Caching
 * - Error retry
 * - Performance tracking
 */
export const useAdvancedVoice = (synthRef) => {
  const cacheRef = useRef(new Map());
  const metricsRef = useRef({
    utteranceCount: 0,
    totalDuration: 0,
    errorCount: 0,
    cacheHits: 0
  });

  // ==================== TEXT OPTIMIZATION ====================
  
  const optimizeText = useCallback((text) => {
    if (!text) return '';
    
    return text
      .replace(/[^\w\s.,!?'-]/g, '') // Remove special chars
      .replace(/\s+/g, ' ') // Normalize whitespace
      .replace(/([.!?])\s+/g, '$1 ') // Normalize punctuation
      .trim();
  }, []);

  // Split text into chunks for better performance
  const chunkText = useCallback((text, maxLength = 200) => {
    if (!text || text.length <= maxLength) return [text];

    const chunks = [];
    let current = '';

    // Split by sentences first
    const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];

    sentences.forEach(sentence => {
      sentence = sentence.trim();
      
      if (!sentence) return;

      if ((current + sentence).length > maxLength) {
        if (current) chunks.push(current.trim());
        current = sentence;
      } else {
        current += (current ? ' ' : '') + sentence;
      }
    });

    if (current) chunks.push(current.trim());
    return chunks.length > 0 ? chunks : [text];
  }, []);

  // ==================== CACHING ====================

  const getCacheKey = useCallback((text, voiceName, options) => {
    return `${text}|${voiceName}|${JSON.stringify(options)}`;
  }, []);

  const cacheUtterance = useCallback((text, voiceName, options) => {
    const key = getCacheKey(text, voiceName, options);
    cacheRef.current.set(key, { text, voiceName, options, timestamp: Date.now() });

    // Limit cache size to 100 items
    if (cacheRef.current.size > 100) {
      const firstKey = cacheRef.current.keys().next().value;
      cacheRef.current.delete(firstKey);
    }
  }, [getCacheKey]);

  const getCachedUtterance = useCallback((text, voiceName, options) => {
    const key = getCacheKey(text, voiceName, options);
    const cached = cacheRef.current.get(key);

    if (cached) {
      metricsRef.current.cacheHits++;
      return cached;
    }

    return null;
  }, [getCacheKey]);

  const clearCache = useCallback(() => {
    cacheRef.current.clear();
  }, []);

  // ==================== ERROR HANDLING & RETRY ====================

  const speakWithRetry = useCallback(async (utterance, maxRetries = 3) => {
    if (!synthRef.current) {
      throw new Error('Speech Synthesis not available');
    }

    for (let attempt = 0; attempt < maxRetries; attempt++) {
      try {
        return await new Promise((resolve, reject) => {
          const timeoutId = setTimeout(() => {
            reject(new Error('Speech synthesis timeout'));
          }, 30000); // 30s timeout

          utterance.onend = () => {
            clearTimeout(timeoutId);
            resolve();
          };

          utterance.onerror = (event) => {
            clearTimeout(timeoutId);
            reject(new Error(`Speech error: ${event.error}`));
          };

          synthRef.current.speak(utterance);
        });
      } catch (error) {
        console.warn(`Speech attempt ${attempt + 1}/${maxRetries} failed:`, error.message);

        // Cancel and retry
        try {
          synthRef.current.cancel();
        } catch (e) {
          console.error('Error canceling speech:', e);
        }

        if (attempt === maxRetries - 1) {
          metricsRef.current.errorCount++;
          throw error;
        }

        // Exponential backoff
        await new Promise(r => setTimeout(r, 500 * Math.pow(1.5, attempt)));
      }
    }
  }, [synthRef]);

  // ==================== PERFORMANCE TRACKING ====================

  const trackUtterance = useCallback((duration, success = true) => {
    metricsRef.current.utteranceCount++;
    metricsRef.current.totalDuration += duration;
    if (!success) {
      metricsRef.current.errorCount++;
    }
  }, []);

  const getPerformanceStats = useCallback(() => {
    const { utteranceCount, totalDuration, errorCount, cacheHits } = metricsRef.current;

    return {
      utteranceCount,
      totalDuration: Math.round(totalDuration),
      errorCount,
      cacheHits,
      avgDuration: utteranceCount > 0 ? Math.round(totalDuration / utteranceCount) : 0,
      errorRate: utteranceCount > 0 ? (errorCount / utteranceCount * 100).toFixed(2) : 0,
      cacheHitRate: utteranceCount > 0 ? (cacheHits / utteranceCount * 100).toFixed(2) : 0
    };
  }, []);

  const resetMetrics = useCallback(() => {
    metricsRef.current = {
      utteranceCount: 0,
      totalDuration: 0,
      errorCount: 0,
      cacheHits: 0
    };
  }, []);

  // ==================== VOICE WARMUP ====================

  const warmupVoices = useCallback(async (voices, getSpeakerVoice) => {
    if (!synthRef.current) return;

    try {
      for (const speaker of voices) {
        const voice = getSpeakerVoice(speaker);
        if (!voice) continue;

        const utterance = new SpeechSynthesisUtterance('.');
        utterance.voice = voice;
        utterance.volume = 0;

        await new Promise(resolve => {
          utterance.onend = resolve;
          utterance.onerror = resolve;
          synthRef.current.speak(utterance);
        });

        // Small delay between warmup
        await new Promise(r => setTimeout(r, 50));
      }
    } catch (error) {
      console.warn('Voice warmup error:', error);
    }
  }, [synthRef]);

  // ==================== DETECT PERFORMANCE LEVEL ====================

  const getPerformanceLevel = useCallback(() => {
    const memory = navigator.deviceMemory || 4;
    const connection = navigator.connection?.effectiveType || '4g';

    const levels = {
      '4g': { 
        rate: 1.1, 
        pitch: 1.0, 
        chunkSize: 250,
        label: 'Optimal'
      },
      '3g': { 
        rate: 0.9, 
        pitch: 0.95, 
        chunkSize: 150,
        label: 'Good'
      },
      '2g': { 
        rate: 0.7, 
        pitch: 0.9, 
        chunkSize: 100,
        label: 'Limited'
      },
      'slow-4g': { 
        rate: 0.8, 
        pitch: 0.9, 
        chunkSize: 120,
        label: 'Slow'
      }
    };

    return levels[connection] || levels['4g'];
  }, []);

  // ==================== AUTO-OPTIMIZE SETTINGS ====================

  const autoOptimizeVoice = useCallback(() => {
    const quality = {
      HIGH: { pitch: 1.0, rate: 0.95, volume: 1.0 },
      MEDIUM: { pitch: 0.95, rate: 0.85, volume: 0.95 },
      LOW: { pitch: 0.9, rate: 0.75, volume: 0.9 }
    };

    try {
      const memUsage = performance.memory?.usedJSHeapSize || 0;
      const totalMemory = performance.memory?.jsHeapSizeLimit || 1;
      const usagePercent = memUsage / totalMemory;

      if (usagePercent > 0.8) return quality.LOW;
      if (usagePercent > 0.5) return quality.MEDIUM;
      return quality.HIGH;
    } catch (error) {
      return quality.HIGH;
    }
  }, []);

  // ==================== CLEANUP ====================

  useEffect(() => {
    return () => {
      clearCache();
      resetMetrics();
    };
  }, [clearCache, resetMetrics]);

  return {
    // Text optimization
    optimizeText,
    chunkText,

    // Caching
    cacheUtterance,
    getCachedUtterance,
    clearCache,

    // Speech with retry
    speakWithRetry,

    // Metrics
    trackUtterance,
    getPerformanceStats,
    resetMetrics,

    // Voice warmup
    warmupVoices,

    // Performance detection
    getPerformanceLevel,
    autoOptimizeVoice
  };
};
</file>

<file path="src/components/hooks/useLocalStorage.js">
import { useState, useEffect } from 'react';

export const useLocalStorage = (key, initialValue) => {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(error);
      return initialValue;
    }
  });

  const setValue = (value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(error);
    }
  };

  return [storedValue, setValue];
};
</file>

<file path="src/components/hooks/useOnlineUsers.js">
// src/hooks/useOnlineUsers.js
import { useEffect, useState } from 'react';
import { ref, onValue, query, orderByChild, equalTo } from 'firebase/database';
import { rtdb } from '../config/firebase';

/**
 * Hook  m v ly danh sch users ang online
 */
export const useOnlineUsers = () => {
  const [onlineUsers, setOnlineUsers] = useState([]);
  const [onlineCount, setOnlineCount] = useState(0);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const presenceRef = ref(rtdb, 'presence');

    const unsubscribe = onValue(presenceRef, (snapshot) => {
      const data = snapshot.val();
      
      if (!data) {
        setOnlineUsers([]);
        setOnlineCount(0);
        setLoading(false);
        return;
      }

      // Lc users ang online
      const online = Object.entries(data)
        .filter(([_, userData]) => userData.online === true)
        .map(([uid, userData]) => ({
          uid,
          ...userData,
        }));

      setOnlineUsers(online);
      setOnlineCount(online.length);
      setLoading(false);
    });

    return () => unsubscribe();
  }, []);

  return { onlineUsers, onlineCount, loading };
};

export default useOnlineUsers;
</file>

<file path="src/components/hooks/usePresence.js">
// src/hooks/usePresence.js
import { useEffect, useState } from 'react';
import { ref, set, onValue, onDisconnect, serverTimestamp } from 'firebase/database';
import { rtdb } from '../config/firebase';
import { auth } from '../config/firebase';

/**
 * Hook  track online/offline status ca user
 * S dng Realtime Database vi .onDisconnect()  t ng cleanup
 */
export const usePresence = () => {
  const [onlineCount, setOnlineCount] = useState(0);
  const [isOnline, setIsOnline] = useState(false);

  useEffect(() => {
    const user = auth.currentUser;
    if (!user) return;

    const userStatusRef = ref(rtdb, `presence/${user.uid}`);
    const connectedRef = ref(rtdb, '.info/connected');

    // Theo di trng thi kt ni ca chnh user ny
    const unsubscribeConnection = onValue(connectedRef, (snapshot) => {
      if (snapshot.val() === true) {
        // Khi connected, set status = online
        set(userStatusRef, {
          online: true,
          lastSeen: serverTimestamp(),
          email: user.email,
          displayName: user.displayName || 'Anonymous',
        });

        // T ng set offline khi disconnect
        onDisconnect(userStatusRef).set({
          online: false,
          lastSeen: serverTimestamp(),
          email: user.email,
          displayName: user.displayName || 'Anonymous',
        });

        setIsOnline(true);
      } else {
        setIsOnline(false);
      }
    });

    return () => {
      unsubscribeConnection();
      // Cleanup: set offline khi unmount component
      set(userStatusRef, {
        online: false,
        lastSeen: serverTimestamp(),
        email: user.email,
        displayName: user.displayName || 'Anonymous',
      });
    };
  }, []);

  return { onlineCount, isOnline };
};

export default usePresence;
</file>

<file path="src/components/hooks/useStreak.js">
import { useState, useEffect } from 'react';
import { collection, query, where, onSnapshot } from 'firebase/firestore';
import { db } from '../../config/firebase';
import { useFirebaseAuth } from '../../hooks/useFirebaseAuth';

export const useStreak = () => {
  const { user } = useFirebaseAuth();
  const [streak, setStreak] = useState(0);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!user) {
      setStreak(0);
      setLoading(false);
      return;
    }

    // Truy vn d liu progress ca user (h tr c Firebase UID v Clerk ID nu cn)
    const q = query(
      collection(db, 'userProgress'),
      where('firebaseUid', '==', user.uid)
    );

    const unsubscribe = onSnapshot(q, (snapshot) => {
      const dates = snapshot.docs
        .map(doc => doc.data().completedAt?.toDate?.() || new Date(doc.data().completedAt))
        .filter(d => !isNaN(d.getTime()))
        .sort((a, b) => b - a);

      let currentStreak = 0;
      if (dates.length > 0) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let i = 0; i < dates.length; i++) {
          const date = new Date(dates[i]);
          date.setHours(0, 0, 0, 0);
          const daysDiff = Math.floor((today - date) / (1000 * 60 * 60 * 24));

          if (daysDiff === currentStreak) {
            currentStreak++;
          } else if (daysDiff > currentStreak) {
            break;
          }
        }
      }
      setStreak(currentStreak);
      setLoading(false);
    });

    return () => unsubscribe();
  }, [user]);

  return { streak, loading };
};
</file>

<file path="src/components/Online/OnlineIndicator.css">
/* src/components/OnlineIndicator.css */
.online-indicator {
  padding: 1rem;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
}

.status {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

.dot.online {
  background-color: #4caf50;
  box-shadow: 0 0 8px #4caf50;
}

.dot.offline {
  background-color: #9e9e9e;
}

.count {
  font-weight: bold;
  color: #4caf50;
}
</file>

<file path="src/components/Online/OnlineIndicator.jsx">
// src/components/OnlineIndicator.jsx
import React from 'react';
import { usePresence } from '../../hooks/usePresence';
import { useOnlineUsers } from '../../hooks/useOnlineUsers';

const OnlineIndicator = () => {
  const { isOnline } = usePresence(); // Track chnh user hin ti
  const { onlineCount, onlineUsers, loading } = useOnlineUsers(); // m tt c users

  if (loading) {
    return <div>Loading...</div>;
  }

  return (
    <div className="online-indicator">
      <div className="status">
        <span className={`dot ${isOnline ? 'online' : 'offline'}`}></span>
        <span>You are {isOnline ? 'online' : 'offline'}</span>
      </div>
      
      <div className="count">
         {onlineCount} users online
      </div>

      {/* Hin th danh sch (optional) */}
      <ul>
        {onlineUsers.map(user => (
          <li key={user.uid}>
            {user.displayName} - {user.email}
          </li>
        ))}
      </ul>
    </div>
  );
};

export default OnlineIndicator;
</file>

<file path="src/components/Online/OnlineStats.jsx">
// src/components/OnlineStats.jsx
import React, { memo, useMemo } from 'react';
import { Users, Globe, AlertCircle } from 'lucide-react';
import { useOnlineUsers } from '../../hooks/useOnlineUsers.js'; //  .js

/**
 * OnlineStats Component  Hin th thng k ngi dng online & tng ngi dng
 * 
 * Tnh nng:
 * - Hin th loading skeleton khi ang ti
 * - Hin th thng bo li nu c
 * - n hon ton nu khng c d liu (trnh flash)
 * - Format s vi du phy (toLocaleString)
 * - Ti u re-render vi useMemo
 * - Responsive: ch hin th trn lg tr ln
 */
const OnlineStats = memo(() => {
  const { onlineCount, totalUsers, loading, error } = useOnlineUsers();

  // === 1. n hon ton nu khng c d liu & khng loading/error ===
  const shouldRender = useMemo(() => {
    return loading || error || onlineCount > 0 || totalUsers > 0;
  }, [loading, error, onlineCount, totalUsers]);

  if (!shouldRender) return null;

  // === 2. Loading State: Skeleton UI ===
  if (loading) {
    return (
      <div className="hidden lg:flex items-center gap-4 text-xs text-gray-400 font-medium animate-pulse">
        <div className="flex items-center gap-1.5">
          <div className="w-1.5 h-1.5 bg-gray-300 rounded-full"></div>
          <Users className="w-4 h-4 text-gray-300" />
          <span className="bg-gray-300 text-transparent rounded">000 online</span>
        </div>
        <div className="flex items-center gap-1 text-gray-300">
          <Globe className="w-4 h-4" />
          <span className="bg-gray-300 text-transparent rounded">0,000</span>
        </div>
      </div>
    );
  }

  // === 3. Error State: Hin th icon cnh bo + tooltip (nu cn) ===
  if (error) {
    return (
      <div
        className="hidden lg:flex items-center gap-1.5 text-xs text-red-500 font-medium"
        title="Khng th ti thng k ngi dng"
      >
        <AlertCircle className="w-4 h-4" />
        <span>Li kt ni</span>
      </div>
    );
  }

  // === 4. Normal State: Hin th d liu ===
  return (
    <div className="hidden lg:flex items-center gap-4 text-xs text-gray-600 font-medium">
      {/* Online Users */}
      <div className="flex items-center gap-1.5">
        <div className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
        <Users className="w-4 h-4 text-green-600" />
        <span>{onlineCount} online</span>
      </div>

      {/* Total Users */}
      <div className="flex items-center gap-1 text-gray-500">
        <Globe className="w-4 h-4" />
        <span>{totalUsers.toLocaleString('vi-VN')}</span>
      </div>
    </div>
  );
});

OnlineStats.displayName = 'OnlineStats';
export default OnlineStats;
</file>

<file path="src/components/pages/EmotionSelector.jsx">
import React, { useState } from 'react';
import { Smile, Volume2, TrendingUp } from 'lucide-react';
import { VOICE_EMOTIONS } from '../../config/voiceExpression';

/**
 * Emotion Selector Component
 * Cho php ngi dng chn emotion  p dng khi pht
 */
export const EmotionSelector = ({ 
  selectedEmotion = 'NEUTRAL',
  onEmotionChange,
  compact = false
}) => {
  const [isOpen, setIsOpen] = useState(false);

  const emotions = Object.entries(VOICE_EMOTIONS).map(([key, emotion]) => ({
    key,
    ...emotion
  }));

  const selected = VOICE_EMOTIONS[selectedEmotion];
  const emotionEmojis = {
    NEUTRAL: '',
    HAPPY: '',
    SAD: '',
    ANGRY: '',
    EXCITED: '',
    SERIOUS: '',
    CONFUSED: '',
    WHISPER: '',
    LOUD: ''
  };

  if (compact) {
    return (
      <div className="flex gap-2 flex-wrap">
        {emotions.map(emotion => (
          <button
            key={emotion.key}
            onClick={() => onEmotionChange?.(emotion.key)}
            className={`px-3 py-1 rounded-full text-xs font-semibold transition-all ${
              selectedEmotion === emotion.key
                ? 'bg-blue-500 text-white shadow-lg scale-110'
                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            }`}
            title={emotion.description}
          >
            {emotionEmojis[emotion.key]} {emotion.label}
          </button>
        ))}
      </div>
    );
  }

  return (
    <div className="space-y-3">
      <div className="flex items-center gap-2">
        <Smile className="w-5 h-5 text-blue-600" />
        <h4 className="font-bold text-gray-900">Voice Expression</h4>
      </div>

      {/* Main Button */}
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="w-full flex items-center justify-between px-4 py-3 bg-gradient-to-r from-blue-100 to-purple-100 border-2 border-blue-300 rounded-lg hover:from-blue-200 hover:to-purple-200 transition-all"
      >
        <div className="flex items-center gap-2">
          <span className="text-2xl">{emotionEmojis[selectedEmotion]}</span>
          <div className="text-left">
            <p className="font-bold text-gray-900">{selected.label}</p>
            <p className="text-xs text-gray-600">{selected.description}</p>
          </div>
        </div>
        <span className="text-xl">{isOpen ? '' : ''}</span>
      </button>

      {/* Dropdown */}
      {isOpen && (
        <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
          {emotions.map(emotion => (
            <button
              key={emotion.key}
              onClick={() => {
                onEmotionChange?.(emotion.key);
                setIsOpen(false);
              }}
              className={`p-3 rounded-lg border-2 transition-all text-center ${
                selectedEmotion === emotion.key
                  ? 'border-blue-500 bg-blue-50 shadow-lg'
                  : 'border-gray-300 bg-white hover:border-blue-300 hover:bg-gray-50'
              }`}
            >
              <p className="text-3xl mb-1">{emotionEmojis[emotion.key]}</p>
              <p className="font-bold text-sm text-gray-900">{emotion.label}</p>
              <p className="text-xs text-gray-600 mt-1">{emotion.description}</p>
              
              {/* Mini voice indicators */}
              <div className="flex justify-center gap-1 mt-2 text-xs">
                <span title="Speed" className="flex items-center gap-1">
                   {(emotion.rate * 100).toFixed(0)}%
                </span>
              </div>
            </button>
          ))}
        </div>
      )}

      {/* Tips */}
      <div className="bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded text-xs text-yellow-800">
        <p className="font-semibold mb-1"> Tips:</p>
        <ul className="list-disc list-inside space-y-1 text-yellow-700">
          <li>Use *text* or _text_ to stress words</li>
          <li>Use {"{EMOTION}"} prefix to force emotion</li>
          <li>Uppercase and punctuation auto-adjust</li>
          <li>Combine markers for stronger effect</li>
        </ul>
      </div>
    </div>
  );
};

/**
 * Mini Expression Indicator
 * Hin th loi expression hin ti
 */
export const ExpressionIndicator = ({ 
  emotion = 'NEUTRAL',
  hasEmphasis = false,
  suggestions = []
}) => {
  const emotionEmojis = {
    NEUTRAL: '', HAPPY: '', SAD: '', ANGRY: '',
    EXCITED: '', SERIOUS: '', CONFUSED: '',
    WHISPER: '', LOUD: ''
  };

  return (
    <div className="flex items-center gap-2 px-3 py-2 bg-blue-50 border-2 border-blue-300 rounded-lg">
      <span className="text-lg">{emotionEmojis[emotion]}</span>
      <span className="text-xs font-semibold text-blue-900">{emotion}</span>
      
      {hasEmphasis && (
        <span className="ml-auto flex items-center gap-1 px-2 py-1 bg-blue-200 rounded-full text-xs font-semibold text-blue-900">
          <Volume2 className="w-3 h-3" />
          Emphasis
        </span>
      )}

      {suggestions.length > 0 && (
        <div className="absolute top-full mt-2 bg-white border-2 border-blue-300 rounded-lg p-2 text-xs whitespace-nowrap shadow-lg">
          {suggestions.map((s, i) => (
            <p key={i} className="text-gray-700"> {s}</p>
          ))}
        </div>
      )}
    </div>
  );
};

export default EmotionSelector;
</file>

<file path="src/components/pages/NotFoundPage.jsx">
import React, { useState, useEffect } from 'react';
import { Home, ArrowLeft } from 'lucide-react';

const NotFoundPage = () => {
  const [stars, setStars] = useState([]);
  const [meteors, setMeteors] = useState([]);
  const [showHiddenLink, setShowHiddenLink] = useState(false);

  // Generate stars on mount
  useEffect(() => {
    const generatedStars = Array.from({ length: 100 }, (_, i) => ({
      id: i,
      left: Math.random() * 100,
      top: Math.random() * 100,
      size: Math.random() * 3,
      duration: Math.random() * 3 + 1,
    }));
    setStars(generatedStars);
  }, []);

  // Create meteors periodically
  useEffect(() => {
    const interval = setInterval(() => {
      const meteor = {
        id: Date.now(),
        top: Math.random() * 100,
      };
      setMeteors((prev) => [...prev, meteor]);

      setTimeout(() => {
        setMeteors((prev) => prev.filter((m) => m.id !== meteor.id));
      }, 2000);
    }, 3000);

    return () => clearInterval(interval);
  }, []);

  // Space key easter egg
  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.code === 'Space') {
        const randomColor = `hsl(${Math.random() * 360}, 50%, 15%)`;
        document.body.style.background = randomColor;
        setTimeout(() => {
          document.body.style.background = '';
        }, 500);
      }
    };

    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, []);

  const handleGoBack = () => window.history.back();

  return (
    <div className="bg-gray-900 min-h-screen flex items-center justify-center p-4 overflow-hidden relative">
      {/* Stars Background */}
      <div className="fixed inset-0">
        {stars.map((star) => (
          <div
            key={star.id}
            className="absolute rounded-full bg-white animate-pulse"
            style={{
              left: `${star.left}%`,
              top: `${star.top}%`,
              width: `${star.size}px`,
              height: `${star.size}px`,
              animationDuration: `${star.duration}s`,
              opacity: 0,
            }}
          />
        ))}
      </div>

      {/* Meteors */}
      {meteors.map((meteor) => (
        <div
          key={meteor.id}
          className="fixed w-0.5 h-0.5 bg-gradient-to-r from-white to-transparent"
          style={{
            top: `${meteor.top}%`,
            left: '100%',
            animation: 'meteor 2s linear forwards',
          }}
        />
      ))}

      {/* Main Content */}
      <div
        className="relative z-10 text-center"
        onMouseEnter={() => setShowHiddenLink(true)}
        onMouseLeave={() => setShowHiddenLink(false)}
      >
        {/* UFO with Beam */}
        <div className="relative mb-8 animate-float">
          <svg className="w-32 h-32 mx-auto" viewBox="0 0 100 100">
            {/* UFO Body */}
            <ellipse cx="50" cy="40" rx="30" ry="10" fill="#4F46E5" />
            <circle cx="50" cy="35" r="20" fill="#818CF8" />
            <ellipse cx="50" cy="30" rx="10" ry="5" fill="#C7D2FE" />
            {/* Beam */}
            <path
              className="animate-beam"
              d="M40 40 L30 80 L70 80 L60 40"
              fill="rgba(79, 70, 229, 0.2)"
            />
          </svg>
        </div>

        {/* 404 Text */}
        <h1 className="text-8xl font-bold text-white mb-4 animate-float">
          4<span className="inline-block animate-portal">0</span>4
        </h1>
        <p className="text-xl text-blue-200 mb-8">   !!!! Bn  lc vo v tr ri </p>
        <p className="text-lg text-purple-300 mb-8">Hc bi m  tui b v lu qu vi! Bm vo linh li i nha </p>

        {/* Interactive Elements */}
        <div className="space-y-4">
          {/* Hidden Portfolio Link */}
          <a
            href="/"
            className={`text-blue-400 hover:text-blue-300 transition block duration-300 ${
              showHiddenLink ? 'opacity-100' : 'opacity-0'
            }`}
          >
             Find your way back to safety
          </a>

          {/* Astronaut */}
          <div className="relative inline-block animate-float">
            <div className="w-24 h-24 rounded-full border-4 border-white mx-auto bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center animate-wave">
              <span className="text-4xl"></span>
            </div>
            <span className="absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full border-4 border-white animate-pulse"></span>
          </div>

          {/* Action Buttons */}
          <div className="flex justify-center gap-4 mt-8 flex-wrap">
            <a
              href="/"
              className="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transform hover:scale-105 transition duration-300 shadow-lg"
            >
              <Home className="w-5 h-5" />
              Return Home
            </a>
            <button
              onClick={handleGoBack}
              className="inline-flex items-center gap-2 px-6 py-3 bg-purple-600 text-white rounded-full hover:bg-purple-700 transform hover:scale-105 transition duration-300 shadow-lg"
            >
              <ArrowLeft className="w-5 h-5" />
              Go Back
            </button>
          </div>
        </div>

        {/* Easter Egg Element */}
        <div className="mt-8 text-gray-500 cursor-pointer hover:text-gray-400 transition">
          <p className="text-sm">Press 'Space' for a surprise!</p>
        </div>
      </div>

      {/* Animations */}
      <style>{`
        @keyframes float {
          0% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
          100% { transform: translateY(0px); }
        }

        @keyframes beam {
          0%, 100% { transform: scaleY(0.8); opacity: 0.3; }
          50% { transform: scaleY(1.1); opacity: 0.7; }
        }

        @keyframes wave {
          0%, 100% { transform: rotate(0deg); }
          50% { transform: rotate(20deg); }
        }

        @keyframes portal-spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        @keyframes meteor {
          0% { transform: translate(0, 0) rotate(45deg); opacity: 1; }
          100% { transform: translate(-100px, 100px) rotate(45deg); opacity: 0; }
        }

        .animate-float {
          animation: float 6s ease-in-out infinite;
        }

        .animate-beam {
          animation: beam 2s ease-in-out infinite;
          transform-origin: top;
        }

        .animate-wave {
          animation: wave 2s ease-in-out infinite;
          transform-origin: 70% 70%;
        }

        .animate-portal {
          animation: portal-spin 8s linear infinite;
          display: inline-block;
        }
      `}</style>
    </div>
  );
};

export default NotFoundPage;
</file>

<file path="src/components/styles/UserProfile.module.css">
/* ============================================
   UserProfile.module.css - CSS Module cho UserProfile
   ============================================ */

/* Container */
.container {
  background: linear-gradient(to bottom right, white, #faf5f0);
  border-radius: 1.5rem;
  box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
  border: 1px solid #fed7aa;
  overflow: hidden;
}

/* Header */
.header {
  position: relative;
  background: linear-gradient(to right, #f97316, #fbbf24, #fbbf24);
  padding: 1.5rem 2rem;
}

.headerOverlay {
  position: absolute;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.05);
}

.headerContent {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Avatar */
.avatar {
  position: relative;
}

.avatarImg {
  width: 5rem;
  height: 5rem;
  border-radius: 1rem;
  border: 4px solid white;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
  object-fit: cover;
}

.avatarDefault {
  width: 5rem;
  height: 5rem;
  border-radius: 1rem;
  border: 4px solid white;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
  background: linear-gradient(to bottom right, #fb923c, #fbbf24);
  display: flex;
  align-items: center;
  justify-content: center;
}

.streakBadge {
  position: absolute;
  bottom: -0.5rem;
  right: -0.5rem;
  background-color: #ef4444;
  color: white;
  font-size: 0.75rem;
  font-weight: 900;
  padding: 0.25rem 0.5rem;
  border-radius: 9999px;
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

/* User Info */
.userInfo {
  flex: 1;
  min-width: 0;
}

.userName {
  font-size: 1.5rem;
  font-weight: 900;
  color: white;
  filter: drop-shadow(0 3px 0 rgba(0, 0, 0, 0.1));
}

.userNameContainer {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.25rem;
}

.authBadge {
  font-size: 0.75rem;
  font-weight: 700;
  padding: 0.25rem 0.625rem;
  border-radius: 9999px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.authBadgeClerk {
  background-color: rgba(255, 255, 255, 0.9);
  color: #ea580c;
}

.authBadgeFirebase {
  background-color: rgba(255, 255, 255, 0.9);
  color: #2563eb;
}

.userEmail {
  color: rgba(255, 255, 255, 0.95);
  font-size: 0.875rem;
  font-weight: 600;
  filter: drop-shadow(0 1px 0 rgba(0, 0, 0, 0.05));
}

.lastActivity {
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.75rem;
  font-weight: 500;
  margin-top: 0.25rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

/* Main Content */
.mainContent {
  padding: 1.5rem;
}

/* Empty State */
.emptyState {
  text-align: center;
  padding: 4rem 0;
}

.emptyStateIcon {
  position: relative;
  display: inline-block;
  margin-bottom: 1.5rem;
}

.emptyStateIconBg {
  position: absolute;
  inset: 0;
  background-color: #fed7aa;
  border-radius: 9999px;
  filter: blur(3rem);
  opacity: 0.5;
}

.emptyStateTitle {
  font-size: 1.5rem;
  font-weight: 900;
  color: #1f2937;
  margin-bottom: 0.75rem;
}

.emptyStateText {
  color: #4b5563;
  font-weight: 500;
  max-width: 28rem;
  margin: 0 auto;
}

/* Stats Grid */
.statsGrid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 1rem;
}

@media (min-width: 1024px) {
  .statsGrid {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
}

.statCard {
  position: relative;
  border-radius: 1.25rem;
  padding: 1rem;
  border: 2px solid;
  transition: all 300ms;
  cursor: pointer;
}

.statCard:hover {
  border-opacity: 1;
  box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
  transform: scale(1.05);
}

.statCardIcon {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.statCardIconBg {
  padding: 0.5rem;
  border-radius: 0.75rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: transform 300ms;
}

.statCard:hover .statCardIconBg {
  transform: scale(1.1);
}

.statCardLabel {
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.statCardValue {
  font-size: 1.875rem;
  font-weight: 900;
}

/* Additional Stats */
.additionalStats {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}

@media (min-width: 1024px) {
  .additionalStats {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

.additionalStatCard {
  background-color: white;
  border-radius: 1.25rem;
  padding: 1.25rem;
  border: 2px solid #e5e7eb;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  transition: all 300ms;
}

.additionalStatCard:hover {
  box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
}

/* Progress Bar */
.progressBar {
  height: 0.5rem;
  background-color: #e5e7eb;
  border-radius: 9999px;
  overflow: hidden;
}

.progressBarFill {
  height: 100%;
  border-radius: 9999px;
  transition: all 300ms;
}

/* Recent Activity */
.recentActivity {
  background-color: white;
  border-radius: 1.25rem;
  padding: 1.5rem;
  border: 2px solid #e5e7eb;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.recentActivityHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.25rem;
}

.recentActivityTitle {
  font-weight: 900;
  color: #111827;
  font-size: 1.25rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.recentActivityCount {
  font-size: 0.875rem;
  font-weight: 700;
  color: #6b7280;
  background-color: #f3f4f6;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
}

.activityList {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  max-height: 24rem;
  overflow-y: auto;
  padding-right: 0.5rem;
}

.activityList::-webkit-scrollbar {
  width: 6px;
}

.activityList::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.activityList::-webkit-scrollbar-thumb {
  background: #fb923c;
  border-radius: 10px;
}

.activityList::-webkit-scrollbar-thumb:hover {
  background: #f97316;
}

.activityItem {
  position: relative;
  padding: 1rem;
  border-radius: 0.75rem;
  border: 2px solid;
  transition: all 300ms;
}

.activityItem:hover {
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
}

.activityItemRecent {
  background: linear-gradient(to right, #fef3c7, #fed7aa);
  border-color: #fed7aa;
}

.activityItemRecent:hover {
  border-color: #fbbf24;
}

.activityItemOld {
  background-color: #f9fafb;
  border-color: #e5e7eb;
}

.activityItemOld:hover {
  border-color: #d1d5db;
}

.activityItemNew {
  position: absolute;
  top: -0.5rem;
  right: -0.5rem;
  background-color: #f97316;
  color: white;
  font-size: 0.75rem;
  font-weight: 900;
  padding: 0.25rem 0.5rem;
  border-radius: 9999px;
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.activityItemContent {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.activityItemInfo {
  flex: 1;
}

.activityItemTitle {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.activityItemTitleText {
  font-weight: 900;
  color: #111827;
  font-size: 1rem;
}

.activityItemDraftBadge {
  font-size: 0.75rem;
  font-weight: 700;
  padding: 0.125rem 0.5rem;
  background-color: #fef08a;
  color: #854d0e;
  border-radius: 9999px;
}

.activityItemMeta {
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 0.75rem;
  color: #4b5563;
  font-weight: 600;
}

.activityItemScore {
  text-align: right;
  margin-left: 1rem;
}

.activityItemScoreValue {
  font-size: 2.25rem;
  font-weight: 900;
  margin-bottom: 0.25rem;
}

.activityItemScoreGreen {
  color: #16a34a;
}

.activityItemScoreBlue {
  color: #2563eb;
}

.activityItemScoreAmber {
  color: #b45309;
}

.activityItemScoreRed {
  color: #dc2626;
}

/* Loading State */
.loading {
  background: linear-gradient(to bottom right, white, #faf5f0);
  border-radius: 1.5rem;
  box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
  border: 1px solid #fed7aa;
  padding: 2rem;
}

.loadingSpinner {
  text-align: center;
}

.loadingSpinnerIcon {
  position: relative;
  width: 4rem;
  height: 4rem;
  margin: 0 auto 1rem;
}

.loadingSpinnerIcon::before {
  content: '';
  position: absolute;
  inset: 0;
  border: 4px solid #fed7aa;
  border-radius: 9999px;
}

.loadingSpinnerIcon::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 4px solid #ea580c;
  border-top: transparent;
  border-radius: 9999px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.loadingText {
  color: #4b5563;
  font-weight: 500;
}
</file>

<file path="src/components/utils/scriptUtils.js">
import { SPEAKER_STYLES, SPEAKER_ICONS, VOICE_CONFIG } from '../../config/voiceConfig';

export const getSpeakerColor = (speaker) => 
  SPEAKER_STYLES[speaker] || 'bg-gradient-to-br from-slate-50 to-slate-100 border-slate-400 text-slate-900';

export const getSpeakerIcon = (speaker) => 
  SPEAKER_ICONS[speaker] || '';

export const getSpeakerTTSOptions = (speaker, playbackRate, playbackVolume) => {
  const config = VOICE_CONFIG.SPEAKER_CONFIG[speaker] || VOICE_CONFIG.SPEAKER_CONFIG.default;
  return { 
    pitch: config.pitch, 
    rate: playbackRate, 
    volume: playbackVolume 
  };
};

export const copyScriptToClipboard = (filteredConversations) => {
  const text = filteredConversations.map(c => `${c.speaker}: ${c.text}`).join('\n\n');
  navigator.clipboard.writeText(text);
};

export const scrollToElement = (elementId, shouldScroll) => {
  if (shouldScroll) {
    const element = document.getElementById(elementId);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  }
};
</file>

<file path="src/components/utils/sounds.js">
export const playSound = (soundName, volume = 0.3) => {
  try {
    const audio = new Audio(`/sounds/${soundName}.mp3`);
    audio.volume = volume;
    audio.play().catch(() => {});
  } catch (error) {
    console.error('Sound playback error:', error);
  }
};

export const sounds = {
  success: () => playSound('success'),
  complete: () => playSound('complete'),
  wrong: () => playSound('wrong'),
};
</file>

<file path="src/components/Voca/VocabularyPractice.jsx">
import React, { useState, useEffect } from 'react';
import { Volume2, ChevronRight, ChevronLeft, RotateCcw, BookOpen, Brain, Zap, Settings, Download, Share2, BarChart3, Trash2, Copy, Check, X } from 'lucide-react';
import { useSpeech } from '../hooks/useSpeech';
import { vocabularyData } from '../../data/vocabularyData';

export default function VocabularyPractice() {
  const { speak, sentenceId, playingId, rate, setRate, pitch, setPitch } = useSpeech();
  const [mode, setMode] = useState('learn');
  const [selectedTopic, setSelectedTopic] = useState(null);
  const [selectedSubtopic, setSelectedSubtopic] = useState(null);
  const [currentWords, setCurrentWords] = useState([]);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isFlipped, setIsFlipped] = useState(false);
  const [favorited, setFavorited] = useState(new Set());
  const [learned, setLearned] = useState(new Set());
  const [masteredWords, setMasteredWords] = useState(new Set());
  const [showStats, setShowStats] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const [searchQuery, setSearchQuery] = useState('');
  const [filteredWords, setFilteredWords] = useState([]);
  const [quizMode, setQuizMode] = useState(false);
  const [quizScore, setQuizScore] = useState(0);
  const [quizAnswered, setQuizAnswered] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [quizOptions, setQuizOptions] = useState([]);
  const [quizCorrectAnswer, setQuizCorrectAnswer] = useState(null);

  const topics = Object.keys(vocabularyData);

  useEffect(() => {
    if (searchQuery.trim() === '') {
      setFilteredWords(currentWords);
    } else {
      const query = searchQuery.toLowerCase();
      setFilteredWords(
        currentWords.filter(
          w =>
            w.word.toLowerCase().includes(query) ||
            w.vietnamese.toLowerCase().includes(query) ||
            w.example.toLowerCase().includes(query)
        )
      );
    }
    setCurrentIndex(0);
  }, [searchQuery, currentWords]);

  // Shuffle array
  const shuffleArray = (array) => {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  };

  const handleSelectTopic = (topic) => {
    setSelectedTopic(topic);
    setSelectedSubtopic(null);
    setCurrentWords([]);
  };

  const handleSelectSubtopic = (subtopic) => {
    const words = vocabularyData[selectedTopic][subtopic];
    setSelectedSubtopic(subtopic);
    setCurrentWords(words);
    setFilteredWords(words);
    setCurrentIndex(0);
    setIsFlipped(false);
    setQuizMode(false);
  };

  const handleSpeak = () => {
    if (displayedWords[currentIndex]) {
      const word = displayedWords[currentIndex];
      speak(word.word, `word-${currentIndex}`);
    }
  };

  const handleSpeakExample = () => {
    if (displayedWords[currentIndex]) {
      const word = displayedWords[currentIndex];
      speak(word.example, `example-${currentIndex}`, 'en', true);
    }
  };

  const handleNext = () => {
    if (currentIndex < displayedWords.length - 1) {
      setCurrentIndex(currentIndex + 1);
      setIsFlipped(false);
      setQuizAnswered(false);
      setSelectedAnswer(null);
      generateQuizOptions(currentIndex + 1);
    }
  };

  const handlePrev = () => {
    if (currentIndex > 0) {
      setCurrentIndex(currentIndex - 1);
      setIsFlipped(false);
      setQuizAnswered(false);
      setSelectedAnswer(null);
      generateQuizOptions(currentIndex - 1);
    }
  };

  const toggleFavorite = () => {
    const word = displayedWords[currentIndex];
    const newFavorited = new Set(favorited);
    if (newFavorited.has(word.word)) {
      newFavorited.delete(word.word);
    } else {
      newFavorited.add(word.word);
    }
    setFavorited(newFavorited);
  };

  const toggleLearned = () => {
    const word = displayedWords[currentIndex];
    const newLearned = new Set(learned);
    if (newLearned.has(word.word)) {
      newLearned.delete(word.word);
    } else {
      newLearned.add(word.word);
    }
    setLearned(newLearned);
  };

  const toggleMastered = () => {
    const word = displayedWords[currentIndex];
    const newMastered = new Set(masteredWords);
    if (newMastered.has(word.word)) {
      newMastered.delete(word.word);
    } else {
      newMastered.add(word.word);
    }
    setMasteredWords(newMastered);
  };

  const handleReset = () => {
    setCurrentIndex(0);
    setIsFlipped(false);
  };

  const generateQuizOptions = (index) => {
    const currentWord = displayedWords[index];
    const correctAnswer = currentWord.word;
    
    // Ly 3 t sai khc
    const otherWords = displayedWords
      .filter((w, idx) => idx !== index)
      .sort(() => 0.5 - Math.random())
      .slice(0, 3)
      .map(w => w.word);
    
    const options = [correctAnswer, ...otherWords];
    setQuizCorrectAnswer(correctAnswer);
    setQuizOptions(shuffleArray(options));
  };

  const startQuiz = () => {
    setQuizMode(true);
    setQuizScore(0);
    setCurrentIndex(0);
    setQuizAnswered(false);
    setSelectedAnswer(null);
    generateQuizOptions(0);
  };

  const handleQuizAnswer = (selectedWord) => {
    setSelectedAnswer(selectedWord);
    setQuizAnswered(true);
    
    if (selectedWord === quizCorrectAnswer) {
      setQuizScore(quizScore + 1);
      toggleMastered();
    }
  };

  const exportToCSV = () => {
    const data = displayedWords.map(w => ({
      Word: w.word,
      Phonetic: w.phonetic,
      Vietnamese: w.vietnamese,
      PartOfSpeech: w.pos,
      Example: w.example,
      Level: w.level,
      Favorite: favorited.has(w.word) ? 'Yes' : 'No',
      Mastered: masteredWords.has(w.word) ? 'Yes' : 'No'
    }));

    const csv = [
      Object.keys(data[0]).join(','),
      ...data.map(row =>
        Object.values(row)
          .map(val => `"${val}"`)
          .join(',')
      )
    ].join('\n');

    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `vocabulary-${selectedSubtopic}.csv`;
    a.click();
  };

  const copyToClipboard = () => {
    const word = displayedWords[currentIndex];
    const text = `${word.word} (${word.phonetic}) - ${word.vietnamese}\nExample: ${word.example}`;
    navigator.clipboard.writeText(text);
    alert(' sao chp!');
  };

  const clearAllData = () => {
    if (window.confirm('Bn chc chn mun xa ton b d liu?')) {
      setFavorited(new Set());
      setLearned(new Set());
      setMasteredWords(new Set());
    }
  };

  const displayedWords = filteredWords.length > 0 ? filteredWords : currentWords;
  const currentWord = displayedWords[currentIndex];
  const isFavorited = currentWord && favorited.has(currentWord.word);
  const isLearned = currentWord && learned.has(currentWord.word);
  const isMastered = currentWord && masteredWords.has(currentWord.word);
  const progressPercent = displayedWords.length > 0 ? ((currentIndex + 1) / displayedWords.length) * 100 : 0;

  const stats = {
    total: currentWords.length,
    mastered: Array.from(masteredWords).filter(w => currentWords.some(cw => cw.word === w)).length,
    learned: Array.from(learned).filter(w => currentWords.some(cw => cw.word === w)).length,
    favorited: Array.from(favorited).filter(w => currentWords.some(cw => cw.word === w)).length,
    remaining: currentWords.length - Array.from(masteredWords).filter(w => currentWords.some(cw => cw.word === w)).length
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-amber-100 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <div className="text-center mb-8">
          <h1 className="text-4xl md:text-5xl font-bold text-orange-600 mb-2 drop-shadow-lg">
             Vocabulary Master
          </h1>
          <p className="text-gray-700">Hc t vng ting Anh t A1 n C2 mt cch hiu qu</p>
        </div>

        {/* Mode Selection */}
        {!selectedTopic && (
          <div className="mb-8">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
              {[
                { id: 'learn', icon: BookOpen, label: 'Hc', color: 'from-blue-400 to-blue-500' },
                { id: 'flashcard', icon: Brain, label: 'Flashcard', color: 'from-orange-400 to-orange-500' },
                { id: 'quiz', icon: Zap, label: 'Quiz', color: 'from-amber-300 to-orange-400' }
              ].map(m => (
                <button
                  key={m.id}
                  onClick={() => setMode(m.id)}
                  className={`p-6 rounded-2xl font-semibold text-lg transition-all transform hover:scale-105 shadow-lg ${
                    mode === m.id
                      ? `bg-gradient-to-r ${m.color} text-white shadow-xl`
                      : `bg-white text-gray-700 shadow hover:shadow-md`
                  }`}
                >
                  <m.icon className="w-8 h-8 mx-auto mb-2" />
                  {m.label}
                </button>
              ))}
            </div>
          </div>
        )}

        {/* Topic Selection */}
        {selectedTopic === null && (
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {topics.map(topic => (
              <button
                key={topic}
                onClick={() => handleSelectTopic(topic)}
                className="p-6 bg-white hover:bg-amber-50 rounded-xl shadow-md hover:shadow-lg transition-all text-left hover:translate-y-[-2px] border-2 border-orange-200"
              >
                <h3 className="font-bold text-lg text-orange-600 mb-2">{topic}</h3>
                <p className="text-sm text-gray-600">
                  {Object.keys(vocabularyData[topic]).length} ch 
                </p>
              </button>
            ))}
          </div>
        )}

        {/* Subtopic Selection */}
        {selectedTopic && selectedSubtopic === null && (
          <div>
            <button
              onClick={() => setSelectedTopic(null)}
              className="flex items-center gap-2 text-blue-600 hover:text-blue-700 mb-6 font-semibold transition"
            >
              <ChevronLeft className="w-4 h-4" />
              Quay li
            </button>
            <h2 className="text-2xl font-bold text-orange-600 mb-6">{selectedTopic}</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {Object.keys(vocabularyData[selectedTopic]).map(subtopic => (
                <button
                  key={subtopic}
                  onClick={() => handleSelectSubtopic(subtopic)}
                  className="p-6 bg-white hover:bg-amber-50 rounded-xl shadow-md hover:shadow-lg transition-all text-left hover:translate-y-[-2px] border-2 border-orange-200"
                >
                  <h3 className="font-bold text-lg text-orange-600 mb-2">{subtopic}</h3>
                  <p className="text-sm text-gray-600">
                    {vocabularyData[selectedTopic][subtopic].length} t
                  </p>
                </button>
              ))}
            </div>
          </div>
        )}

        {/* Learning Interface */}
        {currentWords.length > 0 && currentWord && (
          <div>
            {/* Top Controls */}
            <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
              <button
                onClick={() => {
                  setSelectedTopic(null);
                  setSelectedSubtopic(null);
                  setCurrentWords([]);
                  setFilteredWords([]);
                  setCurrentIndex(0);
                  setSearchQuery('');
                  setQuizMode(false);
                }}
                className="flex items-center gap-2 text-blue-600 hover:text-blue-700 font-semibold transition"
              >
                <ChevronLeft className="w-4 h-4" />
                Quay li
              </button>

              <div className="flex gap-2">
                <button
                  onClick={() => setShowStats(!showStats)}
                  className="flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition shadow-md"
                >
                  <BarChart3 className="w-4 h-4" />
                  Thng k
                </button>
                <button
                  onClick={() => setShowSettings(!showSettings)}
                  className="flex items-center gap-2 px-4 py-2 bg-amber-400 hover:bg-amber-500 text-white rounded-lg font-semibold transition shadow-md"
                >
                  <Settings className="w-4 h-4" />
                  Ci t
                </button>
              </div>
            </div>

            {/* Settings Panel */}
            {showSettings && (
              <div className="bg-white border-2 border-orange-400 rounded-xl p-6 mb-6 shadow-lg">
                <h3 className="text-orange-600 font-bold mb-4"> Ci t Pht m</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label className="text-gray-700 font-semibold block mb-2">Tc : {rate.toFixed(1)}x</label>
                    <input
                      type="range"
                      min="0.5"
                      max="2"
                      step="0.1"
                      value={rate}
                      onChange={(e) => setRate(parseFloat(e.target.value))}
                      className="w-full accent-orange-500"
                    />
                  </div>
                  <div>
                    <label className="text-gray-700 font-semibold block mb-2">Cao : {pitch.toFixed(1)}</label>
                    <input
                      type="range"
                      min="0.5"
                      max="2"
                      step="0.1"
                      value={pitch}
                      onChange={(e) => setPitch(parseFloat(e.target.value))}
                      className="w-full accent-orange-500"
                    />
                  </div>
                </div>
                <button
                  onClick={clearAllData}
                  className="mt-4 flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition shadow-md"
                >
                  <Trash2 className="w-4 h-4" />
                  Xa ton b d liu
                </button>
              </div>
            )}

            {/* Search Bar */}
            {!quizMode && (
              <div className="mb-6">
                <input
                  type="text"
                  placeholder="Tm kim t, dch ngha, hoc v d..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full px-4 py-3 bg-white border-2 border-orange-300 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:border-orange-500 transition shadow-md"
                />
              </div>
            )}

            {/* Stats Panel */}
            {showStats && (
              <div className="grid grid-cols-2 md:grid-cols-5 gap-3 mb-6">
                <div className="bg-gradient-to-br from-blue-400 to-blue-500 p-4 rounded-lg text-center shadow-lg">
                  <p className="text-2xl font-bold text-white">{stats.total}</p>
                  <p className="text-xs text-blue-100">Tng t</p>
                </div>
                <div className="bg-gradient-to-br from-orange-400 to-orange-500 p-4 rounded-lg text-center shadow-lg">
                  <p className="text-2xl font-bold text-white">{stats.mastered}</p>
                  <p className="text-xs text-orange-100"> nm vng</p>
                </div>
                <div className="bg-gradient-to-br from-amber-300 to-amber-400 p-4 rounded-lg text-center shadow-lg">
                  <p className="text-2xl font-bold text-white">{stats.learned}</p>
                  <p className="text-xs text-white"> hc</p>
                </div>
                <div className="bg-gradient-to-br from-rose-400 to-rose-500 p-4 rounded-lg text-center shadow-lg">
                  <p className="text-2xl font-bold text-white">{stats.favorited}</p>
                  <p className="text-xs text-rose-100">Yu thch</p>
                </div>
                <div className="bg-gradient-to-br from-gray-400 to-gray-500 p-4 rounded-lg text-center shadow-lg">
                  <p className="text-2xl font-bold text-white">{stats.remaining}</p>
                  <p className="text-xs text-gray-100">Cn li</p>
                </div>
              </div>
            )}

            {/* Progress Bar */}
            <div className="mb-6">
              <div className="flex justify-between items-center mb-2">
                <span className="text-sm font-semibold text-gray-700">
                  {currentIndex + 1}/{displayedWords.length}
                </span>
                <span className="text-sm font-semibold text-gray-700">
                  {Math.round(progressPercent)}%
                </span>
              </div>
              <div className="w-full bg-gray-300 rounded-full h-3 overflow-hidden shadow-md">
                <div
                  className="bg-gradient-to-r from-blue-500 via-orange-400 to-amber-300 h-full transition-all duration-300"
                  style={{ width: `${progressPercent}%` }}
                />
              </div>
            </div>

            {/* Quiz Mode */}
            {quizMode ? (
              <div className="mb-8">
                <div className="bg-white border-4 border-orange-400 rounded-2xl p-8 text-center min-h-96 flex flex-col justify-center shadow-2xl">
                  <p className="text-orange-500 text-sm mb-4 uppercase tracking-widest font-bold">Cu hi {currentIndex + 1}/{displayedWords.length}</p>
                  <p className="text-4xl font-bold text-orange-600 mb-8">{currentWord.vietnamese}</p>
                  <p className="text-gray-700 mb-6 font-semibold">Chn p n ng:</p>
                  <div className="grid grid-cols-1 gap-3">
                    {quizOptions.map((option, idx) => {
                      const isCorrect = option === quizCorrectAnswer;
                      const isSelected = option === selectedAnswer;
                      
                      let buttonClass = 'bg-white border-2 border-gray-300 text-gray-800 hover:border-orange-400';
                      
                      if (quizAnswered) {
                        if (isCorrect) {
                          buttonClass = 'bg-green-100 border-2 border-green-500 text-green-800';
                        } else if (isSelected && !isCorrect) {
                          buttonClass = 'bg-red-100 border-2 border-red-500 text-red-800';
                        }
                      }

                      return (
                        <button
                          key={idx}
                          onClick={() => !quizAnswered && handleQuizAnswer(option)}
                          disabled={quizAnswered}
                          className={`p-4 rounded-lg font-semibold transition ${buttonClass} ${quizAnswered ? 'cursor-default' : 'cursor-pointer'}`}
                        >
                          <div className="flex items-center justify-between">
                            <span>{option}</span>
                            {quizAnswered && isCorrect && <Check className="w-5 h-5 text-green-600" />}
                            {quizAnswered && isSelected && !isCorrect && <X className="w-5 h-5 text-red-600" />}
                          </div>
                        </button>
                      );
                    })}
                  </div>

                  {quizAnswered && (
                    <div className={`mt-6 p-4 rounded-lg font-semibold text-lg ${
                      selectedAnswer === quizCorrectAnswer
                        ? 'bg-green-100 border-2 border-green-500 text-green-800'
                        : 'bg-red-100 border-2 border-red-500 text-red-800'
                    }`}>
                      {selectedAnswer === quizCorrectAnswer ? (
                        <div className="flex items-center gap-2">
                          <Check className="w-6 h-6" />
                          Chnh xc! 
                        </div>
                      ) : (
                        <div>
                          <div className="flex items-center gap-2 mb-2">
                            <X className="w-6 h-6" />
                            Sai ri!
                          </div>
                          <p className="text-sm">p n ng: <span className="font-bold">{quizCorrectAnswer}</span></p>
                        </div>
                      )}
                    </div>
                  )}
                </div>
              </div>
            ) : (
              /* Card */
              <div
                onClick={() => setIsFlipped(!isFlipped)}
                className="mb-8 cursor-pointer"
              >
                <div className={`min-h-96 bg-gradient-to-br from-white to-amber-50 rounded-2xl shadow-xl p-8 flex flex-col items-center justify-center transition-all duration-500 transform hover:shadow-2xl hover:scale-102 border-4 ${
                  isMastered ? 'border-orange-400' : 'border-orange-200'
                }`}>
                  {!isFlipped ? (
                    <div className="text-center w-full">
                      <p className="text-gray-500 text-sm mb-4 uppercase tracking-widest">T Vng</p>
                      <p className="text-5xl md:text-6xl font-bold text-blue-600 mb-4 break-words">{currentWord.word}</p>
                      <p className="text-gray-600 text-lg italic mb-8">{currentWord.phonetic}</p>
                      <p className="text-gray-600 text-lg">Bm  xem dch ngha</p>
                      <div className="mt-8 inline-block bg-amber-100 px-4 py-2 rounded-lg border-2 border-orange-300">
                        <p className="text-xs text-gray-700">Level: <span className="text-orange-600 font-bold">{currentWord.level}</span></p>
                      </div>
                    </div>
                  ) : (
                    <div className="text-center w-full">
                      <p className="text-orange-500 text-sm mb-4 uppercase tracking-widest">Dch Ngha</p>
                      <p className="text-4xl font-bold text-orange-600 mb-6 break-words">{currentWord.vietnamese}</p>
                      <div className="bg-blue-50 p-4 rounded-lg mb-6 text-left border-2 border-blue-200">
                        <p className="text-xs text-gray-700 mb-2 uppercase font-bold">Loi t</p>
                        <p className="text-gray-800 font-semibold">{currentWord.pos}</p>
                      </div>
                      <div className="bg-amber-100 p-4 rounded-lg text-left border-2 border-orange-300">
                        <p className="text-xs text-gray-700 mb-2 uppercase font-bold">V d</p>
                        <p className="text-gray-800 italic">{currentWord.example}</p>
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            handleSpeakExample();
                          }}
                          className={`mt-3 flex items-center gap-2 px-3 py-1 rounded text-sm font-semibold transition shadow-md ${
                            sentenceId === `example-${currentIndex}`
                              ? 'bg-blue-500 text-white'
                              : 'bg-blue-300 text-white hover:bg-blue-400'
                          }`}
                        >
                          <Volume2 className="w-4 h-4" />
                          Pht v d
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* Action Buttons */}
            <div className="grid grid-cols-2 md:grid-cols-5 gap-3 mb-8">
              <button
                onClick={handleSpeak}
                className={`flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold transition shadow-md ${
                  playingId === `word-${currentIndex}`
                    ? 'bg-orange-600 text-white'
                    : 'bg-orange-500 hover:bg-orange-600 text-white'
                }`}
              >
                <Volume2 className="w-5 h-5" />
                <span className="hidden md:inline">Pht</span>
              </button>
              <button
                onClick={toggleFavorite}
                className={`px-4 py-3 rounded-lg font-semibold transition flex items-center justify-center shadow-md ${
                  isFavorited
                    ? 'bg-rose-500 text-white'
                    : 'bg-gray-300 text-gray-700 hover:bg-gray-400'
                }`}
              >
                 <span className="hidden md:inline">Yu</span>
              </button>
              <button
                onClick={toggleLearned}
                className={`px-4 py-3 rounded-lg font-semibold transition flex items-center justify-center shadow-md ${
                  isLearned
                    ? 'bg-amber-400 text-white'
                    : 'bg-gray-300 text-gray-700 hover:bg-gray-400'
                }`}
              >
                 <span className="hidden md:inline">Hc</span>
              </button>
              <button
                onClick={toggleMastered}
                className={`px-4 py-3 rounded-lg font-semibold transition flex items-center justify-center shadow-md ${
                  isMastered
                    ? 'bg-blue-500 text-white'
                    : 'bg-gray-300 text-gray-700 hover:bg-gray-400'
                }`}
              >
                 <span className="hidden md:inline">Nm</span>
              </button>
              <button
                onClick={handleReset}
                className="px-4 py-3 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg font-semibold transition flex items-center justify-center shadow-md"
              >
                <RotateCcw className="w-5 h-5" />
              </button>
            </div>

            {/* Secondary Actions */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
              {!quizMode && (
                <>
                  <button
                    onClick={startQuiz}
                    className="px-4 py-2 bg-amber-400 hover:bg-amber-500 text-white rounded-lg font-semibold transition flex items-center justify-center gap-2 shadow-md"
                  >
                    <Zap className="w-4 h-4" />
                    <span className="hidden md:inline">Bt u Quiz</span>
                    <span className="md:hidden">Quiz</span>
                  </button>
                  <button
                    onClick={copyToClipboard}
                    className="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg font-semibold transition flex items-center justify-center gap-2 shadow-md"
                  >
                    <Copy className="w-4 h-4" />
                    <span className="hidden md:inline">Sao chp</span>
                  </button>
                  <button
                    onClick={exportToCSV}
                    className="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg font-semibold transition flex items-center justify-center gap-2 shadow-md"
                  >
                    <Download className="w-4 h-4" />
                    <span className="hidden md:inline">Ti CSV</span>
                  </button>
                  <button
                    onClick={() => alert('Chia s tnh nng s sm c cp nht!')}
                    className="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg font-semibold transition flex items-center justify-center gap-2 shadow-md"
                  >
                    <Share2 className="w-4 h-4" />
                    <span className="hidden md:inline">Chia s</span>
                  </button>
                </>
              )}
              {quizMode && (
                <button
                  onClick={() => setQuizMode(false)}
                  className="col-span-2 md:col-span-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition shadow-md"
                >
                  Kt thc Quiz (im: {quizScore}/{displayedWords.length})
                </button>
              )}
            </div>

           {/* Navigation */}
            <div className="space-y-3">
              {/* Progress Indicator */}
              <div className="bg-white rounded-xl p-4 shadow-lg border border-orange-200">
                <div className="flex items-center justify-between mb-3">
                  <span className="text-sm font-bold text-gray-700">{currentIndex + 1}/{displayedWords.length}</span>
                  <span className="text-sm font-bold text-blue-600">{Math.round(progressPercent)}%</span>
                </div>
                
                {/* Mini dots grid */}
                <div className="grid grid-cols-8 md:grid-cols-12 gap-1.5">
                  {displayedWords.map((_, idx) => {
                    const isMasteredWord = displayedWords[idx] && masteredWords.has(displayedWords[idx].word);
                    const isCurrentWord = idx === currentIndex;
                    
                    return (
                      <button
                        key={idx}
                        onClick={() => {
                          setCurrentIndex(idx);
                          setIsFlipped(false);
                          setQuizAnswered(false);
                          setSelectedAnswer(null);
                          if (quizMode) generateQuizOptions(idx);
                        }}
                        className={`relative w-full aspect-square rounded-lg transition-all font-semibold text-[10px] flex items-center justify-center ${
                          isCurrentWord
                            ? 'bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg scale-110'
                            : isMasteredWord
                            ? 'bg-gradient-to-br from-green-400 to-green-500 text-white shadow-md hover:scale-105'
                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300 hover:scale-105'
                        }`}
                      >
                        {idx + 1}
                        {isMasteredWord && !isCurrentWord && (
                          <div className="absolute -top-0.5 -right-0.5 w-2 h-2 bg-yellow-400 rounded-full"></div>
                        )}
                      </button>
                    );
                  })}
                </div>
              </div>

              {/* Action Buttons */}
              <div className="grid grid-cols-3 gap-2">
                <button
                  onClick={handlePrev}
                  disabled={currentIndex === 0}
                  className="flex items-center justify-center gap-1 px-3 py-2.5 bg-gradient-to-r from-gray-400 to-gray-500 text-white rounded-lg font-semibold hover:from-gray-500 hover:to-gray-600 transition disabled:opacity-30 disabled:cursor-not-allowed shadow-md"
                >
                  <ChevronLeft className="w-4 h-4" />
                  <span className="text-sm">Trc</span>
                </button>

                <button
                  onClick={() => {
                    if (quizMode) {
                      setQuizMode(false);
                    } else {
                      startQuiz();
                    }
                  }}
                  className="flex items-center justify-center gap-1 px-3 py-2.5 bg-gradient-to-r from-amber-400 to-orange-500 text-white rounded-lg font-semibold hover:from-amber-500 hover:to-orange-600 transition shadow-md"
                >
                  <Zap className="w-4 h-4" />
                  <span className="text-sm">{quizMode ? 'Dng' : 'Quiz'}</span>
                </button>

                <button
                  onClick={handleNext}
                  disabled={currentIndex === displayedWords.length - 1}
                  className="flex items-center justify-center gap-1 px-3 py-2.5 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-orange-700 transition disabled:opacity-30 disabled:cursor-not-allowed shadow-md"
                >
                  <span className="text-sm">Tip</span>
                  <ChevronRight className="w-4 h-4" />
                </button>
              </div>

              {/* Stats Footer */}
              <div className="bg-gradient-to-r from-blue-50 to-orange-50 rounded-lg p-3 border border-orange-200 shadow-md">
                <div className="grid grid-cols-4 gap-2 text-center">
                  <div>
                    <div className="w-8 h-8 mx-auto mb-1 rounded-lg bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-sm"></div>
                    <p className="text-[10px] text-gray-600 mb-0.5">Nm vng</p>
                    <p className="text-sm font-bold text-blue-600">{stats.mastered}</p>
                  </div>
                  <div>
                    <div className="w-8 h-8 mx-auto mb-1 rounded-lg bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-sm"></div>
                    <p className="text-[10px] text-gray-600 mb-0.5"> hc</p>
                    <p className="text-sm font-bold text-amber-600">{stats.learned}</p>
                  </div>
                  <div>
                    <div className="w-8 h-8 mx-auto mb-1 rounded-lg bg-gradient-to-br from-rose-400 to-pink-500 flex items-center justify-center text-sm"></div>
                    <p className="text-[10px] text-gray-600 mb-0.5">Yu thch</p>
                    <p className="text-sm font-bold text-rose-600">{stats.favorited}</p>
                  </div>
                  <div>
                    <div className="w-8 h-8 mx-auto mb-1 rounded-lg bg-gradient-to-br from-gray-400 to-gray-600 flex items-center justify-center text-sm"></div>
                    <p className="text-[10px] text-gray-600 mb-0.5">Cn li</p>
                    <p className="text-sm font-bold text-gray-600">{stats.remaining}</p>
                  </div>
                </div>
            
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/components/VoiceMetricsBadge.jsx">
import React, { useState, useEffect } from 'react';
import { Activity, AlertCircle, CheckCircle, Zap } from 'lucide-react';

/**
 * Simple Voice Metrics Badge
 * Compact display of voice performance
 */
export const VoiceMetricsBadge = ({ 
  voiceMetrics, 
  ttsMetrics,
  performanceLevel,
  isPlaying = false 
}) => {
  const [showDetails, setShowDetails] = useState(false);

  // Determine status color
  const getStatusColor = () => {
    if (!voiceMetrics) return 'gray';
    if (voiceMetrics.successRate < 80) return 'red';
    if (voiceMetrics.successRate < 95) return 'yellow';
    return 'green';
  };

  const statusColor = getStatusColor();
  const statusColors = {
    green: 'text-green-600 bg-green-50 border-green-300',
    yellow: 'text-yellow-600 bg-yellow-50 border-yellow-300',
    red: 'text-red-600 bg-red-50 border-red-300',
    gray: 'text-gray-600 bg-gray-50 border-gray-300'
  };

  if (!voiceMetrics && !ttsMetrics) return null;

  return (
    <div className="space-y-2">
      {/* Compact Badge */}
      <button
        onClick={() => setShowDetails(!showDetails)}
        className={`w-full flex items-center gap-2 px-3 py-2 rounded-lg border-2 text-sm font-semibold transition-all ${statusColors[statusColor]}`}
      >
        <Activity className={`w-4 h-4 ${isPlaying ? 'animate-pulse' : ''}`} />
        <span>Performance</span>
        
        {voiceMetrics && (
          <span className="ml-auto text-xs">
            {voiceMetrics.successRate}%  {voiceMetrics.speakAttempts} attempts
          </span>
        )}
        
        {voiceMetrics?.errorCount > 0 && (
          <AlertCircle className="w-4 h-4" />
        )}
      </button>

      {/* Detailed View */}
      {showDetails && (
        <div className="bg-white border-2 border-gray-300 rounded-lg p-4 space-y-3 text-sm">
          
          {/* Voice Metrics */}
          {voiceMetrics && (
            <div className="space-y-2 pb-3 border-b-2 border-gray-200">
              <h4 className="font-bold text-gray-900">Voice System</h4>
              <div className="grid grid-cols-2 gap-2 text-xs">
                <div>
                  <p className="text-gray-600">Voice Load</p>
                  <p className="font-semibold text-gray-900">{voiceMetrics.voiceLoadTime}ms</p>
                </div>
                <div>
                  <p className="text-gray-600">Cached</p>
                  <p className="font-semibold text-gray-900">{voiceMetrics.cachedVoices}</p>
                </div>
                <div>
                  <p className="text-gray-600">Success Rate</p>
                  <p className="font-semibold text-green-600">{voiceMetrics.successRate}%</p>
                </div>
                <div>
                  <p className="text-gray-600">Errors</p>
                  <p className={`font-semibold ${voiceMetrics.errorCount > 0 ? 'text-red-600' : 'text-green-600'}`}>
                    {voiceMetrics.errorCount}
                  </p>
                </div>
              </div>
            </div>
          )}

          {/* TTS Metrics */}
          {ttsMetrics && (
            <div className="space-y-2 pb-3 border-b-2 border-gray-200">
              <h4 className="font-bold text-gray-900">Text-to-Speech</h4>
              <div className="grid grid-cols-2 gap-2 text-xs">
                <div>
                  <p className="text-gray-600">Utterances</p>
                  <p className="font-semibold text-gray-900">{ttsMetrics.totalUtterances}</p>
                </div>
                <div>
                  <p className="text-gray-600">Avg Duration</p>
                  <p className="font-semibold text-gray-900">{ttsMetrics.avgDuration}ms</p>
                </div>
                <div>
                  <p className="text-gray-600">Total Time</p>
                  <p className="font-semibold text-gray-900">{Math.round(ttsMetrics.totalDuration / 1000)}s</p>
                </div>
                <div>
                  <p className="text-gray-600">Error Rate</p>
                  <p className={`font-semibold ${parseFloat(ttsMetrics.errorRate) > 5 ? 'text-red-600' : 'text-green-600'}`}>
                    {ttsMetrics.errorRate}%
                  </p>
                </div>
              </div>
            </div>
          )}

          {/* Performance Level */}
          {performanceLevel && (
            <div className="space-y-2">
              <h4 className="font-bold text-gray-900">Device Performance</h4>
              <div className="text-xs space-y-1">
                <p className="text-gray-600">
                  Level: <span className="font-semibold text-blue-600">{performanceLevel.label}</span>
                </p>
                <p className="text-gray-600">
                  Recommended Speed: <span className="font-semibold">{performanceLevel.rate}x</span>
                </p>
                <p className="text-gray-600">
                  Max Chunk Size: <span className="font-semibold">{performanceLevel.chunkSize} chars</span>
                </p>
              </div>
            </div>
          )}

          {/* Close Button */}
          <button
            onClick={() => setShowDetails(false)}
            className="w-full mt-2 px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all"
          >
            Close
          </button>
        </div>
      )}
    </div>
  );
};

export default VoiceMetricsBadge;
</file>

<file path="src/constants/config.js">
export const DESIGN_TOKENS = {
    colors: {
        primary: '#4F46E5',
        accent: '#F59E0B',
        success: '#10B981',
        error: '#EF4444',
        text: '#1F2937',
    },
};

export const TABS = [
    { id: 'categories', label: 'Danh Mc', icon: 'BookOpen' },
    { id: 'flashcards', label: 'Flashcards', icon: 'PlayCircle' },
    { id: 'quiz', label: 'Quiz', icon: 'Award' },
    { id: 'stats', label: 'Thng K', icon: 'BarChart3' },
];

export const LEVELS = ['beginner', 'intermediate', 'advanced'];

export const LEVEL_LABELS = {
    beginner: 'S cp',
    intermediate: 'Trung cp',
    advanced: 'Nng cao',
};
</file>

<file path="src/contexts/AuthContext.jsx">
import React, { createContext, useState, useEffect, useCallback, useContext } from 'react';
import {
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged,
  updateProfile,
  GoogleAuthProvider,
  signInWithPopup,
  sendPasswordResetEmail,
  setPersistence,
  browserLocalPersistence,
} from 'firebase/auth';
import { auth } from '../config/firebase';

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // Set persistence on mount
  useEffect(() => {
    setPersistence(auth, browserLocalPersistence).catch(err => {
      console.warn('Persistence error:', err);
    });
  }, []);

  // Listen to authentication state changes
  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
      setUser(currentUser);
      setLoading(false);
    });

    return unsubscribe;
  }, []);

  // Sign up with email and password
  const signup = useCallback(async (email, password, displayName) => {
    try {
      setError(null);

      if (!email || !password) {
        throw new Error('Email v mt khu khng c  trng');
      }

      if (password.length < 6) {
        throw new Error('Mt khu phi c t nht 6 k t');
      }

      const userCredential = await createUserWithEmailAndPassword(auth, email, password);

      if (displayName) {
        await updateProfile(userCredential.user, {
          displayName,
          photoURL: `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=random`,
        });
      }

      setUser(userCredential.user);
      return userCredential.user;
    } catch (err) {
      const errorMap = {
        'auth/email-already-in-use': 'Email ny  c ng k',
        'auth/weak-password': 'Mt khu phi c t nht 6 k t',
        'auth/invalid-email': 'Email khng hp l',
        'auth/operation-not-allowed': 'ng k tm thi khng kh dng',
      };

      const errorMessage = errorMap[err.code] || err.message;
      setError(errorMessage);
      throw new Error(errorMessage);
    }
  }, []);

  // Sign in with email and password
  const signin = useCallback(async (email, password) => {
    try {
      setError(null);

      if (!email || !password) {
        throw new Error('Email v mt khu khng c  trng');
      }

      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      setUser(userCredential.user);
      return userCredential.user;
    } catch (err) {
      const errorMap = {
        'auth/user-not-found': 'Ti khon khng tn ti',
        'auth/wrong-password': 'Mt khu khng chnh xc',
        'auth/invalid-email': 'Email khng hp l',
        'auth/user-disabled': 'Ti khon  b v hiu ha',
        'auth/too-many-requests': 'Qu nhiu ln ng nhp tht bi, vui lng th li sau',
      };

      const errorMessage = errorMap[err.code] || err.message;
      setError(errorMessage);
      throw new Error(errorMessage);
    }
  }, []);

  // Sign in with Google
  const signInWithGoogle = useCallback(async () => {
    try {
      setError(null);
      const provider = new GoogleAuthProvider();
      const userCredential = await signInWithPopup(auth, provider);
      setUser(userCredential.user);
      return userCredential.user;
    } catch (err) {
      if (err.code === 'auth/popup-closed-by-user') {
        return null;
      }
      const errorMessage = 'Google sign-in failed. Please try again.';
      setError(errorMessage);
      throw new Error(errorMessage);
    }
  }, []);

  // Send password reset email
  const resetPassword = useCallback(async (email) => {
    try {
      setError(null);
      if (!email) {
        throw new Error('Vui lng nhp email');
      }
      await sendPasswordResetEmail(auth, email);
      return true;
    } catch (err) {
      const errorMap = {
        'auth/user-not-found': 'Email ny khng c ng k',
        'auth/invalid-email': 'Email khng hp l',
        'auth/too-many-requests': 'Qu nhiu yu cu, vui lng th li sau',
      };

      const errorMessage = errorMap[err.code] || err.message;
      setError(errorMessage);
      throw new Error(errorMessage);
    }
  }, []);

  // Sign out
  const logout = useCallback(async () => {
    try {
      setError(null);
      await signOut(auth);
      setUser(null);
    } catch (err) {
      const errorMessage = 'ng xut tht bi';
      setError(errorMessage);
      throw new Error(errorMessage);
    }
  }, []);

  // Update user profile
  const updateUserProfile = useCallback(async (updates) => {
    try {
      setError(null);
      if (!auth.currentUser) {
        throw new Error('No user logged in');
      }
      await updateProfile(auth.currentUser, updates);
      setUser({ ...auth.currentUser, ...updates });
    } catch (err) {
      setError(err.message);
      throw err;
    }
  }, []);

  const value = {
    user,
    loading,
    error,
    signup,
    signin,
    signInWithGoogle,
    resetPassword,
    logout,
    updateUserProfile,
    clearError: () => setError(null),
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
};
</file>

<file path="src/contexts/ClerkUserContext.jsx">
import React, { createContext, useContext } from 'react';
import { useClerkAuthentication } from '../hooks/useClerkAuth';

const ClerkUserContext = createContext();

export const ClerkUserProvider = ({ children }) => {
  const auth = useClerkAuthentication();

  return (
    <ClerkUserContext.Provider value={auth}>
      {children}
    </ClerkUserContext.Provider>
  );
};

export const useClerkUser = () => {
  const context = useContext(ClerkUserContext);
  if (!context) {
    throw new Error('useClerkUser must be used within ClerkUserProvider');
  }
  return context;
};
</file>

<file path="src/data/advancedData.js">
export const advanced = {
  level: 'Advanced',
  description: 'Advanced grammar topics for mastery',
  topics: {
    // Topic 1: Reported Speech
    reportedSpeech: {
      id: 'reported_speech',
      title: 'Reported Speech (Indirect Speech)',
      difficulty: 'Advanced',
      icon: '',
      description: 'Report what someone said without using direct quotes',
      lessons: [
        {
          lessonId: 'rs_001',
          title: 'Introduction to Reported Speech',
          duration: '14 mins',
          content: `
            DIRECT SPEECH vs REPORTED SPEECH:
           
            Direct: "I am hungry," she said.
            Reported: She said she was hungry.
           
            TENSE SHIFTS (Backshift):
            When the reporting verb is past tense:
           
            Direct Present Simple  Reported Past Simple
            "I work here."  He said he worked there.
           
            Direct Present Continuous  Reported Past Continuous
            "I am studying."  She said she was studying.
           
            Direct Present Perfect  Reported Past Perfect
            "I have finished."  They said they had finished.
           
            Direct Past Simple  Reported Past Perfect
            "I went yesterday."  He said he had gone.
           
            Direct Future (will)  Reported Conditional (would)
            "I will come."  She said she would come.
           
            Direct Past Perfect  No change
            "I had eaten."  He said he had eaten.
           
            TIME/PLACE SHIFTS:
            Direct  Reported
            now  then
            today  that day
            yesterday  the day before
            tomorrow  the next day/the following day
            here  there
            this  that
           
            Examples:
            Direct: "I was here yesterday," she said.
            Reported: She said she had been there the day before.
           
            Direct: "I will see you tomorrow," he said.
            Reported: He said he would see me the next day.
          `,
          examples: [
            { example: '"I love this place."  He said he loved that place.', explanation: 'Present simple  Past simple, this  that' },
            { example: '"She is working now."  He said she was working then.', explanation: 'Present continuous  Past continuous' },
            { example: '"They will arrive today."  He said they would arrive that day.', explanation: 'will  would, today  that day' },
            { example: '"I have completed it."  She said she had completed it.', explanation: 'Present perfect  Past perfect' },
          ],
        },
        {
          lessonId: 'rs_002',
          title: 'Reported Questions & Commands',
          duration: '12 mins',
          content: `
            REPORTED QUESTIONS:
           
            Form: say/tell + question word + if/whether + statement word order
            (NOT question word order)
           
            Yes/No Questions:
            Direct: "Do you speak English?" he asked.
            Reported: He asked if/whether I spoke English.
           
            Direct: "Will you help me?" she asked.
            Reported: She asked if/whether I would help her.
           
            Question Word Questions:
            Direct: "What time is it?" he asked.
            Reported: He asked what time it was.
           
            Direct: "Where do you live?" she asked.
            Reported: She asked where I lived.
           
            Direct: "How many books have you read?" he asked.
            Reported: He asked how many books I had read.
           
            Important: Use statement word order, not question word order!
             He asked where I lived. (lived after where)
             He asked where did I live.
           
            REPORTED COMMANDS:
           
            Use: tell/ask + (not) + to + infinitive
           
            Direct: "Come here!" he said.
            Reported: He told me to come there.
           
            Direct: "Don't be late!" she said.
            Reported: She told him not to be late.
           
            Direct: "Open the window!" they said.
            Reported: They asked me to open the window.
           
            Positive command: Subject + tell/ask + object + to + verb
            Negative command: Subject + tell/ask + object + not + to + verb
          `,
          examples: [
            { example: '"Are you ready?"  He asked if I was ready.', explanation: 'Yes/No question with if' },
            { example: '"Why didn\'t you call?"  She asked why I hadn\'t called.', explanation: 'Question word with statement order' },
            { example: '"Sit down!"  He told me to sit down.', explanation: 'Command with to infinitive' },
            { example: '"Don\'t go!"  She asked him not to go.', explanation: 'Negative command' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'rs_ex_001',
          type: 'fill_blank',
          difficulty: 'Hard',
          question: '"I am working on a new project," she said.  She said she _____ on a new project.',
          correctAnswer: 'was working',
          hints: ['Present continuous  past continuous', 'am working  was working'],
          explanation: 'In reported speech, present continuous shifts to past continuous when the reporting verb is past.',
        },
        {
          exerciseId: 'rs_ex_002',
          type: 'multiple_choice',
          difficulty: 'Hard',
          question: '"Where did you go yesterday?" he asked.  He asked _____ yesterday.',
          options: [
            { text: 'where I had gone', isCorrect: true, explanation: 'Question word + statement word order + past perfect' },
            { text: 'where did I go', isCorrect: false, explanation: 'Wrong - don\'t use question word order in reported speech' },
            { text: 'if I went', isCorrect: false, explanation: 'Use question word (where), not if' },
            { text: 'what I went', isCorrect: false, explanation: 'Wrong question word' },
          ],
        },
      ],
    },
    // Topic 2: Relative Clauses
    relativeClauses: {
      id: 'relative_clauses',
      title: 'Relative Clauses',
      difficulty: 'Advanced',
      icon: '',
      description: 'Combine sentences using who, which, that, where',
      lessons: [
        {
          lessonId: 'rel_001',
          title: 'Defining Relative Clauses',
          duration: '13 mins',
          content: `
            RELATIVE CLAUSES:
            A clause that gives more information about a noun.
           
            RELATIVE PRONOUNS:
           
            WHO - for people
            "The man who called me was my uncle."
            "Students who study hard pass exams."
           
            WHICH - for things/animals
            "The book which I read was interesting."
            "Cars which use electric batteries are eco-friendly."
           
            WHOSE - possessive for people and things
            "The student whose project won was very happy."
            "The house whose owner is rich has a big garden."
           
            THAT - for people, things, animals (informal)
            "The person that helped me was kind."
            "The car that I bought is reliable."
           
            WHERE - for places
            "The restaurant where we ate was expensive."
            "The city where I was born is beautiful."
           
            WHEN - for time
            "The day when I arrived was sunny."
            "The time when I left was 8 PM."
           
            DEFINING vs NON-DEFINING:
           
            DEFINING (Essential information - NO COMMAS):
            "The student who scored highest won a prize."
            (Which student? The one who scored highest)
           
            "I like the shirt that my sister gave me."
            (Which shirt? The one my sister gave)
           
            NON-DEFINING (Extra information - WITH COMMAS):
            "My friend John, who is a doctor, loves traveling."
            (We already know who John is - extra info)
           
            "The Eiffel Tower, which is in Paris, was built in 1889."
            (We know what it is - extra historical info)
           
            Note: In non-defining clauses:
            - CANNOT use "that"
            - CANNOT omit the relative pronoun
            - Use commas (which, who, whose, where, when)
           
            OMITTING RELATIVE PRONOUNS (Defining clauses only):
           
            Can omit when it's the OBJECT:
            "The book (that) I read was good."  (can omit)
            "The girl (who) I met was nice."  (can omit)
           
            CANNOT omit when it's the SUBJECT:
            "The book that is on the table is mine."  (cannot omit)
            "The man who lives here is my neighbor."  (cannot omit)
          `,
          examples: [
            { example: 'The woman who teaches English is very kind.', explanation: 'WHO - subject of clause' },
            { example: 'The movie which I watched yesterday was great.', explanation: 'WHICH - object (can omit "which")' },
            { example: 'The house where I grew up is still there.', explanation: 'WHERE - for locations' },
            { example: 'The student whose exam was excellent received praise.', explanation: 'WHOSE - possessive' },
            { example: 'My brother, who lives in Tokyo, visits us every summer.', explanation: 'NON-DEFINING - extra info with commas' },
          ],
        },
        {
          lessonId: 'rel_002',
          title: 'Complex Relative Clause Patterns',
          duration: '11 mins',
          content: `
            PREPOSITIONS + RELATIVE PRONOUNS:
           
            Formal (with preposition at beginning):
            "The person to whom I spoke was helpful."
            "The book in which he wrote notes is lost."
            "The reason for which she left is unknown."
           
            Informal (with preposition at end):
            "The person I spoke to was helpful."
            "The book he wrote notes in is lost."
            "The reason she left for is unknown."
           
            WHOSE vs OF WHICH:
           
            People: whose
            "The teacher whose class is interesting..."
           
            Things: whose OR of which
            "The building whose windows are broken..." =
            "The building, the windows of which are broken..."
           
            RELATIVE CLAUSES WITH "WHAT":
           
            "What" is NOT a relative pronoun in the traditional sense.
            Used for something indefinite:
           
            "I don't understand what he meant." (= the thing that)
            "What you said is not true." (= the thing that)
            "I'll do whatever you ask." (= anything that)
           
            REDUCED RELATIVE CLAUSES:
           
            Option 1: Omit relative pronoun + auxiliary
            "The book (that) is on the table"  "The book on the table"
            "The girl (who) is wearing a red dress"  "The girl wearing a red dress"
           
            Option 2: Use -ed form (passive)
            "The man (who) was injured in the accident"  "The man injured in the accident"
            "The package (which) was delivered yesterday"  "The package delivered yesterday"
          `,
          examples: [
            { example: 'The friend to whom I told the secret betrayed me.', explanation: 'Formal - preposition at beginning' },
            { example: 'The friend (that) I told the secret to betrayed me.', explanation: 'Informal - preposition at end' },
            { example: 'The students wearing uniforms are from our school.', explanation: 'Reduced relative clause' },
            { example: 'Do you understand what I mean?', explanation: '"What" for indefinite things' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'rel_ex_001',
          type: 'multiple_choice',
          difficulty: 'Hard',
          question: 'The scientist _____ discovered the cure was awarded a Nobel Prize.',
          options: [
            { text: 'who', isCorrect: true, explanation: 'WHO for person + subject of clause' },
            { text: 'which', isCorrect: false, explanation: 'WHICH is for things, not people' },
            { text: 'that discovered', isCorrect: false, explanation: 'Wrong structure' },
            { text: 'whom', isCorrect: false, explanation: 'WHOM is for object, but here WHO is subject' },
          ],
        },
      ],
    },
    // Topic 3: Passive Voice
    passiveVoice: {
      id: 'passive_voice',
      title: 'Passive Voice',
      difficulty: 'Advanced',
      icon: '',
      description: 'Focus on the action rather than who does it',
      lessons: [
        {
          lessonId: 'pv_001',
          title: 'Formation & Use of Passive Voice',
          duration: '13 mins',
          content: `
            ACTIVE vs PASSIVE:
           
            Active: Subject performs the action
            "The chef prepared the meal."
           
            Passive: Subject receives the action
            "The meal was prepared by the chef."
           
            FORM: be (conjugated) + past participle
           
            TENSE CONVERSIONS:
           
            Present Simple Active: cook
            Present Simple Passive: is/am/are + cooked
            "They cook dinner."  "Dinner is cooked (by them)."
           
            Present Continuous Active: is cooking
            Present Continuous Passive: is/am/are + being + cooked
            "She is cooking rice."  "Rice is being cooked (by her)."
           
            Past Simple Active: cooked
            Past Simple Passive: was/were + cooked
            "They cooked it yesterday."  "It was cooked yesterday."
           
            Past Continuous Active: was cooking
            Past Continuous Passive: was/were + being + cooked
            "I was preparing dinner."  "Dinner was being prepared."
           
            Present Perfect Active: have cooked
            Present Perfect Passive: have/has + been + cooked
            "She has finished the project."  "The project has been finished."
           
            Past Perfect Active: had cooked
            Past Perfect Passive: had + been + cooked
            "They had completed the work."  "The work had been completed."
           
            Future Simple Active: will cook
            Future Simple Passive: will + be + cooked
            "I will fix it."  "It will be fixed."
           
            Modals Active: can cook, must cook
            Modals Passive: can be cooked, must be cooked
            "We must finish this."  "This must be finished."
           
            WHEN TO USE PASSIVE:
            1. Focus on the action, not who does it
            2. The doer is unknown or obvious
            3. More formal/impersonal tone
            4. Scientific or technical writing
           
            Examples:
            "Thousands of people visit this museum each year."
            (Focus on museum, not on specific visitors)
           
            "Several mistakes were found in the report."
            (Who found? Not important)
           
            "The medicine is taken twice daily."
            (How it's used matters, not who uses it)
           
            BY-PHRASE:
            "The book was written by J.K. Rowling." (Include agent)
            "The package was delivered." (Omit obvious agent)
           
            Omit "by" when:
            - Agent is obvious: "The school was closed." (by the principal/authority)
            - Agent is unimportant: "The bridge was destroyed." (by an earthquake/forces)
            - Agent is unknown: "The car was stolen." (we don't know who)
          `,
          examples: [
            { example: 'The letter was written in 1945. (Active: Someone wrote the letter in 1945.)', explanation: 'Focus on action/letter, not writer' },
            { example: 'The windows are being cleaned right now. (Active: Someone is cleaning...)', explanation: 'Present continuous passive' },
            { example: 'By 2030, 50% of cars will be electric-powered. (Active: will power)', explanation: 'Future passive' },
            { example: 'The suspect is believed to be dangerous. (Active: People believe...)', explanation: 'Modal passive' },
          ],
        },
        {
          lessonId: 'pv_002',
          title: 'Passive Voice with Get & Causative',
          duration: '11 mins',
          content: `
            PASSIVE WITH "GET":
           
            "Get" + past participle (less formal than "be"):
           
            "She got injured in the accident."
            (= She was injured - often suggests: something happened to her)
           
            "The car got damaged during transport."
            (= The car was damaged - suggests: unfortunate)
           
            GET + past participle usually implies:
            - Something happened to the person
            - Often negative or unexpected
            - More casual tone
           
            Compare:
            "The window was broken." (factual)
            "The window got broken." (something happened - more dramatic)
           
            CAUSATIVE STRUCTURES:
            "Have something done" = pay someone to do it
           
            "I had my car repaired." (I paid someone to repair it)
            "She got her hair cut." (She paid a stylist)
            "They had the house painted." (They hired painters)
           
            Form: have/get + object + past participle
           
            ACTIVE: A painter paints my house.
            PASSIVE: I have my house painted (by a painter).
           
            Uses:
            - Services: "I had my teeth cleaned."
            - Repairs: "He got his watch fixed."
            - Professional services: "She had her nails done."
           
            Negative: "I won't have my room cleaned." (= I won't allow it)
           
            CAUSATIVE with "LET/MAKE":
           
            "Let" + object + base verb (allow)
            "His mother let him stay up late."
           
            "Make" + object + base verb (force)
            "The teacher made us do homework."
           
            Passive form:
            "He was allowed to stay up late."
            "We were made to do homework."
          `,
          examples: [
            { example: 'I got stuck in traffic for 2 hours.', explanation: 'GET passive - something happened' },
            { example: 'She had her dress tailored for the wedding.', explanation: 'Causative - paid someone' },
            { example: 'The dog was made to sit.', explanation: 'Passive causative with make' },
            { example: 'Children are let to play in the park.', explanation: 'Passive causative with let' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'pv_ex_001',
          type: 'fill_blank',
          difficulty: 'Hard',
          question: 'The project _____ (complete) by next month.',
          correctAnswer: 'will be completed',
          hints: ['Future passive', 'will + be + past participle'],
          explanation: 'Future passive: will + be + past participle of complete (completed)',
        },
        {
          exerciseId: 'pv_ex_002',
          type: 'multiple_choice',
          difficulty: 'Hard',
          question: 'The report _____ three times before it was approved.',
          options: [
            { text: 'had been revised', isCorrect: true, explanation: 'Past perfect passive - multiple times before approval' },
            { text: 'was revised', isCorrect: false, explanation: 'Simple past - but "three times" suggests repetition' },
            { text: 'is being revised', isCorrect: false, explanation: 'Present continuous - wrong tense' },
            { text: 'has been revised', isCorrect: false, explanation: 'Present perfect - but action completed before past event' },
          ],
        },
      ],
    },
    // Topic 4: Noun Phrases & Nominalization
    nounPhrases: {
      id: 'noun_phrases',
      title: 'Noun Phrases & Nominalization',
      difficulty: 'Advanced',
      icon: '',
      description: 'Create complex noun structures and turn verbs into nouns',
      lessons: [
        {
          lessonId: 'np_001',
          title: 'Complex Noun Phrases',
          duration: '12 mins',
          content: `
            NOUN PHRASE STRUCTURE:
           
            (Determiner) + (Pre-modifiers) + HEAD NOUN + (Post-modifiers)
           
            Examples:
            "The beautiful old house"
            det + pre-mod + head noun
           
            "The old house with red shutters"
            det + pre-mod + head noun + post-mod
           
            "All the brilliant young students studying in our school"
            det + pre-mod + head noun + post-mod
           
            PRE-MODIFIERS (Before the noun):
           
            1. Determiners: the, a, this, my, some, all, etc.
            2. Adjectives: big, beautiful, old, interesting, etc.
            3. Numbers: one, two, first, second, etc.
            4. Participles: smoking, broken, sleeping, etc.
            5. Nouns: coffee table, kitchen sink, gold medal, etc.
           
            Examples:
            "A smoking hot cup of coffee" (participle + adjective + noun)
            "The sleeping children" (participle + noun)
            "A beautiful Italian leather wallet" (adjectives + noun)
            "The first international football match" (number + adjective + noun)
           
            POST-MODIFIERS (After the noun):
           
            1. Prepositional phrases: "in the house", "with red roof"
            2. Relative clauses: "who lived there", "that I bought"
            3. Participle clauses: "standing in the corner", "made of wood"
            4. Infinitive clauses: "to visit", "to remember"
           
            Examples:
            "The man in the corner" (prepositional phrase)
            "The books that I recommended" (relative clause)
            "The children playing in the park" (participle clause)
            "The desire to succeed" (infinitive clause)
           
            WORD ORDER OF ADJECTIVES:
            Opinion  Size  Age  Shape  Color  Origin  Material  Noun
           
            "A beautiful old round red Italian leather bag"
           
            But natural English rarely uses more than 3 adjectives.
            "A beautiful old red leather bag" (more natural)
          `,
          examples: [
            { example: 'The tall man with glasses standing near the door', explanation: 'det + adj + noun + prep phrase + participle' },
            { example: 'Several interesting historical documents from that period', explanation: 'det + adj + noun + prep phrase' },
            { example: 'The first successful international peace treaty', explanation: 'det + number + adj + noun' },
            { example: 'A cold glass of delicious fresh orange juice', explanation: 'adj + noun + prep phrase + adjectives' },
          ],
        },
        {
          lessonId: 'np_002',
          title: 'Nominalization - Turning Verbs into Nouns',
          duration: '11 mins',
          content: `
            NOMINALIZATION:
            Converting verbs/adjectives into nouns to make writing more formal/abstract.
           
            COMMON PATTERNS:
           
            1. -tion/-sion (from verbs ending in -e, -te):
            educate  education
            celebrate  celebration
            permit  permission
            decide  decision
           
            2. -ment:
            develop  development
            achieve  achievement
            govern  government
            manage  management
           
            3. -ness (from adjectives):
            happy  happiness
            aware  awareness
            kind  kindness
            clever  cleverness
           
            4. -ance/-ence:
            perform  performance
            appear  appearance
            exist  existence
            prefer  preference
           
            5. -ing:
            walk  walking
            learn  learning
            teach  teaching
            manage  managing
           
            6. -ity:
            able  ability
            possible  possibility
            public  publicity
            popular  popularity
           
            7. Irregular:
            begin  beginning
            grow  growth
            choose  choice
            move  movement
           
            USING NOMINALIZATION:
           
            Verb form (active, dynamic):
            "Students study English to improve their skills."
           
            Nominalized form (formal, abstract):
            "The study of English improves students' skills."
            "English study leads to skill improvement."
           
            Original: "People consume too much plastic."
            Nominalized: "Excessive plastic consumption is harmful."
           
            Original: "Companies pollute the environment."
            Nominalized: "Environmental pollution by companies..."
           
            BENEFITS:
            - More formal tone (academic writing)
            - Shorter, more concise
            - Focus on the action itself, not the person
            - Better for technical/scientific writing
           
            NOUN + NOMINALIZATION combinations:
            "The development of new technology" (technology development)
            "The reduction of carbon emissions" (carbon emission reduction)
            "The improvement of education quality" (education quality improvement)
          `,
          examples: [
            { example: 'The elimination of poverty requires international cooperation.', explanation: 'eliminate  elimination; cooperate  cooperation' },
            { example: 'Her achievement in the field was remarkable.', explanation: 'achieve  achievement' },
            { example: 'The management of the project was challenging.', explanation: 'manage  management' },
            { example: 'His happiness comes from helping others.', explanation: 'happy  happiness' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'np_ex_001',
          type: 'fill_blank',
          difficulty: 'Hard',
          question: 'Choose the best nominalization: "The country must _____ its infrastructure."  "The country needs _____ of its infrastructure."',
          correctAnswer: 'modernize / modernization',
          hints: ['Verb modernize', '-tion ending for noun form'],
          explanation: 'modernize  modernization (verb  noun with -tion suffix)',
        },
      ],
    },
  },
};
</file>

<file path="src/data/beginnerData.js">
export const beginner = {
  level: 'Beginner',
  description: 'Foundation grammar topics for beginners',
  topics: {
    // Topic 1: Present Simple
    presentSimple: {
      id: 'present_simple',
      title: 'Present Simple Tense',
      difficulty: 'Beginner',
      icon: '',
      description: 'Learn how to form and use the simple present tense',
      lessons: [
        {
          lessonId: 'ps_001',
          title: 'Introduction to Present Simple',
          duration: '8 mins',
          content: `
            The Present Simple tense is used to:
            - Describe habits and routines
            - State facts and truths
            - Express regular actions
           
            Affirmative form: Subject + Base verb (+ s/es)
            Example: I play football. She plays football.
           
            Negative form: Subject + do/does + not + Base verb
            Example: I don't play football. She doesn't play football.
           
            Question form: Do/Does + Subject + Base verb?
            Example: Do you play football? Does she play football?
          `,
          examples: [
            { example: 'I wake up at 7 AM every day.', explanation: 'Regular daily habit' },
            { example: 'She works in a bank.', explanation: 'Current occupation' },
            { example: 'Water boils at 100C.', explanation: 'Scientific fact' },
            { example: 'They go to school on weekdays.', explanation: 'Routine activity' },
          ],
        },
        {
          lessonId: 'ps_002',
          title: 'Present Simple - Affirmative & Negative',
          duration: '10 mins',
          content: `
            Rules for adding -s or -es:
           
            1. Regular verbs: Add -s
               play  plays, work  works
           
            2. Verbs ending in -ch, -sh, -x, -z, -o: Add -es
               watch  watches, push  pushes, go  goes
           
            3. Verbs ending in consonant + y: Change y to i, add -es
               study  studies, cry  cries
           
            Common irregular verbs:
            be  is/am/are
            have  has
            do  does
            go  goes
          `,
          examples: [
            { example: 'She studies French.', explanation: 'consonant + y  ies' },
            { example: 'He watches TV.', explanation: 'ends in -ch  add -es' },
            { example: 'I don\'t like spicy food.', explanation: 'Negative: don\'t + base verb' },
            { example: 'They don\'t work on Sundays.', explanation: 'Plural negative' },
          ],
        },
        {
          lessonId: 'ps_003',
          title: 'Present Simple - Questions',
          duration: '9 mins',
          content: `
            Question Formation:
           
            With do/does:
            Do you like coffee?  Yes, I do. / No, I don't.
            Does he like coffee?  Yes, he does. / No, he doesn't.
           
            Question words:
            What do you do? - What is your occupation?
            Where do you live? - Where is your home?
            Why does she study? - For what reason?
            How often do they visit? - Frequency of visits
            Who plays football? - Which person?
          `,
          examples: [
            { example: 'Do they play tennis?', explanation: 'Yes/No question with do' },
            { example: 'Does your mother cook?', explanation: 'Yes/No question with does' },
            { example: 'What time do you wake up?', explanation: 'Information question' },
            { example: 'How often does she exercise?', explanation: 'Frequency question' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'ps_ex_001',
          type: 'multiple_choice',
          difficulty: 'Easy',
          question: 'I _____ to school every day.',
          options: [
            { text: 'go', isCorrect: true, explanation: 'Base verb form for first person' },
            { text: 'goes', isCorrect: false, explanation: 'Used only with third person singular (he/she/it)' },
            { text: 'going', isCorrect: false, explanation: 'This is present progressive, not present simple' },
            { text: 'am go', isCorrect: false, explanation: 'Incorrect grammar' },
          ],
        },
        {
          exerciseId: 'ps_ex_002',
          type: 'multiple_choice',
          difficulty: 'Easy',
          question: 'She _____ like vegetables.',
          options: [
            { text: 'does not', isCorrect: true, explanation: 'Correct negative form' },
            { text: 'do not', isCorrect: false, explanation: 'Used with plural subjects' },
            { text: 'not like', isCorrect: false, explanation: 'Incomplete negative' },
            { text: 'is not', isCorrect: false, explanation: 'Wrong auxiliary verb' },
          ],
        },
        {
          exerciseId: 'ps_ex_003',
          type: 'fill_blank',
          difficulty: 'Medium',
          question: 'My brother _____ (work) in a hospital.',
          correctAnswer: 'works',
          hints: ['Think about third person singular', 'Add -s to the verb'],
          explanation: 'With third person singular subject (he/she/it), add -s to the base verb',
        },
        {
          exerciseId: 'ps_ex_004',
          type: 'multiple_choice',
          difficulty: 'Medium',
          question: 'What time _____ you finish work?',
          options: [
            { text: 'do', isCorrect: true, explanation: 'Question form with do' },
            { text: 'does', isCorrect: false, explanation: 'Does is used with he/she/it' },
            { text: 'are', isCorrect: false, explanation: 'Wrong auxiliary' },
            { text: 'will', isCorrect: false, explanation: 'This is for future tense' },
          ],
        },
        {
          exerciseId: 'ps_ex_005',
          type: 'fill_blank',
          difficulty: 'Hard',
          question: 'They _____ (not/watch) TV during dinner.',
          correctAnswer: 'don\'t watch',
          hints: ['Use do/does for negative', 'Remember plural subjects use do'],
          explanation: 'Plural subjects use "don\'t" + base verb in negative form',
        },
      ],
      vocabulary: [
        { word: 'habit', meaning: 'A regular or repeated behavior', example: 'Reading is my daily habit.' },
        { word: 'routine', meaning: 'A set of regular activities', example: 'Morning routine includes breakfast.' },
        { word: 'frequency', meaning: 'How often something happens', example: 'How is the frequency of your exercise?' },
        { word: 'occur', meaning: 'To happen', example: 'This problem occurs frequently.' },
      ],
    },
    // Topic 2: Present Continuous
    presentContinuous: {
      id: 'present_continuous',
      title: 'Present Continuous Tense',
      difficulty: 'Beginner',
      icon: '',
      description: 'Learn actions happening right now',
      lessons: [
        {
          lessonId: 'pc_001',
          title: 'Introduction to Present Continuous',
          duration: '8 mins',
          content: `
            The Present Continuous (Present Progressive) is used for:
            - Actions happening RIGHT NOW
            - Temporary situations
            - Actions in progress
           
            Form: Subject + am/is/are + verb-ing
           
            I am reading
            You are reading
            He/She/It is reading
            We are reading
            They are reading
           
            Negative: Subject + am/is/are + NOT + verb-ing
            Positive: Am/Is/Are + Subject + verb-ing?
          `,
          examples: [
            { example: 'I am studying English right now.', explanation: 'Action in progress now' },
            { example: 'She is playing tennis at the moment.', explanation: 'Happening currently' },
            { example: 'They are not watching the movie.', explanation: 'Negative form' },
            { example: 'Is he sleeping?', explanation: 'Question form' },
          ],
        },
        {
          lessonId: 'pc_002',
          title: 'Verb-ing Forms & Spelling Rules',
          duration: '10 mins',
          content: `
            Spelling rules for -ing:
           
            1. Regular: Add -ing
               play  playing, read  reading
           
            2. Verb ends in -e: Remove -e, add -ing
               dance  dancing, write  writing
           
            3. Verb ends in consonant + vowel + consonant (CVC):
               Double the consonant, add -ing
               run  running, sit  sitting
               Exception: Single syllable only if stressed
           
            4. Verb ends in -ie: Change to -ying
               lie  lying, die  dying
          `,
          examples: [
            { example: 'run  running', explanation: 'Double consonant rule (CVC)' },
            { example: 'make  making', explanation: 'Remove silent e' },
            { example: 'work  working', explanation: 'No doubling needed' },
            { example: 'swim  swimming', explanation: 'Double m rule' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'pc_ex_001',
          type: 'multiple_choice',
          difficulty: 'Easy',
          question: 'She _____ TV right now.',
          options: [
            { text: 'is watching', isCorrect: true, explanation: 'Correct present continuous form' },
            { text: 'watches', isCorrect: false, explanation: 'This is simple present' },
            { text: 'is watch', isCorrect: false, explanation: 'Missing -ing' },
            { text: 'are watching', isCorrect: false, explanation: 'Wrong form of be' },
          ],
        },
        {
          exerciseId: 'pc_ex_002',
          type: 'fill_blank',
          difficulty: 'Medium',
          question: 'They are _____ (swim) in the pool.',
          correctAnswer: 'swimming',
          hints: ['Remember the CVC rule', 'Double the m'],
          explanation: 'swim  swimming (double the final consonant before adding -ing)',
        },
      ],
      vocabulary: [
        { word: 'temporary', meaning: 'Lasting for a short time', example: 'This is a temporary job.' },
        { word: 'progress', meaning: 'Movement towards completion', example: 'Work in progress.' },
      ],
    },
    // Topic 3: Past Simple
    pastSimple: {
      id: 'past_simple',
      title: 'Past Simple Tense',
      difficulty: 'Beginner',
      icon: '',
      description: 'Talk about completed past actions',
      lessons: [
        {
          lessonId: 'ps_past_001',
          title: 'Introduction to Past Simple',
          duration: '9 mins',
          content: `
            Used for:
            - Completed actions in the past
            - Series of past events
            - Past facts and habits
           
            Regular verbs: Base verb + -ed
            I played, she worked, they studied
           
            Irregular verbs: Must be memorized
            go  went, eat  ate, see  saw, buy  bought
           
            Form:
            Affirmative: Subject + verb-ed (or irregular)
            Negative: Subject + did + not + base verb
            Question: Did + Subject + base verb?
          `,
          examples: [
            { example: 'I played football yesterday.', explanation: 'Regular past simple' },
            { example: 'She went to Paris last month.', explanation: 'Irregular verb' },
            { example: 'They did not come to the party.', explanation: 'Negative past' },
            { example: 'Did you see the movie?', explanation: 'Question form' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'ps_past_ex_001',
          type: 'multiple_choice',
          difficulty: 'Easy',
          question: 'Last weekend, I _____ to the beach.',
          options: [
            { text: 'went', isCorrect: true, explanation: 'Irregular past of go' },
            { text: 'go', isCorrect: false, explanation: 'This is present tense' },
            { text: 'going', isCorrect: false, explanation: 'This is present continuous' },
            { text: 'gone', isCorrect: false, explanation: 'This is past participle' },
          ],
        },
      ],
      vocabulary: [
        { word: 'completed', meaning: 'Finished', example: 'The project is completed.' },
        { word: 'yesterday', meaning: 'The day before today', example: 'I saw him yesterday.' },
      ],
    },
    // Topic 4: Future Simple (will)
    futureSimple: {
      id: 'future_simple',
      title: 'Future Simple - Will',
      difficulty: 'Beginner',
      icon: '',
      description: 'Talk about future actions and predictions',
      lessons: [
        {
          lessonId: 'fs_001',
          title: 'Introduction to Future Simple',
          duration: '8 mins',
          content: `
            Will is used for:
            - Predictions about the future
            - Decisions made at the moment
            - Promises and offers
            - General truths about the future
           
            Form: Subject + will + base verb
            I will go, she will study, they will help
           
            Negative: Subject + will + not + base verb
            I will not go (I won't go)
           
            Question: Will + Subject + base verb?
            Will you help me?
          `,
          examples: [
            { example: 'It will rain tomorrow.', explanation: 'Prediction' },
            { example: 'I will call you later.', explanation: 'Decision' },
            { example: 'She won\'t forget you.', explanation: 'Promise/negative' },
            { example: 'Will they arrive on time?', explanation: 'Question' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'fs_ex_001',
          type: 'multiple_choice',
          difficulty: 'Easy',
          question: 'I _____ you tomorrow.',
          options: [
            { text: 'will see', isCorrect: true, explanation: 'Future simple with will' },
            { text: 'see', isCorrect: false, explanation: 'This is present simple' },
            { text: 'saw', isCorrect: false, explanation: 'This is past simple' },
            { text: 'am seeing', isCorrect: false, explanation: 'This is present continuous' },
          ],
        },
      ],
    },
  },
};
</file>

<file path="src/data/grammarData.js">
// grammarData.js - Complete Grammar Learning Data for HUFLIT (with English and Vietnamese translations)
export const GRAMMAR_DATA = {
  // ===== BEGINNER LEVEL =====
  beginner: {
    level: 'Beginner',
    description: 'Foundation grammar topics for beginners (Nn tng ng php cho ngi mi bt u)',
    topics: {
      // Topic 1: Present Simple
      presentSimple: {
        id: 'present_simple',
        title: 'Present Simple Tense (Th Hin Ti n)',
        difficulty: 'Beginner',
        icon: '',
        description: 'Learn how to form and use the simple present tense (Hc cch hnh thnh v s dng th hin ti n)',
        lessons: [
          {
            lessonId: 'ps_001',
            title: 'Introduction to Present Simple (Gii thiu Th Hin Ti n)',
            duration: '8 mins',
            content: `
**English:**
The Present Simple tense is used to:
- Describe habits and routines
- State facts and truths
- Express regular actions

Affirmative form: Subject + Base verb (+ s/es)
Example: I play football. She plays football.

Negative form: Subject + do/does + not + Base verb
Example: I don't play football. She doesn't play football.

Question form: Do/Does + Subject + Base verb?
Example: Do you play football? Does she play football?

**Vietnamese Translation (Dch Ting Vit):**
Th Hin Ti n c s dng :
- M t thi quen v hot ng hng ngy
- Nu s tht v chn l
- By t hnh ng thng xuyn

Cu trc khng nh: Ch ng + ng t nguyn th (+ s/es)
V d: I play football (Ti chi bng ). She plays football (C y chi bng ).

Cu trc ph nh: Ch ng + do/does + not + ng t nguyn th
V d: I don't play football (Ti khng chi bng ). She doesn't play football (C y khng chi bng ).

Cu trc cu hi: Do/Does + Ch ng + ng t nguyn th?
V d: Do you play football? (Bn c chi bng  khng?) Does she play football? (C y c chi bng  khng?)
            `,
            examples: [
              { 
                example: 'I wake up at 7 AM every day.', 
                explanation: 'Regular daily habit (Thi quen hng ngy u n)',
                vietnamese: {
                  example: 'Ti thc dy lc 7 gi sng mi ngy.',
                  explanation: 'Thi quen hng ngy u n'
                }
              },
              { 
                example: 'She works in a bank.', 
                explanation: 'Current occupation (Ngh nghip hin ti)',
                vietnamese: {
                  example: 'C y lm vic trong ngn hng.',
                  explanation: 'Ngh nghip hin ti'
                }
              },
              { 
                example: 'Water boils at 100C.', 
                explanation: 'Scientific fact (S tht khoa hc)',
                vietnamese: {
                  example: 'Nc si  100C.',
                  explanation: 'S tht khoa hc'
                }
              },
              { 
                example: 'They go to school on weekdays.', 
                explanation: 'Routine activity (Hot ng thng xuyn)',
                vietnamese: {
                  example: 'H i hc vo cc ngy trong tun.',
                  explanation: 'Hot ng thng xuyn'
                }
              },
            ],
          },
          {
            lessonId: 'ps_002',
            title: 'Present Simple - Affirmative & Negative (Th Hin Ti n - Khng nh & Ph nh)',
            duration: '10 mins',
            content: `
**English:**
Rules for adding -s or -es:

1. Regular verbs: Add -s
   play  plays, work  works

2. Verbs ending in -ch, -sh, -x, -z, -o: Add -es
   watch  watches, push  pushes, go  goes

3. Verbs ending in consonant + y: Change y to i, add -es
   study  studies, cry  cries

Common irregular verbs:
be  is/am/are
have  has
do  does
go  goes

**Vietnamese Translation (Dch Ting Vit):**
Quy tc thm -s hoc -es:

1. ng t thng thng: Thm -s
   play  plays, work  works

2. ng t kt thc bng -ch, -sh, -x, -z, -o: Thm -es
   watch  watches, push  pushes, go  goes

3. ng t kt thc bng ph m + y: i y thnh i, thm -es
   study  studies, cry  cries

Cc ng t bt quy tc ph bin:
be  is/am/are
have  has
do  does
go  goes
            `,
            examples: [
              { 
                example: 'She studies French.', 
                explanation: 'consonant + y  ies (ph m + y  ies)',
                vietnamese: {
                  example: 'C y hc ting Php.',
                  explanation: 'ph m + y  ies'
                }
              },
              { 
                example: 'He watches TV.', 
                explanation: 'ends in -ch  add -es (kt thc bng -ch  thm -es)',
                vietnamese: {
                  example: 'Anh y xem TV.',
                  explanation: 'kt thc bng -ch  thm -es'
                }
              },
              { 
                example: 'I don\'t like spicy food.', 
                explanation: 'Negative: don\'t + base verb (Ph nh: don\'t + ng t nguyn th)',
                vietnamese: {
                  example: 'Ti khng thch thc n cay.',
                  explanation: 'Ph nh: don\'t + ng t nguyn th'
                }
              },
              { 
                example: 'They don\'t work on Sundays.', 
                explanation: 'Plural negative (Ph nh s nhiu)',
                vietnamese: {
                  example: 'H khng lm vic vo Ch Nht.',
                  explanation: 'Ph nh s nhiu'
                }
              },
            ],
          },
          {
            lessonId: 'ps_003',
            title: 'Present Simple - Questions (Th Hin Ti n - Cu Hi)',
            duration: '9 mins',
            content: `
**English:**
Question Formation:

With do/does:
Do you like coffee?  Yes, I do. / No, I don't.
Does he like coffee?  Yes, he does. / No, he doesn't.

Question words:
What do you do? - What is your occupation?
Where do you live? - Where is your home?
Why does she study? - For what reason?
How often do they visit? - Frequency of visits
Who plays football? - Which person?

**Vietnamese Translation (Dch Ting Vit):**
Hnh thnh cu hi:

Vi do/does:
Do you like coffee?  Yes, I do. / No, I don't. (Bn c thch c ph khng?  C, ti thch. / Khng, ti khng thch.)
Does he like coffee?  Yes, he does. / No, he doesn't. (Anh y c thch c ph khng?  C, anh y thch. / Khng, anh y khng thch.)

T hi:
What do you do? - What is your occupation? (Bn lm ngh g?)
Where do you live? - Where is your home? (Bn sng  u?)
Why does she study? - For what reason? (Ti sao c y hc? - V l do g?)
How often do they visit? - Frequency of visits (H thm bao lu mt ln? - Tn sut thm ving)
Who plays football? - Which person? (Ai chi bng ? - Ngi no?)
            `,
            examples: [
              { 
                example: 'Do they play tennis?', 
                explanation: 'Yes/No question with do (Cu hi Yes/No vi do)',
                vietnamese: {
                  example: 'H c chi tennis khng?',
                  explanation: 'Cu hi Yes/No vi do'
                }
              },
              { 
                example: 'Does your mother cook?', 
                explanation: 'Yes/No question with does (Cu hi Yes/No vi does)',
                vietnamese: {
                  example: 'M bn c nu n khng?',
                  explanation: 'Cu hi Yes/No vi does'
                }
              },
              { 
                example: 'What time do you wake up?', 
                explanation: 'Information question (Cu hi thng tin)',
                vietnamese: {
                  example: 'Bn thc dy lc my gi?',
                  explanation: 'Cu hi thng tin'
                }
              },
              { 
                example: 'How often does she exercise?', 
                explanation: 'Frequency question (Cu hi tn sut)',
                vietnamese: {
                  example: 'C y tp th dc bao lu mt ln?',
                  explanation: 'Cu hi tn sut'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'ps_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'I _____ to school every day. (Ti _____ n trng mi ngy.)',
            options: [
              { text: 'go', isCorrect: true, explanation: 'Base verb form for first person (Dng ng t nguyn th cho ngi th nht)' },
              { text: 'goes', isCorrect: false, explanation: 'Used only with third person singular (he/she/it) (Ch dng vi ngi th ba s t (he/she/it))' },
              { text: 'going', isCorrect: false, explanation: 'This is present progressive, not present simple (y l th hin ti tip din, khng phi hin ti n)' },
              { text: 'am go', isCorrect: false, explanation: 'Incorrect grammar (Ng php sai)' },
            ],
          },
          {
            exerciseId: 'ps_ex_002',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'She _____ like vegetables. (C y _____ thch rau c.)',
            options: [
              { text: 'does not', isCorrect: true, explanation: 'Correct negative form (Dng ph nh ng)' },
              { text: 'do not', isCorrect: false, explanation: 'Used with plural subjects (Dng vi ch ng s nhiu)' },
              { text: 'not like', isCorrect: false, explanation: 'Incomplete negative (Ph nh khng hon chnh)' },
              { text: 'is not', isCorrect: false, explanation: 'Wrong auxiliary verb (Tr ng t sai)' },
            ],
          },
          {
            exerciseId: 'ps_ex_003',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: 'My brother _____ (work) in a hospital. (Anh trai ti _____ (lm vic) trong bnh vin.)',
            correctAnswer: 'works',
            hints: ['Think about third person singular (Ngh v ngi th ba s t)', 'Add -s to the verb (Thm -s vo ng t)'],
            explanation: 'With third person singular subject (he/she/it), add -s to the base verb (Vi ch ng ngi th ba s t (he/she/it), thm -s vo ng t nguyn th)',
          },
          {
            exerciseId: 'ps_ex_004',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'What time _____ you finish work? (Bn _____ tan s lc my gi?)',
            options: [
              { text: 'do', isCorrect: true, explanation: 'Question form with do (Dng cu hi vi do)' },
              { text: 'does', isCorrect: false, explanation: 'Does is used with he/she/it (Does dng vi he/she/it)' },
              { text: 'are', isCorrect: false, explanation: 'Wrong auxiliary (Tr ng t sai)' },
              { text: 'will', isCorrect: false, explanation: 'This is for future tense (y l cho th tng lai)' },
            ],
          },
          {
            exerciseId: 'ps_ex_005',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'They _____ (not/watch) TV during dinner. (H _____ (khng xem) TV trong ba ti.)',
            correctAnswer: 'don\'t watch',
            hints: ['Use do/does for negative (S dng do/does cho ph nh)', 'Remember plural subjects use do (Nh ch ng s nhiu dng do)'],
            explanation: 'Plural subjects use "don\'t" + base verb in negative form (Ch ng s nhiu dng "don\'t" + ng t nguyn th trong dng ph nh)',
          },
        ],
        vocabulary: [
          { 
            word: 'habit', 
            meaning: 'A regular or repeated behavior (Hnh vi thng xuyn hoc lp li)', 
            example: 'Reading is my daily habit. (c sch l thi quen hng ngy ca ti.)' 
          },
          { 
            word: 'routine', 
            meaning: 'A set of regular activities (B cc hot ng thng xuyn)', 
            example: 'Morning routine includes breakfast. (Thi quen bui sng bao gm n sng.)' 
          },
          { 
            word: 'frequency', 
            meaning: 'How often something happens (Tn sut xy ra iu g )', 
            example: 'How is the frequency of your exercise? (Tn sut tp th dc ca bn nh th no?)' 
          },
          { 
            word: 'occur', 
            meaning: 'To happen (Xy ra)', 
            example: 'This problem occurs frequently. (Vn  ny xy ra thng xuyn.)' 
          },
        ],
      },

      // Topic 2: Present Continuous
      presentContinuous: {
        id: 'present_continuous',
        title: 'Present Continuous Tense (Th Hin Ti Tip Din)',
        difficulty: 'Beginner',
        icon: '',
        description: 'Learn actions happening right now (Hc hnh ng ang xy ra ngay by gi)',
        lessons: [
          {
            lessonId: 'pc_001',
            title: 'Introduction to Present Continuous (Gii thiu Th Hin Ti Tip Din)',
            duration: '8 mins',
            content: `
**English:**
The Present Continuous (Present Progressive) is used for:
- Actions happening RIGHT NOW
- Temporary situations
- Actions in progress

Form: Subject + am/is/are + verb-ing

I am reading
You are reading
He/She/It is reading
We are reading
They are reading

Negative: Subject + am/is/are + NOT + verb-ing
Question: Am/Is/Are + Subject + verb-ing?

**Vietnamese Translation (Dch Ting Vit):**
Th Hin Ti Tip Din (Hin Ti Tip Din) c s dng :
- Hnh ng ang xy ra NGAY BY GI
- Tnh hung tm thi
- Hnh ng ang din ra

Cu trc: Ch ng + am/is/are + verb-ing

I am reading (Ti ang c)
You are reading (Bn ang c)
He/She/It is reading (Anh y/C y/N ang c)
We are reading (Chng ti ang c)
They are reading (H ang c)

Ph nh: Ch ng + am/is/are + NOT + verb-ing
Cu hi: Am/Is/Are + Ch ng + verb-ing?
            `,
            examples: [
              { 
                example: 'I am studying English right now.', 
                explanation: 'Action in progress now (Hnh ng ang din ra ngay by gi)',
                vietnamese: {
                  example: 'Ti ang hc ting Anh ngay by gi.',
                  explanation: 'Hnh ng ang din ra ngay by gi'
                }
              },
              { 
                example: 'She is playing tennis at the moment.', 
                explanation: 'Happening currently (ang xy ra hin ti)',
                vietnamese: {
                  example: 'C y ang chi tennis lc ny.',
                  explanation: 'ang xy ra hin ti'
                }
              },
              { 
                example: 'They are not watching the movie.', 
                explanation: 'Negative form (Dng ph nh)',
                vietnamese: {
                  example: 'H khng ang xem phim.',
                  explanation: 'Dng ph nh'
                }
              },
              { 
                example: 'Is he sleeping?', 
                explanation: 'Question form (Dng cu hi)',
                vietnamese: {
                  example: 'Anh y c ang ng khng?',
                  explanation: 'Dng cu hi'
                }
              },
            ],
          },
          {
            lessonId: 'pc_002',
            title: 'Verb-ing Forms & Spelling Rules (Dng Verb-ing & Quy Tc Chnh T)',
            duration: '10 mins',
            content: `
**English:**
Spelling rules for -ing:

1. Regular: Add -ing
   play  playing, read  reading

2. Verb ends in -e: Remove -e, add -ing
   dance  dancing, write  writing

3. Verb ends in consonant + vowel + consonant (CVC):
   Double the consonant, add -ing
   run  running, sit  sitting
   Exception: Single syllable only if stressed

4. Verb ends in -ie: Change to -ying
   lie  lying, die  dying

**Vietnamese Translation (Dch Ting Vit):**
Quy tc chnh t cho -ing:

1. Thng thng: Thm -ing
   play  playing, read  reading

2. Kt thc bng -e: B -e, thm -ing
   dance  dancing, write  writing

3. Kt thc bng ph m + nguyn m + ph m (CVC):
   Nhn i ph m cui, thm -ing
   run  running, sit  sitting
   Ngoi l: Ch m tit n nu nhn mnh

4. Kt thc bng -ie: i thnh -ying
   lie  lying, die  dying
            `,
            examples: [
              { 
                example: 'run  running', 
                explanation: 'Double consonant rule (CVC) (Quy tc nhn i ph m (CVC))',
                vietnamese: {
                  example: 'run  running',
                  explanation: 'Quy tc nhn i ph m (CVC)'
                }
              },
              { 
                example: 'make  making', 
                explanation: 'Remove silent e (B e cm)',
                vietnamese: {
                  example: 'make  making',
                  explanation: 'B e cm'
                }
              },
              { 
                example: 'work  working', 
                explanation: 'No doubling needed (Khng cn nhn i)',
                vietnamese: {
                  example: 'work  working',
                  explanation: 'Khng cn nhn i'
                }
              },
              { 
                example: 'swim  swimming', 
                explanation: 'Double m rule (Quy tc nhn i m)',
                vietnamese: {
                  example: 'swim  swimming',
                  explanation: 'Quy tc nhn i m'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'pc_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'She _____ TV right now. (C y _____ TV ngay by gi.)',
            options: [
              { text: 'is watching', isCorrect: true, explanation: 'Correct present continuous form (Dng th hin ti tip din ng)' },
              { text: 'watches', isCorrect: false, explanation: 'This is simple present (y l th hin ti n)' },
              { text: 'is watch', isCorrect: false, explanation: 'Missing -ing (Thiu -ing)' },
              { text: 'are watching', isCorrect: false, explanation: 'Wrong form of be (Dng be sai)' },
            ],
          },
          {
            exerciseId: 'pc_ex_002',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: 'They are _____ (swim) in the pool. (H ang _____ (bi) trong h bi.)',
            correctAnswer: 'swimming',
            hints: ['Remember the CVC rule (Nh quy tc CVC)', 'Double the m (Nhn i m)'],
            explanation: 'swim  swimming (double the final consonant before adding -ing) (swim  swimming (nhn i ph m cui trc khi thm -ing))',
          },
        ],
        vocabulary: [
          { 
            word: 'temporary', 
            meaning: 'Lasting for a short time (Ko di trong thi gian ngn)', 
            example: 'This is a temporary job. (y l cng vic tm thi.)' 
          },
          { 
            word: 'progress', 
            meaning: 'Movement towards completion (S tin b hng ti hon thnh)', 
            example: 'Work in progress. (Cng vic ang tin hnh.)' 
          },
        ],
      },

// Topic 3: Past Simple - Complete Definition
      pastSimple: {
        id: 'past_simple',
        title: 'Past Simple Tense (Th Qu Kh n)',
        difficulty: 'Beginner',
        icon: '',
        description: 'Talk about completed past actions (Ni v hnh ng qu kh  hon thnh)',
        lessons: [
          {
            lessonId: 'ps_past_001',
            title: 'Introduction to Past Simple (Gii thiu Th Qu Kh n)',
            duration: '9 mins',
            content: `
**English:**
Used for:
- Completed actions in the past
- Series of past events
- Past facts and habits

Regular verbs: Base verb + -ed
I played, she worked, they studied

Irregular verbs: Must be memorized
go  went, eat  ate, see  saw, buy  bought

Form:
Affirmative: Subject + verb-ed (or irregular)
Negative: Subject + did + not + base verb
Question: Did + Subject + base verb?

**Vietnamese Translation (Dch Ting Vit):**
S dng cho:
- Hnh ng qu kh  hon thnh
- Chui s kin qu kh
- S tht v thi quen qu kh

ng t thng thng: ng t nguyn th + -ed
I played (Ti chi), she worked (C y lm vic), they studied (H hc)

ng t bt quy tc: Phi hc thuc
go  went, eat  ate, see  saw, buy  bought

Cu trc:
Khng nh: Ch ng + verb-ed (hoc bt quy tc)
Ph nh: Ch ng + did + not + ng t nguyn th
Cu hi: Did + Ch ng + ng t nguyn th?
            `,
            examples: [
              { 
                example: 'I played football yesterday.', 
                explanation: 'Regular past simple (Th qu kh n thng thng)',
                vietnamese: {
                  example: 'Ti chi bng  hm qua.',
                  explanation: 'Th qu kh n thng thng'
                }
              },
              { 
                example: 'She went to Paris last month.', 
                explanation: 'Irregular verb (ng t bt quy tc)',
                vietnamese: {
                  example: 'C y i Paris thng trc.',
                  explanation: 'ng t bt quy tc'
                }
              },
              { 
                example: 'They did not come to the party.', 
                explanation: 'Negative past (Qu kh ph nh)',
                vietnamese: {
                  example: 'H khng n ba tic.',
                  explanation: 'Qu kh ph nh'
                }
              },
              { 
                example: 'Did you see the movie?', 
                explanation: 'Question form (Dng cu hi)',
                vietnamese: {
                  example: 'Bn c xem b phim khng?',
                  explanation: 'Dng cu hi'
                }
              },
            ],
          },
          {
            lessonId: 'ps_past_002',
            title: 'Past Simple - Regular Verbs & Spelling (Th Qu Kh n - ng T Thng & Chnh T)',
            duration: '10 mins',
            content: `
**English:**
Spelling rules for -ed:

1. Regular: Add -ed
   play  played, work  worked

2. Verb ends in -e: Add -d
   live  lived, dance  danced

3. Verb ends in consonant + y: Change y to i, add -ed
   study  studied, cry  cried

4. CVC (short vowel): Double consonant + ed
   stop  stopped (but exceptions apply)

Pronunciation: /t/, /d/, /d/

**Vietnamese Translation (Dch Ting Vit):**
Quy tc chnh t cho -ed:

1. Thng thng: Thm -ed
   play  played, work  worked

2. Kt thc bng -e: Thm -d
   live  lived, dance  danced

3. Kt thc bng ph m + y: i y thnh i, thm -ed
   study  studied, cry  cried

4. CVC (nguyn m ngn): Nhn i ph m + ed
   stop  stopped (c ngoi l)

Pht m: /t/, /d/, /d/
            `,
            examples: [
              { 
                example: 'We visited the museum.', 
                explanation: 'Regular -ed ending (Kt thc -ed thng thng)',
                vietnamese: {
                  example: 'Chng ti thm bo tng.',
                  explanation: 'Kt thc -ed thng thng'
                }
              },
              { 
                example: 'He stopped the car.', 
                explanation: 'Double consonant (Nhn i ph m)',
                vietnamese: {
                  example: 'Anh y dng xe.',
                  explanation: 'Nhn i ph m'
                }
              },
              { 
                example: 'She tried the food.', 
                explanation: 'y to i rule (Quy tc y thnh i)',
                vietnamese: {
                  example: 'C y th mn n.',
                  explanation: 'Quy tc y thnh i'
                }
              },
              { 
                example: 'They lived in Hanoi.', 
                explanation: '-e to -d (Quy tc -e thnh -d)',
                vietnamese: {
                  example: 'H sng  H Ni.',
                  explanation: '-e thnh -d'
                }
              },
            ],
          },
          {
            lessonId: 'ps_past_003',
            title: 'Past Simple - Negative & Questions (Th Qu Kh n - Ph nh & Cu Hi)',
            duration: '9 mins',
            content: `
**English:**
Negative: didn't + base verb
I didn't go. She didn't eat.

Questions: Did + subject + base verb?
Did you play? Did he work?

Short answers:
Yes, I did. / No, I didn't.
Yes, she did. / No, she didn't.

Wh-questions: What did you do? Where did they go?

**Vietnamese Translation (Dch Ting Vit):**
Ph nh: didn't + ng t nguyn th
I didn't go (Ti khng i). She didn't eat (C y khng n).

Cu hi: Did + ch ng + ng t nguyn th?
Did you play? (Bn c chi khng?) Did he work? (Anh y c lm vic khng?)

Tr li ngn:
Yes, I did. / No, I didn't. (C, ti . / Khng, ti cha.)
Yes, she did. / No, she didn't. (C, c y . / Khng, c y cha.)

Cu hi Wh: What did you do? (Bn  lm g?) Where did they go? (H  i u?)
            `,
            examples: [
              { 
                example: 'We didn\'t visit the zoo.', 
                explanation: 'Plural negative (Ph nh s nhiu)',
                vietnamese: {
                  example: 'Chng ti khng thm s th.',
                  explanation: 'Ph nh s nhiu'
                }
              },
              { 
                example: 'Did she call you?', 
                explanation: 'Yes/No question (Cu hi Yes/No)',
                vietnamese: {
                  example: 'C y c gi bn khng?',
                  explanation: 'Cu hi Yes/No'
                }
              },
              { 
                example: 'What did you eat for lunch?', 
                explanation: 'Wh-question (Cu hi Wh)',
                vietnamese: {
                  example: 'Bn  n g cho ba tra?',
                  explanation: 'Cu hi Wh'
                }
              },
              { 
                example: 'No, he didn\'t finish the book.', 
                explanation: 'Short negative answer (Tr li ph nh ngn)',
                vietnamese: {
                  example: 'Khng, anh y khng c xong cun sch.',
                  explanation: 'Tr li ph nh ngn'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'ps_past_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'Last weekend, I _____ to the beach. (Cui tun trc, ti _____ n bi bin.)',
            options: [
              { text: 'went', isCorrect: true, explanation: 'Irregular past of go (Qu kh bt quy tc ca go)' },
              { text: 'go', isCorrect: false, explanation: 'This is present tense (y l th hin ti)' },
              { text: 'going', isCorrect: false, explanation: 'This is present continuous (y l th hin ti tip din)' },
              { text: 'gone', isCorrect: false, explanation: 'This is past participle (y l phn t qu kh)' },
            ],
          },
          {
            exerciseId: 'ps_past_ex_002',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: 'She _____ (study) English last year. (C y _____ (hc) ting Anh nm ngoi.)',
            correctAnswer: 'studied',
            hints: ['Change y to i for consonant + y (i y thnh i cho ph m + y)', 'Add -ed (Thm -ed)'],
            explanation: 'study  studied (consonant + y rule) (study  studied (quy tc ph m + y))',
          },
          {
            exerciseId: 'ps_past_ex_003',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: '_____ you enjoy the party? (Bn _____ thch ba tic khng?)',
            options: [
              { text: 'Did', isCorrect: true, explanation: 'Question form with did (Dng cu hi vi did)' },
              { text: 'Do', isCorrect: false, explanation: 'This is present tense (y l th hin ti)' },
              { text: 'Does', isCorrect: false, explanation: 'Used for third person present (Dng cho ngi th ba hin ti)' },
              { text: 'Are', isCorrect: false, explanation: 'Wrong auxiliary (Tr ng t sai)' },
            ],
          },
          {
            exerciseId: 'ps_past_ex_004',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'They _____ (not/visit) the museum yesterday. (H _____ (khng thm) bo tng hm qua.)',
            correctAnswer: 'didn\'t visit',
            hints: ['Use didn\'t for negative (S dng didn\'t cho ph nh)', 'Base verb after did (ng t nguyn th sau did)'],
            explanation: 'Negative form: didn\'t + base verb (Dng ph nh: didn\'t + ng t nguyn th)',
          },
          {
            exerciseId: 'ps_past_ex_005',
            type: 'multiple_choice',
            difficulty: 'Hard',
            question: 'He _____ the book before the class started. (Anh y _____ cun sch trc khi lp hc bt u.)',
            options: [
              { text: 'read', isCorrect: true, explanation: 'Irregular past of read (Qu kh bt quy tc ca read)' },
              { text: 'reads', isCorrect: false, explanation: 'Present tense (Th hin ti)' },
              { text: 'reading', isCorrect: false, explanation: 'Present continuous (Th hin ti tip din)' },
              { text: 'had read', isCorrect: false, explanation: 'Past perfect, more advanced (Qu kh hon thnh, nng cao hn)' },
            ],
          },
        ],
        vocabulary: [
          { 
            word: 'completed', 
            meaning: 'Finished (Hon thnh)', 
            example: 'The project is completed. (D n  hon thnh.)' 
          },
          { 
            word: 'yesterday', 
            meaning: 'The day before today (Ngy hm qua)', 
            example: 'I saw him yesterday. (Ti thy anh y hm qua.)' 
          },
          { 
            word: 'event', 
            meaning: 'Something that happens (S kin xy ra)', 
            example: 'It was a happy event. ( l mt s kin vui v.)' 
          },
          { 
            word: 'habit', 
            meaning: 'Regular behavior in the past (Hnh vi thng xuyn trong qu kh)', 
            example: 'She had a reading habit as a child. (C y c thi quen c sch khi cn nh.)' 
          },
        ],
      },

      // Topic 4: Articles (a/an/the)
      articles: {
        id: 'articles',
        title: 'Articles: A, An, The (Mo T: A, An, The)',
        difficulty: 'Beginner',
        icon: '',
        description: 'Learn definite and indefinite articles (Hc mo t xc nh v khng xc nh)',
        lessons: [
          {
            lessonId: 'art_001',
            title: 'Indefinite Articles: A & An (Mo T Khng Xc nh: A & An)',
            duration: '8 mins',
            content: `
**English:**
Indefinite articles (a/an) are used for:
- First mention of a singular countable noun
- General, non-specific things
- Jobs: I am a teacher.

A before consonant sound: a book, a university
An before vowel sound: an apple, an hour

No article for plural or uncountable: I like apples. Water is important.

**Vietnamese Translation (Dch Ting Vit):**
Mo t khng xc nh (a/an) dng cho:
- Ln  cp u tin n danh t m c s t
- Nhng th chung chung, khng c th
- Ngh nghip: I am a teacher. (Ti l mt gio vin.)

A trc m ph m: a book (mt cun sch), a university (mt trng i hc)
An trc m nguyn m: an apple (mt qu to), an hour (mt gi)

Khng dng mo t cho s nhiu hoc khng m c: I like apples. (Ti thch to.) Water is important. (Nc rt quan trng.)
            `,
            examples: [
              { 
                example: 'I saw a cat in the garden.', 
                explanation: 'First mention ( cp ln u)',
                vietnamese: {
                  example: 'Ti thy mt con mo trong vn.',
                  explanation: ' cp ln u'
                }
              },
              { 
                example: 'She is an engineer.', 
                explanation: 'Job with vowel sound (Ngh nghip vi m nguyn m)',
                vietnamese: {
                  example: 'C y l mt k s.',
                  explanation: 'Ngh nghip vi m nguyn m'
                }
              },
              { 
                example: 'He wants a car.', 
                explanation: 'Consonant sound (m ph m)',
                vietnamese: {
                  example: 'Anh y mun mt chic xe hi.',
                  explanation: 'm ph m'
                }
              },
              { 
                example: 'I eat an orange every day.', 
                explanation: 'Vowel sound (m nguyn m)',
                vietnamese: {
                  example: 'Ti n mt qu cam mi ngy.',
                  explanation: 'm nguyn m'
                }
              },
            ],
          },
          {
            lessonId: 'art_002',
            title: 'Definite Article: The (Mo T Xc nh: The)',
            duration: '9 mins',
            content: `
**English:**
Definite article (the) is used for:
- Specific things both speaker and listener know
- Second mention: I saw a cat. The cat was black.
- Unique things: the sun, the moon
- Superlatives: the best book
- Geographical names: the Pacific Ocean

No the for: general plurals, uncountables, proper names (usually)

**Vietnamese Translation (Dch Ting Vit):**
Mo t xc nh (the) dng cho:
- Nhng th c th m ngi ni v nghe u bit
-  cp ln th hai: I saw a cat. The cat was black. (Ti thy mt con mo. Con mo  mu en.)
- Nhng th duy nht: the sun (mt tri), the moon (mt trng)
- Tnh t so snh nht: the best book (cun sch hay nht)
- Tn a l: the Pacific Ocean (Thi Bnh Dng)

Khng dng the cho: s nhiu chung chung, khng m c, tn ring (thng)
            `,
            examples: [
              { 
                example: 'The book on the table is mine.', 
                explanation: 'Specific book (Cun sch c th)',
                vietnamese: {
                  example: 'Cun sch trn bn l ca ti.',
                  explanation: 'Cun sch c th'
                }
              },
              { 
                example: 'Pass me the pen.', 
                explanation: 'Known object (Vt  bit)',
                vietnamese: {
                  example: 'a ti cy bt.',
                  explanation: 'Vt  bit'
                }
              },
              { 
                example: 'The tallest building in the world.', 
                explanation: 'Superlative (So snh nht)',
                vietnamese: {
                  example: 'Ta nh cao nht th gii.',
                  explanation: 'So snh nht'
                }
              },
              { 
                example: 'We visited the museum yesterday.', 
                explanation: 'Specific place (Ni c th)',
                vietnamese: {
                  example: 'Chng ti thm bo tng hm qua.',
                  explanation: 'Ni c th'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'art_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'I need _____ apple. (Ti cn _____ qu to.)',
            options: [
              { text: 'an', isCorrect: true, explanation: 'Vowel sound (m nguyn m)' },
              { text: 'a', isCorrect: false, explanation: 'Consonant sound only (Ch m ph m)' },
              { text: 'the', isCorrect: false, explanation: 'Not specific (Khng c th)' },
              { text: '-', isCorrect: false, explanation: 'For plurals, not singular (Cho s nhiu, khng phi s t)' },
            ],
          },
          {
            exerciseId: 'art_ex_002',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: '_____ sun is very hot today. (_____ mt tri rt nng hm nay.)',
            correctAnswer: 'The',
            hints: ['Unique thing (Th duy nht)', 'Definite article (Mo t xc nh)'],
            explanation: 'The for unique items like the sun (The cho nhng th duy nht nh mt tri)',
          },
          {
            exerciseId: 'art_ex_003',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'She is _____ doctor. (C y l _____ bc s.)',
            options: [
              { text: 'a', isCorrect: true, explanation: 'Job with consonant sound (Ngh nghip vi m ph m)' },
              { text: 'an', isCorrect: false, explanation: 'Vowel sound required (Cn m nguyn m)' },
              { text: 'the', isCorrect: false, explanation: 'Not specific (Khng c th)' },
              { text: '-', isCorrect: false, explanation: 'Articles needed for jobs (Cn mo t cho ngh nghip)' },
            ],
          },
          {
            exerciseId: 'art_ex_004',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: '_____ dogs are loyal animals. (_____ ch l ng vt trung thnh.)',
            correctAnswer: '-',
            hints: ['General plural (S nhiu chung chung)', 'No article (Khng dng mo t)'],
            explanation: 'No article for general plurals (Khng dng mo t cho s nhiu chung chung)',
          },
        ],
        vocabulary: [
          { 
            word: 'countable', 
            meaning: 'Can be counted (C th m c)', 
            example: 'Apples are countable. (To c th m c.)' 
          },
          { 
            word: 'uncountable', 
            meaning: 'Cannot be counted (Khng th m c)', 
            example: 'Water is uncountable. (Nc khng th m c.)' 
          },
          { 
            word: 'specific', 
            meaning: 'Particular or definite (C th hoc xc nh)', 
            example: 'The specific book I want. (Cun sch c th ti mun.)' 
          },
          { 
            word: 'general', 
            meaning: 'Not specific (Khng c th)', 
            example: 'In general, cats like milk. (Ni chung, mo thch sa.)' 
          },
        ],
      },
    },
  },
  intermediate: {
    level: 'Intermediate',
    description: 'Intermediate grammar topics for building confidence (Cc ch  ng php trung cp  xy dng s t tin)',
    topics: {
      // Topic 1: Present Perfect
      presentPerfect: {
        id: 'present_perfect',
        title: 'Present Perfect Tense (Th Hin Ti Hon Thnh)',
        difficulty: 'Intermediate',
        icon: '',
        description: 'Connect past actions to the present (Kt ni hnh ng qu kh vi hin ti)',
        lessons: [
          {
            lessonId: 'pp_001',
            title: 'Introduction to Present Perfect (Gii thiu Th Hin Ti Hon Thnh)',
            duration: '10 mins',
            content: `
**English:**
The Present Perfect is used for:
- Experiences in life (ever/never)
- Actions completed at an unspecified time
- Actions with present results
- With "for" (duration) and "since" (starting point)

Form: Subject + have/has + past participle
I have eaten. She has gone.

Negative: haven't/hasn't + past participle
Question: Have/Has + Subject + past participle?

**Vietnamese Translation (Dch Ting Vit):**
Th Hin Ti Hon Thnh dng cho:
- Kinh nghim trong i (ever/never)
- Hnh ng hon thnh  thi im khng xc nh
- Hnh ng c kt qu hin ti
- Vi "for" (thi gian ko di) v "since" (im bt u)

Cu trc: Ch ng + have/has + past participle
I have eaten (Ti  n). She has gone (C y  i).

Ph nh: haven't/hasn't + past participle
Cu hi: Have/Has + Ch ng + past participle?
            `,
            examples: [
              { 
                example: 'I have visited Paris three times.', 
                explanation: 'Life experience (Kinh nghim cuc sng)',
                vietnamese: {
                  example: 'Ti  thm Paris ba ln.',
                  explanation: 'Kinh nghim cuc sng'
                }
              },
              { 
                example: 'She has lost her keys.', 
                explanation: 'Present result (Kt qu hin ti)',
                vietnamese: {
                  example: 'C y  mt cha kha.',
                  explanation: 'Kt qu hin ti'
                }
              },
              { 
                example: 'We have lived here since 2010.', 
                explanation: 'With "since" (Vi "since")',
                vietnamese: {
                  example: 'Chng ti  sng  y t nm 2010.',
                  explanation: 'Vi "since"'
                }
              },
              { 
                example: 'They haven\'t finished the project yet.', 
                explanation: 'Negative with "yet" (Ph nh vi "yet")',
                vietnamese: {
                  example: 'H cha hon thnh d n.',
                  explanation: 'Ph nh vi "yet"'
                }
              },
            ],
          },
          {
            lessonId: 'pp_002',
            title: 'Present Perfect vs. Past Simple (Hin Ti Hon Thnh so vi Qu Kh n)',
            duration: '12 mins',
            content: `
**English:**
Present Perfect: Unspecified time, connection to now
I have seen that movie. (Sometime in life, relevant now)

Past Simple: Specific time in the past
I saw that movie yesterday. (Finished, no current link)

Time expressions:
Present Perfect: ever, never, just, already, yet, for, since
Past Simple: yesterday, last week, in 2020, ago

**Vietnamese Translation (Dch Ting Vit):**
Hin Ti Hon Thnh: Thi im khng xc nh, kt ni vi hin ti
I have seen that movie. (Mt lc no  trong i, lin quan n by gi)

Qu Kh n: Thi im c th trong qu kh
I saw that movie yesterday. ( xong, khng lin kt hin ti)

Biu thc thi gian:
Hin Ti Hon Thnh: ever, never, just, already, yet, for, since
Qu Kh n: yesterday, last week, in 2020, ago
            `,
            examples: [
              { 
                example: 'Have you ever been to Japan?', 
                explanation: 'Experience question (Cu hi kinh nghim)',
                vietnamese: {
                  example: 'Bn  tng n Nht Bn cha?',
                  explanation: 'Cu hi kinh nghim'
                }
              },
              { 
                example: 'I just ate lunch.', 
                explanation: 'Recent action (Hnh ng gn y)',
                vietnamese: {
                  example: 'Ti va n tra.',
                  explanation: 'Hnh ng gn y'
                }
              },
              { 
                example: 'He went to the store an hour ago.', 
                explanation: 'Specific past time (Thi im qu kh c th)',
                vietnamese: {
                  example: 'Anh y n ca hng mt gi trc.',
                  explanation: 'Thi im qu kh c th'
                }
              },
              { 
                example: 'She has worked here for five years.', 
                explanation: 'Duration to present (Thi gian ko di n hin ti)',
                vietnamese: {
                  example: 'C y  lm vic  y nm nm.',
                  explanation: 'Thi gian ko di n hin ti'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'pp_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'I _____ this book before. (Ti _____ cun sch ny trc y.)',
            options: [
              { text: 'have read', isCorrect: true, explanation: 'Present perfect for unspecified time (Hin ti hon thnh cho thi im khng xc nh)' },
              { text: 'read', isCorrect: false, explanation: 'Past simple needs specific time (Qu kh n cn thi im c th)' },
              { text: 'am reading', isCorrect: false, explanation: 'Present continuous for now (Hin ti tip din cho hin ti)' },
              { text: 'will read', isCorrect: false, explanation: 'Future tense (Th tng lai)' },
            ],
          },
          {
            exerciseId: 'pp_ex_002',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: 'She _____ (not/see) the movie yet. (C y _____ (cha xem) b phim.)',
            correctAnswer: 'hasn\'t seen',
            hints: ['Use has for third person (Dng has cho ngi th ba)', 'Past participle of see is seen (Phn t qu kh ca see l seen)'],
            explanation: 'Negative present perfect: hasn\'t + past participle (Ph nh hin ti hon thnh: hasn\'t + phn t qu kh)',
          },
          {
            exerciseId: 'pp_ex_003',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'We _____ in this city since 2015. (Chng ti _____  thnh ph ny t nm 2015.)',
            options: [
              { text: 'have lived', isCorrect: true, explanation: 'With "since" for duration to now (Vi "since" cho thi gian ko di n hin ti)' },
              { text: 'lived', isCorrect: false, explanation: 'Past simple for completed period (Qu kh n cho khong thi gian hon thnh)' },
              { text: 'are living', isCorrect: false, explanation: 'Present continuous without duration (Hin ti tip din khng c thi gian ko di)' },
              { text: 'will live', isCorrect: false, explanation: 'Future intention ( nh tng lai)' },
            ],
          },
          {
            exerciseId: 'pp_ex_004',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: '_____ you ever _____ (try) sushi? (Bn _____ tng _____ (th) sushi cha?)',
            correctAnswer: 'Have ... tried',
            hints: ['Question form: Have + subject + past participle (Dng cu hi: Have + ch ng + phn t qu kh)', 'Try  tried (Try  tried)'],
            explanation: 'Present perfect question for experiences (Cu hi hin ti hon thnh cho kinh nghim)',
          },
        ],
        vocabulary: [
          { 
            word: 'experience', 
            meaning: 'Something that happens to you (iu g  xy ra vi bn)', 
            example: 'Traveling is a great experience. (Du lch l mt tri nghim tuyt vi.)' 
          },
          { 
            word: 'duration', 
            meaning: 'Length of time ( di thi gian)', 
            example: 'The duration of the flight is 10 hours. (Thi lng chuyn bay l 10 gi.)' 
          },
          { 
            word: 'unspecified', 
            meaning: 'Not clearly stated (Khng c nu r)', 
            example: 'The time is unspecified. (Thi gian khng c ch nh.)' 
          },
          { 
            word: 'participle', 
            meaning: 'Verb form used in tenses (Dng ng t dng trong th)', 
            example: 'Past participle for perfect tenses. (Phn t qu kh cho th hon thnh.)' 
          },
        ],
      },

      // Topic 2: Past Continuous
      pastContinuous: {
        id: 'past_continuous',
        title: 'Past Continuous Tense (Th Qu Kh Tip Din)',
        difficulty: 'Intermediate',
        icon: '',
        description: 'Describe ongoing past actions (M t hnh ng ang din ra trong qu kh)',
        lessons: [
          {
            lessonId: 'pcont_001',
            title: 'Introduction to Past Continuous (Gii thiu Th Qu Kh Tip Din)',
            duration: '10 mins',
            content: `
**English:**
Used for:
- Actions in progress at a specific past time
- Interrupted actions (with Past Simple)
- Parallel past actions
- Background in stories

Form: Subject + was/were + verb-ing
I was reading at 8 PM. They were playing.

Negative: wasn't/weren't + verb-ing
Question: Was/Were + Subject + verb-ing?

**Vietnamese Translation (Dch Ting Vit):**
Dng cho:
- Hnh ng ang din ra ti thi im qu kh c th
- Hnh ng b gin on (vi Qu Kh n)
- Hnh ng song song trong qu kh
- Nn tng trong cu chuyn

Cu trc: Ch ng + was/were + verb-ing
I was reading at 8 PM (Ti ang c lc 8 gi ti). They were playing (H ang chi).

Ph nh: wasn't/weren't + verb-ing
Cu hi: Was/Were + Ch ng + verb-ing?
            `,
            examples: [
              { 
                example: 'I was watching TV when you called.', 
                explanation: 'Interrupted action (Hnh ng b gin on)',
                vietnamese: {
                  example: 'Ti ang xem TV khi bn gi.',
                  explanation: 'Hnh ng b gin on'
                }
              },
              { 
                example: 'They were studying at midnight.', 
                explanation: 'Specific past time (Thi im qu kh c th)',
                vietnamese: {
                  example: 'H ang hc lc na m.',
                  explanation: 'Thi im qu kh c th'
                }
              },
              { 
                example: 'While she was cooking, he was reading.', 
                explanation: 'Parallel actions (Hnh ng song song)',
                vietnamese: {
                  example: 'Trong khi c y ang nu n, anh y ang c.',
                  explanation: 'Hnh ng song song'
                }
              },
              { 
                example: 'Was it raining yesterday?', 
                explanation: 'Question form (Dng cu hi)',
                vietnamese: {
                  example: 'Tri c ma hm qua khng?',
                  explanation: 'Dng cu hi'
                }
              },
            ],
          },
          {
            lessonId: 'pcont_002',
            title: 'Past Continuous vs. Past Simple (Qu Kh Tip Din so vi Qu Kh n)',
            duration: '11 mins',
            content: `
**English:**
Past Continuous: Ongoing action
I was eating when the phone rang. (Background)

Past Simple: Completed/short action
I ate dinner at 7 PM. (Finished)

Interrupted: Past Continuous (longer) + Past Simple (shorter/interrupter)
She was walking home when it started to rain.

**Vietnamese Translation (Dch Ting Vit):**
Qu Kh Tip Din: Hnh ng ang din ra
I was eating when the phone rang. (Nn tng)

Qu Kh n: Hnh ng hon thnh/ngn
I ate dinner at 7 PM. ( xong)

B gin on: Qu Kh Tip Din (di hn) + Qu Kh n (ngn/gin on)
She was walking home when it started to rain. (C y ang i b v nh khi tri bt u ma.)
            `,
            examples: [
              { 
                example: 'He was driving when the accident happened.', 
                explanation: 'Interrupted by Past Simple (B gin on bi Qu Kh n)',
                vietnamese: {
                  example: 'Anh y ang li xe khi tai nn xy ra.',
                  explanation: 'B gin on bi Qu Kh n'
                }
              },
              { 
                example: 'We were having fun all evening.', 
                explanation: 'Ongoing past action (Hnh ng ang din ra trong qu kh)',
                vietnamese: {
                  example: 'Chng ti ang vui v sut bui ti.',
                  explanation: 'Hnh ng ang din ra trong qu kh'
                }
              },
              { 
                example: 'The children were playing while the adults were talking.', 
                explanation: 'Parallel with "while" (Song song vi "while")',
                vietnamese: {
                  example: 'Tr em ang chi trong khi ngi ln ang ni chuyn.',
                  explanation: 'Song song vi "while"'
                }
              },
              { 
                example: 'I dropped my phone while I was running.', 
                explanation: 'Cause of interruption (Nguyn nhn gin on)',
                vietnamese: {
                  example: 'Ti lm ri in thoi trong khi ang chy.',
                  explanation: 'Nguyn nhn gin on'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'pcont_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'At 5 PM yesterday, she _____ dinner. (Lc 5 gi chiu hm qua, c y _____ ba ti.)',
            options: [
              { text: 'was cooking', isCorrect: true, explanation: 'Ongoing action at specific time (Hnh ng ang din ra ti thi im c th)' },
              { text: 'cooked', isCorrect: false, explanation: 'Past simple for completed (Qu kh n cho hon thnh)' },
              { text: 'cooks', isCorrect: false, explanation: 'Present tense (Th hin ti)' },
              { text: 'has cooked', isCorrect: false, explanation: 'Present perfect (Hin ti hon thnh)' },
            ],
          },
          {
            exerciseId: 'pcont_ex_002',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: 'They _____ (play) football when it started to rain. (H _____ (chi) bng  khi tri bt u ma.)',
            correctAnswer: 'were playing',
            hints: ['Use were for plural (Dng were cho s nhiu)', 'Verb-ing form (Dng verb-ing)'],
            explanation: 'Past continuous for interrupted action (Qu kh tip din cho hnh ng b gin on)',
          },
          {
            exerciseId: 'pcont_ex_003',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: '_____ you _____ (watch) TV last night? (Bn _____ (xem) TV ti qua khng?)',
            options: [
              { text: 'Were ... watching', isCorrect: true, explanation: 'Question form for ongoing past (Dng cu hi cho hnh ng ang din ra qu kh)' },
              { text: 'Did ... watch', isCorrect: false, explanation: 'Past simple for completed (Qu kh n cho hon thnh)' },
              { text: 'Have ... watched', isCorrect: false, explanation: 'Present perfect (Hin ti hon thnh)' },
              { text: 'Are ... watching', isCorrect: false, explanation: 'Present continuous (Hin ti tip din)' },
            ],
          },
          {
            exerciseId: 'pcont_ex_004',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'While I _____ (work), my colleague _____ (call) me. (Trong khi ti _____ (lm vic), ng nghip _____ (gi) ti.)',
            correctAnswer: 'was working ... called',
            hints: ['Past continuous for longer action (Qu kh tip din cho hnh ng di)', 'Past simple for interruption (Qu kh n cho gin on)'],
            explanation: 'Combination: Past continuous + Past simple (Kt hp: Qu kh tip din + Qu kh n)',
          },
        ],
        vocabulary: [
          { 
            word: 'ongoing', 
            meaning: 'Continuing without interruption (Tip tc khng b gin on)', 
            example: 'An ongoing project. (D n ang din ra.)' 
          },
          { 
            word: 'interrupted', 
            meaning: 'Stopped suddenly (B dng t ngt)', 
            example: 'The meeting was interrupted. (Cuc hp b gin on.)' 
          },
          { 
            word: 'parallel', 
            meaning: 'Happening at the same time (Xy ra cng lc)', 
            example: 'Parallel lines never meet. (ng thng song song khng bao gi gp nhau.)' 
          },
          { 
            word: 'background', 
            meaning: 'Setting for an event (Bi cnh cho s kin)', 
            example: 'Story background. (Bi cnh cu chuyn.)' 
          },
        ],
      },

      // Topic 3: Future Forms (Will & Going To)
      futureForms: {
        id: 'future_forms',
        title: 'Future Forms: Will & Going To (Dng Tng Lai: Will & Going To)',
        difficulty: 'Intermediate',
        icon: '',
        description: 'Express future plans and predictions (By t k hoch v d on tng lai)',
        lessons: [
          {
            lessonId: 'ff_001',
            title: 'Introduction to Will (Gii thiu Will)',
            duration: '9 mins',
            content: `
**English:**
Will is used for:
- Spontaneous decisions
- Predictions without evidence
- Offers, promises, threats
- Facts about the future

Form: Subject + will + base verb
I will call you. It will rain tomorrow.

Negative: won't + base verb
Question: Will + Subject + base verb?

Contractions: I'll, you'll, he'll, etc.

**Vietnamese Translation (Dch Ting Vit):**
Will dng cho:
- Quyt nh t pht
- D on khng c bng chng
-  ngh, ha hn, e da
- S tht v tng lai

Cu trc: Ch ng + will + ng t nguyn th
I will call you (Ti s gi bn). It will rain tomorrow (Tri s ma ngy mai).

Ph nh: won't + ng t nguyn th
Cu hi: Will + Ch ng + ng t nguyn th?

Rt gn: I'll, you'll, he'll, v.v.
            `,
            examples: [
              { 
                example: 'I\'ll help you with that.', 
                explanation: 'Spontaneous offer ( ngh t pht)',
                vietnamese: {
                  example: 'Ti s gip bn vic .',
                  explanation: ' ngh t pht'
                }
              },
              { 
                example: 'The meeting will start at 10 AM.', 
                explanation: 'Scheduled fact (S tht lch trnh)',
                vietnamese: {
                  example: 'Cuc hp s bt u lc 10 gi sng.',
                  explanation: 'S tht lch trnh'
                }
              },
              { 
                example: "She won't forget your birthday.", 
                explanation: 'Promise (Ha hn)',
                vietnamese: {
                  example: 'C y s khng qun sinh nht bn.',
                  explanation: 'Ha hn'
                }
              },
              { 
                example: 'Will you come to the party?', 
                explanation: 'Question (Cu hi)',
                vietnamese: {
                  example: 'Bn s n ba tic khng?',
                  explanation: 'Cu hi'
                }
              },
            ],
          },
          {
            lessonId: 'ff_002',
            title: 'Going To for Plans & Predictions (Going To cho K Hoch & D on)',
            duration: '10 mins',
            content: `
**English:**
Going to is used for:
- Planned intentions (with evidence of preparation)
- Predictions based on present evidence
- Near future actions

Form: Subject + am/is/are + going to + base verb
I am going to study tonight. Look, it's going to rain!

Negative: am/is/are + not + going to + base verb
Question: Am/Is/Are + Subject + going to + base verb?

**Vietnamese Translation (Dch Ting Vit):**
Going to dng cho:
-  nh  ln k hoch (vi bng chng chun b)
- D on da trn bng chng hin ti
- Hnh ng tng lai gn

Cu trc: Ch ng + am/is/are + going to + ng t nguyn th
I am going to study tonight (Ti s hc ti nay). Look, it's going to rain! (Nhn ka, tri sp ma!)

Ph nh: am/is/are + not + going to + ng t nguyn th
Cu hi: Am/Is/Are + Ch ng + going to + ng t nguyn th?
            `,
            examples: [
              { 
                example: 'We are going to visit our grandparents this weekend.', 
                explanation: 'Planned intention ( nh  k hoch)',
                vietnamese: {
                  example: 'Chng ti s thm ng b cui tun ny.',
                  explanation: ' nh  k hoch'
                }
              },
              { 
                example: 'He\'s going to fall if he doesn\'t slow down.', 
                explanation: 'Prediction with evidence (D on vi bng chng)',
                vietnamese: {
                  example: 'Anh y s ng nu khng chm li.',
                  explanation: 'D on vi bng chng'
                }
              },
              { 
                example: 'Are you going to buy a new car?', 
                explanation: 'Question about plans (Cu hi v k hoch)',
                vietnamese: {
                  example: 'Bn c nh mua xe mi khng?',
                  explanation: 'Cu hi v k hoch'
                }
              },
              { 
                example: "She isn't going to attend the meeting.", 
                explanation: 'Negative plan (K hoch ph nh)',
                vietnamese: {
                  example: 'C y s khng tham d cuc hp.',
                  explanation: 'K hoch ph nh'
                }
              },
            ],
          },
          {
            lessonId: 'ff_003',
            title: 'Will vs. Going To (Will so vi Going To)',
            duration: '11 mins',
            content: `
**English:**
Will: Spontaneous, general predictions
I'll make coffee. (Decision now)
It will snow this winter. (Opinion)

Going To: Planned, evidence-based
I'm going to make coffee. (Already decided)
Look at the clouds; it's going to snow. (Evidence)

Present Continuous for fixed plans: I'm meeting him at 5 PM.

**Vietnamese Translation (Dch Ting Vit):**
Will: T pht, d on chung
I'll make coffee. (Quyt nh ngay by gi)
It will snow this winter. ( kin)

Going To:  k hoch, da trn bng chng
I'm going to make coffee. ( quyt nh trc)
Look at the clouds; it's going to snow. (Bng chng)

Hin Ti Tip Din cho k hoch c nh: I'm meeting him at 5 PM. (Ti gp anh y lc 5 gi chiu.)
            `,
            examples: [
              { 
                example: "The phone is ringing. I'll get it.", 
                explanation: 'Spontaneous decision (Quyt nh t pht)',
                vietnamese: {
                  example: 'in thoi reo. Ti s nghe.',
                  explanation: 'Quyt nh t pht'
                }
              },
              { 
                example: "I think she'll win the race.", 
                explanation: 'General prediction (D on chung)',
                vietnamese: {
                  example: 'Ti ngh c y s thng cuc ua.',
                  explanation: 'D on chung'
                }
              },
              { 
                example: "We're going to the cinema tonight.", 
                explanation: 'Fixed plan (K hoch c nh)',
                vietnamese: {
                  example: 'Chng ti s i xem phim ti nay.',
                  explanation: 'K hoch c nh'
                }
              },
              { 
                example: "Be careful; you're going to drop that.", 
                explanation: 'Evidence-based prediction (D on da trn bng chng)',
                vietnamese: {
                  example: 'Cn thn; bn sp lm ri ci .',
                  explanation: 'D on da trn bng chng'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'ff_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'Look at those clouds! It _____ rain soon. (Nhn m my ka! Tri _____ ma sm thi.)',
            options: [
              { text: 'is going to', isCorrect: true, explanation: 'Prediction with present evidence (D on vi bng chng hin ti)' },
              { text: 'will', isCorrect: false, explanation: 'General prediction, no evidence (D on chung, khng bng chng)' },
              { text: 'going to', isCorrect: false, explanation: 'Needs form of be (Cn dng ca be)' },
              { text: 'rains', isCorrect: false, explanation: 'Present tense (Th hin ti)' },
            ],
          },
          {
            exerciseId: 'ff_ex_002',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: 'I _____ (help) you with your homework. (Ti _____ (gip) bn lm bi tp.)',
            correctAnswer: 'will help',
            hints: ['Spontaneous offer ( ngh t pht)', 'Will + base verb (Will + ng t nguyn th)'],
            explanation: 'Will for offers (Will cho  ngh)',
          },
          {
            exerciseId: 'ff_ex_003',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'We _____ to Paris next summer. (Chng ti _____ n Paris h ti.)',
            options: [
              { text: 'are going', isCorrect: true, explanation: 'Planned future with present continuous (Tng lai k hoch vi hin ti tip din)' },
              { text: 'will go', isCorrect: false, explanation: 'Spontaneous, not planned (T pht, khng k hoch)' },
              { text: 'go', isCorrect: false, explanation: 'Present tense (Th hin ti)' },
              { text: 'went', isCorrect: false, explanation: 'Past tense (Th qu kh)' },
            ],
          },
          {
            exerciseId: 'ff_ex_004',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: '_____ you _____ (finish) the report by tomorrow? (Bn _____ (hon thnh) bo co trc ngy mai khng?)',
            correctAnswer: 'Will ... finish',
            hints: ['Question with will (Cu hi vi will)', 'For predictions or promises (Cho d on hoc ha hn)'],
            explanation: 'Will question form (Dng cu hi will)',
          },
          {
            exerciseId: 'ff_ex_005',
            type: 'multiple_choice',
            difficulty: 'Hard',
            question: 'I promise I _____ (not/tell) anyone your secret. (Ti ha ti _____ (khng k) b mt ca bn vi ai.)',
            options: [
              { text: 'won\'t tell', isCorrect: true, explanation: 'Promise with will negative (Ha hn vi will ph nh)' },
              { text: 'am not telling', isCorrect: false, explanation: 'Present continuous (Hin ti tip din)' },
              { text: 'don\'t tell', isCorrect: false, explanation: 'Present simple (Hin ti n)' },
              { text: 'won\'t telling', isCorrect: false, explanation: 'Wrong form (Dng sai)' },
            ],
          },
        ],
        vocabulary: [
          { 
            word: 'prediction', 
            meaning: 'Statement about the future (Tuyn b v tng lai)', 
            example: 'Weather prediction. (D bo thi tit.)' 
          },
          { 
            word: 'intention', 
            meaning: 'Plan to do something (K hoch lm g )', 
            example: 'Good intentions. ( nh tt.)' 
          },
          { 
            word: 'spontaneous', 
            meaning: 'Done without planning (Lm m khng lp k hoch)', 
            example: 'Spontaneous trip. (Chuyn i t pht.)' 
          },
          { 
            word: 'evidence', 
            meaning: 'Proof or signs (Bng chng hoc du hiu)', 
            example: 'No evidence found. (Khng tm thy bng chng.)' 
          },
        ],
      },

      // Topic 4: First Conditional
      firstConditional: {
        id: 'first_conditional',
        title: 'First Conditional (Cu iu Kin Loi 1)',
        difficulty: 'Intermediate',
        icon: '',
        description: 'Real possibilities in the future (Kh nng thc t trong tng lai)',
        lessons: [
          {
            lessonId: 'fc_001',
            title: 'Introduction to First Conditional (Gii thiu Cu iu Kin Loi 1)',
            duration: '9 mins',
            content: `
**English:**
Used for real or likely situations in the future.
If + Present Simple, will + base verb
If it rains, we will stay home.

Can use other modals: may, might, can, etc.
If you study, you can pass the exam.

Order can be reversed: We will stay home if it rains.

**Vietnamese Translation (Dch Ting Vit):**
Dng cho tnh hung thc t hoc c kh nng xy ra trong tng lai.
If + Hin Ti n, will + ng t nguyn th
If it rains, we will stay home. (Nu tri ma, chng ti s  nh.)

C th dng modal khc: may, might, can, v.v.
If you study, you can pass the exam. (Nu bn hc, bn c th  k thi.)

C th o ngc: We will stay home if it rains. (Chng ti s  nh nu tri ma.)
            `,
            examples: [
              { 
                example: 'If you heat water to 100C, it boils.', 
                explanation: 'General truth (S tht chung)',
                vietnamese: {
                  example: 'Nu bn un nc n 100C, n si.',
                  explanation: 'S tht chung'
                }
              },
              { 
                example: 'If I see her, I will tell her.', 
                explanation: 'Future possibility (Kh nng tng lai)',
                vietnamese: {
                  example: 'Nu ti gp c y, ti s ni vi c y.',
                  explanation: 'Kh nng tng lai'
                }
              },
              { 
                example: 'We might go out if the weather improves.', 
                explanation: 'With modal "might" (Vi modal "might")',
                vietnamese: {
                  example: 'Chng ti c th ra ngoi nu thi tit tt hn.',
                  explanation: 'Vi modal "might"'
                }
              },
              { 
                example: 'Call me if you need help.', 
                explanation: 'Reversed order (o ngc th t)',
                vietnamese: {
                  example: 'Gi ti nu bn cn gip .',
                  explanation: 'o ngc th t'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'fc_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'If it _____ tomorrow, we will cancel the picnic. (Nu tri _____ ngy mai, chng ti s hy picnic.)',
            options: [
              { text: 'rains', isCorrect: true, explanation: 'Present simple in if-clause (Hin ti n trong mnh  if)' },
              { text: 'will rain', isCorrect: false, explanation: 'No will in if-clause for first conditional (Khng dng will trong mnh  if cho loi 1)' },
              { text: 'rained', isCorrect: false, explanation: 'Past tense for second conditional (Qu kh cho loi 2)' },
              { text: 'is raining', isCorrect: false, explanation: 'Present continuous not standard here (Hin ti tip din khng chun  y)' },
            ],
          },
          {
            exerciseId: 'fc_ex_002',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: 'If you _____ (study) hard, you _____ (pass) the exam. (Nu bn _____ (hc) chm, bn _____ () k thi.)',
            correctAnswer: 'study ... will pass',
            hints: ['Present simple in if (Hin ti n trong if)', 'Will in main clause (Will trong mnh  chnh)'],
            explanation: 'Standard first conditional structure (Cu trc cu iu kin loi 1 chun)',
          },
        ],
        vocabulary: [
          { 
            word: 'possibility', 
            meaning: 'Chance of happening (Kh nng xy ra)', 
            example: 'High possibility of rain. (Kh nng ma cao.)' 
          },
          { 
            word: 'likely', 
            meaning: 'Probably true (C l ng)', 
            example: 'It\'s likely to happen. (C l s xy ra.)' 
          },
          { 
            word: 'clause', 
            meaning: 'Part of a sentence (Phn ca cu)', 
            example: 'If-clause. (Mnh  if.)' 
          },
        ],
      },

      // Topic 5: Comparatives and Superlatives
      comparativesSuperlatives: {
        id: 'comparatives_superlatives',
        title: 'Comparatives and Superlatives (So Snh Hn v So Snh Nht)',
        difficulty: 'Intermediate',
        icon: '',
        description: 'Compare things and people (So snh s vt v con ngi)',
        lessons: [
          {
            lessonId: 'cs_001',
            title: 'Forming Comparatives (Hnh Thnh So Snh Hn)',
            duration: '10 mins',
            content: `
**English:**
Short adjectives (1 syllable): adj + -er + than
tall  taller than

Long adjectives (2+ syllables): more + adj + than
beautiful  more beautiful than

Irregular: good  better, bad  worse, far  farther/further

As...as for equality: as tall as

**Vietnamese Translation (Dch Ting Vit):**
Tnh t ngn (1 m tit): adj + -er + than
tall  taller than (cao hn)

Tnh t di (2+ m tit): more + adj + than
beautiful  more beautiful than (p hn)

Bt quy tc: good  better (tt hn), bad  worse (t hn), far  farther/further (xa hn)

As...as cho bng nhau: as tall as (cao bng)
            `,
            examples: [
              { 
                example: 'This book is more interesting than that one.', 
                explanation: 'Long adjective (Tnh t di)',
                vietnamese: {
                  example: 'Cun sch ny th v hn cun kia.',
                  explanation: 'Tnh t di'
                }
              },
              { 
                example: 'She runs faster than me.', 
                explanation: 'Short adjective (Tnh t ngn)',
                vietnamese: {
                  example: 'C y chy nhanh hn ti.',
                  explanation: 'Tnh t ngn'
                }
              },
              { 
                example: 'My phone is as good as yours.', 
                explanation: 'Equality (Bng nhau)',
                vietnamese: {
                  example: 'in thoi ca ti tt bng ca bn.',
                  explanation: 'Bng nhau'
                }
              },
              { 
                example: 'This test was worse than the last one.', 
                explanation: 'Irregular (Bt quy tc)',
                vietnamese: {
                  example: 'Bi kim tra ny t hn ln trc.',
                  explanation: 'Bt quy tc'
                }
              },
            ],
          },
          {
            lessonId: 'cs_002',
            title: 'Forming Superlatives (Hnh Thnh So Snh Nht)',
            duration: '10 mins',
            content: `
**English:**
Short adjectives: the + adj + -est
tall  the tallest

Long adjectives: the most + adj
beautiful  the most beautiful

Irregular: good  the best, bad  the worst, far  the farthest/furthest

In a group: the tallest in the class

**Vietnamese Translation (Dch Ting Vit):**
Tnh t ngn: the + adj + -est
tall  the tallest (cao nht)

Tnh t di: the most + adj
beautiful  the most beautiful (p nht)

Bt quy tc: good  the best (tt nht), bad  the worst (t nht), far  the farthest/furthest (xa nht)

Trong nhm: the tallest in the class (cao nht lp)
            `,
            examples: [
              { 
                example: 'Mount Everest is the highest mountain.', 
                explanation: 'Short adjective (Tnh t ngn)',
                vietnamese: {
                  example: 'Ni Everest l ngn ni cao nht.',
                  explanation: 'Tnh t ngn'
                }
              },
              { 
                example: 'This is the most expensive car in the showroom.', 
                explanation: 'Long adjective (Tnh t di)',
                vietnamese: {
                  example: 'y l chic xe t nht trong showroom.',
                  explanation: 'Tnh t di'
                }
              },
              { 
                example: 'She is the best student in school.', 
                explanation: 'Irregular (Bt quy tc)',
                vietnamese: {
                  example: 'C y l hc sinh gii nht trng.',
                  explanation: 'Bt quy tc'
                }
              },
              { 
                example: "That was the worst movie I've ever seen.", 
                explanation: 'Irregular negative (Bt quy tc ph nh)',
                vietnamese: {
                  example: ' l b phim t nht ti tng xem.',
                  explanation: 'Bt quy tc ph nh'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'cs_ex_001',
            type: 'multiple_choice',
            difficulty: 'Easy',
            question: 'My house is _____ (big) than yours. (Nh ti _____ (ln) hn nh bn.)',
            options: [
              { text: 'bigger', isCorrect: true, explanation: 'Short adjective + -er (Tnh t ngn + -er)' },
              { text: 'more big', isCorrect: false, explanation: 'For long adjectives only (Ch cho tnh t di)' },
              { text: 'biggest', isCorrect: false, explanation: 'Superlative, not comparative (So snh nht, khng phi hn)' },
              { text: 'as big', isCorrect: false, explanation: 'For equality (Cho bng nhau)' },
            ],
          },
          {
            exerciseId: 'cs_ex_002',
            type: 'fill_blank',
            difficulty: 'Medium',
            question: 'This is _____ (good) book in the library. (y l _____ (hay) sch nht trong th vin.)',
            correctAnswer: 'the best',
            hints: ['Irregular superlative (So snh nht bt quy tc)', 'The + superlative (The + so snh nht)'],
            explanation: 'Good  the best (Good  tt nht)',
          },
          {
            exerciseId: 'cs_ex_003',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'She is not as _____ (tall) as her sister. (C y khng _____ (cao) bng ch gi.)',
            options: [
              { text: 'tall', isCorrect: true, explanation: 'As...as for equality (As...as cho bng nhau)' },
              { text: 'taller', isCorrect: false, explanation: 'Comparative (So snh hn)' },
              { text: 'the tallest', isCorrect: false, explanation: 'Superlative (So snh nht)' },
              { text: 'more tall', isCorrect: false, explanation: 'Wrong form (Dng sai)' },
            ],
          },
          {
            exerciseId: 'cs_ex_004',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'The weather today is _____ (bad) than yesterday. (Thi tit hm nay _____ (t) hn hm qua.)',
            correctAnswer: 'worse',
            hints: ['Irregular comparative (So snh hn bt quy tc)', 'Bad  worse (Bad  t hn)'],
            explanation: 'Irregular form for bad (Dng bt quy tc cho bad)',
          },
        ],
        vocabulary: [
          { 
            word: 'adjective', 
            meaning: 'Word describing a noun (T miu t danh t)', 
            example: 'Beautiful adjective. (Tnh t p.)' 
          },
          { 
            word: 'equality', 
            meaning: 'Being the same (Bng nhau)', 
            example: 'Equality in height. (Bng nhau v chiu cao.)' 
          },
          { 
            word: 'irregular', 
            meaning: 'Not following the usual rule (Khng theo quy tc thng thng)', 
            example: 'Irregular verb. (ng t bt quy tc.)' 
          },
          { 
            word: 'syllable', 
            meaning: 'Unit of pronunciation (n v pht m)', 
            example: 'One-syllable word. (T mt m tit.)' 
          },
        ],
      },
    },
  },
  advanced: {
    level: 'Advanced',
    description: 'Advanced grammar topics for fluency and nuance (Cc ch  ng php nng cao  t s lu lot v tinh t)',
    topics: {
      // Topic 1: Past Perfect and Past Perfect Continuous
      pastPerfectContinuous: {
        id: 'past_perfect_continuous',
        title: 'Past Perfect and Past Perfect Continuous (Qu Kh Hon Thnh v Qu Kh Hon Thnh Tip Din)',
        difficulty: 'Advanced',
        icon: '',
        description: 'Express earlier past actions and ongoing past states (By t hnh ng qu kh trc  v trng thi qu kh ang din ra)',
        lessons: [
          {
            lessonId: 'ppc_001',
            title: 'Past Perfect: Completed Actions Before Another Past Action (Qu Kh Hon Thnh: Hnh ng Hon Thnh Trc Hnh ng Qu Kh Khc)',
            duration: '12 mins',
            content: `
**English:**
Past Perfect: Actions completed before another past action
By the time we arrived, the movie had started.

Form: Subject + had + past participle
Negative: hadn't + past participle
Question: Had + Subject + past participle?

Used in reported speech for past tenses and third conditional.

**Vietnamese Translation (Dch Ting Vit):**
Qu Kh Hon Thnh: Hnh ng hon thnh trc hnh ng qu kh khc
By the time we arrived, the movie had started. (Khi chng ti n, b phim  bt u.)

Cu trc: Ch ng + had + past participle
Ph nh: hadn't + past participle
Cu hi: Had + Ch ng + past participle?

Dng trong li ni gin tip cho th qu kh v iu kin loi 3.
            `,
            examples: [
              { 
                example: 'She had finished her homework before dinner.', 
                explanation: 'Completed before another past event (Hon thnh trc s kin qu kh khc)',
                vietnamese: {
                  example: 'C y  lm xong bi tp trc ba ti.',
                  explanation: 'Hon thnh trc s kin qu kh khc'
                }
              },
              { 
                example: 'They hadn\'t eaten when the guests arrived.',                explanation: 'Negative form (Dng ph nh)',
                vietnamese: {
                  example: 'H cha n khi khch n.',
                  explanation: 'Dng ph nh'
                }
              },
              { 
                example: 'Had you seen the news before the meeting?', 
                explanation: 'Question form (Dng cu hi)',
                vietnamese: {
                  example: 'Bn  xem tin tc trc cuc hp cha?',
                  explanation: 'Dng cu hi'
                }
              },
              { 
                example: 'If I had known, I would have helped.', 
                explanation: 'In third conditional (Trong iu kin loi 3)',
                vietnamese: {
                  example: 'Nu ti bit, ti  gip.',
                  explanation: 'Trong iu kin loi 3'
                }
              },
            ],
          },
          {
            lessonId: 'ppc_002',
            title: 'Past Perfect Continuous: Ongoing Actions Before Another Past Action (Qu Kh Hon Thnh Tip Din: Hnh ng ang Din Ra Trc Hnh ng Qu Kh Khc)',
            duration: '13 mins',
            content: `
**English:**
Past Perfect Continuous: Ongoing actions before another past point, emphasizing duration or cause
She was tired because she had been working all day.

Form: Subject + had been + verb-ing
Negative: hadn't been + verb-ing
Question: Had + Subject + been + verb-ing?

Often with for/since; explains effects like "wet from rain."

**Vietnamese Translation (Dch Ting Vit):**
Qu Kh Hon Thnh Tip Din: Hnh ng ang din ra trc im qu kh khc, nhn mnh thi lng hoc nguyn nhn
She was tired because she had been working all day. (C y mt v  lm vic c ngy.)

Cu trc: Ch ng + had been + verb-ing
Ph nh: hadn't been + verb-ing
Cu hi: Had + Ch ng + been + verb-ing?

Thng vi for/since; gii thch hiu ng nh "wet from rain" (t v ma).
            `,
            examples: [
              { 
                example: 'They had been waiting for hours when the train finally arrived.', 
                explanation: 'Duration before past event (Thi lng trc s kin qu kh)',
                vietnamese: {
                  example: 'H  ch hng gi khi tu cui cng n.',
                  explanation: 'Thi lng trc s kin qu kh'
                }
              },
              { 
                example: 'He hadn\'t been sleeping well, so he was exhausted.', 
                explanation: 'Cause of past state (Nguyn nhn ca trng thi qu kh)',
                vietnamese: {
                  example: 'Anh y cha ng ngon, nn mt mi.',
                  explanation: 'Nguyn nhn ca trng thi qu kh'
                }
              },
              { 
                example: 'How long had you been studying English before moving abroad?', 
                explanation: 'Question with duration (Cu hi vi thi lng)',
                vietnamese: {
                  example: 'Bn  hc ting Anh bao lu trc khi chuyn ra nc ngoi?',
                  explanation: 'Cu hi vi thi lng'
                }
              },
              { 
                example: 'The ground was wet because it had been raining.', 
                explanation: 'Explaining effect (Gii thch hiu ng)',
                vietnamese: {
                  example: 'Mt t t v  ma.',
                  explanation: 'Gii thch hiu ng'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'ppc_ex_001',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'By the time the police arrived, the thief _____ away. (Khi cnh st n, tn trm _____ mt.)',
            options: [
              { text: 'had run', isCorrect: true, explanation: 'Past perfect for completion before past event (Qu kh hon thnh cho hon thnh trc s kin qu kh)' },
              { text: 'ran', isCorrect: false, explanation: 'Past simple for simultaneous actions (Qu kh n cho hnh ng ng thi)' },
              { text: 'was running', isCorrect: false, explanation: 'Past continuous for ongoing (Qu kh tip din cho ang din ra)' },
              { text: 'has run', isCorrect: false, explanation: 'Present perfect not for past sequence (Hin ti hon thnh khng cho chui qu kh)' },
            ],
          },
          {
            exerciseId: 'ppc_ex_002',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'She was crying because she _____ (cry) for hours. (C y khc v  _____ (khc) hng gi.)',
            correctAnswer: 'had been crying',
            hints: ['Past perfect continuous for duration causing effect (Qu kh hon thnh tip din cho thi lng gy hiu ng)', 'Had been + verb-ing (Had been + verb-ing)'],
            explanation: 'Emphasizes ongoing action leading to past result (Nhn mnh hnh ng ang din ra dn n kt qu qu kh)',
          },
          {
            exerciseId: 'ppc_ex_003',
            type: 'multiple_choice',
            difficulty: 'Hard',
            question: 'If we _____ (know) about the storm, we would have stayed home. (Nu chng ti _____ (bit) v cn bo, chng ti   nh.)',
            options: [
              { text: 'had known', isCorrect: true, explanation: 'Past perfect in third conditional (Qu kh hon thnh trong iu kin loi 3)' },
              { text: 'knew', isCorrect: false, explanation: 'Past simple for second conditional (Qu kh n cho loi 2)' },
              { text: 'have known', isCorrect: false, explanation: 'Present perfect for real condition (Hin ti hon thnh cho iu kin thc t)' },
              { text: 'had been knowing', isCorrect: false, explanation: 'Stative verbs not continuous (ng t trng thi khng dng tip din)' },
            ],
          },
        ],
        vocabulary: [
          { 
            word: 'sequence', 
            meaning: 'Order of events (Trnh t s kin)', 
            example: 'Past events in sequence. (S kin qu kh theo trnh t.)' 
          },
          { 
            word: 'duration', 
            meaning: 'Length of time something continues ( di thi gian iu g  tip tc)', 
            example: 'Duration of the meeting. (Thi lng cuc hp.)' 
          },
          { 
            word: 'emphasize', 
            meaning: 'To highlight or stress (Nhn mnh)', 
            example: 'Emphasize the importance. (Nhn mnh tm quan trng.)' 
          },
          { 
            word: 'effect', 
            meaning: 'Result of an action (Kt qu ca hnh ng)', 
            example: 'Side effect of medicine. (Tc dng ph ca thuc.)' 
          },
        ],
      },

      // Topic 2: Second and Third Conditionals
      secondThirdConditionals: {
        id: 'second_third_conditionals',
        title: 'Second and Third Conditionals (Cu iu Kin Loi 2 v Loi 3)',
        difficulty: 'Advanced',
        icon: '',
        description: 'Hypothetical and unreal situations (Tnh hung gi nh v khng thc t)',
        lessons: [
          {
            lessonId: 'stc_001',
            title: 'Second Conditional: Unreal Present/Future (iu Kin Loi 2: Hin Ti/Tng Lai Khng Thc)',
            duration: '11 mins',
            content: `
**English:**
Second Conditional: Unreal or unlikely situations in present/future
If + Past Simple, would + base verb
If I won the lottery, I would travel the world.

For advice/imagination: If I were you, I would apologize.

Mixed: Past affecting present: If I had studied harder, I would be successful now.

**Vietnamese Translation (Dch Ting Vit):**
iu Kin Loi 2: Tnh hung khng thc hoc kh xy ra  hin ti/tng lai
If + Qu Kh n, would + ng t nguyn th
If I won the lottery, I would travel the world. (Nu ti trng s, ti s du lch th gii.)

Cho li khuyn/tng tng: If I were you, I would apologize. (Nu l bn, ti s xin li.)

Kt hp: Qu kh nh hng hin ti: If I had studied harder, I would be successful now. (Nu ti hc chm hn, gi ti  thnh cng.)
            `,
            examples: [
              { 
                example: 'If it rained, we would cancel the game.', 
                explanation: 'Unlikely future (Tng lai kh xy ra)',
                vietnamese: {
                  example: 'Nu tri ma, chng ti s hy trn u.',
                  explanation: 'Tng lai kh xy ra'
                }
              },
              { 
                example: 'If I were rich, I would buy a yacht.', 
                explanation: 'Unreal present with "were" (Hin ti khng thc vi "were")',
                vietnamese: {
                  example: 'Nu ti giu, ti s mua du thuyn.',
                  explanation: 'Hin ti khng thc vi "were"'
                }
              },
              { 
                example: 'She would help if she had time.', 
                explanation: 'Reversed order (o ngc th t)',
                vietnamese: {
                  example: 'C y s gip nu c thi gian.',
                  explanation: 'o ngc th t'
                }
              },
              { 
                example: 'If I had won the race, I would feel proud now.', 
                explanation: 'Mixed conditional (iu kin kt hp)',
                vietnamese: {
                  example: 'Nu ti thng cuc ua, gi ti  t ho.',
                  explanation: 'iu kin kt hp'
                }
              },
            ],
          },
          {
            lessonId: 'stc_002',
            title: 'Third Conditional: Unreal Past (iu Kin Loi 3: Qu Kh Khng Thc)',
            duration: '12 mins',
            content: `
**English:**
Third Conditional: Hypothetical past situations and regrets
If + Past Perfect, would have + past participle
If I had studied, I would have passed the exam.

For criticism/regret: If you had listened, this wouldn't have happened.

Could have/Might have for possibilities: If we had left earlier, we could have caught the train.

**Vietnamese Translation (Dch Ting Vit):**
iu Kin Loi 3: Tnh hung gi nh qu kh v hi tic
If + Qu Kh Hon Thnh, would have + past participle
If I had studied, I would have passed the exam. (Nu ti hc, ti   k thi.)

Cho ph phn/hi tic: If you had listened, this wouldn't have happened. (Nu bn nghe, chuyn ny  khng xy ra.)

Could have/Might have cho kh nng: If we had left earlier, we could have caught the train. (Nu chng ti i sm, chng ti  bt kp tu.)
            `,
            examples: [
              { 
                example: 'If she had called, I would have answered.', 
                explanation: 'Unreal past action (Hnh ng qu kh khng thc)',
                vietnamese: {
                  example: 'Nu c y gi, ti  tr li.',
                  explanation: 'Hnh ng qu kh khng thc'
                }
              },
              { 
                example: 'We wouldn\'t have gotten lost if we had used the map.', 
                explanation: 'Negative result (Kt qu ph nh)',
                vietnamese: {
                  example: 'Chng ti  khng lc nu dng bn .',
                  explanation: 'Kt qu ph nh'
                }
              },
              { 
                example: 'If he had been careful, he might have avoided the accident.', 
                explanation: 'With "might have" for possibility (Vi "might have" cho kh nng)',
                vietnamese: {
                  example: 'Nu anh y cn thn, anh y  trnh c tai nn.',
                  explanation: 'Vi "might have" cho kh nng'
                }
              },
              { 
                example: 'I wish I had learned Spanish earlier.', 
                explanation: 'Regret with third conditional implication (Hi tic ng  iu kin loi 3)',
                vietnamese: {
                  example: 'c g ti hc ting Ty Ban Nha sm hn.',
                  explanation: 'Hi tic ng  iu kin loi 3'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'stc_ex_001',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'If I _____ you, I _____ the job offer. (Nu l bn, ti _____ li  ngh cng vic.)',
            options: [
              { text: 'were ... would accept', isCorrect: true, explanation: 'Second conditional for advice (Loi 2 cho li khuyn)' },
              { text: 'am ... accept', isCorrect: false, explanation: 'Present tenses for real situations (Hin ti cho tnh hung thc t)' },
              { text: 'had been ... had accepted', isCorrect: false, explanation: 'Third conditional for past (Loi 3 cho qu kh)' },
              { text: 'will be ... will accept', isCorrect: false, explanation: 'First conditional for likely future (Loi 1 cho tng lai c th)' },
            ],
          },
          {
            exerciseId: 'stc_ex_002',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'If we _____ (not/miss) the bus, we _____ (arrive) on time. (Nu chng ti _____ (khng tr) xe but, chng ti _____ (n) ng gi.)',
            correctAnswer: 'hadn\'t missed ... would have arrived',
            hints: ['Past perfect in if-clause (Qu kh hon thnh trong mnh  if)', 'Would have + past participle in main clause (Would have + past participle trong mnh  chnh)'],
            explanation: 'Third conditional for unreal past (Loi 3 cho qu kh khng thc)',
          },
          {
            exerciseId: 'stc_ex_003',
            type: 'multiple_choice',
            difficulty: 'Hard',
            question: 'If she _____ harder last year, she _____ a promotion now. (Nu c y _____ chm ch nm ngoi, gi c y _____ thng chc.)',
            options: [
              { text: 'had worked ... would have', isCorrect: true, explanation: 'Mixed third-second conditional (Kt hp loi 3-2)' },
              { text: 'worked ... would have', isCorrect: false, explanation: 'Inconsistent tenses (Th khng nht qun)' },
              { text: 'works ... will have', isCorrect: false, explanation: 'First conditional structure (Cu trc loi 1)' },
              { text: 'had worked ... would work', isCorrect: false, explanation: 'Close, but main clause should be present for mixed (Mnh  chnh nn l hin ti cho kt hp)' },
            ],
          },
        ],
        vocabulary: [
          { 
            word: 'hypothetical', 
            meaning: 'Based on an imagined situation (Da trn tnh hung tng tng)', 
            example: 'Hypothetical scenario. (Tnh hung gi nh.)' 
          },
          { 
            word: 'regret', 
            meaning: 'Feeling sorry about the past (Cm gic tic nui v qu kh)', 
            example: 'No regrets in life. (Khng hi tic trong i.)' 
          },
          { 
            word: 'implication', 
            meaning: 'Something suggested but not directly stated (iu g  gi  nhng khng ni trc tip)', 
            example: 'Hidden implication. ( ngm.)' 
          },
          { 
            word: 'criticism', 
            meaning: 'Expression of disapproval (By t s khng tn thnh)', 
            example: 'Constructive criticism. (Ph bnh mang tnh xy dng.)' 
          },
        ],
      },

      // Topic 3: Reported Speech
      reportedSpeech: {
        id: 'reported_speech',
        title: 'Reported Speech (Li Ni Gin Tip)',
        difficulty: 'Advanced',
        icon: '',
        description: 'Convert direct speech to indirect forms (Chuyn li ni trc tip sang gin tip)',
        lessons: [
          {
            lessonId: 'rs_001',
            title: 'Statements and Questions in Reported Speech (Cu Trn Thut v Cu Hi trong Li Ni Gin Tip)',
            duration: '12 mins',
            content: `
**English:**
Reported Speech: Backshift tenses for past reporting
Direct: "I am tired," he said.  Reported: He said he was tired.

Tense changes: Present Simple  Past Simple; Will  Would; Present Continuous  Past Continuous.

Questions: Say/Ask + if/whether (Yes/No); Wh-questions keep Wh-word.
Direct: "Where are you?"  He asked where I was.

No backshift if reporting verb is present or truth/universal.

**Vietnamese Translation (Dch Ting Vit):**
Li Ni Gin Tip: Li th cho bo co qu kh
Direct: "I am tired," he said.  Reported: He said he was tired. (Anh y ni anh y mt.)

Thay i th: Hin Ti n  Qu Kh n; Will  Would; Hin Ti Tip Din  Qu Kh Tip Din.

Cu hi: Say/Ask + if/whether (Yes/No); Cu hi Wh gi Wh-word.
Direct: "Where are you?"  He asked where I was. (Anh y hi ti  u.)

Khng li th nu ng t bo co  hin ti hoc s tht/v thi.
            `,
            examples: [
              { 
                example: '"I will go tomorrow," she said.  She said she would go the next day.', 
                explanation: 'Future to conditional + time shift (Tng lai thnh iu kin + dch thi gian)',
                vietnamese: {
                  example: 'C y ni c y s i ngy hm sau.',
                  explanation: 'Tng lai thnh iu kin + dch thi gian'
                }
              },
              { 
                example: '"Do you like coffee?" he asked.  He asked if I liked coffee.', 
                explanation: 'Yes/No question (Cu hi Yes/No)',
                vietnamese: {
                  example: 'Anh y hi ti c thch c ph khng.',
                  explanation: 'Cu hi Yes/No'
                }
              },
              { 
                example: '"What time is it?"  She asked what time it was.', 
                explanation: 'Wh-question (Cu hi Wh)',
                vietnamese: {
                  example: 'C y hi gi l my gi.',
                  explanation: 'Cu hi Wh'
                }
              },
              { 
                example: 'He says, "The Earth is round."  He says the Earth is round.', 
                explanation: 'No backshift for universal truth (Khng li th cho s tht ph qut)',
                vietnamese: {
                  example: 'Anh y ni Tri t trn.',
                  explanation: 'Khng li th cho s tht ph qut'
                }
              },
            ],
          },
          {
            lessonId: 'rs_002',
            title: 'Commands, Requests, and Suggestions in Reported Speech (Lnh, Yu Cu, v Gi  trong Li Ni Gin Tip)',
            duration: '11 mins',
            content: `
**English:**
Commands/Requests: Tell/Ask + object + infinitive
Direct: "Close the door!"  He told me to close the door.
Negative: "Don't touch it!"  She told him not to touch it.

Suggestions: Suggest + gerund or that-clause
Direct: "Let's go!"  He suggested going. / He suggested that we go.

Reporting verbs: Advise, warn, recommend, etc., with specific patterns.

Time/place words: Here  there; Now  then; This  that.

**Vietnamese Translation (Dch Ting Vit):**
Lnh/Yu Cu: Tell/Ask + tn ng + to infinitive
Direct: "Close the door!"  He told me to close the door. (Anh y bo ti ng ca.)
Ph nh: "Don't touch it!"  She told him not to touch it. (C y bo anh y ng chm.)

Gi : Suggest + gerund hoc that-clause
Direct: "Let's go!"  He suggested going. / He suggested that we go. (Anh y gi  chng ta i.)

ng t bo co: Advise, warn, recommend, v.v., vi mu c th.

T thi gian/ni chn: Here  there; Now  then; This  that.
            `,
            examples: [
              { 
                example: '"Please sit down," the teacher said.  The teacher asked us to sit down.', 
                explanation: 'Polite request (Yu cu lch s)',
                vietnamese: {
                  example: 'Thy c yu cu chng ti ngi xung.',
                  explanation: 'Yu cu lch s'
                }
              },
              { 
                example: '"You should see a doctor," she said.  She advised me to see a doctor.', 
                explanation: 'Advice with "advise" (Li khuyn vi "advise")',
                vietnamese: {
                  example: 'C y khuyn ti gp bc s.',
                  explanation: 'Li khuyn vi "advise"'
                }
              },
              { 
                example: '"Why don\'t we eat out?"  He suggested eating out.', 
                explanation: 'Suggestion with gerund (Gi  vi gerund)',
                vietnamese: {
                  example: 'Anh y gi  n ngoi.',
                  explanation: 'Gi  vi gerund'
                }
              },
              { 
                example: '"Be careful!"  She warned me to be careful.', 
                explanation: 'Warning (Cnh bo)',
                vietnamese: {
                  example: 'C y cnh bo ti cn thn.',
                  explanation: 'Cnh bo'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'rs_ex_001',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'Direct: "I\'m leaving now."  Reported: She said she _____ now.',
            options: [
              { text: 'was leaving then', isCorrect: true, explanation: 'Backshift + time word change (Li th + i t thi gian)' },
              { text: 'is leaving now', isCorrect: false, explanation: 'No backshift needed only for present reporting (Khng li th ch cho bo co hin ti)' },
              { text: 'leaves now', isCorrect: false, explanation: 'Incorrect tense shift (Li th sai)' },
              { text: 'will leave then', isCorrect: false, explanation: 'Wrong future form (Dng tng lai sai)' },
            ],
          },
          {
            exerciseId: 'rs_ex_002',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'Direct: "Don\'t forget your keys!"  He told me _____ my keys. (Direct: "ng qun cha kha!")',
            correctAnswer: 'not to forget',
            hints: ['Tell + object + not to infinitive (Tell + tn ng + not to infinitive)', 'Negative command (Lnh ph nh)'],
            explanation: 'Reported command structure (Cu trc lnh gin tip)',
          },
          {
            exerciseId: 'rs_ex_003',
            type: 'multiple_choice',
            difficulty: 'Hard',
            question: 'Direct: "Shall we start?"  He suggested _____.',
            options: [
              { text: 'starting', isCorrect: true, explanation: 'Suggest + gerund (Suggest + gerund)' },
              { text: 'to start', isCorrect: false, explanation: 'Infinitive for other verbs like advise (To infinitive cho ng t khc nh advise)' },
              { text: 'that we start', isCorrect: false, explanation: 'Alternative that-clause, but gerund is direct (That-clause thay th, nhng gerund trc tip hn)' },
              { text: 'we starting', isCorrect: false, explanation: 'Incorrect structure (Cu trc sai)' },
            ],
          },
        ],
        vocabulary: [
          { 
            word: 'backshift', 
            meaning: 'Changing tenses in reported speech (Thay i th trong li ni gin tip)', 
            example: 'Tense backshift rules. (Quy tc li th.)' 
          },
          { 
            word: 'infinitive', 
            meaning: 'Base form of verb (Dng nguyn th ca ng t)', 
            example: 'To infinitive after tell. (To infinitive sau tell.)' 
          },
          { 
            word: 'gerund', 
            meaning: 'Verb-ing as noun (Verb-ing nh danh t)', 
            example: 'Suggest + gerund. (Suggest + gerund.)' 
          },
          { 
            word: 'universal', 
            meaning: 'True for all time (ng cho mi thi gian)', 
            example: 'Universal truth. (S tht ph qut.)' 
          },
        ],
      },

      // Topic 4: Passive Voice
      passiveVoice: {
        id: 'passive_voice',
        title: 'Passive Voice (Th B ng)',
        difficulty: 'Advanced',
        icon: '',
        description: 'Focus on the action or receiver rather than the doer (Tp trung vo hnh ng hoc ngi nhn hn l ngi thc hin)',
        lessons: [
          {
            lessonId: 'pv_001',
            title: 'Forming Passives Across Tenses (Hnh Thnh Th B ng Qua Cc Th)',
            duration: '12 mins',
            content: `
**English:**
Passive: Object becomes subject + be + past participle (+ by agent)
Present Simple: The book is read by students.
Past Simple: The window was broken.
Present Perfect: The report has been finished.

Future: Will be done; Modals: Must be completed.

No agent if unknown/irrelevant; Get-passive for informal: The car got stolen.

**Vietnamese Translation (Dch Ting Vit):**
Th B ng: Tn ng thnh ch ng + be + past participle (+ by agent)
Hin Ti n: The book is read by students. (Cun sch c c bi hc sinh.)
Qu Kh n: The window was broken. (Ca s b v.)
Hin Ti Hon Thnh: The report has been finished. (Bo co  c hon thnh.)

Tng Lai: Will be done; Modal: Must be completed. (Phi c hon thnh.)

Khng dng agent nu khng bit/khng quan trng; Get-passive cho thn mt: The car got stolen. (Xe b nh cp.)
            `,
            examples: [
              { 
                example: 'The cake was eaten by the children.', 
                explanation: 'Past simple passive (Qu kh n b ng)',
                vietnamese: {
                  example: 'Chic bnh b tr em n.',
                  explanation: 'Qu kh n b ng'
                }
              },
              { 
                example: 'English is spoken in many countries.', 
                explanation: 'Present simple passive (Hin ti n b ng)',
                vietnamese: {
                  example: 'Ting Anh c ni  nhiu quc gia.',
                  explanation: 'Hin ti n b ng'
                }
              },
              { 
                example: 'The letter will be sent tomorrow.', 
                explanation: 'Future passive (Tng lai b ng)',
                vietnamese: {
                  example: 'L th s c gi ngy mai.',
                  explanation: 'Tng lai b ng'
                }
              },
              { 
                example: 'This problem must be solved immediately.', 
                explanation: 'Modal passive (Modal b ng)',
                vietnamese: {
                  example: 'Vn  ny phi c gii quyt ngay.',
                  explanation: 'Modal b ng'
                }
              },
            ],
          },
          {
            lessonId: 'pv_002',
            title: 'Advanced Uses: Causative and Impersonal Passives (S Dng Nng Cao: Th Gy Ra v Th B ng Phi C Nhn)',
            duration: '13 mins',
            content: `
**English:**
Causative: Have/Get something done (arrange for others to do)
I had my car repaired. (Someone repaired it for me.)

Impersonal: It is said that...; People think...  It is thought that...
Used in formal writing; He is believed to be innocent.

Passives with reporting verbs: It was reported that the economy improved.

Double object: Give someone something  Something was given to someone.

**Vietnamese Translation (Dch Ting Vit):**
Th Gy Ra: Have/Get something done (sp xp cho ngi khc lm)
I had my car repaired. (Ti nh sa xe.) (Ai  sa gip ti.)

Phi C Nhn: It is said that...; People think...  It is thought that... (c cho l...)
Dng trong vit trang trng; He is believed to be innocent. (Anh y c cho l v ti.)

B ng vi ng t bo co: It was reported that the economy improved. (c bo co rng kinh t ci thin.)

i tng kp: Give someone something  Something was given to someone. (Th g  c a cho ai .)
            `,
            examples: [
              { 
                example: 'She got her hair cut yesterday.', 
                explanation: 'Informal causative (Th gy ra thn mt)',
                vietnamese: {
                  example: 'C y nh ct tc hm qua.',
                  explanation: 'Th gy ra thn mt'
                }
              },
              { 
                example: 'It is believed that climate change is accelerating.', 
                explanation: 'Impersonal passive (B ng phi c nhn)',
                vietnamese: {
                  example: 'c cho rng bin i kh hu ang tng tc.',
                  explanation: 'B ng phi c nhn'
                }
              },
              { 
                example: 'The news was announced to the public.', 
                explanation: 'Passive with reporting verb (B ng vi ng t bo co)',
                vietnamese: {
                  example: 'Tin tc c thng bo cho cng chng.',
                  explanation: 'B ng vi ng t bo co'
                }
              },
              { 
                example: 'A gift was given to her by the committee.', 
                explanation: 'Double object passive (B ng i tng kp)',
                vietnamese: {
                  example: 'Mn qu c y ban tng c y.',
                  explanation: 'B ng i tng kp'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'pv_ex_001',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'The book _____ by the author last year. (Cun sch _____ bi tc gi nm ngoi.)',
            options: [
              { text: 'was written', isCorrect: true, explanation: 'Past simple passive (Qu kh n b ng)' },
              { text: 'wrote', isCorrect: false, explanation: 'Active voice (Th ch ng)' },
              { text: 'is written', isCorrect: false, explanation: 'Present passive (Hin ti b ng)' },
              { text: 'has written', isCorrect: false, explanation: 'Present perfect active (Hin ti hon thnh ch ng)' },
            ],
          },
          {
            exerciseId: 'pv_ex_002',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'I need to _____ my computer _____; it\'s broken. (Ti cn _____ my tnh _____; n hng.)',
            correctAnswer: 'have ... repaired',
            hints: ['Causative have + object + past participle (Th gy ra have + tn ng + past participle)'],
            explanation: 'Causative structure for arranging service (Cu trc gy ra cho sp xp dch v)',
          },
          {
            exerciseId: 'pv_ex_003',
            type: 'multiple_choice',
            difficulty: 'Hard',
            question: 'It _____ that the meeting has been postponed. (c _____ rng cuc hp b hon.)',
            options: [
              { text: 'is reported', isCorrect: true, explanation: 'Impersonal passive with reporting verb (B ng phi c nhn vi ng t bo co)' },
              { text: 'reports', isCorrect: false, explanation: 'Active form (Th ch ng)' },
              { text: 'reported', isCorrect: false, explanation: 'Missing "is" for present (Thiu "is" cho hin ti)' },
              { text: 'will report', isCorrect: false, explanation: 'Future active (Tng lai ch ng)' },
            ],
          },
        ],
        vocabulary: [
          { 
            word: 'agent', 
            meaning: 'The doer in passive (Ngi thc hin trong b ng)', 
            example: 'By the agent. (Bi ngi thc hin.)' 
          },
          { 
            word: 'participle', 
            meaning: 'Past form in passive (Dng qu kh trong b ng)', 
            example: 'Past participle required. (Cn phn t qu kh.)' 
          },
          { 
            word: 'causative', 
            meaning: 'Structure for causing an action (Cu trc cho gy ra hnh ng)', 
            example: 'Causative have. (Th gy ra have.)' 
          },
          { 
            word: 'impersonal', 
            meaning: 'General or formal without specific subject (Chung chung hoc trang trng khng c ch ng c th)', 
            example: 'Impersonal construction. (Cu trc phi c nhn.)' 
          },
        ],
      },

      // Topic 5: Relative Clauses
      relativeClauses: {
        id: 'relative_clauses',
        title: 'Relative Clauses (Mnh  Quan H)',
        difficulty: 'Advanced',
        icon: '',
        description: 'Define or add information with who, which, that, etc. (Xc nh hoc thm thng tin vi who, which, that, v.v.)',
        lessons: [
          {
            lessonId: 'rc_001',
            title: 'Defining and Non-Defining Relative Clauses (Mnh  Quan H Xc nh v Khng Xc nh)',
            duration: '12 mins',
            content: `
**English:**
Defining: Essential info, no commas (restricts meaning)
The man who lives next door is friendly. (Specifies which man)

Non-Defining: Extra info, commas (adds detail)
My brother, who lives in London, is visiting. (Assumes one brother)

Relative pronouns: Who (people), Which (things), That (both, defining only), Whose (possession).

Omission: In defining, omit if object: The book (which) I read was great.

**Vietnamese Translation (Dch Ting Vit):**
Xc nh: Thng tin thit yu, khng du phy (hn ch  ngha)
The man who lives next door is friendly. (Ngi n ng sng cnh nh thn thin.) (Ch r ngi no)

Khng Xc nh: Thng tin thm, c du phy (thm chi tit)
My brother, who lives in London, is visiting. (Anh trai ti, sng  London, ang thm.) (Gi nh mt anh trai)

i t quan h: Who (ngi), Which (vt), That (c hai, ch xc nh), Whose (s hu).

B: Trong xc nh, b nu tn ng: The book (which) I read was great. (Cun sch ti c hay.)
            `,
            examples: [
              { 
                example: 'The car that broke down was mine.', 
                explanation: 'Defining clause (Mnh  xc nh)',
                vietnamese: {
                  example: 'Chic xe hng l ca ti.',
                  explanation: 'Mnh  xc nh'
                }
              },
              { 
                example: 'Paris, which is the capital of France, is beautiful.', 
                explanation: 'Non-defining clause (Mnh  khng xc nh)',
                vietnamese: {
                  example: 'Paris, th  Php, rt p.',
                  explanation: 'Mnh  khng xc nh'
                }
              },
              { 
                example: 'The woman whose dog bit me apologized.', 
                explanation: 'Possessive "whose" (S hu "whose")',
                vietnamese: {
                  example: 'Ngi ph n c con ch cn ti  xin li.',
                  explanation: 'S hu "whose"'
                }
              },
              { 
                example: 'This is the house we bought last year.', 
                explanation: 'Omitted relative pronoun (B i t quan h)',
                vietnamese: {
                  example: 'y l ngi nh chng ti mua nm ngoi.',
                  explanation: 'B i t quan h'
                }
              },
            ],
          },
          {
            lessonId: 'rc_002',
            title: 'Reduced Relative Clauses and Prepositions (Mnh  Quan H Rt Gn v Gii T)',
            duration: '13 mins',
            content: `
**English:**
Reduced: Participles replace clauses
The man living next door  The man who lives next door.
Past: The book written by him (which was written).

Prepositions: At end (informal) or front (formal)
The house (which) we live in. / The house in which we live.

Whose with things: The company whose shares fell.

Contact clauses: Informal defining without pronoun/preposition.

**Vietnamese Translation (Dch Ting Vit):**
Rt Gn: Phn t thay th mnh 
The man living next door  The man who lives next door. (Ngi n ng sng cnh nh.)
Qu kh: The book written by him (Cun sch c vit bi anh y.)

Gii t: Cui (thn mt) hoc u (trang trng)
The house (which) we live in. / The house in which we live. (Ngi nh chng ti sng trong.)

Whose vi vt: The company whose shares fell. (Cng ty c c phiu gim.)

Contact clauses: Xc nh thn mt khng i t/gii t.
            `,
            examples: [
              { 
                example: 'The students studying abroad miss home.', 
                explanation: 'Present participle reduced (Phn t hin ti rt gn)',
                vietnamese: {
                  example: 'Hc sinh hc nc ngoi nh nh.',
                  explanation: 'Phn t hin ti rt gn'
                }
              },
              { 
                example: 'The painting stolen from the museum was recovered.', 
                explanation: 'Past participle reduced (Phn t qu kh rt gn)',
                vietnamese: {
                  example: 'Bc tranh b nh cp t bo tng  c ly li.',
                  explanation: 'Phn t qu kh rt gn'
                }
              },
              { 
                example: 'The city in which I grew up is changing.', 
                explanation: 'Preposition at front (Gii t  u)',
                vietnamese: {
                  example: 'Thnh ph ti ln ln ang thay i.',
                  explanation: 'Gii t  u'
                }
              },
              { 
                example: 'The software whose bugs were fixed works better.', 
                explanation: 'Whose with thing (Whose vi vt)',
                vietnamese: {
                  example: 'Phn mm sa li chy tt hn.',
                  explanation: 'Whose vi vt'
                }
              },
            ],
          },
        ],
        exercises: [
          {
            exerciseId: 'rc_ex_001',
            type: 'multiple_choice',
            difficulty: 'Medium',
            question: 'The restaurant, _____ serves Italian food, is always crowded. (Nh hng, _____ phc v mn , lun ng.)',
            options: [
              { text: 'which', isCorrect: true, explanation: 'Non-defining relative pronoun (i t quan h khng xc nh)' },
              { text: 'that', isCorrect: false, explanation: 'That only for defining (That ch cho xc nh)' },
              { text: 'who', isCorrect: false, explanation: 'Who for people (Who cho ngi)' },
              { text: 'whose', isCorrect: false, explanation: 'Whose for possession (Whose cho s hu)' },
            ],
          },
          {
            exerciseId: 'rc_ex_002',
            type: 'fill_blank',
            difficulty: 'Hard',
            question: 'The girl _____ I met yesterday is my cousin. (C gi _____ ti gp hm qua l em h ti.)',
            correctAnswer: 'who/that',
            hints: ['Defining clause for people (Mnh  xc nh cho ngi)', 'Who or that (Who hoc that)'],
            explanation: 'Defining relative clause (Mnh  quan h xc nh)',
          },
          {
            exerciseId: 'rc_ex_003',
            type: 'multiple_choice',
            difficulty: 'Hard',
            question: 'The keys _____ on the table belong to John. (Chm cha kha _____ trn bn thuc v John.)',
            options: [
              { text: 'found', isCorrect: true, explanation: 'Reduced past participle (Rt gn phn t qu kh)' },
              { text: 'finding', isCorrect: false, explanation: 'Present participle for active (Phn t hin ti cho ch ng)' },
              { text: 'which found', isCorrect: false, explanation: 'Full clause needed if not reduced (Cn mnh  y  nu khng rt gn)' },
              { text: 'who found', isCorrect: false, explanation: 'Who for people (Who cho ngi)' },
            ],
          },
        ],
        vocabulary: [
          { 
            word: 'restrictive', 
            meaning: 'Defining or limiting (Xc nh hoc hn ch)', 
            example: 'Restrictive clause. (Mnh  hn ch.)' 
          },
          { 
            word: 'non-restrictive', 
            meaning: 'Additional, non-essential (Thm vo, khng thit yu)', 
            example: 'Non-restrictive info. (Thng tin khng hn ch.)' 
          },
          { 
            word: 'omission', 
            meaning: 'Leaving out (B qua)', 
            example: 'Pronoun omission. (B i t.)' 
          },
          { 
            word: 'preposition', 
            meaning: 'Word showing relation (T ch mi quan h)', 
            example: 'Preposition in clause. (Gii t trong mnh .)' 
          },
        ],
      },
    },
  },
};

// Export helper function to get grammar data by level
export const getGrammarByLevel = (level) => {
  const levelLower = level.toLowerCase();
  if (levelLower === 'beginner') return GRAMMAR_DATA.beginner;
  if (levelLower === 'intermediate') return GRAMMAR_DATA.intermediate;
  if (levelLower === 'advanced') return GRAMMAR_DATA.advanced;
  return null;
};

// Get all lesson IDs for a level (for progress per level)
export const getLessonIdsByLevel = (level) => {
  const data = getGrammarByLevel(level);
  if (!data?.topics) return [];
  const ids = [];
  Object.values(data.topics).forEach(topic => {
    (topic.lessons || []).forEach(lesson => ids.push(lesson.lessonId));
  });
  return ids;
};

// Get all lesson IDs for given topic ids across all levels (for quiz readiness)
export const getLessonIdsForTopicIds = (topicIds) => {
  const ids = new Set();
  Object.values(GRAMMAR_DATA).forEach(level => {
    if (!level.topics) return;
    Object.values(level.topics).forEach(topic => {
      if (topicIds.includes(topic.id) && topic.lessons) {
        topic.lessons.forEach(lesson => ids.add(lesson.lessonId));
      }
    });
  });
  return Array.from(ids);
};

// Export helper function to get all topics
export const getAllTopics = () => {
  const topics = [];
  Object.values(GRAMMAR_DATA).forEach(level => {
    Object.values(level.topics).forEach(topic => {
      topics.push(topic);
    });
  });
  return topics;
};

// Export helper function to search lessons
export const searchLessons = (keyword) => {
  const results = [];
  Object.values(GRAMMAR_DATA).forEach(level => {
    Object.values(level.topics).forEach(topic => {
      if (topic.title.toLowerCase().includes(keyword.toLowerCase()) ||
          topic.description.toLowerCase().includes(keyword.toLowerCase())) {
        results.push(topic);
      }
      topic.lessons.forEach(lesson => {
        if (lesson.title.toLowerCase().includes(keyword.toLowerCase())) {
          results.push({ ...topic, lesson });
        }
      });
    });
  });
  return results;
};

// Export helper to get exercises by difficulty
export const getExercisesByDifficulty = (topic, difficulty) => {
  return topic.exercises.filter(ex => ex.difficulty === difficulty);
};

// Quiz data structure for testing multiple topics
export const GRAMMAR_QUIZZES = [
  {
    quizId: 'quiz_beginner_1',
    title: 'Beginner Grammar Quiz - Present Tenses (Bi Kim Tra Ng Php Ngi Mi - Cc Th Hin Ti)',
    difficulty: 'Beginner',
    duration: 20,
    passingScore: 70,
    topics: ['present_simple', 'present_continuous'],
    questions: [
      {
        id: 'q1',
        question: 'She _____ in a hospital. (C y _____ trong bnh vin.)',
        type: 'multiple_choice',
        options: [
          { text: 'work', isCorrect: false },
          { text: 'works', isCorrect: true },
          { text: 'is working', isCorrect: false },
          { text: 'worked', isCorrect: false },
        ],
        explanation: 'Third person singular present simple needs -s: works (Ngi th ba s t th hin ti n cn -s: works)',
      },
      {
        id: 'q2',
        question: 'What are they doing right now? (H ang lm g ngay by gi?)',
        type: 'multiple_choice',
        options: [
          { text: 'study', isCorrect: false },
          { text: 'studies', isCorrect: false },
          { text: 'studying', isCorrect: true },
          { text: 'studied', isCorrect: false },
        ],
        explanation: 'Present continuous for current action: are + studying (Hin ti tip din cho hnh ng hin ti: are + studying)',
      },
    ],
  },
  {
    quizId: 'quiz_intermediate_1',
    title: 'Intermediate Quiz - Perfect Tenses & Modals (Bi Kim Tra Trung Cp - Cc Th Hon Thnh & Modal)',
    difficulty: 'Intermediate',
    duration: 30,
    passingScore: 75,
    topics: ['present_perfect', 'modals'],
    questions: [
      {
        id: 'q1',
        question: 'I _____ to Paris three times in my life. (Ti _____ n Paris ba ln trong i.)',
        type: 'multiple_choice',
        options: [
          { text: 'have been', isCorrect: true },
          { text: 'went', isCorrect: false },
          { text: 'am going', isCorrect: false },
          { text: 'was', isCorrect: false },
        ],
        explanation: 'Present perfect for life experiences: have + been (Hin ti hon thnh cho kinh nghim cuc sng: have + been)',
      },
      {
        id: 'q2',
        question: 'You _____ eat in the library. It\'s against the rules. (Bn _____ n trong th vin. iu ny vi phm quy nh.)',
        type: 'multiple_choice',
        options: [
          { text: 'can', isCorrect: false },
          { text: 'could', isCorrect: false },
          { text: 'mustn\'t', isCorrect: true },
          { text: 'don\'t have to', isCorrect: false },
        ],
        explanation: 'Prohibition/rules: mustn\'t (Cm on/quy tc: mustn\'t)',
      },
    ],
  },
  {
    quizId: 'quiz_advanced_1',
    title: 'Advanced Quiz - Passive Voice & Reported Speech (Bi Kim Tra Nng Cp - Cu Th ng & Cu Gin Tip)',
    difficulty: 'Advanced',
    duration: 40,
    passingScore: 80,
    topics: ['passive_voice', 'reported_speech'],
    questions: [
      {
        id: 'q1',
        question: 'The project _____ by the team leader last week. (D n _____ bi trng nhm tun trc.)',
        type: 'multiple_choice',
        options: [
          { text: 'was completed', isCorrect: true },
          { text: 'has been completed', isCorrect: false },
          { text: 'was being completed', isCorrect: false },
          { text: 'completed', isCorrect: false },
        ],
        explanation: 'Past simple passive: was + past participle (Qu kh n th ng: was + phn t qu kh)',
      },
      {
        id: 'q2',
        question: 'She said she _____ the movie yesterday. (C y ni c y _____ b phim hm qua.)',
        type: 'multiple_choice',
        options: [
          { text: 'has watched', isCorrect: false },
          { text: 'had watched', isCorrect: true },
          { text: 'watched', isCorrect: false },
          { text: 'watch', isCorrect: false },
        ],
        explanation: 'Reported speech: past simple becomes past perfect (Cu gin tip: qu kh n tr thnh qu kh hon thnh)',
      },
    ],
  },
];

// Progress tracking data structure
export const GRAMMAR_PROGRESS_TEMPLATE = {
  userId: '',
  completedLessons: [],
  completedExercises: [],
  quizScores: [],
  topicProgress: {}, // topicId: { completed: bool, progress: 0-100 }
  totalPoints: 0,
  level: 'Beginner',
  streak: 0,
  lastAccessDate: null,
};

// Difficulty levels and their characteristics
export const DIFFICULTY_LEVELS = {
  Easy: {
    color: '#10b981', // green
    icon: '',
    description: 'Perfect for beginners (Hon ho cho ngi mi)',
  },
  Medium: {
    color: '#f59e0b', // amber
    icon: '',
    description: 'Intermediate level (Cp trung cp)',
  },
  Hard: {
    color: '#ef4444', // red
    icon: '',
    description: 'Advanced challenges (Th thch nng cao)',
  },
};

// Common mistakes and explanations
export const COMMON_MISTAKES = [
  {
    id: 'mistake_1',
    mistake: 'I am go to school.',
    correct: 'I go to school.',
    explanation: 'Don\'t use am/is/are + base verb. Use am/is/are + -ing for present continuous or just base verb for present simple. (ng dng am/is/are + ng t nguyn th. Dng am/is/are + -ing cho hin ti tip din hoc ch ng t nguyn th cho hin ti n.)',
    topic: 'present_simple',
  },
  {
    id: 'mistake_2',
    mistake: 'She have completed the work.',
    correct: 'She has completed the work.',
    explanation: 'With third person singular (she, he, it), use "has" not "have". (Vi ngi th ba s t (she, he, it), dng "has" khng phi "have".)',
    topic: 'present_perfect',
  },
  {
    id: 'mistake_3',
    mistake: 'If I would know, I would tell you.',
    correct: 'If I knew, I would tell you.',
    explanation: 'In second conditional (if clause), use past simple, not would + verb. (Trong cu iu kin loi 2 (mnh  if), dng qu kh n, khng phi would + ng t.)',
    topic: 'conditionals',
  },
  {
    id: 'mistake_4',
    mistake: 'I told him to not come.',
    correct: 'I told him not to come.',
    explanation: 'Negative infinitive: not + to + verb (ng t nguyn th ph nh: not + to + ng t)',
    topic: 'modals',
  },
  {
    id: 'mistake_5',
    mistake: 'The car was stolen by someone unknown.',
    correct: 'The car was stolen.',
    explanation: 'When agent is unknown or unimportant, omit the "by" phrase. (Khi ngi lm khng r hoc khng quan trng, b cm "by".)',
    topic: 'passive_voice',
  },
];

// Study tips and strategies
export const STUDY_TIPS = [
  {
    id: 'tip_1',
    title: 'Use Context Clues (S dng Gi  Ng Cnh)',
    description: 'Always look for time expressions (yesterday, now, tomorrow) to determine the correct tense. (Lun tm biu thc thi gian (hm qua, by gi, ngy mai)  xc nh th ng.)',
    relatedTopics: ['present_simple', 'past_simple', 'future_simple'],
  },
  {
    id: 'tip_2',
    title: 'Practice Conjugation (Luyn Chia ng T)',
    description: 'Regular conjugation practice helps internalize verb forms. Create flashcards for irregular verbs. (Luyn chia ng t thng xuyn gip ghi nh dng ng t. To flashcard cho ng t bt quy tc.)',
    relatedTopics: ['present_simple', 'past_simple', 'present_perfect'],
  },
  {
    id: 'tip_3',
    title: 'Active to Passive Conversion (Chuyn T Ch ng Sang Th ng)',
    description: 'Practice converting sentences from active to passive voice to understand structure better. (Luyn chuyn cu t ch ng sang th ng  hiu cu trc tt hn.)',
    relatedTopics: ['passive_voice'],
  },
  {
    id: 'tip_4',
    title: 'Dialogue Practice (Luyn i Thoi)',
    description: 'Practice reported speech by writing dialogues, then converting them to reported speech. (Luyn cu gin tip bng cch vit i thoi, sau  chuyn sang gin tip.)',
    relatedTopics: ['reported_speech'],
  },
  {
    id: 'tip_5',
    description: 'Conditional Mind Mapping (Lp Bn  T Duy iu Kin)',
    description: 'Create a mind map showing when to use each conditional type based on likelihood and time. (To bn  t duy cho thy khi no dng tng loi iu kin da trn kh nng v thi gian.)',
    relatedTopics: ['conditionals'],
  },
];

// Real-world examples for context
export const REAL_WORLD_EXAMPLES = [
  {
    id: 'example_1',
    context: 'Job Interview (Phng Vn Vic Lm)',
    original: 'I work in software development.',
    explanation: 'Present simple for current job/role (Hin ti n cho cng vic/hin ti)',
    topic: 'present_simple',
  },
  {
    id: 'example_2',
    context: 'News Report (Bo Co Tin Tc)',
    original: 'The bridge has been damaged by recent floods.',
    explanation: 'Passive voice for factual reporting (Th ng cho bo co s tht)',
    topic: 'passive_voice',
  },
  {
    id: 'example_3',
    context: 'Chat with Friend (Tr Chuyn Vi Bn)',
    original: 'I\'m writing an email right now.',
    explanation: 'Present continuous for current activity (Hin ti tip din cho hot ng hin ti)',
    topic: 'present_continuous',
  },
  {
    id: 'example_4',
    context: 'Business Meeting (Cuc Hp Kinh Doanh)',
    original: 'If we don\'t receive payment by Friday, we\'ll cancel the contract.',
    explanation: 'First conditional for realistic future scenario (Loi 1 cho tnh hung tng lai thc t)',
    topic: 'conditionals',
  },
  {
    id: 'example_5',
    context: 'Academic Writing (Vit Hc Thut)',
    original: 'The rapid development of artificial intelligence has revolutionized industries.',
    explanation: 'Present perfect + nominalization for formal writing (Hin ti hon thnh + danh t ha cho vit trang trng)',
    topic: 'present_perfect',
  },
];

export default GRAMMAR_DATA;
</file>

<file path="src/data/intermediateData.js">
export const intermediate = {
  level: 'Intermediate',
  description: 'Intermediate grammar topics for building fluency',
  topics: {
    // Topic 1: Present Perfect
    presentPerfect: {
      id: 'present_perfect',
      title: 'Present Perfect Tense',
      difficulty: 'Intermediate',
      icon: '',
      description: 'Connect past actions with the present',
      lessons: [
        {
          lessonId: 'pf_001',
          title: 'Introduction to Present Perfect',
          duration: '10 mins',
          content: `
            Present Perfect connects past and present:
           
            Used for:
            - Recent past actions with present relevance
            - Life experiences (have you ever...?)
            - Changes over time
            - Actions that started in past, continue now
           
            Form: have/has + past participle
            I have seen, he has gone, they have studied
           
            Regular verbs: -ed form (played, worked)
            Irregular verbs: Special form (gogone, eateaten, seeseen)
           
            Negative: have/has + not + past participle
            He has not finished (hasn't finished)
           
            Question: Have/Has + Subject + past participle?
            Have you finished? Has she arrived?
          `,
          examples: [
            { example: 'I have lived here for 5 years.', explanation: 'Action started in past, continues' },
            { example: 'She has never been to Japan.', explanation: 'Life experience' },
            { example: 'They have already eaten lunch.', explanation: 'Recent past action' },
            { example: 'Have you finished your homework?', explanation: 'Question form' },
          ],
        },
        {
          lessonId: 'pf_002',
          title: 'Present Perfect vs Simple Past',
          duration: '11 mins',
          content: `
            Key Differences:
           
            Present Perfect (have + past participle):
            - Used for recent past or life experiences
            - No specific time is mentioned (or recently)
            - Impact on present is important
           
            Simple Past (regular -ed):
            - Used for completed past actions
            - Specific time is mentioned (yesterday, last year, ago)
            - Focus on when it happened
           
            Examples:
            Present Perfect: I have lost my keys. (Looking for them now)
            Simple Past: I lost my keys yesterday. (Specific time given)
           
            Present Perfect: She has visited Paris. (Life experience)
            Simple Past: She visited Paris in 2019. (When = important)
           
            Time expressions:
            Present Perfect: just, recently, already, yet, for, since, ever, never
            Simple Past: yesterday, last week, 10 years ago, in 2020, at 3 PM
          `,
          examples: [
            { example: 'I have seen that movie. (General - no time)', explanation: 'Life experience' },
            { example: 'I saw that movie last week. (Specific time)', explanation: 'When is important' },
            { example: 'She has just arrived. (Recent)', explanation: 'Just = recently' },
            { example: 'They have worked here since 2015. (Duration)', explanation: 'For/since: duration' },
          ],
        },
        {
          lessonId: 'pf_003',
          title: 'Irregular Past Participles',
          duration: '12 mins',
          content: `
            Common Irregular Verbs:
           
            go  gone
            come  come
            eat  eaten
            see  seen
            drink  drunk
            write  written
            give  given
            take  taken
            make  made
            break  broken
            choose  chosen
            do  done
            have  had
            know  known
            meet  met
            pay  paid
            read  read
            run  run
            say  said
            send  sent
            speak  spoken
            spend  spent
            steal  stolen
            swim  swum
            teach  taught
            think  thought
            understand  understood
            wear  worn
            win  won
          `,
          examples: [
            { example: 'I have written a letter.', explanation: 'write  written' },
            { example: 'She has broken her arm.', explanation: 'break  broken' },
            { example: 'They have taken the exam.', explanation: 'take  taken' },
            { example: 'He has never been to Australia.', explanation: 'be  been' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'pf_ex_001',
          type: 'multiple_choice',
          difficulty: 'Medium',
          question: 'I _____ to three countries so far.',
          options: [
            { text: 'have been', isCorrect: true, explanation: 'Present perfect for life experience' },
            { text: 'went', isCorrect: false, explanation: 'Simple past - would need specific dates' },
            { text: 'am going', isCorrect: false, explanation: 'This is future/present continuous' },
            { text: 'will go', isCorrect: false, explanation: 'This is future' },
          ],
        },
        {
          exerciseId: 'pf_ex_002',
          type: 'fill_blank',
          difficulty: 'Medium',
          question: 'She _____ (finish) her project yet?',
          correctAnswer: 'has finished',
          hints: ['Use present perfect for recent past', 'With "yet" use have/has'],
          explanation: 'Present perfect: has + past participle. "Yet" indicates incomplete until now.',
        },
      ],
    },
    // Topic 2: Past Perfect
    pastPerfect: {
      id: 'past_perfect',
      title: 'Past Perfect Tense',
      difficulty: 'Intermediate',
      icon: '',
      description: 'Show which past action happened first',
      lessons: [
        {
          lessonId: 'pp_001',
          title: 'Introduction to Past Perfect',
          duration: '10 mins',
          content: `
            Past Perfect shows sequence of two past events:
            Which happened FIRST?
           
            Form: had + past participle
            I had eaten, she had gone, they had studied
           
            Used for:
            - Action completed before another past action
            - Reported speech (said that he had...)
            - Result of a past action
           
            Timeline:
            Event 1 (earlier)  had + past participle
            Event 2 (later)  simple past
           
            Example:
            When I arrived, she had already left.
            (She left first  had left)
            (I arrived second  arrived)
          `,
          examples: [
            { example: 'By the time he arrived, I had finished the work.', explanation: 'I finished first' },
            { example: 'She said she had never seen him before.', explanation: 'Reported speech' },
            { example: 'After they had eaten, they went for a walk.', explanation: 'Eat first, walk second' },
            { example: 'The train had left before we got to the station.', explanation: 'Train left first' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'pp_ex_001',
          type: 'multiple_choice',
          difficulty: 'Medium',
          question: 'By the time I called, they _____ the movie.',
          options: [
            { text: 'had finished', isCorrect: true, explanation: 'First action in past perfect' },
            { text: 'finished', isCorrect: false, explanation: 'Simple past doesn\'t show sequence' },
            { text: 'have finished', isCorrect: false, explanation: 'Present perfect is for recent past' },
            { text: 'are finishing', isCorrect: false, explanation: 'Present continuous' },
          ],
        },
      ],
    },
    // Topic 3: Modals (Can, Could, May, Might, Must, Should, Would)
    modals: {
      id: 'modals',
      title: 'Modal Verbs',
      difficulty: 'Intermediate',
      icon: '',
      description: 'Express ability, permission, obligation, and possibility',
      lessons: [
        {
          lessonId: 'mod_001',
          title: 'Introduction to Modal Verbs',
          duration: '12 mins',
          content: `
            Modal verbs show:
            1. ABILITY: can, could
            2. PERMISSION: can, could, may
            3. POSSIBILITY: may, might, could
            4. OBLIGATION/NECESSITY: must, have to, should
            5. ADVICE: should, ought to
            6. PREFERENCE: would, would rather
           
            Form: Modal + base verb (NO -ing, -ed, or -s)
            I can speak, she could run, they must go
           
            ABILITY (Present/Past):
            - can: I can swim. (Present ability)
            - could: I could swim when I was young. (Past ability)
           
            PERMISSION:
            - can: Can I use your phone?
            - could: Could I borrow your pen?
            - may: May I ask a question? (Formal)
           
            POSSIBILITY:
            - may: It may rain tomorrow.
            - might: She might come to the party.
            - could: You could be right.
           
            OBLIGATION/NECESSITY:
            - must: You must wear a seatbelt. (Strong obligation)
            - have to: I have to go to work. (External obligation)
            - should: You should eat healthily. (Advice/recommendation)
           
            PREFERENCE:
            - would: I would like tea.
            - would rather: I would rather stay home.
          `,
          examples: [
            { example: 'Can you swim?', explanation: 'Ability question' },
            { example: 'May I come in?', explanation: 'Polite permission request' },
            { example: 'You should study harder.', explanation: 'Advice' },
            { example: 'It might rain tomorrow.', explanation: 'Possibility' },
            { example: 'She must be at work.', explanation: 'Deduction/certainty' },
            { example: 'I have to finish this by 5 PM.', explanation: 'External obligation' },
          ],
        },
        {
          lessonId: 'mod_002',
          title: 'Modal Verbs - Negative & Questions',
          duration: '10 mins',
          content: `
            NEGATIVES:
            can't, couldn't, mustn't, shouldn't, wouldn't
           
            Examples:
            - I can't swim. (No ability)
            - You shouldn't smoke. (Advice against)
            - You mustn't enter. (Prohibition - strong)
            - She wouldn't say that. (Unwilling)
           
            QUESTIONS:
            Can you...? Could you...? May I...? Would you...?
           
            Example responses:
            Q: Can you help me?
            A: Yes, I can. / No, I can't.
           
            Q: Would you like coffee?
            A: Yes, I would. / No, I wouldn't.
           
            MUST vs HAVE TO vs SHOULD:
           
            MUST (internal obligation):
            I must quit smoking. (Personal decision)
            You mustn't be late. (Rules)
           
            HAVE TO (external obligation):
            I have to work tomorrow. (External requirement)
            He has to attend the meeting. (Boss says so)
           
            SHOULD (advice/recommendation):
            You should see a doctor. (I recommend)
            She should study more. (Not strict, just advice)
          `,
          examples: [
            { example: 'Can\'t you help me?', explanation: 'Negative question' },
            { example: 'You mustn\'t tell anyone.', explanation: 'Prohibition' },
            { example: 'I have to leave now.', explanation: 'External obligation' },
            { example: 'Would you prefer tea or coffee?', explanation: 'Polite question' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'mod_ex_001',
          type: 'multiple_choice',
          difficulty: 'Medium',
          question: 'You _____ eat in the library. It\'s against the rules.',
          options: [
            { text: 'mustn\'t', isCorrect: true, explanation: 'Prohibition - rules' },
            { text: 'don\'t have to', isCorrect: false, explanation: 'No obligation, but mustn\'t is prohibition' },
            { text: 'shouldn\'t', isCorrect: false, explanation: 'Advice, but mustn\'t shows rules' },
            { text: 'won\'t', isCorrect: false, explanation: 'Future, doesn\'t show prohibition' },
          ],
        },
        {
          exerciseId: 'mod_ex_002',
          type: 'multiple_choice',
          difficulty: 'Medium',
          question: 'I _____ go to the dentist next week.',
          options: [
            { text: 'have to', isCorrect: true, explanation: 'External obligation - appointment' },
            { text: 'should', isCorrect: false, explanation: 'Advice, not firm obligation' },
            { text: 'might', isCorrect: false, explanation: 'Possibility, not obligation' },
            { text: 'could', isCorrect: false, explanation: 'Ability, not obligation' },
          ],
        },
      ],
      vocabulary: [
        { word: 'prohibition', meaning: 'Not allowed', example: 'Parking prohibition in this area.' },
        { word: 'obligation', meaning: 'Something you must do', example: 'It\'s an obligation to pay taxes.' },
        { word: 'permission', meaning: 'Allowed to do something', example: 'You have permission to leave.' },
        { word: 'deduction', meaning: 'Conclusion based on evidence', example: 'He must be tired (deduction).' },
      ],
    },
    // Topic 4: Conditionals (If/Unless)
    conditionals: {
      id: 'conditionals',
      title: 'Conditional Sentences',
      difficulty: 'Intermediate',
      icon: '',
      description: 'Express hypothetical situations and consequences',
      lessons: [
        {
          lessonId: 'cond_001',
          title: 'Zero, First, and Second Conditionals',
          duration: '13 mins',
          content: `
            CONDITIONAL TYPES:
           
            ZERO CONDITIONAL (General truths):
            If/When + present simple, present simple
            If you heat water to 100C, it boils.
            When you press this button, the light turns on.
            (Always true)
           
            FIRST CONDITIONAL (Possible future):
            If + present simple, will + base verb
            If it rains tomorrow, I will stay home.
            If you study hard, you will pass the exam.
            (Likely to happen)
           
            SECOND CONDITIONAL (Hypothetical/Unlikely):
            If + past simple, would + base verb
            If I won the lottery, I would travel the world.
            If she studied harder, she would pass.
            (Unlikely or impossible now, imagination)
           
            Note: With "be" in if clause, use "were"
            If I were you, I would accept the job.
            If she were here, she would help.
           
            UNLESS (= if not):
            Unless + affirmative, affirmative
            I will go unless it rains.
            (= I will go if it doesn't rain)
           
            Unless you study, you won't pass.
            (= If you don't study, you won't pass)
          `,
          examples: [
            { example: 'If you mix red and blue, you get purple.', explanation: 'Zero conditional - fact' },
            { example: 'If you see Tom, tell him to call me.', explanation: 'First conditional - likely' },
            { example: 'If I were a bird, I would fly to Paris.', explanation: 'Second conditional - imagination' },
            { example: 'Unless you apologize, he won\'t forgive you.', explanation: 'Unless = if not' },
          ],
        },
        {
          lessonId: 'cond_002',
          title: 'Third Conditional & Mixed Conditionals',
          duration: '12 mins',
          content: `
            THIRD CONDITIONAL (Past - impossible):
            If + had + past participle, would have + past participle
            If I had studied, I would have passed the exam.
            If she had known, she would have called.
            (Impossible - talking about past)
           
            Uses:
            - Regret: If only I had known!
            - Criticism: If you had listened, this wouldn't have happened.
            - Speculation: If they had arrived earlier, they would have seen the show.
           
            MIXED CONDITIONALS (Mix tenses):
           
            Type A: Present result of past condition
            If + had + past participle, would + base verb (now)
            If I had studied medicine, I would be a doctor now.
            (I didn't study, so I'm not a doctor)
           
            If she had married him, she would live in London now.
            (She didn't marry, so she doesn't live there)
           
            Type B: Past result of present condition
            If + past simple, would have + past participle (past)
            If you were more careful, you wouldn't have broken the vase.
            (You're careless - that's why you broke it)
           
            If she worked harder, she would have passed yesterday.
            (She's lazy, so didn't pass)
           
            SUMMARY TABLE:
           
            Zero: If + present, present (facts)
            First: If + present, will (likely future)
            Second: If + past, would (unlikely/imagination)
            Third: If + had + past participle, would have (impossible past)
            Mixed: Combinations of above
          `,
          examples: [
            { example: 'If I had known the truth, I wouldn\'t be angry now.', explanation: 'Mixed - past condition, present result' },
            { example: 'If you had arrived on time, we would have watched the movie.', explanation: 'Third conditional - impossible past' },
            { example: 'I would help you if I had the money.', explanation: 'Mixed - present condition, would help' },
            { example: 'If only they had listened!', explanation: 'Third conditional - regret' },
          ],
        },
      ],
      exercises: [
        {
          exerciseId: 'cond_ex_001',
          type: 'multiple_choice',
          difficulty: 'Hard',
          question: 'If I _____ you were coming, I would have prepared dinner.',
          options: [
            { text: 'had known', isCorrect: true, explanation: 'Third conditional - if + had + past participle' },
            { text: 'knew', isCorrect: false, explanation: 'Second conditional - not for past regret' },
            { text: 'would know', isCorrect: false, explanation: 'Wrong structure' },
            { text: 'have known', isCorrect: false, explanation: 'Present perfect, not past condition' },
          ],
        },
        {
          exerciseId: 'cond_ex_002',
          type: 'fill_blank',
          difficulty: 'Hard',
          question: 'If you _____ (not/be) late, we would have caught the train.',
          correctAnswer: 'hadn\'t been',
          hints: ['Third conditional for past', 'Negative: had + not + been'],
          explanation: 'Third conditional negative: If + had not + past participle',
        },
      ],
    },
  },
};
</file>

<file path="src/data/vocabulary/vocabularyDataLevel1.js">
// src/data/vocabularyDataLevel1.js
// Vocabulary data for CEFR levels A1 - A2 (Beginner & Elementary)
// Expanded with 150+ high-frequency, practical vocabulary items
// Organized by main topics and sub-topics
// Each entry: { word, phonetic (IPA), pos (part of speech), vietnamese, example, level }

export const vocabularyDataLevel1 = {
  "TRAVEL & TOURISM": {
    "Travel Activities": [
      { word: "relax", phonetic: "/rlks/", pos: "verb", vietnamese: "th gin", example: "I just want to relax on the beach all day.", level: "A1" },
      { word: "visit", phonetic: "/vz.t/", pos: "verb", vietnamese: "thm", example: "We visit my grandparents every Sunday.", level: "A1" },
      { word: "walk", phonetic: "/wk/", pos: "verb", vietnamese: "i b", example: "Let's walk to the park.", level: "A1" },
      { word: "swim", phonetic: "/swm/", pos: "verb", vietnamese: "bi", example: "I can swim in the pool.", level: "A1" },
      { word: "play", phonetic: "/ple/", pos: "verb", vietnamese: "chi", example: "Children play football in the park.", level: "A1" },
      { word: "eat", phonetic: "/it/", pos: "verb", vietnamese: "n", example: "We eat breakfast at 7 o'clock.", level: "A1" },
      { word: "drink", phonetic: "/drk/", pos: "verb", vietnamese: "ung", example: "I drink water every morning.", level: "A1" },
      { word: "shop", phonetic: "/p/", pos: "verb", vietnamese: "mua sm", example: "She likes to shop on weekends.", level: "A1" },
      { word: "take photos", phonetic: "/tek f.tz/", pos: "verb phrase", vietnamese: "chp nh", example: "Tourists take photos of the statue.", level: "A2" },
      { word: "enjoy", phonetic: "/nd/", pos: "verb", vietnamese: "thch", example: "I enjoy the beautiful view.", level: "A2" }
    ],
    "Transportation": [
      { word: "train", phonetic: "/tren/", pos: "noun", vietnamese: "tu ha", example: "We took the train to the countryside.", level: "A1" },
      { word: "taxi", phonetic: "/tk.si/", pos: "noun", vietnamese: "taxi", example: "She hailed a taxi to the airport.", level: "A1" },
      { word: "bus", phonetic: "/bs/", pos: "noun", vietnamese: "xe but", example: "The bus arrives every 10 minutes.", level: "A1" },
      { word: "car", phonetic: "/kr/", pos: "noun", vietnamese: "xe hi", example: "My father drives a red car.", level: "A1" },
      { word: "plane", phonetic: "/plen/", pos: "noun", vietnamese: "my bay", example: "The plane takes off at 9 AM.", level: "A1" },
      { word: "bicycle", phonetic: "/ba.s.kl/", pos: "noun", vietnamese: "xe p", example: "I ride my bicycle to school.", level: "A1" },
      { word: "boat", phonetic: "/bt/", pos: "noun", vietnamese: "thuyn", example: "We crossed the river by boat.", level: "A1" },
      { word: "flight", phonetic: "/flat/", pos: "noun", vietnamese: "chuyn bay", example: "Our flight was delayed due to bad weather.", level: "A2" },
      { word: "ticket", phonetic: "/tk.t/", pos: "noun", vietnamese: "v", example: "I bought a train ticket online.", level: "A2" },
      { word: "driver", phonetic: "/dra.vr/", pos: "noun", vietnamese: "ti x", example: "The bus driver is very friendly.", level: "A2" }
    ],
    "Accommodation & Shopping": [
      { word: "hotel", phonetic: "/htel/", pos: "noun", vietnamese: "khch sn", example: "We booked a room at a luxury hotel.", level: "A1" },
      { word: "room", phonetic: "/rum/", pos: "noun", vietnamese: "phng", example: "My room has a big window.", level: "A1" },
      { word: "bed", phonetic: "/bed/", pos: "noun", vietnamese: "ging", example: "The bed is very comfortable.", level: "A1" },
      { word: "bathroom", phonetic: "/b.rum/", pos: "noun", vietnamese: "phng tm", example: "The bathroom has hot water.", level: "A1" },
      { word: "key", phonetic: "/ki/", pos: "noun", vietnamese: "cha kha", example: "Here is your room key.", level: "A1" },
      { word: "shop", phonetic: "/p/", pos: "noun", vietnamese: "ca hng", example: "There is a shop near the hotel.", level: "A1" },
      { word: "market", phonetic: "/m.kt/", pos: "noun", vietnamese: "ch", example: "I bought fruit at the market.", level: "A1" },
      { word: "money", phonetic: "/mn.i/", pos: "noun", vietnamese: "tin", example: "I need money to buy food.", level: "A1" },
      { word: "souvenir", phonetic: "/su.vnr/", pos: "noun", vietnamese: " lu nim", example: "I bought a souvenir from the market.", level: "A2" },
      { word: "price", phonetic: "/pras/", pos: "noun", vietnamese: "gi", example: "The price is too high.", level: "A2" },
      { word: "cheap", phonetic: "/tip/", pos: "adj", vietnamese: "r", example: "This shirt is very cheap.", level: "A2" },
      { word: "expensive", phonetic: "/kspen.sv/", pos: "adj", vietnamese: "t", example: "The hotel is expensive.", level: "A2" }
    ],
    "Travel Problems": [
      { word: "cancel", phonetic: "/kn.sl/", pos: "verb", vietnamese: "hy b", example: "The tour was canceled due to rain.", level: "A2" },
      { word: "late", phonetic: "/let/", pos: "adj", vietnamese: "mun", example: "The train is late again.", level: "A1" },
      { word: "lost", phonetic: "/lst/", pos: "adj", vietnamese: "lc", example: "I am lost. Where is the station?", level: "A1" },
      { word: "problem", phonetic: "/prb.lm/", pos: "noun", vietnamese: "vn ", example: "We have a problem with the booking.", level: "A2" },
      { word: "help", phonetic: "/help/", pos: "verb", vietnamese: "gip ", example: "Can you help me, please?", level: "A1" }
    ]
  },
  "FOOD & RESTAURANTS": {
    "Ordering Food": [
      { word: "menu", phonetic: "/men.ju/", pos: "noun", vietnamese: "thc n", example: "Can I see the menu, please?", level: "A1" },
      { word: "water", phonetic: "/w.tr/", pos: "noun", vietnamese: "nc", example: "I would like a glass of water.", level: "A1" },
      { word: "coffee", phonetic: "/kf.i/", pos: "noun", vietnamese: "c ph", example: "I drink coffee every morning.", level: "A1" },
      { word: "tea", phonetic: "/ti/", pos: "noun", vietnamese: "tr", example: "Would you like tea or coffee?", level: "A1" },
      { word: "bread", phonetic: "/bred/", pos: "noun", vietnamese: "bnh m", example: "I eat bread for breakfast.", level: "A1" },
      { word: "rice", phonetic: "/ras/", pos: "noun", vietnamese: "cm", example: "We eat rice every day.", level: "A1" },
      { word: "chicken", phonetic: "/tk.n/", pos: "noun", vietnamese: "g", example: "I like fried chicken.", level: "A1" },
      { word: "fish", phonetic: "/f/", pos: "noun", vietnamese: "c", example: "Grilled fish is healthy.", level: "A1" },
      { word: "dessert", phonetic: "/dzt/", pos: "noun", vietnamese: "mn trng ming", example: "Ice cream is my favorite dessert.", level: "A2" },
      { word: "bill", phonetic: "/bl/", pos: "noun", vietnamese: "ha n", example: "Could you bring the bill, please?", level: "A2" },
      { word: "order", phonetic: "/.dr/", pos: "verb", vietnamese: "gi mn", example: "I would like to order now.", level: "A2" },
      { word: "delicious", phonetic: "/dl.s/", pos: "adj", vietnamese: "ngon", example: "This soup is delicious!", level: "A2" }
    ],
    "Restaurant Features": [
      { word: "waiter", phonetic: "/we.tr/", pos: "noun", vietnamese: "bi bn nam", example: "The waiter took our order quickly.", level: "A1" },
      { word: "table", phonetic: "/te.bl/", pos: "noun", vietnamese: "bn", example: "We need a table for four.", level: "A1" },
      { word: "chair", phonetic: "/ter/", pos: "noun", vietnamese: "gh", example: "Please take a chair.", level: "A1" },
      { word: "clean", phonetic: "/klin/", pos: "adj", vietnamese: "sch", example: "The restaurant is very clean.", level: "A1" },
      { word: "open", phonetic: "/.pn/", pos: "adj", vietnamese: "m ca", example: "The restaurant is open from 11 AM.", level: "A1" },
      { word: "close", phonetic: "/klz/", pos: "verb", vietnamese: "ng ca", example: "The shop closes at 10 PM.", level: "A1" },
      { word: "fast", phonetic: "/fst/", pos: "adj", vietnamese: "nhanh", example: "The service is very fast.", level: "A2" },
      { word: "slow", phonetic: "/sl/", pos: "adj", vietnamese: "chm", example: "The service is a bit slow today.", level: "A2" }
    ],
    "Job & Career (Food Industry)": [
      { word: "chef", phonetic: "/ef/", pos: "noun", vietnamese: "u bp", example: "The chef prepared a special dish.", level: "A2" },
      { word: "waitress", phonetic: "/we.trs/", pos: "noun", vietnamese: "bi bn n", example: "The waitress recommended the specials.", level: "A1" },
      { word: "cook", phonetic: "/kk/", pos: "verb", vietnamese: "nu n", example: "My mother cooks dinner every day.", level: "A1" },
      { word: "kitchen", phonetic: "/kt.n/", pos: "noun", vietnamese: "bp", example: "The chef works in the kitchen.", level: "A1" },
      { word: "food", phonetic: "/fud/", pos: "noun", vietnamese: " n", example: "The food here is excellent.", level: "A1" },
      { word: "breakfast", phonetic: "/brek.fst/", pos: "noun", vietnamese: "ba sng", example: "I eat breakfast at 7 AM.", level: "A1" },
      { word: "lunch", phonetic: "/lnt/", pos: "noun", vietnamese: "ba tra", example: "We have lunch at noon.", level: "A1" },
      { word: "dinner", phonetic: "/dn.r/", pos: "noun", vietnamese: "ba ti", example: "Dinner is ready at 7 PM.", level: "A1" }
    ]
  },
  "EDUCATION": {
    "Academic Terms": [
      { word: "school", phonetic: "/skul/", pos: "noun", vietnamese: "trng hc", example: "I go to school every day.", level: "A1" },
      { word: "teacher", phonetic: "/ti.tr/", pos: "noun", vietnamese: "gio vin", example: "My teacher is very kind.", level: "A1" },
      { word: "student", phonetic: "/stu.dnt/", pos: "noun", vietnamese: "hc sinh", example: "There are 30 students in my class.", level: "A1" },
      { word: "class", phonetic: "/kls/", pos: "noun", vietnamese: "lp hc", example: "English class starts at 8 AM.", level: "A1" },
      { word: "book", phonetic: "/bk/", pos: "noun", vietnamese: "sch", example: "I read a book every night.", level: "A1" },
      { word: "pen", phonetic: "/pen/", pos: "noun", vietnamese: "bt", example: "I write with a blue pen.", level: "A1" },
      { word: "pencil", phonetic: "/pen.sl/", pos: "noun", vietnamese: "bt ch", example: "Please sharpen your pencil.", level: "A1" },
      { word: "paper", phonetic: "/pe.pr/", pos: "noun", vietnamese: "giy", example: "I need paper for my homework.", level: "A1" }
    ],
    "Study Requirements": [
      { word: "homework", phonetic: "/hm.wk/", pos: "noun", vietnamese: "bi tp v nh", example: "Finish your homework before dinner.", level: "A1" },
      { word: "exam", phonetic: "/zm/", pos: "noun", vietnamese: "k thi", example: "The final exam is next week.", level: "A2" },
      { word: "test", phonetic: "/test/", pos: "noun", vietnamese: "bi kim tra", example: "We have a math test tomorrow.", level: "A1" },
      { word: "learn", phonetic: "/ln/", pos: "verb", vietnamese: "hc", example: "I learn English at school.", level: "A1" },
      { word: "read", phonetic: "/rid/", pos: "verb", vietnamese: "c", example: "I read a story every day.", level: "A1" },
      { word: "write", phonetic: "/rat/", pos: "verb", vietnamese: "vit", example: "Please write your name here.", level: "A1" },
      { word: "listen", phonetic: "/ls.n/", pos: "verb", vietnamese: "nghe", example: "Listen to the teacher carefully.", level: "A1" },
      { word: "speak", phonetic: "/spik/", pos: "verb", vietnamese: "ni", example: "I speak Vietnamese at home.", level: "A1" }
    ],
    "Performance & Learning": [
      { word: "grade", phonetic: "/red/", pos: "noun", vietnamese: "im s", example: "She got an A grade in English.", level: "A2" },
      { word: "study", phonetic: "/std.i/", pos: "verb", vietnamese: "hc tp", example: "I need to study for the test.", level: "A1" },
      { word: "good", phonetic: "/d/", pos: "adj", vietnamese: "tt", example: "You did a good job!", level: "A1" },
      { word: "bad", phonetic: "/bd/", pos: "adj", vietnamese: "xu", example: "This is a bad answer.", level: "A1" },
      { word: "easy", phonetic: "/i.zi/", pos: "adj", vietnamese: "d", example: "The test was easy.", level: "A1" },
      { word: "difficult", phonetic: "/df..klt/", pos: "adj", vietnamese: "kh", example: "Math is difficult for me.", level: "A2" },
      { word: "pass", phonetic: "/ps/", pos: "verb", vietnamese: "", example: "I hope to pass the exam.", level: "A2" },
      { word: "fail", phonetic: "/fel/", pos: "verb", vietnamese: "trt", example: "I don't want to fail the test.", level: "A2" }
    ]
  },
  "SHOPPING & CUSTOMER SERVICE": {
    "Returns & Refunds": [
      { word: "return", phonetic: "/rtn/", pos: "verb", vietnamese: "tr hng", example: "I need to return this shirt because it's too small.", level: "A2" },
      { word: "receipt", phonetic: "/rsit/", pos: "noun", vietnamese: "bin lai", example: "Keep the receipt for returns.", level: "A2" },
      { word: "buy", phonetic: "/ba/", pos: "verb", vietnamese: "mua", example: "I want to buy a new phone.", level: "A1" },
      { word: "sell", phonetic: "/sel/", pos: "verb", vietnamese: "bn", example: "This shop sells clothes.", level: "A1" },
      { word: "size", phonetic: "/saz/", pos: "noun", vietnamese: "kch c", example: "What size do you need?", level: "A2" },
      { word: "small", phonetic: "/sml/", pos: "adj", vietnamese: "nh", example: "This shirt is too small.", level: "A1" },
      { word: "large", phonetic: "/ld/", pos: "adj", vietnamese: "ln", example: "I need a large pizza.", level: "A1" }
    ],
    "Problems & Solutions": [
      { word: "problem", phonetic: "/prb.lm/", pos: "noun", vietnamese: "vn ", example: "We have a problem with the order.", level: "A2" },
      { word: "help", phonetic: "/help/", pos: "verb", vietnamese: "gip ", example: "Can you help me find this item?", level: "A1" },
      { word: "sorry", phonetic: "/sr.i/", pos: "int", vietnamese: "xin li", example: "I'm sorry, we don't have it.", level: "A1" },
      { word: "thank you", phonetic: "/k ju/", pos: "phrase", vietnamese: "cm n", example: "Thank you for your help.", level: "A1" }
    ],
    "Service & Quality": [
      { word: "service", phonetic: "/s.vs/", pos: "noun", vietnamese: "dch v", example: "Customer service was outstanding.", level: "A2" },
      { word: "quality", phonetic: "/kwl..ti/", pos: "noun", vietnamese: "cht lng", example: "The quality is very good.", level: "A2" },
      { word: "new", phonetic: "/nju/", pos: "adj", vietnamese: "mi", example: "I want a new phone.", level: "A1" },
      { word: "old", phonetic: "/ld/", pos: "adj", vietnamese: "c", example: "This bag is old.", level: "A1" },
      { word: "big", phonetic: "/b/", pos: "adj", vietnamese: "to", example: "The shop is very big.", level: "A1" }
    ],
    "Customer Relations": [
      { word: "customer", phonetic: "/ks.t.mr/", pos: "noun", vietnamese: "khch hng", example: "The customer is always right.", level: "A2" },
      { word: "happy", phonetic: "/hp.i/", pos: "adj", vietnamese: "vui", example: "The customer is happy with the service.", level: "A1" },
      { word: "please", phonetic: "/pliz/", pos: "int", vietnamese: "lm n", example: "Can I help you, please?", level: "A1" }
    ]
  },
  "BUSINESS & WORKPLACE": {
    "Company Operations": [
      { word: "company", phonetic: "/km.p.ni/", pos: "noun", vietnamese: "cng ty", example: "I work for a big company.", level: "A2" },
      { word: "work", phonetic: "/wk/", pos: "verb", vietnamese: "lm vic", example: "I work from 9 to 5.", level: "A1" },
      { word: "job", phonetic: "/db/", pos: "noun", vietnamese: "cng vic", example: "I have a new job.", level: "A1" },
      { word: "boss", phonetic: "/bs/", pos: "noun", vietnamese: "sp", example: "My boss is very nice.", level: "A2" }
    ],
    "Performance & Reviews": [
      { word: "goal", phonetic: "/l/", pos: "noun", vietnamese: "mc tiu", example: "Set achievable goals for the team.", level: "A2" },
      { word: "hard", phonetic: "/hd/", pos: "adj", vietnamese: "kh khn", example: "The work is hard but interesting.", level: "A1" },
      { word: "easy", phonetic: "/i.zi/", pos: "adj", vietnamese: "d", example: "This task is easy.", level: "A1" }
    ],
    "Materials & Products": [
      { word: "product", phonetic: "/prd.kt/", pos: "noun", vietnamese: "sn phm", example: "The new product launched successfully.", level: "A2" },
      { word: "make", phonetic: "/mek/", pos: "verb", vietnamese: "lm", example: "We make high-quality products.", level: "A1" }
    ],
    "Work Environment": [
      { word: "office", phonetic: "/f.s/", pos: "noun", vietnamese: "vn phng", example: "The office is modern and spacious.", level: "A1" },
      { word: "desk", phonetic: "/desk/", pos: "noun", vietnamese: "bn lm vic", example: "My desk is near the window.", level: "A1" },
      { word: "computer", phonetic: "/kmpju.tr/", pos: "noun", vietnamese: "my tnh", example: "I use a computer at work.", level: "A1" },
      { word: "phone", phonetic: "/fn/", pos: "noun", vietnamese: "in thoi", example: "Please answer the phone.", level: "A1" }
    ],
    "Projects & Planning": [
      { word: "plan", phonetic: "/pln/", pos: "noun", vietnamese: "k hoch", example: "We have a plan for next month.", level: "A2" },
      { word: "time", phonetic: "/tam/", pos: "noun", vietnamese: "thi gian", example: "I don't have time today.", level: "A1" }
    ]
  },
  "COMMUNICATION": {
    "Product Launch & Marketing": [
      { word: "new", phonetic: "/nju/", pos: "adj", vietnamese: "mi", example: "This is a new product.", level: "A1" },
      { word: "good", phonetic: "/d/", pos: "adj", vietnamese: "tt", example: "It's a good idea.", level: "A1" }
    ],
    "Team Collaboration": [
      { word: "meeting", phonetic: "/mi.t/", pos: "noun", vietnamese: "cuc hp", example: "Schedule a team meeting.", level: "A2" },
      { word: "team", phonetic: "/tim/", pos: "noun", vietnamese: "i nhm", example: "We work as a team.", level: "A1" },
      { word: "talk", phonetic: "/tk/", pos: "verb", vietnamese: "ni chuyn", example: "Let's talk about the project.", level: "A1" }
    ],
    "Design & Materials": [
      { word: "color", phonetic: "/kl.r/", pos: "noun", vietnamese: "mu sc", example: "I like blue color.", level: "A1" },
      { word: "big", phonetic: "/b/", pos: "adj", vietnamese: "to", example: "The design is big.", level: "A1" }
    ],
    "Feedback & Adjustments": [
      { word: "change", phonetic: "/tend/", pos: "verb", vietnamese: "thay i", example: "We need to change the plan.", level: "A2" },
      { word: "better", phonetic: "/bet.r/", pos: "adj", vietnamese: "tt hn", example: "This is better than before.", level: "A1" }
    ],
    "Events & Presentations": [
      { word: "day", phonetic: "/de/", pos: "noun", vietnamese: "ngy", example: "The event is next Monday.", level: "A1" },
      { word: "time", phonetic: "/tam/", pos: "noun", vietnamese: "gi", example: "What time is the presentation?", level: "A1" }
    ]
  },
  "AUDIO & VOICE SERVICES": {
    "Voice Recording": [
      { word: "voice", phonetic: "/vs/", pos: "noun", vietnamese: "ging ni", example: "She has a beautiful voice.", level: "A1" },
      { word: "speak", phonetic: "/spik/", pos: "verb", vietnamese: "ni", example: "Please speak slowly.", level: "A1" },
      { word: "record", phonetic: "/rkd/", pos: "verb", vietnamese: "ghi m", example: "I will record the meeting.", level: "A2" }
    ],
    "Service Features": [
      { word: "sound", phonetic: "/sand/", pos: "noun", vietnamese: "m thanh", example: "The sound is too loud.", level: "A1" },
      { word: "clear", phonetic: "/klr/", pos: "adj", vietnamese: "r rng", example: "The voice is clear.", level: "A2" }
    ],
    "Audio Production": [
      { word: "music", phonetic: "/mju.zk/", pos: "noun", vietnamese: "m nhc", example: "I like pop music.", level: "A1" },
      { word: "song", phonetic: "/s/", pos: "noun", vietnamese: "bi ht", example: "This is my favorite song.", level: "A1" }
    ],
    "Client Communication": [
      { word: "call", phonetic: "/kl/", pos: "verb", vietnamese: "gi in", example: "I will call you later.", level: "A1" },
      { word: "email", phonetic: "/i.mel/", pos: "noun", vietnamese: "th in t", example: "Send me an email.", level: "A2" }
    ]
  },
  "TEXT MESSAGING": {
    "Informal Communication": [
      { word: "chat", phonetic: "/tt/", pos: "noun", vietnamese: "cuc tr chuyn", example: "Let's have a quick chat.", level: "A1" },
      { word: "emoji", phonetic: "/m.di/", pos: "noun", vietnamese: "biu tng cm xc", example: "Use an emoji to express your mood.", level: "A2" },
      { word: "hi", phonetic: "/ha/", pos: "int", vietnamese: "xin cho", example: "Hi! How are you?", level: "A1" },
      { word: "hello", phonetic: "/hl/", pos: "int", vietnamese: "xin cho", example: "Hello, nice to meet you.", level: "A1" },
      { word: "bye", phonetic: "/ba/", pos: "int", vietnamese: "tm bit", example: "Bye! See you tomorrow.", level: "A1" }
    ],
    "Expressing Agreement": [
      { word: "sure", phonetic: "/r/", pos: "adv", vietnamese: "chc chn", example: "Sure, that sounds good.", level: "A1" },
      { word: "okay", phonetic: "/ke/", pos: "adv", vietnamese: "c", example: "Okay, let's do it.", level: "A1" },
      { word: "agree", phonetic: "/ri/", pos: "verb", vietnamese: "ng ", example: "I agree with your idea.", level: "A2" },
      { word: "yes", phonetic: "/jes/", pos: "adv", vietnamese: "c", example: "Yes, I understand.", level: "A1" },
      { word: "no", phonetic: "/n/", pos: "adv", vietnamese: "khng", example: "No, thank you.", level: "A1" }
    ]
  }
};
</file>

<file path="src/data/vocabulary/vocabularyDataLevel2.js">
// src/data/vocabularyDataLevel2.js
// Vocabulary data for CEFR levels B1 - B2 (Intermediate to Upper-Intermediate)
// Expanded with 300+ high-frequency, practical, and professional vocabulary items
// Organized by main topics and sub-topics
// Each entry: { word, phonetic (IPA), pos (part of speech), vietnamese, example, level }

export const vocabularyDataLevel2 = {
  "TRAVEL & TOURISM": {
    "Travel Activities": [
      { word: "explore", phonetic: "/ksplr/", pos: "verb", vietnamese: "khm ph", example: "We plan to explore the ancient ruins during our trip.", level: "A2" },
      { word: "hike", phonetic: "/hak/", pos: "verb", vietnamese: "i b ng di", example: "They decided to hike up the mountain for a better view.", level: "B1" },
      { word: "sightsee", phonetic: "/sat.si/", pos: "verb", vietnamese: "tham quan", example: "Tourists often sightsee in the city center.", level: "B1" },
      { word: "adventure", phonetic: "/dven.tr/", pos: "noun", vietnamese: "cuc phiu lu", example: "The trip was full of adventure and excitement.", level: "B2" },
      { word: "backpack", phonetic: "/bk.pk/", pos: "verb", vietnamese: "i du lch ba l", example: "She loves to backpack through Europe in summer.", level: "B1" },
      { word: "cruise", phonetic: "/kruz/", pos: "noun", vietnamese: "chuyn du thuyn", example: "We booked a Mediterranean cruise for our honeymoon.", level: "B1" },
      { word: "guidebook", phonetic: "/ad.bk/", pos: "noun", vietnamese: "sch hng dn du lch", example: "The guidebook recommends the best local restaurants.", level: "B1" },
      { word: "landmark", phonetic: "/lnd.mk/", pos: "noun", vietnamese: "a danh", example: "The Eiffel Tower is a famous landmark in Paris.", level: "B1" },
      { word: "itinerary", phonetic: "/atn.r.r.i/", pos: "noun", vietnamese: "lch trnh", example: "Our itinerary includes three cities in one week.", level: "B2" },
      { word: "scenic", phonetic: "/si.nk/", pos: "adj", vietnamese: "cnh p", example: "The scenic route offers stunning mountain views.", level: "B2" },
      { word: "off the beaten path", phonetic: "/f  bi.tn p/", pos: "phrase", vietnamese: "ni t ngi bit", example: "We prefer destinations off the beaten path.", level: "B2" },
      { word: "souvenir shop", phonetic: "/su.vnr p/", pos: "noun", vietnamese: "ca hng lu nim", example: "The souvenir shop sells handmade crafts.", level: "B1" },
      { word: "passport", phonetic: "/p.spt/", pos: "noun", vietnamese: "h chiu", example: "Dont forget your passport at the airport.", level: "B1" },
      { word: "visa", phonetic: "/vi.z/", pos: "noun", vietnamese: "th thc", example: "You need a visa to enter this country.", level: "B1" },
      { word: "customs", phonetic: "/ks.tmz/", pos: "noun", vietnamese: "hi quan", example: "We declared all items at customs.", level: "B2" }
    ],
    "Transportation": [
      { word: "subway", phonetic: "/sb.we/", pos: "noun", vietnamese: "tu in ngm", example: "The subway is the fastest way to get around the city.", level: "B1" },
      { word: "ferry", phonetic: "/fer.i/", pos: "noun", vietnamese: "ph", example: "We crossed the river by ferry.", level: "B2" },
      { word: "platform", phonetic: "/plt.fm/", pos: "noun", vietnamese: "sn ga", example: "The train arrives on platform 3.", level: "B1" },
      { word: "departure", phonetic: "/dp.tr/", pos: "noun", vietnamese: "s khi hnh", example: "Check the departure time before leaving.", level: "B1" },
      { word: "arrival", phonetic: "/ra.vl/", pos: "noun", vietnamese: "s n ni", example: "Flight arrival is at 8 PM.", level: "B1" },
      { word: "transfer", phonetic: "/trns.fr/", pos: "noun", vietnamese: "chuyn tip", example: "We have a two-hour transfer in Singapore.", level: "B1" },
      { word: "boarding pass", phonetic: "/b.d ps/", pos: "noun", vietnamese: "th ln my bay", example: "Print your boarding pass at home.", level: "B1" },
      { word: "luggage", phonetic: "/l.d/", pos: "noun", vietnamese: "hnh l", example: "Each passenger can bring one piece of luggage.", level: "B1" },
      { word: "check-in", phonetic: "/tek.n/", pos: "noun", vietnamese: "lm th tc", example: "Online check-in opens 24 hours before the flight.", level: "B1" },
      { word: "security", phonetic: "/skj.r.ti/", pos: "noun", vietnamese: "an ninh", example: "Remove your shoes at security.", level: "B1" },
      { word: "gate", phonetic: "/et/", pos: "noun", vietnamese: "ca ra my bay", example: "Our flight departs from gate 12.", level: "B1" },
      { word: "overhead bin", phonetic: "/.v.hed bn/", pos: "noun", vietnamese: "khoang hnh l trn u", example: "Please store your bag in the overhead bin.", level: "B2" },
      { word: "turbulence", phonetic: "/t.bj.lns/", pos: "noun", vietnamese: "nhiu ng", example: "The plane experienced turbulence during the storm.", level: "B2" },
      { word: "jet", phonetic: "/det/", pos: "noun", vietnamese: "my bay phn lc", example: "We flew on a private jet to the island.", level: "B2" }
    ],
    "Accommodation & Shopping": [
      { word: "hostel", phonetic: "/hs.tl/", pos: "noun", vietnamese: "nh ngh gi r", example: "Backpackers often stay in hostels to save money.", level: "B1" },
      { word: "reservation", phonetic: "/rez.ve.n/", pos: "noun", vietnamese: "t ch", example: "Make a reservation for the hotel in advance.", level: "B1" },
      { word: "bargain", phonetic: "/b.n/", pos: "verb", vietnamese: "mc c", example: "You can bargain for a better price at the flea market.", level: "B2" },
      { word: "reception", phonetic: "/rsep.n/", pos: "noun", vietnamese: "l tn", example: "Ask at reception for extra towels.", level: "B1" },
      { word: "single room", phonetic: "/s.l rum/", pos: "noun", vietnamese: "phng n", example: "I booked a single room for one night.", level: "B1" },
      { word: "double room", phonetic: "/db.l rum/", pos: "noun", vietnamese: "phng i", example: "The double room has a queen-size bed.", level: "B1" },
      { word: "suite", phonetic: "/swit/", pos: "noun", vietnamese: "phng suite", example: "The presidential suite costs $1000 per night.", level: "B1" },
      { word: "amenities", phonetic: "/mi.n.tiz/", pos: "noun", vietnamese: "tin nghi", example: "The hotel offers free Wi-Fi and gym amenities.", level: "B2" },
      { word: "check-out", phonetic: "/tek.at/", pos: "noun", vietnamese: "tr phng", example: "Check-out time is 11 AM.", level: "B1" },
      { word: "deposit", phonetic: "/dpz.t/", pos: "noun", vietnamese: "tin t cc", example: "We require a $50 deposit for the key.", level: "B1" },
      { word: "flea market", phonetic: "/fli m.kt/", pos: "noun", vietnamese: "ch tri", example: "You can find antiques at the flea market.", level: "B2" },
      { word: "discount", phonetic: "/ds.kant/", pos: "noun", vietnamese: "gim gi", example: "Students get a 10% discount.", level: "B1" },
      { word: "sale", phonetic: "/sel/", pos: "noun", vietnamese: "bn gim gi", example: "The store is having a big sale this weekend.", level: "B1" },
      { word: "cash", phonetic: "/k/", pos: "noun", vietnamese: "tin mt", example: "I paid in cash to avoid fees.", level: "B1" },
      { word: "credit card", phonetic: "/kred.t kd/", pos: "noun", vietnamese: "th tn dng", example: "Do you accept credit cards?", level: "B1" }
    ],
    "Travel Problems": [
      { word: "delay", phonetic: "/dle/", pos: "noun", vietnamese: "s chm tr", example: "The flight delay caused us to miss our connection.", level: "B1" },
      { word: "emergency", phonetic: "/m.dn.si/", pos: "noun", vietnamese: "tnh hung khn cp", example: "In case of emergency, contact the embassy.", level: "B1" },
      { word: "lost luggage", phonetic: "/lst l.d/", pos: "noun", vietnamese: "hnh l b mt", example: "My lost luggage was found after two days.", level: "B2" },
      { word: "jet lag", phonetic: "/det l/", pos: "noun", vietnamese: "mt mi do lch mi gi", example: "I suffered from jet lag after the long flight.", level: "B2" },
      { word: "miss", phonetic: "/ms/", pos: "verb", vietnamese: "nh", example: "I missed my train because of traffic.", level: "B1" },
      { word: "cancelled", phonetic: "/kn.sld/", pos: "adj", vietnamese: "b hy", example: "The tour was cancelled due to bad weather.", level: "B1" },
      { word: "overbooked", phonetic: "/.vbkt/", pos: "adj", vietnamese: "t qu s", example: "The hotel was overbooked during the festival.", level: "B2" },
      { word: "scam", phonetic: "/skm/", pos: "noun", vietnamese: "la o", example: "Beware of taxi scams at the airport.", level: "B2" },
      { word: "pickpocket", phonetic: "/pkpk.t/", pos: "noun", vietnamese: "k mc ti", example: "Pickpockets target tourists in crowded areas.", level: "B2" },
      { word: "insurance", phonetic: "/n.rns/", pos: "noun", vietnamese: "bo him", example: "Travel insurance covers medical emergencies.", level: "B1" },
      { word: "compensation", phonetic: "/km.pense.n/", pos: "noun", vietnamese: "bi thng", example: "The airline offered compensation for the delay.", level: "B2" },
      { word: "stranded", phonetic: "/strn.dd/", pos: "adj", vietnamese: "b kt", example: "Passengers were stranded overnight at the airport.", level: "B2" }
    ]
  },
  "FOOD & RESTAURANTS": {
    "Ordering Food": [
      { word: "appetizer", phonetic: "/p..ta.zr/", pos: "noun", vietnamese: "mn khai v", example: "We ordered soup as an appetizer.", level: "B1" },
      { word: "main course", phonetic: "/men krs/", pos: "noun", vietnamese: "mn chnh", example: "The steak is the main course tonight.", level: "B1" },
      { word: "side dish", phonetic: "/sad d/", pos: "noun", vietnamese: "mn ph", example: "Fries come as a side dish with the burger.", level: "B1" },
      { word: "beverage", phonetic: "/bev.r.d/", pos: "noun", vietnamese: " ung", example: "Soft drinks are included in the beverage menu.", level: "B1" },
      { word: "recommend", phonetic: "/rek.mend/", pos: "verb", vietnamese: "gi ", example: "Can you recommend a good wine?", level: "B1" },
      { word: "special", phonetic: "/spe.l/", pos: "noun", vietnamese: "mn c bit", example: "Todays special is grilled salmon.", level: "B1" },
      { word: "rare", phonetic: "/rer/", pos: "adj", vietnamese: "ti (tht)", example: "Id like my steak rare, please.", level: "B1" },
      { word: "medium", phonetic: "/mi.di.m/", pos: "adj", vietnamese: "va chn ti", example: "Medium is perfect for me.", level: "B1" },
      { word: "well-done", phonetic: "/wel dn/", pos: "adj", vietnamese: "chn k", example: "He always orders his meat well-done.", level: "B1" },
      { word: "allergic", phonetic: "/l.dk/", pos: "adj", vietnamese: "d ng", example: "Im allergic to peanuts.", level: "B1" },
      { word: "vegetarian", phonetic: "/ved.te.ri.n/", pos: "adj", vietnamese: "n chay", example: "Do you have vegetarian options?", level: "B1" },
      { word: "spicy", phonetic: "/spa.si/", pos: "adj", vietnamese: "cay", example: "This curry is too spicy for me.", level: "B1" },
      { word: "portion", phonetic: "/p.n/", pos: "noun", vietnamese: "khu phn", example: "The portion size is generous here.", level: "B2" },
      { word: "gourmet", phonetic: "/.me/", pos: "adj", vietnamese: "cao cp", example: "This is a gourmet restaurant with Michelin stars.", level: "B2" }
    ],
    "Restaurant Features": [
      { word: "cuisine", phonetic: "/kwzin/", pos: "noun", vietnamese: "m thc", example: "This place serves Italian cuisine.", level: "B1" },
      { word: "reservation", phonetic: "/rez.ve.n/", pos: "noun", vietnamese: "t bn", example: "Do you have a reservation?", level: "B1" },
      { word: "tip", phonetic: "/tp/", pos: "noun", vietnamese: "tin boa", example: "We left a generous tip for good service.", level: "B1" },
      { word: "ambiance", phonetic: "/m.bi.ns/", pos: "noun", vietnamese: "khng kh", example: "The restaurant has a romantic ambiance.", level: "B2" },
      { word: "service charge", phonetic: "/s.vs td/", pos: "noun", vietnamese: "ph dch v", example: "A 10% service charge is added to the bill.", level: "B1" },
      { word: "outdoor seating", phonetic: "/at.dr si.t/", pos: "noun", vietnamese: "ch ngi ngoi tri", example: "We prefer outdoor seating in summer.", level: "B1" },
      { word: "live music", phonetic: "/lav mju.zk/", pos: "noun", vietnamese: "nhc sng", example: "The bar has live music every Friday.", level: "B1" },
      { word: "dress code", phonetic: "/dres kd/", pos: "noun", vietnamese: "quy nh trang phc", example: "The restaurant has a smart casual dress code.", level: "B2" },
      { word: "buffet", phonetic: "/bf.e/", pos: "noun", vietnamese: "tic t chn", example: "The hotel offers a breakfast buffet.", level: "B1" },
      { word: "takeaway", phonetic: "/te.k.we/", pos: "noun", vietnamese: " mang i", example: "Can I get this as takeaway?", level: "B1" },
      { word: "chain", phonetic: "/ten/", pos: "noun", vietnamese: "chui ca hng", example: "This is part of an international restaurant chain.", level: "B2" },
      { word: "family-run", phonetic: "/fm..li rn/", pos: "adj", vietnamese: "do gia nh qun l", example: "Its a small family-run restaurant with great food.", level: "B2" }
    ],
    "Job & Career (Food Industry)": [
      { word: "manager", phonetic: "/mn..dr/", pos: "noun", vietnamese: "qun l", example: "The restaurant manager handled the complaint.", level: "B1" },
      { word: "bartender", phonetic: "/brten.dr/", pos: "noun", vietnamese: "ngi pha ch ru", example: "The bartender mixed a cocktail.", level: "B2" },
      { word: "head chef", phonetic: "/hed ef/", pos: "noun", vietnamese: "u bp trng", example: "The head chef creates the daily specials.", level: "B1" },
      { word: "sous chef", phonetic: "/su ef/", pos: "noun", vietnamese: "ph u bp", example: "The sous chef assists the head chef.", level: "B2" },
      { word: "dishwasher", phonetic: "/dw.r/", pos: "noun", vietnamese: "nhn vin ra bt", example: "The dishwasher works in the back kitchen.", level: "B1" },
      { word: "hostess", phonetic: "/h.stes/", pos: "noun", vietnamese: "n tip tn", example: "The hostess greeted us at the door.", level: "B1" },
      { word: "shift", phonetic: "/ft/", pos: "noun", vietnamese: "ca lm", example: "I work the evening shift from 5 to 11.", level: "B1" },
      { word: "tips", phonetic: "/tps/", pos: "noun", vietnamese: "tin boa", example: "Waiters earn extra from tips.", level: "B1" },
      { word: "uniform", phonetic: "/ju.n.fm/", pos: "noun", vietnamese: "ng phc", example: "Staff must wear a clean uniform.", level: "B1" },
      { word: "menu planning", phonetic: "/men.ju pln./", pos: "noun", vietnamese: "lp thc n", example: "Menu planning considers seasonal ingredients.", level: "B2" },
      { word: "hygiene", phonetic: "/ha.din/", pos: "noun", vietnamese: "v sinh", example: "Food hygiene is strictly enforced.", level: "B2" }
    ]
  },
  "EDUCATION": {
    "Academic Terms": [
      { word: "semester", phonetic: "/smes.tr/", pos: "noun", vietnamese: "hc k", example: "The fall semester starts in September.", level: "B1" },
      { word: "lecture", phonetic: "/lek.tr/", pos: "noun", vietnamese: "bi ging", example: "The professor gave a lecture on history.", level: "B1" },
      { word: "curriculum", phonetic: "/krk.j.lm/", pos: "noun", vietnamese: "chng trnh hc", example: "The curriculum includes math and science.", level: "B2" },
      { word: "diploma", phonetic: "/dpl.m/", pos: "noun", vietnamese: "bng cp", example: "He received his diploma after graduation.", level: "B2" },
      { word: "faculty", phonetic: "/fk.l.ti/", pos: "noun", vietnamese: "khoa", example: "She teaches in the Faculty of Science.", level: "B1" },
      { word: "campus", phonetic: "/km.ps/", pos: "noun", vietnamese: "khun vin trng", example: "The campus has a large library.", level: "B1" },
      { word: "tuition", phonetic: "/tju.n/", pos: "noun", vietnamese: "hc ph", example: "Tuition fees increased this year.", level: "B1" },
      { word: "scholarship", phonetic: "/skl..p/", pos: "noun", vietnamese: "hc bng", example: "She won a scholarship to study abroad.", level: "B1" },
      { word: "deadline", phonetic: "/ded.lan/", pos: "noun", vietnamese: "hn cht", example: "The assignment deadline is next Friday.", level: "B1" },
      { word: "enroll", phonetic: "/nrl/", pos: "verb", vietnamese: "ng k hc", example: "You can enroll online before the semester.", level: "B1" },
      { word: "major", phonetic: "/me.dr/", pos: "noun", vietnamese: "chuyn ngnh", example: "My major is Computer Science.", level: "B1" },
      { word: "minor", phonetic: "/ma.nr/", pos: "noun", vietnamese: "ph ngnh", example: "I have a minor in Psychology.", level: "B2" },
      { word: "elective", phonetic: "/lek.tv/", pos: "noun", vietnamese: "mn t chn", example: "Photography is my favorite elective.", level: "B2" },
      { word: "credit", phonetic: "/kred.t/", pos: "noun", vietnamese: "tn ch", example: "This course is worth 3 credits.", level: "B2" }
    ],
    "Study Requirements": [
      { word: "assignment", phonetic: "/san.mnt/", pos: "noun", vietnamese: "bi tp", example: "Complete the assignment by Friday.", level: "B1" },
      { word: "attendance", phonetic: "/ten.dns/", pos: "noun", vietnamese: "s tham gia", example: "Attendance is mandatory for all classes.", level: "B2" },
      { word: "research", phonetic: "/rst/", pos: "noun", vietnamese: "nghin cu", example: "Students must conduct research for the project.", level: "B1" },
      { word: "essay", phonetic: "/es.e/", pos: "noun", vietnamese: "bi lun", example: "Write a 1000-word essay on climate change.", level: "B1" },
      { word: "presentation", phonetic: "/prez.nte.n/", pos: "noun", vietnamese: "bi thuyt trnh", example: "Prepare a 10-minute presentation.", level: "B1" },
      { word: "group work", phonetic: "/rup wk/", pos: "noun", vietnamese: "lm vic nhm", example: "This project requires group work.", level: "B1" },
      { word: "revision", phonetic: "/rv.n/", pos: "noun", vietnamese: "n tp", example: "Do revision before the exam.", level: "B1" },
      { word: "plagiarism", phonetic: "/ple.dr..zm/", pos: "noun", vietnamese: "o vn", example: "Plagiarism will result in failure.", level: "B2" },
      { word: "citation", phonetic: "/sate.n/", pos: "noun", vietnamese: "trch dn", example: "Include proper citations in your paper.", level: "B2" },
      { word: "bibliography", phonetic: "/bb.li.r.fi/", pos: "noun", vietnamese: "ti liu tham kho", example: "Add a bibliography at the end of your essay.", level: "B2" }
    ],
    "Performance & Learning": [
      { word: "progress", phonetic: "/pr.res/", pos: "noun", vietnamese: "s tin b", example: "He made good progress in his studies.", level: "B1" },
      { word: "motivation", phonetic: "/m.tve.n/", pos: "noun", vietnamese: "ng lc", example: "Lack of motivation affects performance.", level: "B2" },
      { word: "feedback", phonetic: "/fid.bk/", pos: "noun", vietnamese: "phn hi", example: "The teacher gave constructive feedback.", level: "B2" },
      { word: "concentration", phonetic: "/kn.sntre.n/", pos: "noun", vietnamese: "s tp trung", example: "Good concentration is key to learning.", level: "B1" },
      { word: "distraction", phonetic: "/dstrk.n/", pos: "noun", vietnamese: "s phn tm", example: "Phones are a major distraction in class.", level: "B1" },
      { word: "memory", phonetic: "/mem.r.i/", pos: "noun", vietnamese: "tr nh", example: "She has an excellent memory for names.", level: "B1" },
      { word: "comprehension", phonetic: "/km.prhen.n/", pos: "noun", vietnamese: "s hiu", example: "Reading improves comprehension skills.", level: "B2" },
      { word: "critical thinking", phonetic: "/krt..kl .k/", pos: "noun", vietnamese: "t duy phn bin", example: "The course develops critical thinking.", level: "B2" },
      { word: "self-study", phonetic: "/self std.i/", pos: "noun", vietnamese: "t hc", example: "Self-study is important for language learning.", level: "B2" }
    ]
  },
  "SHOPPING & CUSTOMER SERVICE": {
    "Returns & Refunds": [
      { word: "refund", phonetic: "/ri.fnd/", pos: "noun", vietnamese: "hon tin", example: "The store issued a full refund.", level: "B1" },
      { word: "exchange", phonetic: "/kstend/", pos: "verb", vietnamese: "i hng", example: "Can I exchange this for a larger size?", level: "B1" },
      { word: "policy", phonetic: "/pl..si/", pos: "noun", vietnamese: "chnh sch", example: "Check the return policy before buying.", level: "B2" },
      { word: "receipt", phonetic: "/rsit/", pos: "noun", vietnamese: "bin lai", example: "Keep your receipt for returns.", level: "B1" },
      { word: "defective", phonetic: "/dfek.tv/", pos: "adj", vietnamese: "li", example: "The product is defective and doesnt work.", level: "B2" },
      { word: "warranty", phonetic: "/wr.n.ti/", pos: "noun", vietnamese: "bo hnh", example: "This comes with a two-year warranty.", level: "B2" },
      { word: "replacement", phonetic: "/rples.mnt/", pos: "noun", vietnamese: "sn phm thay th", example: "They sent a replacement within 3 days.", level: "B2" },
      { word: "faulty", phonetic: "/fl.ti/", pos: "adj", vietnamese: "hng", example: "Return faulty items within 30 days.", level: "B2" }
    ],
    "Problems & Solutions": [
      { word: "complaint", phonetic: "/kmplent/", pos: "noun", vietnamese: "li phn nn", example: "I filed a complaint about the service.", level: "B1" },
      { word: "apology", phonetic: "/pl..di/", pos: "noun", vietnamese: "li xin li", example: "The manager offered an apology.", level: "B1" },
      { word: "resolve", phonetic: "/rzlv/", pos: "verb", vietnamese: "gii quyt", example: "We will resolve the issue promptly.", level: "B2" },
      { word: "escalate", phonetic: "/es.k.let/", pos: "verb", vietnamese: "leo thang", example: "Escalate the issue to a supervisor.", level: "B2" },
      { word: "compensation", phonetic: "/km.pense.n/", pos: "noun", vietnamese: "bi thng", example: "They offered compensation for the delay.", level: "B2" },
      { word: "satisfaction", phonetic: "/st.sfk.n/", pos: "noun", vietnamese: "s hi lng", example: "Customer satisfaction is our priority.", level: "B2" }
    ],
    "Service & Quality": [
      { word: "quality", phonetic: "/kwl..ti/", pos: "noun", vietnamese: "cht lng", example: "The quality of the fabric is excellent.", level: "B1" },
      { word: "durable", phonetic: "/dj.r.bl/", pos: "adj", vietnamese: "bn", example: "These shoes are very durable.", level: "B2" },
      { word: "brand", phonetic: "/brnd/", pos: "noun", vietnamese: "thng hiu", example: "This is a well-known brand.", level: "B1" },
      { word: "guarantee", phonetic: "/r.nti/", pos: "noun", vietnamese: "bo m", example: "The product comes with a money-back guarantee.", level: "B2" },
      { word: "value for money", phonetic: "/vl.ju f mn.i/", pos: "phrase", vietnamese: "ng gi", example: "This phone offers good value for money.", level: "B2" },
      { word: "premium", phonetic: "/pri.mi.m/", pos: "adj", vietnamese: "cao cp", example: "They sell premium quality products.", level: "B2" }
    ],
    "Customer Relations": [
      { word: "assistance", phonetic: "/ss.tns/", pos: "noun", vietnamese: "s h tr", example: "Do you need assistance with your purchase?", level: "B1" },
      { word: "feedback", phonetic: "/fid.bk/", pos: "noun", vietnamese: "phn hi", example: "We appreciate your feedback.", level: "B2" },
      { word: "loyalty", phonetic: "/l.l.ti/", pos: "noun", vietnamese: "lng trung thnh", example: "We reward customer loyalty with discounts.", level: "B2" },
      { word: "survey", phonetic: "/s.ve/", pos: "noun", vietnamese: "kho st", example: "Please complete our customer survey.", level: "B1" },
      { word: "recommendation", phonetic: "/rek..mende.n/", pos: "noun", vietnamese: "li khuyn", example: "Can you give me a recommendation?", level: "B2" },
      { word: "membership", phonetic: "/mem.b.p/", pos: "noun", vietnamese: "thnh vin", example: "Join our membership for exclusive offers.", level: "B2" }
    ]
  },
  "BUSINESS & WORKPLACE": {
    "Company Operations": [
      { word: "management", phonetic: "/mn..d.mnt/", pos: "noun", vietnamese: "qun l", example: "Effective management is crucial.", level: "B1" },
      { word: "operation", phonetic: "/p.re.n/", pos: "noun", vietnamese: "hot ng", example: "Daily operations run smoothly.", level: "B2" },
      { word: "strategy", phonetic: "/strt..di/", pos: "noun", vietnamese: "chin lc", example: "The company developed a new strategy.", level: "B2" },
      { word: "supply", phonetic: "/spla/", pos: "noun", vietnamese: "ngun cung", example: "We have a steady supply of materials.", level: "B2" },
      { word: "revenue", phonetic: "/rev.n.ju/", pos: "noun", vietnamese: "doanh thu", example: "Revenue increased by 20% this quarter.", level: "B2" },
      { word: "profit", phonetic: "/prf.t/", pos: "noun", vietnamese: "li nhun", example: "The company made a large profit.", level: "B1" },
      { word: "loss", phonetic: "/ls/", pos: "noun", vietnamese: "l", example: "They reported a loss this year.", level: "B1" },
      { word: "branch", phonetic: "/brnt/", pos: "noun", vietnamese: "chi nhnh", example: "We opened a new branch in Hanoi.", level: "B1" },
      { word: "headquarters", phonetic: "/hedkw.tz/", pos: "noun", vietnamese: "tr s chnh", example: "The headquarters is in Singapore.", level: "B2" },
      { word: "expansion", phonetic: "/kspn.n/", pos: "noun", vietnamese: "m rng", example: "The company plans international expansion.", level: "B2" }
    ],
    "Performance & Reviews": [
      { word: "review", phonetic: "/rvju/", pos: "noun", vietnamese: "nh gi", example: "The employee received a positive review.", level: "B1" },
      { word: "performance", phonetic: "/pf.mns/", pos: "noun", vietnamese: "hiu sut", example: "Annual performance reviews are held.", level: "B2" },
      { word: "improvement", phonetic: "/mpruv.mnt/", pos: "noun", vietnamese: "ci thin", example: "Areas for improvement were identified.", level: "B2" },
      { word: "target", phonetic: "/t.t/", pos: "noun", vietnamese: "mc tiu", example: "We met our sales target.", level: "B1" },
      { word: "bonus", phonetic: "/b.ns/", pos: "noun", vietnamese: "tin thng", example: "Employees get a year-end bonus.", level: "B1" },
      { word: "promotion", phonetic: "/prm.n/", pos: "noun", vietnamese: "thng chc", example: "She got a promotion after two years.", level: "B1" },
      { word: "appraisal", phonetic: "/pre.zl/", pos: "noun", vietnamese: "nh gi hiu sut", example: "The annual appraisal is next month.", level: "B2" },
      { word: "strength", phonetic: "/stre/", pos: "noun", vietnamese: "im mnh", example: "Teamwork is her strength.", level: "B2" },
      { word: "weakness", phonetic: "/wik.ns/", pos: "noun", vietnamese: "im yu", example: "Time management is his weakness.", level: "B2" }
    ],
    "Materials & Products": [
      { word: "material", phonetic: "/mt.ri.l/", pos: "noun", vietnamese: "nguyn liu", example: "High-quality materials are used.", level: "B1" },
      { word: "fabric", phonetic: "/fb.rk/", pos: "noun", vietnamese: "vi", example: "The fabric is soft and durable.", level: "B2" },
      { word: "packaging", phonetic: "/pk..d/", pos: "noun", vietnamese: "bao b", example: "Eco-friendly packaging is important.", level: "B2" },
      { word: "inventory", phonetic: "/n.vn.tr.i/", pos: "noun", vietnamese: "hng tn kho", example: "Check inventory before ordering.", level: "B2" },
      { word: "launch", phonetic: "/lnt/", pos: "noun", vietnamese: "ra mt sn phm", example: "The product launch was successful.", level: "B2" }
    ],
    "Work Environment": [
      { word: "colleague", phonetic: "/kl.i/", pos: "noun", vietnamese: "ng nghip", example: "I work with great colleagues.", level: "B1" },
      { word: "safety", phonetic: "/sef.ti/", pos: "noun", vietnamese: "an ton", example: "Workplace safety is prioritized.", level: "B1" },
      { word: "environment", phonetic: "/nva.rn.mnt/", pos: "noun", vietnamese: "mi trng lm vic", example: "A positive work environment boosts morale.", level: "B2" },
      { word: "flexible", phonetic: "/flek.s.bl/", pos: "adj", vietnamese: "linh hot", example: "We offer flexible working hours.", level: "B1" },
      { word: "remote", phonetic: "/rmt/", pos: "adj", vietnamese: "t xa", example: "Many employees work remote now.", level: "B1" },
      { word: "break", phonetic: "/brek/", pos: "noun", vietnamese: "ngh gii lao", example: "Take a 15-minute break.", level: "B1" },
      { word: "overtime", phonetic: "/.v.tam/", pos: "noun", vietnamese: "lm thm gi", example: "I worked overtime last week.", level: "B2" },
      { word: "culture", phonetic: "/kl.tr/", pos: "noun", vietnamese: "vn ha cng ty", example: "Company culture values innovation.", level: "B2" }
    ],
    "Projects & Planning": [
      { word: "project", phonetic: "/prd.ekt/", pos: "noun", vietnamese: "d n", example: "The project deadline is approaching.", level: "B1" },
      { word: "planning", phonetic: "/pln./", pos: "noun", vietnamese: "lp k hoch", example: "Careful planning ensures success.", level: "B2" },
      { word: "budget", phonetic: "/bd.t/", pos: "noun", vietnamese: "ngn sch", example: "Stay within the budget.", level: "B2" },
      { word: "timeline", phonetic: "/tam.lan/", pos: "noun", vietnamese: "lch trnh", example: "The timeline shows all milestones.", level: "B2" },
      { word: "resource", phonetic: "/rzs/", pos: "noun", vietnamese: "ngun lc", example: "We need more human resources.", level: "B2" },
      { word: "milestone", phonetic: "/mal.stn/", pos: "noun", vietnamese: "mc quan trng", example: "We reached a key milestone.", level: "B2" }
    ]
  },
  "COMMUNICATION": {
    "Product Launch & Marketing": [
      { word: "promotion", phonetic: "/prm.n/", pos: "noun", vietnamese: "khuyn mi", example: "The promotion attracted many customers.", level: "B1" },
      { word: "brand", phonetic: "/brnd/", pos: "noun", vietnamese: "thng hiu", example: "Build a strong brand identity.", level: "B2" },
      { word: "launch", phonetic: "/lnt/", pos: "verb", vietnamese: "ra mt", example: "The company will launch the product next month.", level: "B2" },
      { word: "marketing", phonetic: "/m.k.t/", pos: "noun", vietnamese: "tip th", example: "Effective marketing increases sales.", level: "B2" },
      { word: "campaign", phonetic: "/kmpen/", pos: "noun", vietnamese: "chin dch", example: "The ad campaign went viral.", level: "B2" },
      { word: "target audience", phonetic: "/t.t .di.ns/", pos: "noun", vietnamese: "i tng mc tiu", example: "Our target audience is young professionals.", level: "B2" }
    ],
    "Team Collaboration": [
      { word: "teamwork", phonetic: "/tim.wk/", pos: "noun", vietnamese: "lm vic nhm", example: "Good teamwork is essential.", level: "B1" },
      { word: "coordinate", phonetic: "/k.d.net/", pos: "verb", vietnamese: "phi hp", example: "We need to coordinate our efforts.", level: "B2" },
      { word: "collaboration", phonetic: "/klb.re.n/", pos: "noun", vietnamese: "hp tc", example: "Collaboration improves results.", level: "B2" },
      { word: "brainstorm", phonetic: "/bren.stm/", pos: "verb", vietnamese: "ng no", example: "Lets brainstorm new ideas.", level: "B2" }
    ],
    "Design & Materials": [
      { word: "design", phonetic: "/dzan/", pos: "noun", vietnamese: "thit k", example: "The product design is innovative.", level: "B1" },
      { word: "material", phonetic: "/mt.ri.l/", pos: "noun", vietnamese: "cht liu", example: "Choose sustainable materials.", level: "B1" },
      { word: "prototype", phonetic: "/pr.t.tap/", pos: "noun", vietnamese: "mu th", example: "Test the prototype before production.", level: "B2" }
    ],
    "Feedback & Adjustments": [
      { word: "improve", phonetic: "/mpruv/", pos: "verb", vietnamese: "ci thin", example: "We can improve the process.", level: "B1" },
      { word: "feedback", phonetic: "/fid.bk/", pos: "noun", vietnamese: "phn hi", example: "Provide constructive feedback.", level: "B2" },
      { word: "adjustment", phonetic: "/dst.mnt/", pos: "noun", vietnamese: "iu chnh", example: "Make necessary adjustments.", level: "B2" },
      { word: "revision", phonetic: "/rv.n/", pos: "noun", vietnamese: "sa i", example: "Submit the revision by Monday.", level: "B2" }
    ],
    "Events & Presentations": [
      { word: "event", phonetic: "/vent/", pos: "noun", vietnamese: "s kin", example: "Organize a corporate event.", level: "B1" },
      { word: "presentation", phonetic: "/prez.nte.n/", pos: "noun", vietnamese: "bi thuyt trnh", example: "Prepare a slide presentation.", level: "B2" },
      { word: "conference", phonetic: "/kn.fr.ns/", pos: "noun", vietnamese: "hi ngh", example: "Attend the annual conference.", level: "B2" },
      { word: "workshop", phonetic: "/wk.p/", pos: "noun", vietnamese: "xng lm vic", example: "Join the training workshop.", level: "B2" },
      { word: "agenda", phonetic: "/den.d/", pos: "noun", vietnamese: "chng trnh ngh s", example: "Check the meeting agenda.", level: "B2" }
    ]
  },
  "AUDIO & VOICE SERVICES": {
    "Voice Recording": [
      { word: "recording", phonetic: "/rk.d/", pos: "noun", vietnamese: "bn ghi m", example: "The voice recording was clear.", level: "B1" },
      { word: "studio", phonetic: "/stju.di./", pos: "noun", vietnamese: "phng thu", example: "Record in a professional studio.", level: "B1" },
      { word: "microphone", phonetic: "/ma.kr.fn/", pos: "noun", vietnamese: "micr", example: "Use a high-quality microphone.", level: "B2" },
      { word: "session", phonetic: "/se.n/", pos: "noun", vietnamese: "bui ghi m", example: "The recording session lasted two hours.", level: "B2" },
      { word: "voiceover", phonetic: "/vs..vr/", pos: "noun", vietnamese: "lng ting", example: "She does voiceover for commercials.", level: "B2" }
    ],
    "Service Features": [
      { word: "feature", phonetic: "/fi.tr/", pos: "noun", vietnamese: "tnh nng", example: "The service has advanced features.", level: "B1" },
      { word: "quality", phonetic: "/kwl..ti/", pos: "noun", vietnamese: "cht lng", example: "High audio quality is guaranteed.", level: "B1" },
      { word: "editing", phonetic: "/ed..t/", pos: "noun", vietnamese: "chnh sa", example: "Audio editing improves quality.", level: "B2" },
      { word: "format", phonetic: "/f.mt/", pos: "noun", vietnamese: "nh dng", example: "Export in MP3 format.", level: "B2" }
    ],
    "Audio Production": [
      { word: "track", phonetic: "/trk/", pos: "noun", vietnamese: "bn nhc", example: "Edit the audio track.", level: "B1" },
      { word: "production", phonetic: "/prdk.n/", pos: "noun", vietnamese: "sn xut m thanh", example: "Audio production requires skill.", level: "B2" },
      { word: "effect", phonetic: "/fekt/", pos: "noun", vietnamese: "hiu ng", example: "Add sound effects.", level: "B2" },
      { word: "mix", phonetic: "/mks/", pos: "verb", vietnamese: "pha trn", example: "Mix the vocals with the music.", level: "B2" }
    ],
    "Client Communication": [
      { word: "update", phonetic: "/pdet/", pos: "noun", vietnamese: "cp nht", example: "Send progress updates.", level: "B1" },
      { word: "client", phonetic: "/kla.nt/", pos: "noun", vietnamese: "khch hng", example: "Communicate with the client regularly.", level: "B2" },
      { word: "contract", phonetic: "/kn.trkt/", pos: "noun", vietnamese: "hp ng", example: "Sign the service contract.", level: "B2" },
      { word: "deadline", phonetic: "/ded.lan/", pos: "noun", vietnamese: "hn cht", example: "Meet the project deadline.", level: "B2" }
    ]
  },
  "TEXT MESSAGING": {
    "Informal Communication": [
      { word: "abbreviation", phonetic: "/bri.vie.n/", pos: "noun", vietnamese: "vit tt", example: "LOL is a common abbreviation.", level: "B1" },
      { word: "casual", phonetic: "/k.u.l/", pos: "adj", vietnamese: "thn mt", example: "Keep the tone casual in texts.", level: "B1" },
      { word: "slang", phonetic: "/sl/", pos: "noun", vietnamese: "ting lng", example: "Text messaging often uses slang.", level: "B2" },
      { word: "emoji", phonetic: "/m.di/", pos: "noun", vietnamese: "biu tng cm xc", example: "Use an emoji to show emotion.", level: "B1" },
      { word: "sticker", phonetic: "/stk.r/", pos: "noun", vietnamese: "nhn dn", example: "Send a funny sticker.", level: "B2" }
    ],
    "Expressing Agreement": [
      { word: "absolutely", phonetic: "/b.slut.li/", pos: "adv", vietnamese: "hon ton", example: "Absolutely, I support that.", level: "B1" },
      { word: "indeed", phonetic: "/ndid/", pos: "adv", vietnamese: "tht vy", example: "Indeed, you're right.", level: "B2" },
      { word: "definitely", phonetic: "/def..nt.li/", pos: "adv", vietnamese: "chc chn", example: "Definitely, let's meet.", level: "B1" },
      { word: "totally", phonetic: "/t.tl.i/", pos: "adv", vietnamese: "hon ton", example: "I totally agree with you.", level: "B1" }
    ]
  }
};
</file>

<file path="src/data/vocabulary/vocabularyDataLevel3.js">
// src/data/vocabularyDataLevel3.js
// Vocabulary data for CEFR levels C1 - C2 (Advanced & Proficient)
// Expanded with 300+ high-frequency academic, business, professional, and nuanced vocabulary items
// Organized by main topics and sub-topics
// Each entry: { word, phonetic (IPA), pos (part of speech), vietnamese, example, level }

export const vocabularyDataLevel3 = {
  "TRAVEL & TOURISM": {
    "Travel Activities": [
      { word: "itinerary", phonetic: "/atn.r.r.i/", pos: "noun", vietnamese: "lch trnh du lch", example: "The bespoke itinerary included private tours of hidden gems.", level: "C1" },
      { word: "expedition", phonetic: "/ek.spd.n/", pos: "noun", vietnamese: "cuc thm him", example: "The polar expedition required months of preparation and funding.", level: "C1" },
      { word: "pilgrimage", phonetic: "/pl.r.md/", pos: "noun", vietnamese: "cuc hnh hng", example: "The Camino de Santiago attracts thousands on spiritual pilgrimage.", level: "C1" },
      { word: "sojourn", phonetic: "/sd.n/", pos: "noun", vietnamese: "k lu tr ngn", example: "His sojourn in Kyoto profoundly influenced his aesthetic philosophy.", level: "C2" },
      { word: "peripatetic", phonetic: "/per..ptet.k/", pos: "adj", vietnamese: "di chuyn lin tc", example: "Her peripatetic career spanned five continents in a decade.", level: "C2" },
      { word: "odyssey", phonetic: "/d..si/", pos: "noun", vietnamese: "hnh trnh di y th thch", example: "The refugees odyssey across three countries lasted two years.", level: "C2" },
      { word: "immersion", phonetic: "/m.n/", pos: "noun", vietnamese: "s ha nhp", example: "Cultural immersion is the most effective way to learn a language.", level: "C1" },
      { word: "ecotourism", phonetic: "/i.kt.r.zm/", pos: "noun", vietnamese: "du lch sinh thi", example: "Ecotourism promotes conservation while supporting local economies.", level: "C1" },
      { word: "heritage", phonetic: "/her..td/", pos: "noun", vietnamese: "di sn", example: "UNESCO protects world heritage sites of outstanding value.", level: "C1" },
      { word: "ethnographic", phonetic: "/e.nrf.k/", pos: "adj", vietnamese: "nhn hc dn tc", example: "The ethnographic study documented indigenous tribal rituals.", level: "C2" },
      { word: "cosmopolitan", phonetic: "/kz.mpl..tn/", pos: "adj", vietnamese: "quc t ha", example: "Singapore is a truly cosmopolitan city with diverse cultures.", level: "C1" },
      { word: "paradisiacal", phonetic: "/pr..dsa..kl/", pos: "adj", vietnamese: "thin ng", example: "The islands paradisiacal beaches attract luxury travelers.", level: "C2" }
    ],
    "Transportation": [
      { word: "charter", phonetic: "/t.tr/", pos: "verb", vietnamese: "thu bao", example: "The firm chartered a yacht for the corporate retreat.", level: "C1" },
      { word: "transit", phonetic: "/trn.zt/", pos: "noun", vietnamese: "qu cnh", example: "Visa-free transit is allowed for up to 72 hours.", level: "C1" },
      { word: "layover", phonetic: "/le..vr/", pos: "noun", vietnamese: "thi gian dng chn", example: "The 12-hour layover allowed a city tour.", level: "C1" },
      { word: "logistics", phonetic: "/lds.tks/", pos: "noun", vietnamese: "hu cn", example: "Global logistics ensure timely delivery of perishable goods.", level: "C1" },
      { word: "infrastructure", phonetic: "/n.frstrk.tr/", pos: "noun", vietnamese: "c s h tng", example: "The country invested heavily in transport infrastructure.", level: "C1" },
      { word: "congestion", phonetic: "/kndes.tn/", pos: "noun", vietnamese: "tc nghn", example: "Urban congestion reduces productivity and air quality.", level: "C1" },
      { word: "intermodal", phonetic: "/n.tm.dl/", pos: "adj", vietnamese: "a phng thc", example: "Intermodal transport combines rail, road, and sea.", level: "C2" },
      { word: "hub", phonetic: "/hb/", pos: "noun", vietnamese: "trung tm", example: "Dubai is a major aviation hub for the Middle East.", level: "C1" },
      { word: "freight", phonetic: "/fret/", pos: "noun", vietnamese: "hng ha vn chuyn", example: "Air freight is faster but more expensive than sea.", level: "C1" },
      { word: "carriage", phonetic: "/kr.d/", pos: "noun", vietnamese: "ph vn chuyn", example: "Carriage is included in the quoted price.", level: "C2" },
      { word: "commuter belt", phonetic: "/kmju.tr belt/", pos: "noun", vietnamese: "vng ngoi  i lm", example: "Housing prices rise in the commuter belt.", level: "C2" },
      { word: "maglev", phonetic: "/m.lev/", pos: "noun", vietnamese: "tu t trng", example: "Japans maglev train reaches 600 km/h.", level: "C2" }
    ],
    "Accommodation & Shopping": [
      { word: "concierge", phonetic: "/kn.si.e/", pos: "noun", vietnamese: "nhn vin l tn cao cp", example: "The concierge secured last-minute opera tickets.", level: "C1" },
      { word: "boutique", phonetic: "/butik/", pos: "noun", vietnamese: "ca hng thi trang cao cp", example: "The boutique hotel offers personalized service.", level: "C1" },
      { word: "upscale", phonetic: "/pskel/", pos: "adj", vietnamese: "cao cp", example: "The upscale mall features luxury brands.", level: "C1" },
      { word: "patronage", phonetic: "/pt.r.nd/", pos: "noun", vietnamese: "s ng h", example: "Royal patronage elevated the brands prestige.", level: "C2" },
      { word: "artisan", phonetic: "/.t.zn/", pos: "noun", vietnamese: "th th cng", example: "Artisan markets showcase local craftsmanship.", level: "C1" },
      { word: "bespoke", phonetic: "/bspk/", pos: "adj", vietnamese: "may theo yu cu", example: "He ordered a bespoke suit from Savile Row.", level: "C2" },
      { word: "curated", phonetic: "/kjre.td/", pos: "adj", vietnamese: "c chn lc", example: "The curated collection features emerging designers.", level: "C1" },
      { word: "provenance", phonetic: "/prv..nns/", pos: "noun", vietnamese: "ngun gc", example: "The artworks provenance traces back to the Renaissance.", level: "C2" },
      { word: "haute couture", phonetic: "/t kutjr/", pos: "noun", vietnamese: "thi trang cao cp", example: "Paris Fashion Week showcases haute couture.", level: "C2" },
      { word: "vintage", phonetic: "/vn.td/", pos: "adj", vietnamese: "c in", example: "She collects vintage handbags from the 1950s.", level: "C1" },
      { word: "consignment", phonetic: "/knsan.mnt/", pos: "noun", vietnamese: "hng k gi", example: "The store sells luxury items on consignment.", level: "C2" }
    ],
    "Travel Problems": [
      { word: "contingency", phonetic: "/kntn.dn.si/", pos: "noun", vietnamese: "k hoch d phng", example: "A contingency fund covers unexpected travel disruptions.", level: "C1" },
      { word: "repatriation", phonetic: "/ripe.trie.n/", pos: "noun", vietnamese: "hi hng", example: "The government organized repatriation flights during the crisis.", level: "C2" },
      { word: "quarantine", phonetic: "/kwr.n.tin/", pos: "noun", vietnamese: "cch ly", example: "Mandatory quarantine applies to all inbound travelers.", level: "C1" },
      { word: "visa waiver", phonetic: "/vi.z we.vr/", pos: "noun", vietnamese: "min visa", example: "The visa waiver program facilitates short business trips.", level: "C1" },
      { word: "overbooking", phonetic: "/.vbk./", pos: "noun", vietnamese: "t qu s lng", example: "Overbooking is a common practice in budget airlines.", level: "C2" },
      { word: "force majeure", phonetic: "/fs mr/", pos: "noun", vietnamese: "bt kh khng", example: "The contract includes a force majeure clause.", level: "C2" },
      { word: "itinerant", phonetic: "/atn.r.nt/", pos: "adj", vietnamese: "lu ng", example: "Itinerant workers face visa complications.", level: "C2" },
      { word: "geopolitical", phonetic: "/di..plt..kl/", pos: "adj", vietnamese: "chnh tr a l", example: "Geopolitical tensions affect travel advisories.", level: "C1" },
      { word: "sanction", phonetic: "/sk.n/", pos: "noun", vietnamese: "cm vn", example: "Economic sanctions restrict travel to certain nations.", level: "C1" },
      { word: "embargo", phonetic: "/mb./", pos: "noun", vietnamese: "cm vn", example: "The trade embargo disrupted supply chains.", level: "C2" }
    ]
  },
  "FOOD & RESTAURANTS": {
    "Ordering Food": [
      { word: "sommelier", phonetic: "/sm.l.ie/", pos: "noun", vietnamese: "chuyn gia ru vang", example: "The sommelier curated a wine flight for the tasting menu.", level: "C1" },
      { word: "degustation", phonetic: "/de.ste.n/", pos: "noun", vietnamese: "ba n nm th", example: "The 12-course degustation lasted four hours.", level: "C2" },
      { word: "gastronomy", phonetic: "/strn..mi/", pos: "noun", vietnamese: "ngh thut m thc", example: "Molecular gastronomy redefines culinary boundaries.", level: "C2" },
      { word: "palate", phonetic: "/pl.t/", pos: "noun", vietnamese: "v gic", example: "The sorbet serves to cleanse the palate between courses.", level: "C1" },
      { word: "terroir", phonetic: "/ter.wr/", pos: "noun", vietnamese: "c trng vng t", example: "The wines terroir reflects volcanic soil and maritime climate.", level: "C2" },
      { word: "umami", phonetic: "/um.mi/", pos: "noun", vietnamese: "v umami", example: "Miso and aged cheese are rich in umami.", level: "C1" },
      { word: "mouthfeel", phonetic: "/ma.fil/", pos: "noun", vietnamese: "cm gic trong ming", example: "The dessert has a silky mouthfeel.", level: "C2" },
      { word: "pairing", phonetic: "/pe.r/", pos: "noun", vietnamese: "kt hp mn", example: "The chef suggests a bold red for spice pairing.", level: "C1" }
    ],
    "Restaurant Features": [
      { word: "ambience", phonetic: "/m.bi.ns/", pos: "noun", vietnamese: "khng gian", example: "The candlelit ambience enhances the dining experience.", level: "C1" },
      { word: "Michelin", phonetic: "/m.l.n/", pos: "adj", vietnamese: "sao Michelin", example: "Only 137 restaurants worldwide hold three Michelin stars.", level: "C1" },
      { word: "fusion", phonetic: "/fju.n/", pos: "noun", vietnamese: "kt hp m thc", example: "The menu features Franco-Japanese fusion cuisine.", level: "C1" },
      { word: "patisserie", phonetic: "/pti.sr.i/", pos: "noun", vietnamese: "tim bnh ngt", example: "The patisserie is renowned for its croissants.", level: "C1" },
       { word: "tasting menu", phonetic: "/te.st men.ju/", pos: "noun", vietnamese: "thc n nm th", example: "The tasting menu changes weekly based on seasonal produce.", level: "C1" },
      { word: "farm-to-table", phonetic: "/fm t te.bl/", pos: "adj", vietnamese: "t nng tri n bn n", example: "The restaurant follows a strict farm-to-table philosophy.", level: "C1" },
      { word: "nose-to-tail", phonetic: "/nz t tel/", pos: "adj", vietnamese: "ton b con vt", example: "The chef practices nose-to-tail cooking to reduce waste.", level: "C2" },
      { word: "sous-vide", phonetic: "/su vid/", pos: "noun", vietnamese: "nu chn khng", example: "Sous-vide ensures precise temperature control.", level: "C2" },
      { word: "molecular gastronomy", phonetic: "/mlek.j.lr strn..mi/", pos: "noun", vietnamese: "m thc phn t", example: "Ferran Adri pioneered molecular gastronomy.", level: "C2" }
    ],
    "Job & Career (Food Industry)": [
      { word: "caterer", phonetic: "/ke.tr.r/", pos: "noun", vietnamese: "ngi cung cp dch v n ung", example: "The caterer managed a 500-guest gala seamlessly.", level: "C1" },
      { word: "executive chef", phonetic: "/zek.j.tv ef/", pos: "noun", vietnamese: "u bp trng", example: "The executive chef oversees multiple restaurant outlets.", level: "C1" },
      { word: "matre d'", phonetic: "/me.tr di/", pos: "noun", vietnamese: "qun l nh hng", example: "The matre d ensures flawless front-of-house operations.", level: "C2" },
      { word: "culinary", phonetic: "/kl..nr.i/", pos: "adj", vietnamese: "thuc m thc", example: "She graduated from a prestigious culinary academy.", level: "C1" },
      { word: "hospitality", phonetic: "/hs.ptl..ti/", pos: "noun", vietnamese: "ngnh dch v khch sn", example: "Hospitality management requires both art and science.", level: "C1" },
      { word: "sommelier", phonetic: "/sm.l.ie/", pos: "noun", vietnamese: "chuyn gia ru", example: "The head sommelier holds a Master Sommelier diploma.", level: "C1" },
      { word: "pastry chef", phonetic: "/pe.stri ef/", pos: "noun", vietnamese: "u bp bnh ngt", example: "The pastry chef creates intricate sugar sculptures.", level: "C1" },
      { word: "brigade", phonetic: "/bred/", pos: "noun", vietnamese: "i bp", example: "The kitchen brigade system ensures efficiency.", level: "C2" },
      { word: "mise en place", phonetic: "/miz  pls/", pos: "noun", vietnamese: "chun b nguyn liu", example: "Mise en place is completed before service begins.", level: "C2" },
      { word: "foraging", phonetic: "/fr..d/", pos: "noun", vietnamese: "tm kim nguyn liu t nhin", example: "The chef incorporates foraged wild herbs.", level: "C2" }
    ]
  },
  "EDUCATION": {
    "Academic Terms": [
      { word: "thesis", phonetic: "/i.ss/", pos: "noun", vietnamese: "lun vn", example: "The doctoral thesis was published by Oxford University Press.", level: "C1" },
      { word: "prerequisite", phonetic: "/prirek.w.zt/", pos: "noun", vietnamese: "tin ", example: "Linear algebra is a prerequisite for machine learning.", level: "C1" },
      { word: "pedagogy", phonetic: "/ped..d.i/", pos: "noun", vietnamese: "phng php ging dy", example: "Constructivist pedagogy emphasizes student-centered learning.", level: "C2" },
      { word: "curriculum vitae", phonetic: "/krk.j.lm vi.ta/", pos: "noun", vietnamese: "s yu l lch", example: "Submit your curriculum vitae in PDF format.", level: "C1" },
      { word: "dissertation", phonetic: "/ds.te.n/", pos: "noun", vietnamese: "lun n tin s", example: "The dissertation defense is scheduled for next month.", level: "C1" },
      { word: "tenure", phonetic: "/ten.jr/", pos: "noun", vietnamese: "ch  lm vic lu di", example: "Tenure-track positions are highly competitive.", level: "C1" },
      { word: "syllabus", phonetic: "/sl..bs/", pos: "noun", vietnamese: " cng mn hc", example: "The syllabus includes primary and secondary readings.", level: "C1" },
      { word: "plagiarism", phonetic: "/ple.dr..zm/", pos: "noun", vietnamese: "o vn", example: "Turnitin detects plagiarism with 98% accuracy.", level: "C1" },
      { word: "citation", phonetic: "/sate.n/", pos: "noun", vietnamese: "trch dn", example: "Use Harvard style for in-text citations.", level: "C1" },
       { word: "endowment", phonetic: "/nda.mnt/", pos: "noun", vietnamese: "qu ti tr", example: "The universitys endowment exceeds $40 billion.", level: "C2" },
      { word: "emeritus", phonetic: "/mer..ts/", pos: "adj", vietnamese: "ngh hu danh d", example: "Professor Smith is now emeritus after 40 years.", level: "C2" }
    ],
    "Study Requirements": [
      { word: "rigor", phonetic: "/r.r/", pos: "noun", vietnamese: "s nghim ngt", example: "The course is known for its academic rigor.", level: "C1" },
      { word: "practicum", phonetic: "/prk.t.km/", pos: "noun", vietnamese: "thc tp", example: "The teaching practicum lasts one semester.", level: "C1" },
      { word: "comprehensive exam", phonetic: "/km.prhen.sv zm/", pos: "noun", vietnamese: "k thi tng hp", example: "PhD candidates must pass comprehensive exams.", level: "C1" },
      { word: "peer review", phonetic: "/p rvju/", pos: "noun", vietnamese: "nh gi ng nghip", example: "All submissions undergo blind peer review.", level: "C1" },
      { word: "grant", phonetic: "/rnt/", pos: "noun", vietnamese: "khon ti tr", example: "She received a research grant from the NSF.", level: "C1" },
      { word: "fellowship", phonetic: "/fel..p/", pos: "noun", vietnamese: "hc bng nghin cu", example: "The Rhodes fellowship funds study at Oxford.", level: "C1" },
      { word: "sabbatical", phonetic: "/sbt..kl/", pos: "noun", vietnamese: "ngh php nghin cu", example: "Professors take sabbatical every seven years.", level: "C2" },
      { word: "interdisciplinary", phonetic: "/n.tds..pl.nr.i/", pos: "adj", vietnamese: "lin ngnh", example: "The program offers interdisciplinary studies in AI and ethics.", level: "C1" }
    ],
    "Performance & Learning": [
      { word: "cognition", phonetic: "/kn.n/", pos: "noun", vietnamese: "nhn thc", example: "The study explores cognition in aging populations.", level: "C2" },
      { word: "metacognition", phonetic: "/met..kn.n/", pos: "noun", vietnamese: "siu nhn thc", example: "Metacognition enhances self-regulated learning.", level: "C2" },
      { word: "proficiency", phonetic: "/prf.n.si/", pos: "noun", vietnamese: "s thnh tho", example: "C2 proficiency is required for translation work.", level: "C1" },
      { word: "retention", phonetic: "/rten.n/", pos: "noun", vietnamese: "s ghi nh", example: "Spaced repetition maximizes long-term retention.", level: "C1" },
      { word: "heuristic", phonetic: "/hjrs.tk/", pos: "noun", vietnamese: "phng php th v sai", example: "Heuristics help solve ill-defined problems.", level: "C2" },
      { word: "schema", phonetic: "/ski.m/", pos: "noun", vietnamese: "lc ", example: "Prior knowledge activates relevant schemas.", level: "C2" },
      { word: "transfer", phonetic: "/trns.fr/", pos: "noun", vietnamese: "chuyn giao kin thc", example: "Positive transfer occurs when skills overlap.", level: "C2" },
      { word: "scaffolding", phonetic: "/skf.l.d/", pos: "noun", vietnamese: "h tr hc tp", example: "Teachers provide scaffolding for complex tasks.", level: "C2" }
    ]
  },
  "SHOPPING & CUSTOMER SERVICE": {
    "Returns & Refunds": [
      { word: "replacement", phonetic: "/rples.mnt/", pos: "noun", vietnamese: "sn phm thay th", example: "A replacement was dispatched via express courier.", level: "C1" },
      { word: "reimbursement", phonetic: "/ri.mbs.mnt/", pos: "noun", vietnamese: "hon tr tin", example: "Expense reimbursement requires original receipts.", level: "C1" },
      { word: "warranty claim", phonetic: "/wr.n.ti klem/", pos: "noun", vietnamese: "yu cu bo hnh", example: "File a warranty claim within 30 days of purchase.", level: "C1" },
      { word: "restocking fee", phonetic: "/ristk. fi/", pos: "noun", vietnamese: "ph nhp li kho", example: "A 20% restocking fee applies to opened software.", level: "C1" },
      { word: "pro rata", phonetic: "/pr r.t/", pos: "adv", vietnamese: "t l", example: "Refunds are calculated pro rata for partial use.", level: "C2" },
      { word: "indemnity", phonetic: "/ndem.n.ti/", pos: "noun", vietnamese: "bi thng", example: "The policy provides indemnity against third-party claims.", level: "C2" },
      { word: "statutory", phonetic: "/stt..tr.i/", pos: "adj", vietnamese: "theo lut nh", example: "Consumers have statutory rights to refunds.", level: "C2" }
    ],
    "Problems & Solutions": [
      { word: "escalation", phonetic: "/es.kle.n/", pos: "noun", vietnamese: "leo thang", example: "Escalation protocols ensure swift resolution.", level: "C1" },
      { word: "mitigation", phonetic: "/mt.e.n/", pos: "noun", vietnamese: "gim thiu", example: "Risk mitigation includes backup suppliers.", level: "C1" },
      { word: "redress", phonetic: "/rdres/", pos: "noun", vietnamese: "s khc phc", example: "The ombudsman provides redress for consumer grievances.", level: "C2" },
      { word: "arbitration", phonetic: "/.btre.n/", pos: "noun", vietnamese: "trng ti", example: "Disputes are resolved through binding arbitration.", level: "C2" },
      { word: "litigation", phonetic: "/lt.e.n/", pos: "noun", vietnamese: "kin tng", example: "Class-action litigation can be costly and prolonged.", level: "C2" },
      { word: "restitution", phonetic: "/res.ttju.n/", pos: "noun", vietnamese: "bi thng thit hi", example: "The court ordered full restitution to victims.", level: "C2" }
    ],
    "Service & Quality": [
      { word: "satisfaction", phonetic: "/st.sfk.n/", pos: "noun", vietnamese: "s hi lng", example: "Net Promoter Score measures customer satisfaction.", level: "C1" },
      { word: "benchmark", phonetic: "/bent.mk/", pos: "noun", vietnamese: "tiu chun", example: "Industry benchmarks set performance expectations.", level: "C1" },
      { word: "excellence", phonetic: "/ek.sl.ns/", pos: "noun", vietnamese: "s xut sc", example: "The brand pursues operational excellence relentlessly.", level: "C1" },
      { word: "compliance", phonetic: "/kmpla.ns/", pos: "noun", vietnamese: "tun th", example: "GDPR compliance is mandatory for EU customers.", level: "C1" },
      { word: "certification", phonetic: "/s.t.fke.n/", pos: "noun", vietnamese: "chng nhn", example: "ISO 9001 certification validates quality systems.", level: "C1" },
      { word: "traceability", phonetic: "/tre.sbl..ti/", pos: "noun", vietnamese: "kh nng truy xut", example: "Blockchain enhances supply chain traceability.", level: "C2" },
      { word: "provenance", phonetic: "/prv..nns/", pos: "noun", vietnamese: "ngun gc", example: "Diamond provenance ensures ethical sourcing.", level: "C2" }
    ],
    "Customer Relations": [
      { word: "inquiry", phonetic: "/nkwa.ri/", pos: "noun", vietnamese: "thc mc", example: "All inquiries are tracked in the CRM system.", level: "C1" },
      { word: "relation", phonetic: "/rle.n/", pos: "noun", vietnamese: "mi quan h", example: "Long-term client relations drive recurring revenue.", level: "C1" },
      { word: "rapport", phonetic: "/rpr/", pos: "noun", vietnamese: "mi quan h tt", example: "Sales reps build rapport through active listening.", level: "C1" },
       { word: "retention", phonetic: "/rten.n/", pos: "noun", vietnamese: "gi chn khch", example: "Churn analysis improves customer retention.", level: "C1" },
      { word: "churn", phonetic: "/tn/", pos: "noun", vietnamese: "t l ri b", example: "High churn signals underlying dissatisfaction.", level: "C1" },
      { word: "stakeholder", phonetic: "/stekhl.dr/", pos: "noun", vietnamese: "bn lin quan", example: "Engage stakeholders early in product design.", level: "C1" },
      { word: "ombudsman", phonetic: "/m.bdz.mn/", pos: "noun", vietnamese: "ngi ha gii", example: "The ombudsman resolves consumer disputes impartially.", level: "C2" }
    ]
  },
  "BUSINESS & WORKPLACE": {
    "Company Operations": [
      { word: "revenue", phonetic: "/rev.n.ju/", pos: "noun", vietnamese: "doanh thu", example: "Recurring revenue ensures financial stability.", level: "C1" },
      { word: "efficiency", phonetic: "/f.n.si/", pos: "noun", vietnamese: "hiu qu", example: "Lean methodologies enhance operational efficiency.", level: "C1" },
      { word: "inventory", phonetic: "/n.vn.tr.i/", pos: "noun", vietnamese: "hng tn kho", example: "ABC analysis optimizes inventory management.", level: "C1" },
      { word: "prototype", phonetic: "/pr.t.tap/", pos: "noun", vietnamese: "mu th", example: "Rapid prototyping accelerates innovation cycles.", level: "C1" },
      { word: "synergy", phonetic: "/sn..di/", pos: "noun", vietnamese: "hiu ng cng hng", example: "The merger unlocked significant synergies.", level: "C1" },
      { word: "leverage", phonetic: "/li.vr.d/", pos: "verb", vietnamese: "tn dng", example: "Leverage data to personalize customer experiences.", level: "C1" },
      { word: "scalability", phonetic: "/ske.lbl..ti/", pos: "noun", vietnamese: "kh nng m rng", example: "Cloud-native architecture ensures scalability.", level: "C1" },
      { word: "disruption", phonetic: "/dsrp.n/", pos: "noun", vietnamese: "s gin on", example: "Digital disruption reshapes entire industries.", level: "C1" },
      { word: "paradigm", phonetic: "/pr..dam/", pos: "noun", vietnamese: "m hnh", example: "The platform economy represents a new paradigm.", level: "C2" },
     ],
    "Performance & Reviews": [
      { word: "appraisal", phonetic: "/pre.zl/", pos: "noun", vietnamese: "nh gi hiu sut", example: "360-degree appraisal includes peer feedback.", level: "C1" },
      { word: "KPI", phonetic: "/ke pi a/", pos: "noun", vietnamese: "ch s hiu sut chnh", example: "Revenue per employee is a key KPI.", level: "C1" },
      { word: "benchmarking", phonetic: "/bent.m.k/", pos: "noun", vietnamese: "so snh chun", example: "Benchmarking identifies performance gaps.", level: "C1" },
      { word: "meritocracy", phonetic: "/mer.tk.r.si/", pos: "noun", vietnamese: "ch  ti nng", example: "The firm promotes a meritocracy culture.", level: "C2" },
      { word: "efficacy", phonetic: "/ef..k.si/", pos: "noun", vietnamese: "hiu lc", example: "Randomized trials prove vaccine efficacy.", level: "C2" },
      { word: "OKR", phonetic: "/ ke /", pos: "noun", vietnamese: "mc tiu v kt qu then cht", example: "We align using OKRs at all levels.", level: "C2" }
    ],
    "Materials & Products": [
      { word: "specification", phonetic: "/spes..fke.n/", pos: "noun", vietnamese: "thng s k thut", example: "The API meets industry specifications.", level: "C1" },
      { word: "patent", phonetic: "/pt.nt/", pos: "noun", vietnamese: "bng sng ch", example: "The patent expires in 2030.", level: "C1" },
      { word: "iteration", phonetic: "/t.re.n/", pos: "noun", vietnamese: "phin bn lp", example: "Each iteration improves usability.", level: "C1" },
      { word: "obsolescence", phonetic: "/b.sles.ns/", pos: "noun", vietnamese: "li thi", example: "Planned obsolescence drives upgrade cycles.", level: "C2" },
      { word: "sustainability", phonetic: "/sste.nbl..ti/", pos: "noun", vietnamese: "bn vng", example: "Circular economy principles enhance sustainability.", level: "C1" }
    ],
    "Work Environment": [
      { word: "culture", phonetic: "/kl.tr/", pos: "noun", vietnamese: "vn ha cng ty", example: "Toxic culture leads to high turnover.", level: "C1" },
      { word: "ergonomics", phonetic: "/.nm.ks/", pos: "noun", vietnamese: "cng thi hc", example: "Ergonomic chairs reduce back pain.", level: "C1" },
      { word: "hierarchy", phonetic: "/ha.r.ki/", pos: "noun", vietnamese: "cp bc", example: "Flat hierarchy fosters open communication.", level: "C1" },
      { word: "autonomy", phonetic: "/tn..mi/", pos: "noun", vietnamese: "t ch", example: "High autonomy increases job satisfaction.", level: "C1" },
      { word: "burnout", phonetic: "/bn.at/", pos: "noun", vietnamese: "kit sc", example: "Chronic stress leads to burnout.", level: "C1" },
      { word: "telecommute", phonetic: "/tel..kmjut/", pos: "verb", vietnamese: "lm vic t xa", example: "70% of staff telecommute twice weekly.", level: "C1" },
      { word: "psychological safety", phonetic: "/sa.kld..kl sef.ti/", pos: "noun", vietnamese: "an ton tm l", example: "Psychological safety enables risk-taking.", level: "C2" }
    ],
    "Projects & Planning": [
      { word: "timeline", phonetic: "/tam.lan/", pos: "noun", vietnamese: "lch trnh", example: "The Gantt chart visualizes the project timeline.", level: "C1" },
      { word: "milestone", phonetic: "/mal.stn/", pos: "noun", vietnamese: "mc quan trng", example: "MVP launch is the next milestone.", level: "C1" },
      { word: "feasibility", phonetic: "/fi.zbl..ti/", pos: "noun", vietnamese: "tnh kh thi", example: "A feasibility study precedes investment.", level: "C1" },
      { word: "contingency", phonetic: "/kntn.dn.si/", pos: "noun", vietnamese: "d phng", example: "Allocate 15% contingency in the budget.", level: "C1" },
      { word: "stakeholder", phonetic: "/stekhl.dr/", pos: "noun", vietnamese: "bn lin quan", example: "Map stakeholders by influence and interest.", level: "C1" },
      { word: "scope creep", phonetic: "/skp krip/", pos: "noun", vietnamese: "m rng phm vi", example: "Control scope creep with change requests.", level: "C2" }
    ]
  },
  "COMMUNICATION": {
    "Product Launch & Marketing": [
      { word: "campaign", phonetic: "/kmpen/", pos: "noun", vietnamese: "chin dch", example: "The omnichannel campaign integrated AR and social media.", level: "C1" },
      { word: "positioning", phonetic: "/pz.n./", pos: "noun", vietnamese: "nh v", example: "Premium positioning targets high-net-worth individuals.", level: "C1" },
      { word: "virality", phonetic: "/varl..ti/", pos: "noun", vietnamese: "kh nng lan truyn", example: "The challenge achieved virality within 48 hours.", level: "C1" },
      { word: "penetration", phonetic: "/pen.tre.n/", pos: "noun", vietnamese: " thm nhp", example: "Market penetration reached 40% in urban areas.", level: "C2" },
      { word: "disruptor", phonetic: "/dsrp.tr/", pos: "noun", vietnamese: "k ph v", example: "The startup is a category disruptor.", level: "C2" }
    ],
    "Team Collaboration": [
      { word: "collaboration", phonetic: "/klb.re.n/", pos: "noun", vietnamese: "hp tc", example: "Cross-functional collaboration drives innovation.", level: "C1" },
      { word: "delegate", phonetic: "/del..et/", pos: "verb", vietnamese: "giao ph", example: "Effective leaders delegate authority appropriately.", level: "C1" },
      { word: "consensus", phonetic: "/knsen.ss/", pos: "noun", vietnamese: "ng thun", example: "Decision by consensus slows but improves buy-in.", level: "C1" },
      { word: "synergistic", phonetic: "/sn.ds.tk/", pos: "adj", vietnamese: "cng hng", example: "Synergistic teams outperform individuals.", level: "C2" }
    ],
    "Design & Materials": [
      { word: "prototype", phonetic: "/pr.t.tap/", pos: "noun", vietnamese: "mu th", example: "Figma enables rapid interactive prototypes.", level: "C1" },
      { word: "aesthetic", phonetic: "/eset.k/", pos: "adj", vietnamese: "thm m", example: "Minimalist aesthetic dominates modern UI design.", level: "C2" },
      { word: "ergonomic", phonetic: "/.nm.k/", pos: "adj", vietnamese: "cng thi", example: "Ergonomic keyboards reduce RSI risk.", level: "C1" },
      { word: "modular", phonetic: "/md..lr/", pos: "adj", vietnamese: "theo m-un", example: "Modular architecture allows flexible scaling.", level: "C1" }
    ],
    "Feedback & Adjustments": [
      { word: "revise", phonetic: "/rvaz/", pos: "verb", vietnamese: "sa cha", example: "Revise the draft based on peer feedback.", level: "C1" },
      { word: "critique", phonetic: "/krtik/", pos: "noun", vietnamese: "ph bnh", example: "The design critique was constructive and detailed.", level: "C2" },
      { word: "iteration", phonetic: "/t.re.n/", pos: "noun", vietnamese: "lp li", example: "Each iteration refines the user flow.", level: "C1" },
      { word: "calibration", phonetic: "/kl.bre.n/", pos: "noun", vietnamese: "hiu chun", example: "Regular calibration ensures data accuracy.", level: "C2" }
    ],
    "Events & Presentations": [
      { word: "seminar", phonetic: "/sem..nr/", pos: "noun", vietnamese: "hi tho", example: "The AI ethics seminar attracted 500 attendees.", level: "C1" },
      { word: "keynote", phonetic: "/ki.nt/", pos: "noun", vietnamese: "bi pht biu chnh", example: "The CEO delivered the opening keynote.", level: "C1" },
      { word: "symposium", phonetic: "/smp.zi.m/", pos: "noun", vietnamese: "hi tho chuyn ", example: "The medical symposium published proceedings.", level: "C1" },
      { word: "plenary", phonetic: "/pli.nr.i/", pos: "adj", vietnamese: "ton th", example: "The plenary session voted on the resolution.", level: "C1" }
    ]
  },
  "AUDIO & VOICE SERVICES": {
    "Voice Recording": [
      { word: "voiceover", phonetic: "/vs..vr/", pos: "noun", vietnamese: "lng ting", example: "The audiobook features a celebrity voiceover.", level: "C1" },
      { word: "narration", phonetic: "/nre.n/", pos: "noun", vietnamese: "li dn chuyn", example: "David Attenboroughs narration is iconic.", level: "C1" },
      { word: "dubbing", phonetic: "/db./", pos: "noun", vietnamese: "lng ting phim", example: "Lip-sync dubbing requires precise timing.", level: "C1" },
      { word: "soundscape", phonetic: "/sand.skep/", pos: "noun", vietnamese: "bi cnh m thanh", example: "The VR experience features immersive soundscapes.", level: "C2" },
      { word: "foley", phonetic: "/f.li/", pos: "noun", vietnamese: "hiu ng m thanh thc", example: "Foley artists recreate footsteps and doors.", level: "C2" }
    ],
    "Service Features": [
      { word: "transcription", phonetic: "/trnskrp.n/", pos: "noun", vietnamese: "chuyn i m thanh thnh vn bn", example: "AI transcription achieves 99% accuracy in quiet conditions.", level: "C1" },
      { word: "customization", phonetic: "/ks.t.maze.n/", pos: "noun", vietnamese: "ty chnh", example: "Full customization of TTS voices is available.", level: "C2" },
      { word: "encoding", phonetic: "/nk.d/", pos: "noun", vietnamese: "m ha", example: "Use FLAC for lossless audio encoding.", level: "C1" },
      { word: "normalization", phonetic: "/n.m.laze.n/", pos: "noun", vietnamese: "chun ha m lng", example: "Loudness normalization ensures consistent playback.", level: "C2" }
    ],
    "Audio Production": [
      { word: "mixing", phonetic: "/mk.s/", pos: "noun", vietnamese: "phi m", example: "Stem mixing allows flexible post-production.", level: "C1" },
      { word: "mastering", phonetic: "/m.str./", pos: "noun", vietnamese: "lm master", example: "Analog mastering adds warmth to digital tracks.", level: "C2" },
      { word: "equalization", phonetic: "/i.kw.laze.n/", pos: "noun", vietnamese: "cn bng tn s", example: "Parametric equalization precisely shapes tone.", level: "C1" },
      { word: "artifact", phonetic: "/.t.fkt/", pos: "noun", vietnamese: "nhiu m", example: "Avoid compression artifacts in high-res audio.", level: "C2" }
    ],
    "Client Communication": [
      { word: "brief", phonetic: "/brif/", pos: "noun", vietnamese: "tm tt yu cu", example: "The creative brief defines tone and deliverables.", level: "C1" },
      { word: "revision", phonetic: "/rv.n/", pos: "noun", vietnamese: "bn sa", example: "Two rounds of revision are included in the quote.", level: "C1" },
      { word: "deliverable", phonetic: "/dlv.r..bl/", pos: "noun", vietnamese: "sn phm bn giao", example: "Final deliverables include WAV and MP3 files.", level: "C1" },
      { word: "turnaround", phonetic: "/tn.rand/", pos: "noun", vietnamese: "thi gian hon thnh", example: "24-hour turnaround for urgent voiceovers.", level: "C1" }
    ]
  },
  "TEXT MESSAGING": {
    "Informal Communication": [
      { word: "brevity", phonetic: "/brev..ti/", pos: "noun", vietnamese: "s ngn gn", example: "Brevity is valued in professional messaging.", level: "C2" },
      { word: "colloquial", phonetic: "/kl.kwi.l/", pos: "adj", vietnamese: "thn mt", example: "Colloquial expressions dominate casual texting.", level: "C1" },
      { word: "paralinguistic", phonetic: "/pr..lws.tk/", pos: "adj", vietnamese: "phi ngn ng", example: "Emojis serve paralinguistic functions.", level: "C2" },
      { word: "asynchronous", phonetic: "/es.kr.ns/", pos: "adj", vietnamese: "khng ng b", example: "Texting enables asynchronous communication.", level: "C1" }
    ],
    "Expressing Agreement": [
      { word: "concur", phonetic: "/knkr/", pos: "verb", vietnamese: "ng tnh", example: "I concur with the proposed timeline.", level: "C2" },
      { word: "unequivocally", phonetic: "/n.kwv..kl.i/", pos: "adv", vietnamese: "khng m h", example: "I unequivocally endorse this initiative.", level: "C2" },
      { word: "corroborate", phonetic: "/krb..ret/", pos: "verb", vietnamese: "xc nhn", example: "Your data corroborates my hypothesis.", level: "C2" },
     ]
  }
};
</file>

<file path="src/data/vocabulary/vocabularyDataLevel4.js">
// src/data/vocabularyDataLevel4.js
// Vocabulary data for CEFR levels C1 - C2 (Advanced & Proficient)
// Expanded with 100+ high-frequency, academic, business, and professional vocabulary items
// Organized by main topics and sub-topics
// Each entry: { word, phonetic (IPA), pos (part of speech), vietnamese, example, level }

export const vocabularyDataLevel4 = {
  "TRAVEL & TOURISM": {
    "Travel Activities": [
      { word: "itinerary", phonetic: "/atn.r.r.i/", pos: "noun", vietnamese: "lch trnh du lch", example: "The travel agent prepared a detailed itinerary for the group tour.", level: "C1" },
      { word: "expedition", phonetic: "/ek.spd.n/", pos: "noun", vietnamese: "cuc thm him", example: "The Antarctic expedition required specialized gear and training.", level: "C1" },
      { word: "pilgrimage", phonetic: "/pl.r.md/", pos: "noun", vietnamese: "cuc hnh hng", example: "Thousands make the annual pilgrimage to the sacred temple.", level: "C1" },
      { word: "sojourn", phonetic: "/sd.n/", pos: "noun", vietnamese: "k lu tr ngn", example: "Her brief sojourn in Paris inspired her novel.", level: "C2" },
      { word: "peripatetic", phonetic: "/per..ptet.k/", pos: "adj", vietnamese: "di chuyn lin tc", example: "His peripatetic lifestyle took him to over 50 countries.", level: "C2" }
    ],
    "Transportation": [
      { word: "charter", phonetic: "/t.tr/", pos: "verb", vietnamese: "thu bao (tu, my bay)", example: "The company chartered a private jet for the executives.", level: "C1" },
      { word: "transit", phonetic: "/trn.zt/", pos: "noun", vietnamese: "qu cnh", example: "Passengers in transit do not need a visa for layovers under 24 hours.", level: "C1" },
      { word: "layover", phonetic: "/le..vr/", pos: "noun", vietnamese: "thi gian dng chn", example: "We had a six-hour layover in Dubai.", level: "C1" },
      { word: "commuter", phonetic: "/kmju.tr/", pos: "noun", vietnamese: "ngi i lm hng ngy", example: "Commuters face heavy traffic during rush hour.", level: "C1" },
      { word: "logistics", phonetic: "/lds.tks/", pos: "noun", vietnamese: "hu cn", example: "Efficient logistics are crucial for tourism supply chains.", level: "C2" }
    ],
    "Accommodation & Shopping": [
      { word: "concierge", phonetic: "/kn.si.e/", pos: "noun", vietnamese: "nhn vin l tn cao cp", example: "The concierge arranged theater tickets and dinner reservations.", level: "C1" },
      { word: "boutique", phonetic: "/butik/", pos: "noun", vietnamese: "ca hng thi trang cao cp", example: "She prefers shopping at boutique stores rather than chains.", level: "C1" },
      { word: "upscale", phonetic: "/pskel/", pos: "adj", vietnamese: "cao cp", example: "The upscale resort offers personalized spa treatments.", level: "C1" },
      { word: "patronage", phonetic: "/pt.r.nd/", pos: "noun", vietnamese: "s ng h (khch quen)", example: "The hotel relies on repeat patronage from loyal guests.", level: "C2" },
      { word: "artisan", phonetic: "/.t.zn/", pos: "noun", vietnamese: "th th cng", example: "Local artisans sell handmade jewelry at the market.", level: "C1" }
    ],
    "Travel Problems": [
      { word: "contingency", phonetic: "/kntn.dn.si/", pos: "noun", vietnamese: "k hoch d phng", example: "We have a contingency plan in case of flight cancellation.", level: "C1" },
      { word: "repatriation", phonetic: "/ripe.trie.n/", pos: "noun", vietnamese: "hi hng", example: "The embassy arranged repatriation for stranded citizens.", level: "C2" },
      { word: "quarantine", phonetic: "/kwr.n.tin/", pos: "noun", vietnamese: "cch ly", example: "Travelers must undergo quarantine upon arrival.", level: "C1" },
      { word: "visa waiver", phonetic: "/vi.z we.vr/", pos: "noun", vietnamese: "min visa", example: "The country offers a visa waiver for short stays.", level: "C1" },
      { word: "overbooking", phonetic: "/.vbk./", pos: "noun", vietnamese: "t qu s lng", example: "Overbooking led to several passengers being bumped from the flight.", level: "C2" }
    ]
  },
  "FOOD & RESTAURANTS": {
    "Ordering Food": [
      { word: "sommelier", phonetic: "/sm.l.ie/", pos: "noun", vietnamese: "chuyn gia ru vang", example: "The sommelier recommended a vintage Bordeaux to pair with the steak.", level: "C1" },
      { word: "degustation", phonetic: "/de.ste.n/", pos: "noun", vietnamese: "ba n nm th", example: "The restaurant offers a seven-course degustation menu.", level: "C2" },
      { word: " la carte", phonetic: "/ l kt/", pos: "adj", vietnamese: "ty chn mn", example: "Guests can order  la carte or choose the set menu.", level: "C1" },
      { word: "gastronomy", phonetic: "/strn..mi/", pos: "noun", vietnamese: "ngh thut m thc", example: "Molecular gastronomy transforms traditional dishes.", level: "C2" },
      { word: "palate", phonetic: "/pl.t/", pos: "noun", vietnamese: "v gic", example: "The dish was designed to cleanse the palate between courses.", level: "C1" }
    ],
    "Restaurant Features": [
      { word: "ambience", phonetic: "/m.bi.ns/", pos: "noun", vietnamese: "khng gian", example: "The candlelit ambience creates an intimate dining experience.", level: "C1" },
      { word: "Michelin", phonetic: "/m.l.n/", pos: "adj", vietnamese: "sao Michelin", example: "The restaurant earned its third Michelin star this year.", level: "C1" },
      { word: "fusion", phonetic: "/fju.n/", pos: "noun", vietnamese: "kt hp m thc", example: "The menu features Asian-Latin fusion cuisine.", level: "C1" },
      { word: "patisserie", phonetic: "/pti.sr.i/", pos: "noun", vietnamese: "tim bnh ngt", example: "The patisserie is famous for its macarons and clairs.", level: "C1" },
      { word: "al fresco", phonetic: "/l fres.k/", pos: "adj", vietnamese: "ngoi tri", example: "We prefer al fresco dining during summer evenings.", level: "C2" }
    ],
    "Job & Career (Food Industry)": [
      { word: "executive chef", phonetic: "/zek.j.tv ef/", pos: "noun", vietnamese: "u bp trng", example: "The executive chef oversees all kitchen operations.", level: "C1" },
      { word: "matre d'", phonetic: "/me.tr di/", pos: "noun", vietnamese: "qun l nh hng", example: "The matre d' greeted VIP guests at the entrance.", level: "C2" },
      { word: "culinary", phonetic: "/kl..nr.i/", pos: "adj", vietnamese: "thuc m thc", example: "She enrolled in a prestigious culinary institute.", level: "C1" },
      { word: "sous-chef", phonetic: "/su ef/", pos: "noun", vietnamese: "ph u bp", example: "The sous-chef prepared the mise en place before service.", level: "C1" },
      { word: "hospitality", phonetic: "/hs.ptl..ti/", pos: "noun", vietnamese: "ngnh dch v khch sn", example: "He has 20 years of experience in hospitality management.", level: "C1" }
    ]
  },
  "EDUCATION": {
    "Academic Terms": [
      { word: "pedagogy", phonetic: "/ped..d.i/", pos: "noun", vietnamese: "phng php ging dy", example: "The course focuses on modern pedagogy and student engagement.", level: "C2" },
      { word: "curriculum vitae", phonetic: "/krk.j.lm vi.ta/", pos: "noun", vietnamese: "s yu l lch", example: "Submit your curriculum vitae with the application form.", level: "C1" },
      { word: "dissertation", phonetic: "/ds.te.n/", pos: "noun", vietnamese: "lun n tin s", example: "Her dissertation was published in a peer-reviewed journal.", level: "C1" },
      { word: "tenure", phonetic: "/ten.jr/", pos: "noun", vietnamese: "ch  lm vic lu di", example: "Professors seek tenure for academic freedom and job security.", level: "C1" },
      { word: "syllabus", phonetic: "/sl..bs/", pos: "noun", vietnamese: " cng mn hc", example: "The syllabus outlines weekly readings and assignments.", level: "C1" }
    ],
    "Study Requirements": [
      { word: "plagiarism", phonetic: "/ple.dr..zm/", pos: "noun", vietnamese: "o vn", example: "Plagiarism results in immediate academic penalties.", level: "C1" },
      { word: "citation", phonetic: "/sate.n/", pos: "noun", vietnamese: "trch dn", example: "Use APA format for all citations in your paper.", level: "C1" },
      { word: "scholarship", phonetic: "/skl..p/", pos: "noun", vietnamese: "hc bng", example: "She received a full scholarship to study abroad.", level: "C1" },
      { word: "practicum", phonetic: "/prk.t.km/", pos: "noun", vietnamese: "thc tp", example: "The teaching practicum is a required component of the program.", level: "C1" },
      { word: "accreditation", phonetic: "/kred.te.n/", pos: "noun", vietnamese: "cng nhn", example: "The university lost its accreditation due to quality issues.", level: "C2" }
    ],
    "Performance & Learning": [
      { word: "cognition", phonetic: "/kn.n/", pos: "noun", vietnamese: "nhn thc", example: "The study examines cognition in bilingual children.", level: "C2" },
      { word: "metacognition", phonetic: "/met..kn.n/", pos: "noun", vietnamese: "siu nhn thc", example: "Metacognition helps students monitor their own learning.", level: "C2" },
      { word: "proficiency", phonetic: "/prf.n.si/", pos: "noun", vietnamese: "s thnh tho", example: "Language proficiency is assessed through standardized tests.", level: "C1" },
      { word: "retention", phonetic: "/rten.n/", pos: "noun", vietnamese: "s ghi nh", example: "Spaced repetition improves long-term retention of vocabulary.", level: "C1" },
      { word: "heuristic", phonetic: "/hjrs.tk/", pos: "noun", vietnamese: "phng php th v sai", example: "Students use heuristics to solve complex math problems.", level: "C2" }
    ]
  },
  "SHOPPING & CUSTOMER SERVICE": {
    "Returns & Refunds": [
      { word: "reimbursement", phonetic: "/ri.mbs.mnt/", pos: "noun", vietnamese: "hon tr tin", example: "Submit receipts for expense reimbursement within 30 days.", level: "C1" },
      { word: "warranty claim", phonetic: "/wr.n.ti klem/", pos: "noun", vietnamese: "yu cu bo hnh", example: "File a warranty claim for defective products.", level: "C1" },
      { word: "restocking fee", phonetic: "/ristk. fi/", pos: "noun", vietnamese: "ph nhp li kho", example: "A 15% restocking fee applies to returned electronics.", level: "C1" },
      { word: "pro rata", phonetic: "/pr r.t/", pos: "adv", vietnamese: "t l", example: "Refunds are issued pro rata for unused subscription periods.", level: "C2" },
      { word: "indemnity", phonetic: "/ndem.n.ti/", pos: "noun", vietnamese: "bi thng", example: "The policy includes indemnity against product liability.", level: "C2" }
    ],
    "Problems & Solutions": [
      { word: "escalation", phonetic: "/es.kle.n/", pos: "noun", vietnamese: "leo thang (vn )", example: "Customer complaints require immediate escalation to management.", level: "C1" },
      { word: "mitigation", phonetic: "/mt.e.n/", pos: "noun", vietnamese: "gim thiu", example: "Risk mitigation strategies prevent service disruptions.", level: "C1" },
      { word: "redress", phonetic: "/rdres/", pos: "noun", vietnamese: "s khc phc", example: "Consumers have the right to seek redress for faulty goods.", level: "C2" },
      { word: "arbitration", phonetic: "/.btre.n/", pos: "noun", vietnamese: "trng ti", example: "Disputes may be resolved through binding arbitration.", level: "C2" },
      { word: "litigation", phonetic: "/lt.e.n/", pos: "noun", vietnamese: "kin tng", example: "The company faces costly litigation over false advertising.", level: "C2" }
    ],
    "Service & Quality": [
      { word: "benchmark", phonetic: "/bent.mk/", pos: "noun", vietnamese: "tiu chun", example: "Industry benchmarks measure service quality and efficiency.", level: "C1" },
      { word: "excellence", phonetic: "/ek.sl.ns/", pos: "noun", vietnamese: "s xut sc", example: "The brand is synonymous with excellence in craftsmanship.", level: "C1" },
      { word: "compliance", phonetic: "/kmpla.ns/", pos: "noun", vietnamese: "tun th", example: "Regulatory compliance is mandatory for all retailers.", level: "C1" },
      { word: "certification", phonetic: "/s.t.fke.n/", pos: "noun", vietnamese: "chng nhn", example: "ISO certification enhances credibility with customers.", level: "C1" },
      { word: "traceability", phonetic: "/tre.sbl..ti/", pos: "noun", vietnamese: "kh nng truy xut", example: "Supply chain traceability ensures ethical sourcing.", level: "C2" }
    ],
    "Customer Relations": [
      { word: "rapport", phonetic: "/rpr/", pos: "noun", vietnamese: "mi quan h tt", example: "Sales staff build rapport through active listening.", level: "C1" },
      { word: "advocacy", phonetic: "/d.v.k.si/", pos: "noun", vietnamese: "s ng h", example: "Customer advocacy drives word-of-mouth marketing.", level: "C1" },
      { word: "retention", phonetic: "/rten.n/", pos: "noun", vietnamese: "gi chn khch", example: "Loyalty programs improve customer retention rates.", level: "C1" },
      { word: "churn", phonetic: "/tn/", pos: "noun", vietnamese: "t l ri b", example: "High churn indicates dissatisfaction with service.", level: "C1" },
      { word: "stakeholder", phonetic: "/stekhl.dr/", pos: "noun", vietnamese: "bn lin quan", example: "Engage all stakeholders in product development.", level: "C1" }
    ]
  },
  "BUSINESS & WORKPLACE": {
    "Company Operations": [
      { word: "synergy", phonetic: "/sn..di/", pos: "noun", vietnamese: "hiu ng cng hng", example: "The merger created synergy between the two firms.", level: "C1" },
      { word: "leverage", phonetic: "/li.vr.d/", pos: "verb", vietnamese: "tn dng", example: "Leverage data analytics to optimize operations.", level: "C1" },
      { word: "scalability", phonetic: "/ske.lbl..ti/", pos: "noun", vietnamese: "kh nng m rng", example: "Cloud infrastructure offers high scalability for growing businesses.", level: "C1" },
      { word: "disruption", phonetic: "/dsrp.n/", pos: "noun", vietnamese: "s gin on", example: "Digital disruption transformed the retail industry.", level: "C1" },
      { word: "paradigm", phonetic: "/pr..dam/", pos: "noun", vietnamese: "m hnh", example: "The company operates under a new business paradigm.", level: "C2" }
    ],
    "Performance & Reviews": [
      { word: "KPI", phonetic: "/ke pi a/", pos: "noun", vietnamese: "ch s hiu sut chnh", example: "Track KPIs to measure team performance.", level: "C1" },
      { word: "benchmarking", phonetic: "/bent.m.k/", pos: "noun", vietnamese: "so snh chun", example: "Benchmarking against competitors reveals improvement areas.", level: "C1" },
      { word: "accountability", phonetic: "/kan.tbl..ti/", pos: "noun", vietnamese: "trch nhim", example: "Managers promote a culture of accountability.", level: "C1" },
      { word: "meritocracy", phonetic: "/mer.tk.r.si/", pos: "noun", vietnamese: "ch  ti nng", example: "The firm operates as a meritocracy based on results.", level: "C2" },
      { word: "efficacy", phonetic: "/ef..k.si/", pos: "noun", vietnamese: "hiu lc", example: "Clinical trials prove the drug's efficacy.", level: "C2" }
    ],
    "Materials & Products": [
      { word: "specification", phonetic: "/spes..fke.n/", pos: "noun", vietnamese: "thng s k thut", example: "The product meets all safety specifications.", level: "C1" },
      { word: "patent", phonetic: "/pt.nt/", pos: "noun", vietnamese: "bng sng ch", example: "The invention is protected by international patents.", level: "C1" },
      { word: "prototype", phonetic: "/pr.t.tap/", pos: "noun", vietnamese: "nguyn mu", example: "Engineers built a working prototype in six weeks.", level: "C1" },
      { word: "iteration", phonetic: "/t.re.n/", pos: "noun", vietnamese: "phin bn lp", example: "Each iteration improves usability and performance.", level: "C1" },
      { word: "obsolescence", phonetic: "/b.sles.ns/", pos: "noun", vietnamese: "li thi", example: "Planned obsolescence encourages frequent upgrades.", level: "C2" }
    ],
    "Work Environment": [
      { word: "ergonomics", phonetic: "/.nm.ks/", pos: "noun", vietnamese: "cng thi hc", example: "Ergonomics reduce workplace injuries and fatigue.", level: "C1" },
      { word: "hierarchy", phonetic: "/ha.r.ki/", pos: "noun", vietnamese: "cp bc", example: "The company has a flat organizational hierarchy.", level: "C1" },
      { word: "autonomy", phonetic: "/tn..mi/", pos: "noun", vietnamese: "t ch", example: "Employees value autonomy in decision-making.", level: "C1" },
      { word: "burnout", phonetic: "/bn.at/", pos: "noun", vietnamese: "kit sc", example: "Prevent burnout with regular breaks and support.", level: "C1" },
      { word: "telecommute", phonetic: "/tel..kmjut/", pos: "verb", vietnamese: "lm vic t xa", example: "Many staff telecommute two days per week.", level: "C1" }
    ],
    "Projects & Planning": [
      { word: "feasibility", phonetic: "/fi.zbl..ti/", pos: "noun", vietnamese: "tnh kh thi", example: "A feasibility study was conducted before launch.", level: "C1" },
      { word: "Gantt chart", phonetic: "/nt tt/", pos: "noun", vietnamese: "biu  Gantt", example: "Use a Gantt chart to visualize project timelines.", level: "C1" },
      { word: "contingency", phonetic: "/kntn.dn.si/", pos: "noun", vietnamese: "d phng", example: "Include a 10% contingency in the budget.", level: "C1" },
      { word: "stakeholder", phonetic: "/stekhl.dr/", pos: "noun", vietnamese: "bn lin quan", example: "Engage stakeholders early in project planning.", level: "C1" },
      { word: "agile", phonetic: "/d.al/", pos: "adj", vietnamese: "linh hot", example: "We use agile methodology for software development.", level: "C1" }
    ]
  },
  "COMMUNICATION": {
    "Product Launch & Marketing": [
      { word: "positioning", phonetic: "/pz.n./", pos: "noun", vietnamese: "nh v thng hiu", example: "Effective positioning differentiates the product in the market.", level: "C1" },
      { word: "guerrilla marketing", phonetic: "/rl. m.k.t/", pos: "noun", vietnamese: "tip th du kch", example: "Guerrilla marketing creates buzz with low budgets.", level: "C1" },
      { word: "virality", phonetic: "/varl..ti/", pos: "noun", vietnamese: "kh nng lan truyn", example: "The video achieved virality within 24 hours.", level: "C1" },
      { word: "demographics", phonetic: "/dem.rf.ks/", pos: "noun", vietnamese: "nhn khu hc", example: "Target demographics include urban professionals aged 25-40.", level: "C1" },
      { word: "penetration", phonetic: "/pen.tre.n/", pos: "noun", vietnamese: " thm nhp th trng", example: "Market penetration reached 35% in the first year.", level: "C2" }
    ],
    "Team Collaboration": [
      { word: "consensus", phonetic: "/knsen.ss/", pos: "noun", vietnamese: "ng thun", example: "The team reached consensus on the final design.", level: "C1" },
      { word: "facilitate", phonetic: "/fsl..tet/", pos: "verb", vietnamese: "h tr", example: "The manager facilitates weekly team meetings.", level: "C1" },
      { word: "synergistic", phonetic: "/sn.ds.tk/", pos: "adj", vietnamese: "cng hng", example: "Synergistic collaboration produces innovative solutions.", level: "C2" },
      { word: "cohesive", phonetic: "/khi.sv/", pos: "adj", vietnamese: "gn kt", example: "A cohesive team achieves more than individuals.", level: "C1" },
      { word: "alignment", phonetic: "/lan.mnt/", pos: "noun", vietnamese: "s ng nht", example: "Ensure alignment between goals and actions.", level: "C1" }
    ],
    "Design & Materials": [
      { word: "aesthetics", phonetic: "/eset.ks/", pos: "noun", vietnamese: "tnh thm m", example: "Aesthetics play a key role in user experience.", level: "C1" },
      { word: "prototype", phonetic: "/pr.t.tap/", pos: "noun", vietnamese: "mu th", example: "Iterate quickly on low-fidelity prototypes.", level: "C1" },
      { word: "sustainability", phonetic: "/sste.nbl..ti/", pos: "noun", vietnamese: "bn vng", example: "Use sustainable materials in product design.", level: "C1" },
      { word: "ergonomic", phonetic: "/.nm.k/", pos: "adj", vietnamese: "cng thi", example: "The chair has an ergonomic design for long hours.", level: "C1" },
      { word: "modular", phonetic: "/md..lr/", pos: "adj", vietnamese: "theo m-un", example: "Modular furniture allows flexible configurations.", level: "C1" }
    ],
    "Feedback & Adjustments": [
      { word: "iteration", phonetic: "/t.re.n/", pos: "noun", vietnamese: "lp li", example: "Each iteration refines the user interface.", level: "C1" },
      { word: "pivot", phonetic: "/pv.t/", pos: "verb", vietnamese: "chuyn hng", example: "The startup pivoted after user feedback.", level: "C1" },
      { word: "refinement", phonetic: "/rfan.mnt/", pos: "noun", vietnamese: "s tinh chnh", example: "Continuous refinement improves product quality.", level: "C1" },
      { word: "calibration", phonetic: "/kl.bre.n/", pos: "noun", vietnamese: "hiu chun", example: "Regular calibration ensures measurement accuracy.", level: "C2" },
      { word: "validation", phonetic: "/vl.de.n/", pos: "noun", vietnamese: "xc nhn", example: "User validation confirmed the feature's value.", level: "C1" }
    ],
    "Events & Presentations": [
      { word: "keynote", phonetic: "/ki.nt/", pos: "noun", vietnamese: "bi pht biu chnh", example: "The CEO delivered the keynote at the conference.", level: "C1" },
      { word: "symposium", phonetic: "/smp.zi.m/", pos: "noun", vietnamese: "hi tho chuyn ", example: "The medical symposium attracted global experts.", level: "C1" },
      { word: "panel", phonetic: "/pn.l/", pos: "noun", vietnamese: "ban hi tho", example: "She joined a panel on sustainable business.", level: "C1" },
      { word: "plenary", phonetic: "/pli.nr.i/", pos: "adj", vietnamese: "ton th", example: "The plenary session included all delegates.", level: "C1" },
      { word: "convene", phonetic: "/knvin/", pos: "verb", vietnamese: "triu tp", example: "The board will convene next quarter.", level: "C2" }
    ]
  },
  "AUDIO & VOICE SERVICES": {
    "Voice Recording": [
      { word: "narration", phonetic: "/nre.n/", pos: "noun", vietnamese: "li dn chuyn", example: "His deep voice is perfect for documentary narration.", level: "C1" },
      { word: "dubbing", phonetic: "/db./", pos: "noun", vietnamese: "lng ting", example: "The film requires dubbing into five languages.", level: "C1" },
      { word: "soundscape", phonetic: "/sand.skep/", pos: "noun", vietnamese: "bi cnh m thanh", example: "The soundscape immerses listeners in the environment.", level: "C2" },
      { word: "post-production", phonetic: "/pst prdk.n/", pos: "noun", vietnamese: "hu k", example: "Post-production includes editing, mixing, and mastering.", level: "C1" },
      { word: "foley", phonetic: "/f.li/", pos: "noun", vietnamese: "hiu ng m thanh thc", example: "Foley artists recreate everyday sounds in studio.", level: "C2" }
    ],
    "Service Features": [
      { word: "encoding", phonetic: "/nk.d/", pos: "noun", vietnamese: "m ha", example: "Use lossless encoding for archival audio.", level: "C1" },
      { word: "metadata", phonetic: "/met.de.t/", pos: "noun", vietnamese: "siu d liu", example: "Embed metadata in audio files for cataloging.", level: "C1" },
      { word: "bitrate", phonetic: "/bt.ret/", pos: "noun", vietnamese: "tc  bit", example: "Higher bitrate improves audio fidelity.", level: "C1" },
      { word: "compression", phonetic: "/kmpre.n/", pos: "noun", vietnamese: "nn", example: "Lossless compression preserves original quality.", level: "C1" },
      { word: "normalization", phonetic: "/n.m.laze.n/", pos: "noun", vietnamese: "chun ha m lng", example: "Apply normalization to balance track volumes.", level: "C2" }
    ],
    "Audio Production": [
      { word: "equalization", phonetic: "/i.kw.laze.n/", pos: "noun", vietnamese: "cn bng tn s", example: "Use equalization to enhance vocal clarity.", level: "C1" },
      { word: "reverb", phonetic: "/rvb/", pos: "noun", vietnamese: "hi m", example: "Add subtle reverb to create spatial depth.", level: "C1" },
      { word: "stem", phonetic: "/stem/", pos: "noun", vietnamese: "bn phi ring", example: "Deliver individual stems for final mixing.", level: "C1" },
      { word: "render", phonetic: "/ren.dr/", pos: "verb", vietnamese: "xut file", example: "Render the final mix in WAV format.", level: "C1" },
      { word: "artifact", phonetic: "/.t.fkt/", pos: "noun", vietnamese: "nhiu m", example: "Avoid compression artifacts in high-quality audio.", level: "C2" }
    ],
    "Client Communication": [
      { word: "proofing", phonetic: "/pru.f/", pos: "noun", vietnamese: "xem trc", example: "Send audio proofing links for client approval.", level: "C1" },
      { word: "turnaround", phonetic: "/tn.rand/", pos: "noun", vietnamese: "thi gian hon thnh", example: "We offer 24-hour turnaround for urgent projects.", level: "C1" },
      { word: "deliverable", phonetic: "/dlv.r..bl/", pos: "noun", vietnamese: "sn phm bn giao", example: "The final deliverable includes mastered files.", level: "C1" },
      { word: "SOW", phonetic: "/es  db.lju/", pos: "noun", vietnamese: "phm vi cng vic", example: "Sign the SOW before production begins.", level: "C1" },
      { word: "milestone", phonetic: "/mal.stn/", pos: "noun", vietnamese: "mc tin ", example: "Reach the first milestone by week four.", level: "C1" }
    ]
  },
  "TEXT MESSAGING": {
    "Informal Communication": [
      { word: "brevity", phonetic: "/brev..ti/", pos: "noun", vietnamese: "s ngn gn", example: "Text messaging favors brevity and clarity.", level: "C2" },
      { word: "colloquial", phonetic: "/kl.kwi.l/", pos: "adj", vietnamese: "thn mt", example: "Use colloquial language in casual chats.", level: "C1" },
      { word: "ellipsis", phonetic: "/lp.ss/", pos: "noun", vietnamese: "du chm lng", example: "An ellipsis implies hesitation or trailing thought.", level: "C2" },
      { word: "paralinguistic", phonetic: "/pr..lws.tk/", pos: "adj", vietnamese: "phi ngn ng", example: "Emojis serve paralinguistic functions in text.", level: "C2" },
      { word: "asynchronous", phonetic: "/es.kr.ns/", pos: "adj", vietnamese: "khng ng b", example: "Texting allows asynchronous communication.", level: "C1" }
    ],
    "Expressing Agreement": [
      { word: "concur", phonetic: "/knkr/", pos: "verb", vietnamese: "ng tnh", example: "I concur with your assessment of the situation.", level: "C2" },
      { word: "unequivocally", phonetic: "/n.kwv..kl.i/", pos: "adv", vietnamese: "khng m h", example: "I unequivocally support the proposal.", level: "C2" },
      { word: "affirmative", phonetic: "/f.m.tv/", pos: "adj", vietnamese: "khng nh", example: "My response is in the affirmative.", level: "C1" },
      { word: "corroborate", phonetic: "/krb..ret/", pos: "verb", vietnamese: "xc nhn", example: "Your data corroborates my findings.", level: "C2" },
      { word: "endorse", phonetic: "/nds/", pos: "verb", vietnamese: "tn thnh", example: "I fully endorse this initiative.", level: "C1" }
    ]
  }
};
</file>

<file path="src/data/vocabulary/vocabularyDataLevel5.js">
// src/data/vocabularyDataLevel5.js
// Vocabulary data for CEFR levels B1 - B2 (Intermediate to Upper-Intermediate)
// 300+ NEW, UNIQUE words  NO DUPLICATES with Level1, Level2, Level3, or Level4
// Organized by main topics and sub-topics
// Each entry: { word, phonetic (IPA), pos (part of speech), vietnamese, example, level }

export const vocabularyDataLevel5 = {
  "TRAVEL & TOURISM": {
    "Travel Activities": [
      { word: "wander", phonetic: "/wn.dr/", pos: "verb", vietnamese: "lang thang", example: "We love to wander through narrow cobblestone streets.", level: "B1" },
      { word: "stroll", phonetic: "/strl/", pos: "verb", vietnamese: "do bc", example: "Lets take a stroll along the riverbank at sunset.", level: "B1" },
      { word: "roam", phonetic: "/rm/", pos: "verb", vietnamese: "lang thang t do", example: "Camels roam freely in the desert.", level: "B1" },
      { word: "trek", phonetic: "/trek/", pos: "verb", vietnamese: "i b ng di", example: "We plan to trek to Everest Base Camp next year.", level: "B2" },
      { word: "safari", phonetic: "/sf.ri/", pos: "noun", vietnamese: "chuyn sn nh ng vt", example: "The safari in Kenya was unforgettable.", level: "B1" },
      { word: "snorkel", phonetic: "/sn.kl/", pos: "verb", vietnamese: "ln ng th", example: "We snorkeled among colorful coral reefs.", level: "B1" },
      { word: "kayak", phonetic: "/ka.k/", pos: "verb", vietnamese: "cho thuyn kayak", example: "They kayak down the river every weekend.", level: "B1" },
      { word: "paraglide", phonetic: "/pr..lad/", pos: "verb", vietnamese: "nhy d ln", example: "I want to paraglide over the cliffs in Rio.", level: "B2" },
      { word: "voluntourism", phonetic: "/vl.n.tr.zm/", pos: "noun", vietnamese: "du lch tnh nguyn", example: "Voluntourism combines travel with helping local communities.", level: "B2" },
      { word: "homestay", phonetic: "/hm.ste/", pos: "noun", vietnamese: " nh dn", example: "The homestay experience gave us authentic local food.", level: "B1" },
      { word: "couchsurf", phonetic: "/kat.sf/", pos: "verb", vietnamese: "ng nh nh ngi l", example: "Many backpackers couchsurf to save money.", level: "B2" },
      { word: "flashpacker", phonetic: "/flpk.r/", pos: "noun", vietnamese: "du khch ba l cao cp", example: "Flashpackers travel with gadgets and comfort in mind.", level: "B2" }
    ],
    "Transportation": [
      { word: "scooter", phonetic: "/sku.tr/", pos: "noun", vietnamese: "xe my nh", example: "Renting a scooter is the best way to explore the island.", level: "B1" },
      { word: "rickshaw", phonetic: "/rk./", pos: "noun", vietnamese: "xe xch l", example: "We took a rickshaw through the old town.", level: "B1" },
      { word: "cable car", phonetic: "/ke.bl kr/", pos: "noun", vietnamese: "cp treo", example: "The cable car ride offers panoramic views.", level: "B1" },
      { word: "tram", phonetic: "/trm/", pos: "noun", vietnamese: "xe in", example: "The tram system is efficient and eco-friendly.", level: "B1" },
      { word: "helicopter", phonetic: "/hel.kp.tr/", pos: "noun", vietnamese: "trc thng", example: "We took a helicopter tour over the Grand Canyon.", level: "B1" },
      { word: "shuttle", phonetic: "/t.l/", pos: "noun", vietnamese: "xe a n", example: "The hotel provides a free airport shuttle.", level: "B1" },
      { word: "carpool", phonetic: "/k.pul/", pos: "verb", vietnamese: "i chung xe", example: "We carpool to reduce traffic and save gas.", level: "B2" },
      { word: "round-trip", phonetic: "/rand trp/", pos: "adj", vietnamese: "kh hi", example: "I bought a round-trip ticket to save money.", level: "B1" },
      { word: "one-way", phonetic: "/wn we/", pos: "adj", vietnamese: "mt chiu", example: "I only need a one-way ticket to Berlin.", level: "B1" },
      { word: "standby", phonetic: "/stnd.ba/", pos: "noun", vietnamese: "ch ch trng", example: "I got a cheap flight on standby.", level: "B2" },
      { word: "red-eye", phonetic: "/red a/", pos: "noun", vietnamese: "chuyn bay m", example: "I took a red-eye flight to arrive early.", level: "B2" },
      { word: "layover", phonetic: "/le..vr/", pos: "noun", vietnamese: "dng chn", example: "We had a 3-hour layover in Doha.", level: "B1" }
    ],
    "Accommodation & Shopping": [
      { word: "lobby", phonetic: "/lb.i/", pos: "noun", vietnamese: "snh khch sn", example: "Meet me in the hotel lobby at 7 PM.", level: "B1" },
      { word: "balcony", phonetic: "/bl.k.ni/", pos: "noun", vietnamese: "ban cng", example: "Our room has a balcony with sea view.", level: "B1" },
      { word: "elevator", phonetic: "/el..ve.tr/", pos: "noun", vietnamese: "thang my", example: "Take the elevator to the 5th floor.", level: "B1" },
      { word: "laundry", phonetic: "/ln.dri/", pos: "noun", vietnamese: "dch v git i", example: "The hotel offers same-day laundry service.", level: "B1" },
      { word: "safe", phonetic: "/sef/", pos: "noun", vietnamese: "kt st", example: "Keep your passport in the room safe.", level: "B1" },
      { word: "minibar", phonetic: "/mn.i.br/", pos: "noun", vietnamese: "t lnh nh", example: "Items from the minibar are not free.", level: "B1" },
      { word: "housekeeping", phonetic: "/haski.p/", pos: "noun", vietnamese: "dch v dn phng", example: "Housekeeping comes every morning.", level: "B1" },
      { word: "bazaar", phonetic: "/bzr/", pos: "noun", vietnamese: "ch truyn thng", example: "The Grand Bazaar in Istanbul is huge.", level: "B1" },
      { word: "outlet", phonetic: "/at.let/", pos: "noun", vietnamese: "ca hng gim gi", example: "We shopped at the designer outlet mall.", level: "B1" },
      { word: "window shopping", phonetic: "/wn.d p./", pos: "noun", vietnamese: "ngm  m khng mua", example: "We did some window shopping in Paris.", level: "B1" },
      { word: "impulse buy", phonetic: "/m.pls ba/", pos: "noun", vietnamese: "mua theo cm tnh", example: "That chocolate was an impulse buy.", level: "B2" },
      { word: "haggling", phonetic: "/h.l/", pos: "noun", vietnamese: "mc c", example: "Haggling is expected in the night market.", level: "B2" }
    ],
    "Travel Problems": [
      { word: "motion sickness", phonetic: "/m.n sk.ns/", pos: "noun", vietnamese: "say xe", example: "I get motion sickness on boats.", level: "B1" },
      { word: "homesick", phonetic: "/hm.sk/", pos: "adj", vietnamese: "nh nh", example: "She felt homesick after two weeks abroad.", level: "B1" },
      { word: "culture shock", phonetic: "/kl.tr k/", pos: "noun", vietnamese: "sc vn ha", example: "Culture shock is normal for first-time travelers.", level: "B2" },
      { word: "scam", phonetic: "/skm/", pos: "noun", vietnamese: "la o", example: "Beware of the fake taxi scam.", level: "B1" },
      { word: "rip-off", phonetic: "/rp f/", pos: "noun", vietnamese: "gi ct c", example: "That souvenir shop is a total rip-off.", level: "B2" },
      { word: "bedbug", phonetic: "/bed.b/", pos: "noun", vietnamese: "rp ging", example: "The hostel had a bedbug problem.", level: "B2" },
      { word: "food poisoning", phonetic: "/fud p.zn./", pos: "noun", vietnamese: "ng c thc phm", example: "He got food poisoning from street food.", level: "B1" },
      { word: "sunburn", phonetic: "/sn.bn/", pos: "noun", vietnamese: "chy nng", example: "Wear sunscreen to avoid sunburn.", level: "B1" },
      { word: "mosquito", phonetic: "/mski.t/", pos: "noun", vietnamese: "mui", example: "Mosquitoes are bad near the lake.", level: "B1" },
      { word: "pickpocket", phonetic: "/pkpk.t/", pos: "noun", vietnamese: "k mc ti", example: "Pickpockets target crowded tourist areas.", level: "B2" }
    ]
  },
  "FOOD & RESTAURANTS": {
    "Ordering Food": [
      { word: "rare", phonetic: "/rer/", pos: "adj", vietnamese: "ti (tht)", example: "Id like my steak rare, please.", level: "B1" },
      { word: "medium rare", phonetic: "/mi.di.m rer/", pos: "adj", vietnamese: "ti va", example: "Medium rare is my favorite.", level: "B1" },
      { word: "medium", phonetic: "/mi.di.m/", pos: "adj", vietnamese: "va chn ti", example: "Ill have the chicken medium.", level: "B1" },
      { word: "well done", phonetic: "/wel dn/", pos: "adj", vietnamese: "chn k", example: "My dad always wants his meat well done.", level: "B1" },
      { word: "grilled", phonetic: "/rld/", pos: "adj", vietnamese: "nng", example: "I prefer grilled fish over fried.", level: "B1" },
      { word: "steamed", phonetic: "/stimd/", pos: "adj", vietnamese: "hp", example: "Steamed vegetables are healthy.", level: "B1" },
      { word: "fried", phonetic: "/frad/", pos: "adj", vietnamese: "chin", example: "Fried chicken is my guilty pleasure.", level: "B1" },
      { word: "boiled", phonetic: "/bld/", pos: "adj", vietnamese: "luc", example: "Boiled eggs for breakfast, please.", level: "B1" },
      { word: "roasted", phonetic: "/r.std/", pos: "adj", vietnamese: "quay", example: "Roasted pork smells amazing.", level: "B1" },
      { word: "baked", phonetic: "/bekt/", pos: "adj", vietnamese: "nng l", example: "Baked salmon with herbs is delicious.", level: "B1" },
      { word: "raw", phonetic: "/r/", pos: "adj", vietnamese: "sng", example: "Sushi uses raw fish.", level: "B1" },
      { word: "crispy", phonetic: "/krs.pi/", pos: "adj", vietnamese: "gin", example: "I love crispy fried chicken skin.", level: "B1" },
      { word: "tender", phonetic: "/ten.dr/", pos: "adj", vietnamese: "mm", example: "The beef was very tender.", level: "B2" },
      { word: "juicy", phonetic: "/du.si/", pos: "adj", vietnamese: "nhiu nc", example: "This burger is so juicy!", level: "B1" }
    ],
    "Restaurant Features": [
      { word: "cozy", phonetic: "/k.zi/", pos: "adj", vietnamese: "m cng", example: "This caf is small and cozy.", level: "B1" },
      { word: "trendy", phonetic: "/tren.di/", pos: "adj", vietnamese: "thi thng", example: "The new restaurant is very trendy.", level: "B1" },
      { word: "crowded", phonetic: "/kra.dd/", pos: "adj", vietnamese: "ng c", example: "The market gets crowded on weekends.", level: "B1" },
      { word: "quiet", phonetic: "/kwa.t/", pos: "adj", vietnamese: "yn tnh", example: "We want a quiet table in the corner.", level: "B1" },
      { word: "view", phonetic: "/vju/", pos: "noun", vietnamese: "tm nhn", example: "The restaurant has a great sea view.", level: "B1" },
      { word: "terrace", phonetic: "/ter.s/", pos: "noun", vietnamese: "sn thng", example: "Lets sit on the terrace.", level: "B1" },
      { word: "rooftop", phonetic: "/ruf.tp/", pos: "noun", vietnamese: "mi nh", example: "The rooftop bar is open until midnight.", level: "B1" },
      { word: "self-service", phonetic: "/self s.vs/", pos: "adj", vietnamese: "t phc v", example: "This is a self-service restaurant.", level: "B1" },
      { word: "all-you-can-eat", phonetic: "/l ju kn it/", pos: "adj", vietnamese: "n th ga", example: "The buffet is all-you-can-eat for $20.", level: "B1" },
      { word: "set menu", phonetic: "/set men.ju/", pos: "noun", vietnamese: "thc n c nh", example: "The set menu includes soup and dessert.", level: "B1" },
      { word: "kids menu", phonetic: "/kdz men.ju/", pos: "noun", vietnamese: "thc n tr em", example: "Do you have a kids menu?", level: "B1" },
      { word: "happy hour", phonetic: "/hp.i ar/", pos: "noun", vietnamese: "gi khuyn mi", example: "Drinks are half price during happy hour.", level: "B2" }
    ],
    "Job & Career (Food Industry)": [
      { word: "barista", phonetic: "/brs.t/", pos: "noun", vietnamese: "nhn vin pha c ph", example: "The barista made a perfect latte art.", level: "B1" },
      { word: "baker", phonetic: "/be.kr/", pos: "noun", vietnamese: "th lm bnh", example: "The baker starts work at 4 AM.", level: "B1" },
      { word: "butcher", phonetic: "/bt.r/", pos: "noun", vietnamese: "ngi bn tht", example: "Ask the butcher for fresh cuts.", level: "B1" },
      { word: "cashier", phonetic: "/kr/", pos: "noun", vietnamese: "thu ngn", example: "The cashier scanned my items quickly.", level: "B1" },
      { word: "delivery", phonetic: "/dlv.r.i/", pos: "noun", vietnamese: "giao hng", example: "Food delivery is available until 10 PM.", level: "B1" },
      { word: "takeout", phonetic: "/tek.at/", pos: "noun", vietnamese: " mang v", example: "Ill get takeout from the Thai place.", level: "B1" },
      { word: "drive-thru", phonetic: "/drav ru/", pos: "noun", vietnamese: "dch v xe hi", example: "Lets use the drive-thru to save time.", level: "B1" },
      { word: "food truck", phonetic: "/fud trk/", pos: "noun", vietnamese: "xe ti  n", example: "The taco food truck is amazing.", level: "B1" },
      { word: "street food", phonetic: "/strit fud/", pos: "noun", vietnamese: " n ng ph", example: "Vietnam is famous for street food.", level: "B1" },
      { word: "pop-up", phonetic: "/pp p/", pos: "noun", vietnamese: "qun tm thi", example: "The pop-up restaurant lasts only one month.", level: "B2" }
    ]
  },
  "EDUCATION": {
    "Academic Terms": [
      { word: "notebook", phonetic: "/nt.bk/", pos: "noun", vietnamese: "v", example: "I write all my notes in a notebook.", level: "B1" },
      { word: "textbook", phonetic: "/tekst.bk/", pos: "noun", vietnamese: "sch gio khoa", example: "The textbook costs $80.", level: "B1" },
      { word: "dictionary", phonetic: "/dk.n.r.i/", pos: "noun", vietnamese: "t in", example: "Use a dictionary to check spelling.", level: "B1" },
      { word: "library", phonetic: "/la.brr.i/", pos: "noun", vietnamese: "th vin", example: "The library is open until 9 PM.", level: "B1" },
      { word: "laboratory", phonetic: "/lbr..tr.i/", pos: "noun", vietnamese: "phng th nghim", example: "We do experiments in the laboratory.", level: "B1" },
      { word: "playground", phonetic: "/ple.rand/", pos: "noun", vietnamese: "sn chi", example: "Children play in the school playground.", level: "B1" },
      { word: "canteen", phonetic: "/kntin/", pos: "noun", vietnamese: "nh n", example: "Lunch is served in the canteen.", level: "B1" },
      { word: "uniform", phonetic: "/ju.n.fm/", pos: "noun", vietnamese: "ng phc", example: "Students must wear a uniform.", level: "B1" },
      { word: "principal", phonetic: "/prn.s.pl/", pos: "noun", vietnamese: "hiu trng", example: "The principal gave a speech.", level: "B1" },
      { word: "timetable", phonetic: "/tamte.bl/", pos: "noun", vietnamese: "thi kha biu", example: "Check the timetable for class changes.", level: "B1" },
      { word: "break time", phonetic: "/brek tam/", pos: "noun", vietnamese: "gi gii lao", example: "We play football during break time.", level: "B1" },
      { word: "assembly", phonetic: "/sem.bli/", pos: "noun", vietnamese: "bui cho c", example: "The assembly starts at 8 AM.", level: "B1" }
    ],
    "Study Requirements": [
      { word: "project", phonetic: "/prd.ekt/", pos: "noun", vietnamese: "d n", example: "Were working on a group project.", level: "B1" },
      { word: "quiz", phonetic: "/kwz/", pos: "noun", vietnamese: "bi kim tra nh", example: "We have a quiz every Friday.", level: "B1" },
      { word: "revision", phonetic: "/rv.n/", pos: "noun", vietnamese: "n tp", example: "I need two hours for revision.", level: "B1" },
      { word: "notes", phonetic: "/nts/", pos: "noun", vietnamese: "ghi chp", example: "Take clear notes during the lecture.", level: "B1" },
      { word: "summary", phonetic: "/sm.r.i/", pos: "noun", vietnamese: "tm tt", example: "Write a summary of the chapter.", level: "B1" },
      { word: "deadline", phonetic: "/ded.lan/", pos: "noun", vietnamese: "hn cht", example: "The deadline is next Monday.", level: "B1" },
      { word: "extension", phonetic: "/ksten.n/", pos: "noun", vietnamese: "gia hn", example: "Can I get an extension for the essay?", level: "B2" },
      { word: "oral exam", phonetic: "/.rl zm/", pos: "noun", vietnamese: "thi ni", example: "The oral exam is worth 30%.", level: "B1" },
      { word: "multiple choice", phonetic: "/ml.t.pl ts/", pos: "adj", vietnamese: "trc nghim", example: "The test is multiple choice.", level: "B1" },
      { word: "true or false", phonetic: "/tru r fls/", pos: "phrase", vietnamese: "ng sai", example: "Answer true or false.", level: "B1" }
    ],
    "Performance & Learning": [
      { word: "improve", phonetic: "/mpruv/", pos: "verb", vietnamese: "ci thin", example: "I want to improve my English.", level: "B1" },
      { word: "practice", phonetic: "/prk.ts/", pos: "verb", vietnamese: "luyn tp", example: "Practice makes perfect.", level: "B1" },
      { word: "mistake", phonetic: "/mstek/", pos: "noun", vietnamese: "li", example: "We learn from our mistakes.", level: "B1" },
      { word: "effort", phonetic: "/ef.t/", pos: "noun", vietnamese: "n lc", example: "You need to make more effort.", level: "B1" },
      { word: "skill", phonetic: "/skl/", pos: "noun", vietnamese: "k nng", example: "Reading is an important skill.", level: "B1" },
      { word: "talent", phonetic: "/tl.nt/", pos: "noun", vietnamese: "ti nng", example: "She has a talent for music.", level: "B1" },
      { word: "weak", phonetic: "/wik/", pos: "adj", vietnamese: "yu", example: "Math is my weak subject.", level: "B1" },
      { word: "strong", phonetic: "/str/", pos: "adj", vietnamese: "mnh", example: "English is my strong subject.", level: "B1" },
      { word: "confident", phonetic: "/kn.f.dnt/", pos: "adj", vietnamese: "t tin", example: "I feel confident about the exam.", level: "B1" },
      { word: "nervous", phonetic: "/n.vs/", pos: "adj", vietnamese: "lo lng", example: "I get nervous before speaking.", level: "B1" }
    ]
  },
  "SHOPPING & CUSTOMER SERVICE": {
    "Returns & Refunds": [
      { word: "fitting room", phonetic: "/ft. rum/", pos: "noun", vietnamese: "phng th ", example: "Can I use the fitting room?", level: "B1" },
      { word: "try on", phonetic: "/tra n/", pos: "verb", vietnamese: "th ", example: "Can I try on this dress?", level: "B1" },
      { word: "fit", phonetic: "/ft/", pos: "verb", vietnamese: "va", example: "These shoes fit perfectly.", level: "B1" },
      { word: "tight", phonetic: "/tat/", pos: "adj", vietnamese: "cht", example: "This shirt is too tight.", level: "B1" },
      { word: "loose", phonetic: "/lus/", pos: "adj", vietnamese: "rng", example: "These pants are too loose.", level: "B1" },
      { word: "medium", phonetic: "/mi.di.m/", pos: "noun", vietnamese: "c va", example: "I wear medium size.", level: "B1" },
      { word: "refundable", phonetic: "/rfn.d.bl/", pos: "adj", vietnamese: "c th hon tin", example: "Tickets are non-refundable.", level: "B2" },
      { word: "store credit", phonetic: "/str kred.t/", pos: "noun", vietnamese: "tn dng ca hng", example: "They gave me store credit instead of cash.", level: "B2" }
    ],
    "Problems & Solutions": [
      { word: "out of stock", phonetic: "/at v stk/", pos: "phrase", vietnamese: "ht hng", example: "Sorry, that item is out of stock.", level: "B1" },
      { word: "sold out", phonetic: "/sld at/", pos: "adj", vietnamese: "bn ht", example: "The concert is sold out.", level: "B1" },
      { word: "damaged", phonetic: "/dm.dd/", pos: "adj", vietnamese: "hng", example: "This box is damaged.", level: "B1" },
      { word: "faulty", phonetic: "/fl.ti/", pos: "adj", vietnamese: "li k thut", example: "The phone is faulty.", level: "B2" },
      { word: "replace", phonetic: "/rples/", pos: "verb", vietnamese: "thay th", example: "Can you replace this item?", level: "B1" },
      { word: "apologize", phonetic: "/pl..daz/", pos: "verb", vietnamese: "xin li", example: "We apologize for the delay.", level: "B1" },
      { word: "complain", phonetic: "/kmplen/", pos: "verb", vietnamese: "phn nn", example: "I want to complain about the service.", level: "B1" }
    ],
    "Service & Quality": [
      { word: "helpful", phonetic: "/help.fl/", pos: "adj", vietnamese: "hu ch", example: "The staff is very helpful.", level: "B1" },
      { word: "friendly", phonetic: "/frend.li/", pos: "adj", vietnamese: "thn thin", example: "The shop assistant is friendly.", level: "B1" },
      { word: "rude", phonetic: "/rud/", pos: "adj", vietnamese: "th l", example: "The cashier was rude to me.", level: "B1" },
      { word: "variety", phonetic: "/vra..ti/", pos: "noun", vietnamese: "a dng", example: "This store has a good variety of products.", level: "B1" },
      { word: "range", phonetic: "/rend/", pos: "noun", vietnamese: "phm vi", example: "They offer a wide range of sizes.", level: "B1" },
      { word: "affordable", phonetic: "/f.d.bl/", pos: "adj", vietnamese: "hp ti tin", example: "The prices are affordable.", level: "B1" },
      { word: "overpriced", phonetic: "/.vprast/", pos: "adj", vietnamese: "t ", example: "This caf is overpriced.", level: "B2" },
      { word: "bargain", phonetic: "/b.n/", pos: "noun", vietnamese: "mn hi", example: "I got these shoes at a bargain.", level: "B1" }
    ],
    "Customer Relations": [
      { word: "regular", phonetic: "/re.j.lr/", pos: "adj", vietnamese: "thng xuyn", example: "Hes a regular customer here.", level: "B1" },
      { word: "recommend", phonetic: "/rek.mend/", pos: "verb", vietnamese: "gii thiu", example: "Can you recommend a good phone?", level: "B1" },
      { word: "review", phonetic: "/rvju/", pos: "noun", vietnamese: "nh gi", example: "I left a five-star review.", level: "B1" },
      { word: "rating", phonetic: "/re.t/", pos: "noun", vietnamese: "xp hng", example: "The hotel has a 4.8 rating.", level: "B1" },
      { word: "loyal", phonetic: "/l.l/", pos: "adj", vietnamese: "trung thnh", example: "We reward loyal customers.", level: "B1" },
      { word: "VIP", phonetic: "/vi a pi/", pos: "noun", vietnamese: "khch VIP", example: "VIP members get free shipping.", level: "B1" }
    ]
  },
  "BUSINESS & WORKPLACE": {
    "Company Operations": [
      { word: "branch", phonetic: "/brnt/", pos: "noun", vietnamese: "chi nhnh", example: "Were opening a new branch in Da Nang.", level: "B1" },
      { word: "department", phonetic: "/dpt.mnt/", pos: "noun", vietnamese: "phng ban", example: "I work in the marketing department.", level: "B1" },
      { word: "staff", phonetic: "/stf/", pos: "noun", vietnamese: "nhn vin", example: "The staff meeting is at 9 AM.", level: "B1" },
      { word: "salary", phonetic: "/sl.r.i/", pos: "noun", vietnamese: "lng", example: "My salary is paid monthly.", level: "B1" },
      { word: "contract", phonetic: "/kn.trkt/", pos: "noun", vietnamese: "hp ng", example: "Sign the contract before starting.", level: "B1" },
      { word: "client", phonetic: "/kla.nt/", pos: "noun", vietnamese: "khch hng", example: "We have a meeting with the client.", level: "B1" },
      { word: "deadline", phonetic: "/ded.lan/", pos: "noun", vietnamese: "hn cht", example: "The project deadline is Friday.", level: "B1" },
      { word: "overtime", phonetic: "/.v.tam/", pos: "noun", vietnamese: "tng ca", example: "I worked overtime last week.", level: "B1" },
      { word: "remote", phonetic: "/rmt/", pos: "adj", vietnamese: "t xa", example: "I work remote three days a week.", level: "B1" },
      { word: "flexible", phonetic: "/flek.s.bl/", pos: "adj", vietnamese: "linh hot", example: "We offer flexible working hours.", level: "B1" }
    ],
    "Performance & Reviews": [
      { word: "raise", phonetic: "/rez/", pos: "noun", vietnamese: "tng lng", example: "I got a raise after one year.", level: "B1" },
      { word: "bonus", phonetic: "/b.ns/", pos: "noun", vietnamese: "thng", example: "We get a year-end bonus.", level: "B1" },
      { word: "target", phonetic: "/t.t/", pos: "noun", vietnamese: "mc tiu", example: "We hit our sales target.", level: "B1" },
      { word: "feedback", phonetic: "/fid.bk/", pos: "noun", vietnamese: "phn hi", example: "I need feedback on my presentation.", level: "B1" },
      { word: "strength", phonetic: "/stre/", pos: "noun", vietnamese: "im mnh", example: "Teamwork is my strength.", level: "B1" },
      { word: "weakness", phonetic: "/wik.ns/", pos: "noun", vietnamese: "im yu", example: "Public speaking is my weakness.", level: "B1" },
      { word: "skill", phonetic: "/skl/", pos: "noun", vietnamese: "k nng", example: "Communication is a key skill.", level: "B1" },
      { word: "training", phonetic: "/tre.n/", pos: "noun", vietnamese: "o to", example: "New staff get two weeks of training.", level: "B1" }
    ],
    "Materials & Products": [
      { word: "sample", phonetic: "/sm.pl/", pos: "noun", vietnamese: "mu th", example: "Can I have a free sample?", level: "B1" },
      { word: "catalog", phonetic: "/kt..l/", pos: "noun", vietnamese: "danh mc", example: "Check the catalog for new items.", level: "B1" },
      { word: "brochure", phonetic: "/br.r/", pos: "noun", vietnamese: "ti liu gii thiu", example: "Take a brochure for more information.", level: "B1" },
      { word: "label", phonetic: "/le.bl/", pos: "noun", vietnamese: "nhn", example: "Check the label for washing instructions.", level: "B1" },
      { word: "barcode", phonetic: "/b.kd/", pos: "noun", vietnamese: "m vch", example: "Scan the barcode at checkout.", level: "B1" },
      { word: "packaging", phonetic: "/pk..d/", pos: "noun", vietnamese: "bao b", example: "The packaging is eco-friendly.", level: "B1" }
    ],
    "Work Environment": [
      { word: "meeting room", phonetic: "/mi.t rum/", pos: "noun", vietnamese: "phng hp", example: "Book the meeting room for 2 PM.", level: "B1" },
      { word: "printer", phonetic: "/prn.tr/", pos: "noun", vietnamese: "my in", example: "The printer is out of ink.", level: "B1" },
      { word: "copier", phonetic: "/kp.i.r/", pos: "noun", vietnamese: "my photocopy", example: "Use the copier on the second floor.", level: "B1" },
      { word: "Wi-Fi", phonetic: "/wa.fa/", pos: "noun", vietnamese: "mng khng dy", example: "The office Wi-Fi is fast.", level: "B1" },
      { word: "air conditioning", phonetic: "/e knd.n./", pos: "noun", vietnamese: "my lnh", example: "The air conditioning is too cold.", level: "B1" },
      { word: "break room", phonetic: "/brek rum/", pos: "noun", vietnamese: "phng ngh", example: "Lets have coffee in the break room.", level: "B1" }
    ],
    "Projects & Planning": [
      { word: "schedule", phonetic: "/ed.jul/", pos: "noun", vietnamese: "lch trnh", example: "Check the schedule for updates.", level: "B1" },
      { word: "task", phonetic: "/tsk/", pos: "noun", vietnamese: "nhim v", example: "Finish this task by Friday.", level: "B1" },
      { word: "priority", phonetic: "/prar..ti/", pos: "noun", vietnamese: "u tin", example: "This is top priority.", level: "B1" },
      { word: "update", phonetic: "/pdet/", pos: "noun", vietnamese: "cp nht", example: "Send me a project update.", level: "B1" },
      { word: "progress", phonetic: "/pr.res/", pos: "noun", vietnamese: "tin ", example: "Were making good progress.", level: "B1" }
    ]
  },
  "COMMUNICATION": {
    "Product Launch & Marketing": [
      { word: "advertisement", phonetic: "/dv.ts.mnt/", pos: "noun", vietnamese: "qung co", example: "I saw your advertisement online.", level: "B1" },
      { word: "slogan", phonetic: "/sl.n/", pos: "noun", vietnamese: "khu hiu", example: "Just Do It is a famous slogan.", level: "B1" },
      { word: "poster", phonetic: "/p.str/", pos: "noun", vietnamese: "p phch", example: "Put the poster on the wall.", level: "B1" },
      { word: "commercial", phonetic: "/km.l/", pos: "noun", vietnamese: "qung co TV", example: "The commercial was funny.", level: "B1" },
      { word: "influencer", phonetic: "/n.flu.n.sr/", pos: "noun", vietnamese: "ngi nh hng", example: "We hired a social media influencer.", level: "B1" },
      { word: "viral", phonetic: "/va.rl/", pos: "adj", vietnamese: "lan truyn", example: "The video went viral overnight.", level: "B1" }
    ],
    "Team Collaboration": [
      { word: "discuss", phonetic: "/dsks/", pos: "verb", vietnamese: "tho lun", example: "Lets discuss the plan.", level: "B1" },
      { word: "suggest", phonetic: "/sdest/", pos: "verb", vietnamese: " xut", example: "I suggest we meet at 10 AM.", level: "B1" },
       { word: "disagree", phonetic: "/ds.ri/", pos: "verb", vietnamese: "khng ng ", example: "I disagree with that decision.", level: "B1" },
      { word: "opinion", phonetic: "/pn.jn/", pos: "noun", vietnamese: " kin", example: "Whats your opinion?", level: "B1" },
      { word: "decision", phonetic: "/ds.n/", pos: "noun", vietnamese: "quyt nh", example: "We made a final decision.", level: "B1" }
    ],
    "Design & Materials": [
      { word: "pattern", phonetic: "/pt.n/", pos: "noun", vietnamese: "hoa vn", example: "I like the floral pattern.", level: "B1" },
      { word: "plain", phonetic: "/plen/", pos: "adj", vietnamese: "trn", example: "I prefer plain colors.", level: "B1" },
      { word: "striped", phonetic: "/strapt/", pos: "adj", vietnamese: "sc", example: "He wore a striped shirt.", level: "B1" },
      { word: "checked", phonetic: "/tekt/", pos: "adj", vietnamese: "k caro", example: "She has a checked skirt.", level: "B1" },
      { word: "leather", phonetic: "/le.r/", pos: "noun", vietnamese: "da", example: "This bag is made of leather.", level: "B1" },
      { word: "cotton", phonetic: "/kt.n/", pos: "noun", vietnamese: "vi cotton", example: "I wear cotton in summer.", level: "B1" }
    ],
    "Feedback & Adjustments": [
      { word: "change", phonetic: "/tend/", pos: "verb", vietnamese: "thay i", example: "We need to change the design.", level: "B1" },
      { word: "fix", phonetic: "/fks/", pos: "verb", vietnamese: "sa", example: "Can you fix this error?", level: "B1" },
      { word: "update", phonetic: "/pdet/", pos: "verb", vietnamese: "cp nht", example: "Please update the file.", level: "B1" },
      { word: "correct", phonetic: "/krekt/", pos: "verb", vietnamese: "sa li", example: "Correct the spelling mistakes.", level: "B1" },
      { word: "improve", phonetic: "/mpruv/", pos: "verb", vietnamese: "ci thin", example: "How can we improve this?", level: "B1" }
    ],
    "Events & Presentations": [
      { word: "audience", phonetic: "/.di.ns/", pos: "noun", vietnamese: "khn gi", example: "The audience clapped loudly.", level: "B1" },
      { word: "slide", phonetic: "/slad/", pos: "noun", vietnamese: "trang chiu", example: "Next slide, please.", level: "B1" },
      { word: "projector", phonetic: "/prdek.tr/", pos: "noun", vietnamese: "my chiu", example: "The projector isnt working.", level: "B1" },
      { word: "speech", phonetic: "/spit/", pos: "noun", vietnamese: "bi pht biu", example: "She gave a great speech.", level: "B1" },
      { word: "host", phonetic: "/hst/", pos: "verb", vietnamese: "dn chng trnh", example: "He will host the event.", level: "B1" }
    ]
  },
  "AUDIO & VOICE SERVICES": {
    "Voice Recording": [
      { word: "headphones", phonetic: "/hed.fnz/", pos: "noun", vietnamese: "tai nghe", example: "I use headphones to record voice.", level: "B1" },
      { word: "speaker", phonetic: "/spi.kr/", pos: "noun", vietnamese: "loa", example: "The speaker volume is low.", level: "B1" },
      { word: "volume", phonetic: "/vl.jum/", pos: "noun", vietnamese: "m lng", example: "Turn up the volume.", level: "B1" },
      { word: "pause", phonetic: "/pz/", pos: "verb", vietnamese: "tm dng", example: "Pause the recording here.", level: "B1" },
      { word: "record", phonetic: "/rkd/", pos: "verb", vietnamese: "ghi m", example: "Let me record your voice.", level: "B1" }
    ],
    "Service Features": [
      { word: "clear", phonetic: "/klr/", pos: "adj", vietnamese: "r rng", example: "The sound is very clear.", level: "B1" },
      { word: "loud", phonetic: "/lad/", pos: "adj", vietnamese: "to", example: "The music is too loud.", level: "B1" },
      { word: "quiet", phonetic: "/kwa.t/", pos: "adj", vietnamese: "nh", example: "Keep your voice quiet.", level: "B1" },
      { word: "fast", phonetic: "/fst/", pos: "adj", vietnamese: "nhanh", example: "Speak fast or slow?", level: "B1" },
      { word: "slow", phonetic: "/sl/", pos: "adj", vietnamese: "chm", example: "Please speak slow.", level: "B1" }
    ],
    "Audio Production": [
      { word: "edit", phonetic: "/ed.t/", pos: "verb", vietnamese: "chnh sa", example: "I will edit the audio.", level: "B1" },
      { word: "cut", phonetic: "/kt/", pos: "verb", vietnamese: "ct", example: "Cut this part out.", level: "B1" },
      { word: "add", phonetic: "/d/", pos: "verb", vietnamese: "thm", example: "Add music at the beginning.", level: "B1" },
      { word: "save", phonetic: "/sev/", pos: "verb", vietnamese: "lu", example: "Save the file as MP3.", level: "B1" },
      { word: "export", phonetic: "/kspt/", pos: "verb", vietnamese: "xut file", example: "Export in high quality.", level: "B2" }
    ],
    "Client Communication": [
      { word: "message", phonetic: "/mes.d/", pos: "noun", vietnamese: "tin nhn", example: "I sent you a message.", level: "B1" },
      { word: "reply", phonetic: "/rpla/", pos: "verb", vietnamese: "tr li", example: "Please reply soon.", level: "B1" },
      { word: "attachment", phonetic: "/tt.mnt/", pos: "noun", vietnamese: "tp nh km", example: "Check the attachment.", level: "B1" },
      { word: "subject", phonetic: "/sb.dekt/", pos: "noun", vietnamese: "ch ", example: "Write a clear subject.", level: "B1" },
      { word: "forward", phonetic: "/f.wd/", pos: "verb", vietnamese: "chuyn tip", example: "Forward this email to the team.", level: "B1" }
    ]
  },
  "TEXT MESSAGING": {
     
    "Expressing Agreement": [
      { word: "cool", phonetic: "/kul/", pos: "adj", vietnamese: "tuyt", example: "Cool, see you then!", level: "B1" },
      { word: "awesome", phonetic: "/.sm/", pos: "adj", vietnamese: "tuyt vi", example: "Thats awesome!", level: "B1" },
      { word: "great", phonetic: "/ret/", pos: "adj", vietnamese: "tuyt", example: "Great idea!", level: "B1" },
      { word: "perfect", phonetic: "/p.fekt/", pos: "adj", vietnamese: "hon ho", example: "Perfect, lets do it.", level: "B1" },
      { word: "sounds good", phonetic: "/sandz d/", pos: "phrase", vietnamese: "nghe hay y", example: "Sounds good to me.", level: "B1" },
      { word: "deal", phonetic: "/dil/", pos: "noun", vietnamese: "tha thun", example: "Deal! See you at 7.", level: "B1" }
    ]
  }
};
</file>

<file path="src/data/vocabularyHelpers.js">
// vocabularyHelpers.js - Helper Functions for Vocabulary Data

import VOCABULARY_DATA from './vocabularyData';

// Get vocabulary by level
export const getVocabularyByLevel = (level) => {
  const levelLower = level.toLowerCase();
  return VOCABULARY_DATA[levelLower] || VOCABULARY_DATA.beginner;
};

// Search vocabulary across all levels
export const searchVocabulary = (query) => {
  const results = [];
  Object.values(VOCABULARY_DATA).forEach(levelData => {
    Object.values(levelData.categories).forEach(category => {
      const filtered = category.words.filter(word => 
        word.word.toLowerCase().includes(query.toLowerCase()) ||
        word.definition.toLowerCase().includes(query.toLowerCase()) ||
        word.vietnamese.toLowerCase().includes(query.toLowerCase()) ||
        word.alternatives.some(alt => alt.toLowerCase().includes(query.toLowerCase()))
      );
      results.push(...filtered);
    });
  });
  return results;
};

// Get random word from specific level
export const getRandomWord = (level = 'beginner') => {
  const levelData = getVocabularyByLevel(level);
  const allWords = [];
  Object.values(levelData.categories).forEach(category => {
    allWords.push(...category.words);
  });
  return allWords[Math.floor(Math.random() * allWords.length)];
};

// Get all words across all levels
export const getAllWords = () => {
  const allWords = [];
  Object.values(VOCABULARY_DATA).forEach(levelData => {
    Object.values(levelData.categories).forEach(category => {
      allWords.push(...category.words);
    });
  });
  return allWords;
};

// Get exam vocabulary statistics
export const getExamVocabulary = () => {
  let totalWords = 0;
  Object.values(VOCABULARY_DATA).forEach(levelData => {
    Object.values(levelData.categories).forEach(category => {
      totalWords += category.words.length;
    });
  });

  return {
    totalWords: totalWords,
    examTopics: ['Travel', 'Business', 'Communication', 'Analysis', 'Marketing', 'Professional', 'Technical'],
  };
};

// Create flashcards from vocabulary
export const createFlashcards = (level) => {
  const levelData = getVocabularyByLevel(level);
  const flashcards = [];
  
  Object.values(levelData.categories).forEach(category => {
    category.words.forEach(word => {
      flashcards.push({
        id: word.id,
        front: word.word,
        back: word.definition,
        pronunciation: word.pronunciation,
        example: word.example,
        vietnamese: word.vietnamese,
        category: category.title,
        level: level,
      });
    });
  });

  return flashcards;
};

// Get vocabulary by specific category
export const getVocabularyByCategory = (category, level = 'beginner') => {
  const levelData = getVocabularyByLevel(level);
  return levelData.categories[category]?.words || [];
};

// Create quiz with random questions
export const createQuiz = (level, count = 10) => {
  const allWords = [];
  const levelData = getVocabularyByLevel(level);
  
  Object.values(levelData.categories).forEach(category => {
    allWords.push(...category.words);
  });

  const shuffled = [...allWords].sort(() => Math.random() - 0.5);
  const selected = shuffled.slice(0, Math.min(count, allWords.length));

  return selected.map(word => ({
    id: word.id,
    word: word.word,
    options: [
      word.definition,
      word.alternatives[0],
      word.alternatives[1],
      word.alternatives[2],
    ].sort(() => Math.random() - 0.5),
    correct: word.definition,
    pronunciation: word.pronunciation,
    vietnamese: word.vietnamese,
    example: word.example,
  }));
};

// Get category statistics
export const getCategoryStats = (level = 'beginner') => {
  const levelData = getVocabularyByLevel(level);
  const stats = {};
  
  Object.entries(levelData.categories).forEach(([key, category]) => {
    stats[key] = {
      name: category.title,
      count: category.words.length,
      description: category.description,
    };
  });

  return stats;
};

// Get words by difficulty/level
export const getWordsByDifficulty = (level) => {
  const words = [];
  const levelData = getVocabularyByLevel(level);
  
  Object.values(levelData.categories).forEach(category => {
    words.push(...category.words);
  });

  return {
    level: level,
    totalWords: words.length,
    words: words,
  };
};

// Calculate learning progress
export const calculateProgress = (completedWords, vocabularyData) => {
  if (!vocabularyData || !vocabularyData.categories) return 0;
  
  let totalWords = 0;
  Object.values(vocabularyData.categories).forEach(category => {
    totalWords += category.words.length;
  });
  
  return totalWords > 0 ? Math.round((completedWords.length / totalWords) * 100) : 0;
};

// Handle flashcard navigation
export const handleFlashcardNav = (direction, currentIndex, flashcards) => {
  if (direction === 'prev') {
    return Math.max(0, currentIndex - 1);
  }
  return Math.min(flashcards.length - 1, currentIndex + 1);
};

// Get words by category with stats
export const getWordsWithStats = (level) => {
  const levelData = getVocabularyByLevel(level);
  const categoriesWithStats = {};
  
  Object.entries(levelData.categories).forEach(([key, category]) => {
    categoriesWithStats[key] = {
      id: category.id,
      title: category.title,
      description: category.description,
      words: category.words,
      wordCount: category.words.length,
    };
  });
  
  return categoriesWithStats;
};

// Filter words by difficulty range
export const filterWordsByRange = (words, minLength, maxLength) => {
  return words.filter(word => 
    word.word.length >= minLength && word.word.length <= maxLength
  );
};

// Get most common words
export const getMostCommonWords = (level, count = 20) => {
  const allWords = [];
  const levelData = getVocabularyByLevel(level);
  
  Object.values(levelData.categories).forEach(category => {
    allWords.push(...category.words);
  });

  return allWords.slice(0, count);
};

// Export all helpers as object for convenience
export const vocabHelpers = {
  getVocabularyByLevel,
  searchVocabulary,
  getRandomWord,
  getAllWords,
  getExamVocabulary,
  createFlashcards,
  getVocabularyByCategory,
  createQuiz,
  getCategoryStats,
  getWordsByDifficulty,
  calculateProgress,
  handleFlashcardNav,
  getWordsWithStats,
  filterWordsByRange,
  getMostCommonWords,
};
</file>

<file path="src/dataconnect-generated/.guides/config.json">
{
  "description": "A set of guides for interacting with the generated firebase dataconnect sdk",
  "mcpServers": {
    "firebase": {
      "command": "npx",
      "args": ["-y", "firebase-tools@latest", "experimental:mcp"]
    }
  }
}
</file>

<file path="src/dataconnect-generated/.guides/setup.md">
# Setup

If the user hasn't already installed the SDK, always run the user's node package manager of choice, and install the package in the directory ../package.json.
For more information on where the library is located, look at the connector.yaml file.

```ts
import { initializeApp } from 'firebase/app';

initializeApp({
  // fill in your project config here using the values from your Firebase project or from the `firebase_get_sdk_config` tool from the Firebase MCP server.
});
```

Then, you can run the SDK as needed.
```ts
import { ... } from '@dataconnect/generated';
```




## React
### Setup

The user should make sure to install the `@tanstack/react-query` package, along with `@tanstack-query-firebase/react` and `firebase`.

Then, they should initialize Firebase:
```ts
import { initializeApp } from 'firebase/app';
initializeApp(firebaseConfig); /* your config here. To generate this, you can use the `firebase_sdk_config` MCP tool */
```

Then, they should add a `QueryClientProvider` to their root of their application.

Here's an example:

```ts
import { initializeApp } from 'firebase/app';
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

const firebaseConfig = {
  /* your config here. To generate this, you can use the `firebase_sdk_config` MCP tool */
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

// Create a TanStack Query client instance
const queryClient = new QueryClient();

function App() {
  return (
    // Provide the client to your App
    <QueryClientProvider client={queryClient}>
      <MyApplication />
    </QueryClientProvider>
  )
}

render(<App />, document.getElementById('root'));
```
</file>

<file path="src/dataconnect-generated/.guides/usage.md">
# Basic Usage

Always prioritize using a supported framework over using the generated SDK
directly. Supported frameworks simplify the developer experience and help ensure
best practices are followed.




### React
For each operation, there is a wrapper hook that can be used to call the operation.

Here are all of the hooks that get generated:
```ts
import { useCreateNewList, useGetMyLists, useAddMovieToList, useGetMoviesInList } from '@dataconnect/generated/react';
// The types of these hooks are available in react/index.d.ts

const { data, isPending, isSuccess, isError, error } = useCreateNewList(createNewListVars);

const { data, isPending, isSuccess, isError, error } = useGetMyLists();

const { data, isPending, isSuccess, isError, error } = useAddMovieToList(addMovieToListVars);

const { data, isPending, isSuccess, isError, error } = useGetMoviesInList(getMoviesInListVars);

```

Here's an example from a different generated SDK:

```ts
import { useListAllMovies } from '@dataconnect/generated/react';

function MyComponent() {
  const { isLoading, data, error } = useListAllMovies();
  if(isLoading) {
    return <div>Loading...</div>
  }
  if(error) {
    return <div> An Error Occurred: {error} </div>
  }
}

// App.tsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import MyComponent from './my-component';

function App() {
  const queryClient = new QueryClient();
  return <QueryClientProvider client={queryClient}>
    <MyComponent />
  </QueryClientProvider>
}
```



## Advanced Usage
If a user is not using a supported framework, they can use the generated SDK directly.

Here's an example of how to use it with the first 5 operations:

```js
import { createNewList, getMyLists, addMovieToList, getMoviesInList } from '@dataconnect/generated';


// Operation CreateNewList:  For variables, look at type CreateNewListVars in ../index.d.ts
const { data } = await CreateNewList(dataConnect, createNewListVars);

// Operation GetMyLists: 
const { data } = await GetMyLists(dataConnect);

// Operation AddMovieToList:  For variables, look at type AddMovieToListVars in ../index.d.ts
const { data } = await AddMovieToList(dataConnect, addMovieToListVars);

// Operation GetMoviesInList:  For variables, look at type GetMoviesInListVars in ../index.d.ts
const { data } = await GetMoviesInList(dataConnect, getMoviesInListVars);


```
</file>

<file path="src/dataconnect-generated/esm/index.esm.js">
import { queryRef, executeQuery, mutationRef, executeMutation, validateArgs } from 'firebase/data-connect';

export const connectorConfig = {
  connector: 'example',
  service: 'listening',
  location: 'us-east4'
};

export const createNewListRef = (dcOrVars, vars) => {
  const { dc: dcInstance, vars: inputVars} = validateArgs(connectorConfig, dcOrVars, vars, true);
  dcInstance._useGeneratedSdk();
  return mutationRef(dcInstance, 'CreateNewList', inputVars);
}
createNewListRef.operationName = 'CreateNewList';

export function createNewList(dcOrVars, vars) {
  return executeMutation(createNewListRef(dcOrVars, vars));
}

export const getMyListsRef = (dc) => {
  const { dc: dcInstance} = validateArgs(connectorConfig, dc, undefined);
  dcInstance._useGeneratedSdk();
  return queryRef(dcInstance, 'GetMyLists');
}
getMyListsRef.operationName = 'GetMyLists';

export function getMyLists(dc) {
  return executeQuery(getMyListsRef(dc));
}

export const addMovieToListRef = (dcOrVars, vars) => {
  const { dc: dcInstance, vars: inputVars} = validateArgs(connectorConfig, dcOrVars, vars, true);
  dcInstance._useGeneratedSdk();
  return mutationRef(dcInstance, 'AddMovieToList', inputVars);
}
addMovieToListRef.operationName = 'AddMovieToList';

export function addMovieToList(dcOrVars, vars) {
  return executeMutation(addMovieToListRef(dcOrVars, vars));
}

export const getMoviesInListRef = (dcOrVars, vars) => {
  const { dc: dcInstance, vars: inputVars} = validateArgs(connectorConfig, dcOrVars, vars, true);
  dcInstance._useGeneratedSdk();
  return queryRef(dcInstance, 'GetMoviesInList', inputVars);
}
getMoviesInListRef.operationName = 'GetMoviesInList';

export function getMoviesInList(dcOrVars, vars) {
  return executeQuery(getMoviesInListRef(dcOrVars, vars));
}
</file>

<file path="src/dataconnect-generated/esm/package.json">
{"type":"module"}
</file>

<file path="src/dataconnect-generated/index.cjs.js">
const { queryRef, executeQuery, mutationRef, executeMutation, validateArgs } = require('firebase/data-connect');

const connectorConfig = {
  connector: 'example',
  service: 'listening',
  location: 'us-east4'
};
exports.connectorConfig = connectorConfig;

const createNewListRef = (dcOrVars, vars) => {
  const { dc: dcInstance, vars: inputVars} = validateArgs(connectorConfig, dcOrVars, vars, true);
  dcInstance._useGeneratedSdk();
  return mutationRef(dcInstance, 'CreateNewList', inputVars);
}
createNewListRef.operationName = 'CreateNewList';
exports.createNewListRef = createNewListRef;

exports.createNewList = function createNewList(dcOrVars, vars) {
  return executeMutation(createNewListRef(dcOrVars, vars));
};

const getMyListsRef = (dc) => {
  const { dc: dcInstance} = validateArgs(connectorConfig, dc, undefined);
  dcInstance._useGeneratedSdk();
  return queryRef(dcInstance, 'GetMyLists');
}
getMyListsRef.operationName = 'GetMyLists';
exports.getMyListsRef = getMyListsRef;

exports.getMyLists = function getMyLists(dc) {
  return executeQuery(getMyListsRef(dc));
};

const addMovieToListRef = (dcOrVars, vars) => {
  const { dc: dcInstance, vars: inputVars} = validateArgs(connectorConfig, dcOrVars, vars, true);
  dcInstance._useGeneratedSdk();
  return mutationRef(dcInstance, 'AddMovieToList', inputVars);
}
addMovieToListRef.operationName = 'AddMovieToList';
exports.addMovieToListRef = addMovieToListRef;

exports.addMovieToList = function addMovieToList(dcOrVars, vars) {
  return executeMutation(addMovieToListRef(dcOrVars, vars));
};

const getMoviesInListRef = (dcOrVars, vars) => {
  const { dc: dcInstance, vars: inputVars} = validateArgs(connectorConfig, dcOrVars, vars, true);
  dcInstance._useGeneratedSdk();
  return queryRef(dcInstance, 'GetMoviesInList', inputVars);
}
getMoviesInListRef.operationName = 'GetMoviesInList';
exports.getMoviesInListRef = getMoviesInListRef;

exports.getMoviesInList = function getMoviesInList(dcOrVars, vars) {
  return executeQuery(getMoviesInListRef(dcOrVars, vars));
};
</file>

<file path="src/dataconnect-generated/index.d.ts">
import { ConnectorConfig, DataConnect, QueryRef, QueryPromise, MutationRef, MutationPromise } from 'firebase/data-connect';

export const connectorConfig: ConnectorConfig;

export type TimestampString = string;
export type UUIDString = string;
export type Int64String = string;
export type DateString = string;




export interface AddMovieToListData {
  listItem_insert: ListItem_Key;
}

export interface AddMovieToListVariables {
  listId: UUIDString;
  movieId: UUIDString;
  note?: string | null;
  position: number;
}

export interface CreateNewListData {
  list_insert: List_Key;
}

export interface CreateNewListVariables {
  name: string;
  description?: string | null;
  isPublic?: boolean | null;
}

export interface GetMoviesInListData {
  list?: {
    movies_via_ListItem: ({
      id: UUIDString;
      title: string;
      year: number;
      summary?: string | null;
      runtime?: number | null;
      genres?: string[] | null;
    } & Movie_Key)[];
  };
}

export interface GetMoviesInListVariables {
  listId: UUIDString;
}

export interface GetMyListsData {
  lists: ({
    id: UUIDString;
    name: string;
    description?: string | null;
    isPublic?: boolean | null;
    createdAt: TimestampString;
    updatedAt: TimestampString;
  } & List_Key)[];
}

export interface ListItem_Key {
  listId: UUIDString;
  movieId: UUIDString;
  __typename?: 'ListItem_Key';
}

export interface List_Key {
  id: UUIDString;
  __typename?: 'List_Key';
}

export interface Movie_Key {
  id: UUIDString;
  __typename?: 'Movie_Key';
}

export interface Review_Key {
  id: UUIDString;
  __typename?: 'Review_Key';
}

export interface User_Key {
  id: UUIDString;
  __typename?: 'User_Key';
}

export interface Watch_Key {
  id: UUIDString;
  __typename?: 'Watch_Key';
}

interface CreateNewListRef {
  /* Allow users to create refs without passing in DataConnect */
  (vars: CreateNewListVariables): MutationRef<CreateNewListData, CreateNewListVariables>;
  /* Allow users to pass in custom DataConnect instances */
  (dc: DataConnect, vars: CreateNewListVariables): MutationRef<CreateNewListData, CreateNewListVariables>;
  operationName: string;
}
export const createNewListRef: CreateNewListRef;

export function createNewList(vars: CreateNewListVariables): MutationPromise<CreateNewListData, CreateNewListVariables>;
export function createNewList(dc: DataConnect, vars: CreateNewListVariables): MutationPromise<CreateNewListData, CreateNewListVariables>;

interface GetMyListsRef {
  /* Allow users to create refs without passing in DataConnect */
  (): QueryRef<GetMyListsData, undefined>;
  /* Allow users to pass in custom DataConnect instances */
  (dc: DataConnect): QueryRef<GetMyListsData, undefined>;
  operationName: string;
}
export const getMyListsRef: GetMyListsRef;

export function getMyLists(): QueryPromise<GetMyListsData, undefined>;
export function getMyLists(dc: DataConnect): QueryPromise<GetMyListsData, undefined>;

interface AddMovieToListRef {
  /* Allow users to create refs without passing in DataConnect */
  (vars: AddMovieToListVariables): MutationRef<AddMovieToListData, AddMovieToListVariables>;
  /* Allow users to pass in custom DataConnect instances */
  (dc: DataConnect, vars: AddMovieToListVariables): MutationRef<AddMovieToListData, AddMovieToListVariables>;
  operationName: string;
}
export const addMovieToListRef: AddMovieToListRef;

export function addMovieToList(vars: AddMovieToListVariables): MutationPromise<AddMovieToListData, AddMovieToListVariables>;
export function addMovieToList(dc: DataConnect, vars: AddMovieToListVariables): MutationPromise<AddMovieToListData, AddMovieToListVariables>;

interface GetMoviesInListRef {
  /* Allow users to create refs without passing in DataConnect */
  (vars: GetMoviesInListVariables): QueryRef<GetMoviesInListData, GetMoviesInListVariables>;
  /* Allow users to pass in custom DataConnect instances */
  (dc: DataConnect, vars: GetMoviesInListVariables): QueryRef<GetMoviesInListData, GetMoviesInListVariables>;
  operationName: string;
}
export const getMoviesInListRef: GetMoviesInListRef;

export function getMoviesInList(vars: GetMoviesInListVariables): QueryPromise<GetMoviesInListData, GetMoviesInListVariables>;
export function getMoviesInList(dc: DataConnect, vars: GetMoviesInListVariables): QueryPromise<GetMoviesInListData, GetMoviesInListVariables>;
</file>

<file path="src/dataconnect-generated/package.json">
{
  "name": "@dataconnect/generated",
  "version": "1.0.0",
  "author": "Firebase <firebase-support@google.com> (https://firebase.google.com/)",
  "description": "Generated SDK For example",
  "license": "Apache-2.0",
  "engines": {
    "node": " >=18.0"
  },
  "typings": "index.d.ts",
  "module": "esm/index.esm.js",
  "main": "index.cjs.js",
  "browser": "esm/index.esm.js",
  "exports": {
    ".": {
      "types": "./index.d.ts",
      "require": "./index.cjs.js",
      "default": "./esm/index.esm.js"
    },
    "./react": {
      "types": "./react/index.d.ts",
      "require": "./react/index.cjs.js",
      "import": "./react/esm/index.esm.js",
      "default": "./react/esm/index.esm.js"
    },
    "./package.json": "./package.json"
  },
  "peerDependencies": {
    "firebase": "^11.3.0 || ^12.0.0",
    "@tanstack-query-firebase/react": "^2.0.0"
  }
}
</file>

<file path="src/dataconnect-generated/react/esm/index.esm.js">
import { createNewListRef, getMyListsRef, addMovieToListRef, getMoviesInListRef, connectorConfig } from '../../esm/index.esm.js';
import { validateArgs, CallerSdkTypeEnum } from 'firebase/data-connect';
import { useDataConnectQuery, useDataConnectMutation, validateReactArgs } from '@tanstack-query-firebase/react/data-connect';

export function useCreateNewList(dcOrOptions, options) {
  const { dc: dcInstance, vars: inputOpts } = validateArgs(connectorConfig, dcOrOptions, options);
  function refFactory(vars) {
    return createNewListRef(dcInstance, vars);
  }
  return useDataConnectMutation(refFactory, inputOpts, CallerSdkTypeEnum.GeneratedReact);
}


export function useGetMyLists(dcOrOptions, options) {
  const { dc: dcInstance, options: inputOpts } = validateReactArgs(connectorConfig, dcOrOptions, options);
  const ref = getMyListsRef(dcInstance);
  return useDataConnectQuery(ref, inputOpts, CallerSdkTypeEnum.GeneratedReact);
}
export function useAddMovieToList(dcOrOptions, options) {
  const { dc: dcInstance, vars: inputOpts } = validateArgs(connectorConfig, dcOrOptions, options);
  function refFactory(vars) {
    return addMovieToListRef(dcInstance, vars);
  }
  return useDataConnectMutation(refFactory, inputOpts, CallerSdkTypeEnum.GeneratedReact);
}


export function useGetMoviesInList(dcOrVars, varsOrOptions, options) {
  const { dc: dcInstance, vars: inputVars, options: inputOpts } = validateReactArgs(connectorConfig, dcOrVars, varsOrOptions, options, true, true);
  const ref = getMoviesInListRef(dcInstance, inputVars);
  return useDataConnectQuery(ref, inputOpts, CallerSdkTypeEnum.GeneratedReact);
}
</file>

<file path="src/dataconnect-generated/react/esm/package.json">
{"type":"module"}
</file>

<file path="src/dataconnect-generated/react/index.cjs.js">
const { createNewListRef, getMyListsRef, addMovieToListRef, getMoviesInListRef, connectorConfig } = require('../index.cjs.js');
const { validateArgs, CallerSdkTypeEnum } = require('firebase/data-connect');
const { useDataConnectQuery, useDataConnectMutation, validateReactArgs } = require('@tanstack-query-firebase/react/data-connect');

exports.useCreateNewList = function useCreateNewList(dcOrOptions, options) {
  const { dc: dcInstance, vars: inputOpts } = validateArgs(connectorConfig, dcOrOptions, options);
  function refFactory(vars) {
    return createNewListRef(dcInstance, vars);
  }
  return useDataConnectMutation(refFactory, inputOpts, CallerSdkTypeEnum.GeneratedReact);
}


exports.useGetMyLists = function useGetMyLists(dcOrOptions, options) {
  const { dc: dcInstance, options: inputOpts } = validateReactArgs(connectorConfig, dcOrOptions, options);
  const ref = getMyListsRef(dcInstance);
  return useDataConnectQuery(ref, inputOpts, CallerSdkTypeEnum.GeneratedReact);
}
exports.useAddMovieToList = function useAddMovieToList(dcOrOptions, options) {
  const { dc: dcInstance, vars: inputOpts } = validateArgs(connectorConfig, dcOrOptions, options);
  function refFactory(vars) {
    return addMovieToListRef(dcInstance, vars);
  }
  return useDataConnectMutation(refFactory, inputOpts, CallerSdkTypeEnum.GeneratedReact);
}


exports.useGetMoviesInList = function useGetMoviesInList(dcOrVars, varsOrOptions, options) {
  const { dc: dcInstance, vars: inputVars, options: inputOpts } = validateReactArgs(connectorConfig, dcOrVars, varsOrOptions, options, true, true);
  const ref = getMoviesInListRef(dcInstance, inputVars);
  return useDataConnectQuery(ref, inputOpts, CallerSdkTypeEnum.GeneratedReact);
}
</file>

<file path="src/dataconnect-generated/react/index.d.ts">
import { CreateNewListData, CreateNewListVariables, GetMyListsData, AddMovieToListData, AddMovieToListVariables, GetMoviesInListData, GetMoviesInListVariables } from '../';
import { UseDataConnectQueryResult, useDataConnectQueryOptions, UseDataConnectMutationResult, useDataConnectMutationOptions} from '@tanstack-query-firebase/react/data-connect';
import { UseQueryResult, UseMutationResult} from '@tanstack/react-query';
import { DataConnect } from 'firebase/data-connect';
import { FirebaseError } from 'firebase/app';


export function useCreateNewList(options?: useDataConnectMutationOptions<CreateNewListData, FirebaseError, CreateNewListVariables>): UseDataConnectMutationResult<CreateNewListData, CreateNewListVariables>;
export function useCreateNewList(dc: DataConnect, options?: useDataConnectMutationOptions<CreateNewListData, FirebaseError, CreateNewListVariables>): UseDataConnectMutationResult<CreateNewListData, CreateNewListVariables>;

export function useGetMyLists(options?: useDataConnectQueryOptions<GetMyListsData>): UseDataConnectQueryResult<GetMyListsData, undefined>;
export function useGetMyLists(dc: DataConnect, options?: useDataConnectQueryOptions<GetMyListsData>): UseDataConnectQueryResult<GetMyListsData, undefined>;

export function useAddMovieToList(options?: useDataConnectMutationOptions<AddMovieToListData, FirebaseError, AddMovieToListVariables>): UseDataConnectMutationResult<AddMovieToListData, AddMovieToListVariables>;
export function useAddMovieToList(dc: DataConnect, options?: useDataConnectMutationOptions<AddMovieToListData, FirebaseError, AddMovieToListVariables>): UseDataConnectMutationResult<AddMovieToListData, AddMovieToListVariables>;

export function useGetMoviesInList(vars: GetMoviesInListVariables, options?: useDataConnectQueryOptions<GetMoviesInListData>): UseDataConnectQueryResult<GetMoviesInListData, GetMoviesInListVariables>;
export function useGetMoviesInList(dc: DataConnect, vars: GetMoviesInListVariables, options?: useDataConnectQueryOptions<GetMoviesInListData>): UseDataConnectQueryResult<GetMoviesInListData, GetMoviesInListVariables>;
</file>

<file path="src/dataconnect-generated/react/package.json">
{
  "name": "@dataconnect/generated-react",
  "version": "1.0.0",
  "author": "Firebase <firebase-support@google.com> (https://firebase.google.com/)",
  "description": "Generated SDK For example",
  "license": "Apache-2.0",
  "engines": {
    "node": " >=18.0"
  },
  "typings": "index.d.ts",
  "main": "index.cjs.js",
  "module": "esm/index.esm.js",
  "browser": "esm/index.esm.js",
  "peerDependencies": {
    "@tanstack-query-firebase/react": "^2.0.0"
  }
}
</file>

<file path="src/dataconnect-generated/react/README.md">
# Generated React README
This README will guide you through the process of using the generated React SDK package for the connector `example`. It will also provide examples on how to use your generated SDK to call your Data Connect queries and mutations.

**If you're looking for the `JavaScript README`, you can find it at [`dataconnect-generated/README.md`](../README.md)**

***NOTE:** This README is generated alongside the generated SDK. If you make changes to this file, they will be overwritten when the SDK is regenerated.*

You can use this generated SDK by importing from the package `@dataconnect/generated/react` as shown below. Both CommonJS and ESM imports are supported.

You can also follow the instructions from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#react).

# Table of Contents
- [**Overview**](#generated-react-readme)
- [**TanStack Query Firebase & TanStack React Query**](#tanstack-query-firebase-tanstack-react-query)
  - [*Package Installation*](#installing-tanstack-query-firebase-and-tanstack-react-query-packages)
  - [*Configuring TanStack Query*](#configuring-tanstack-query)
- [**Accessing the connector**](#accessing-the-connector)
  - [*Connecting to the local Emulator*](#connecting-to-the-local-emulator)
- [**Queries**](#queries)
  - [*GetMyLists*](#getmylists)
  - [*GetMoviesInList*](#getmoviesinlist)
- [**Mutations**](#mutations)
  - [*CreateNewList*](#createnewlist)
  - [*AddMovieToList*](#addmovietolist)

# TanStack Query Firebase & TanStack React Query
This SDK provides [React](https://react.dev/) hooks generated specific to your application, for the operations found in the connector `example`. These hooks are generated using [TanStack Query Firebase](https://react-query-firebase.invertase.dev/) by our partners at Invertase, a library built on top of [TanStack React Query v5](https://tanstack.com/query/v5/docs/framework/react/overview).

***You do not need to be familiar with Tanstack Query or Tanstack Query Firebase to use this SDK.*** However, you may find it useful to learn more about them, as they will empower you as a user of this Generated React SDK.

## Installing TanStack Query Firebase and TanStack React Query Packages
In order to use the React generated SDK, you must install the `TanStack React Query` and `TanStack Query Firebase` packages.
```bash
npm i --save @tanstack/react-query @tanstack-query-firebase/react
```
```bash
npm i --save firebase@latest # Note: React has a peer dependency on ^11.3.0
```

You can also follow the installation instructions from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#tanstack-install), or the [TanStack Query Firebase documentation](https://react-query-firebase.invertase.dev/react) and [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/installation).

## Configuring TanStack Query
In order to use the React generated SDK in your application, you must wrap your application's component tree in a `QueryClientProvider` component from TanStack React Query. None of your generated React SDK hooks will work without this provider.

```javascript
import { QueryClientProvider } from '@tanstack/react-query';

// Create a TanStack Query client instance
const queryClient = new QueryClient()

function App() {
  return (
    // Provide the client to your App
    <QueryClientProvider client={queryClient}>
      <MyApplication />
    </QueryClientProvider>
  )
}
```

To learn more about `QueryClientProvider`, see the [TanStack React Query documentation](https://tanstack.com/query/latest/docs/framework/react/quick-start) and the [TanStack Query Firebase documentation](https://invertase.docs.page/tanstack-query-firebase/react#usage).

# Accessing the connector
A connector is a collection of Queries and Mutations. One SDK is generated for each connector - this SDK is generated for the connector `example`.

You can find more information about connectors in the [Data Connect documentation](https://firebase.google.com/docs/data-connect#how-does).

```javascript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig } from '@dataconnect/generated';

const dataConnect = getDataConnect(connectorConfig);
```

## Connecting to the local Emulator
By default, the connector will connect to the production service.

To connect to the emulator, you can use the following code.
You can also follow the emulator instructions from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#emulator-react-angular).

```javascript
import { connectDataConnectEmulator, getDataConnect } from 'firebase/data-connect';
import { connectorConfig } from '@dataconnect/generated';

const dataConnect = getDataConnect(connectorConfig);
connectDataConnectEmulator(dataConnect, 'localhost', 9399);
```

After it's initialized, you can call your Data Connect [queries](#queries) and [mutations](#mutations) using the hooks provided from your generated React SDK.

# Queries

The React generated SDK provides Query hook functions that call and return [`useDataConnectQuery`](https://react-query-firebase.invertase.dev/react/data-connect/querying) hooks from TanStack Query Firebase.

Calling these hook functions will return a `UseQueryResult` object. This object holds the state of your Query, including whether the Query is loading, has completed, or has succeeded/failed, and the most recent data returned by the Query, among other things. To learn more about these hooks and how to use them, see the [TanStack Query Firebase documentation](https://react-query-firebase.invertase.dev/react/data-connect/querying).

TanStack React Query caches the results of your Queries, so using the same Query hook function in multiple places in your application allows the entire application to automatically see updates to that Query's data.

Query hooks execute their Queries automatically when called, and periodically refresh, unless you change the `queryOptions` for the Query. To learn how to stop a Query from automatically executing, including how to make a query "lazy", see the [TanStack React Query documentation](https://tanstack.com/query/latest/docs/framework/react/guides/disabling-queries).

To learn more about TanStack React Query's Queries, see the [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/guides/queries).

## Using Query Hooks
Here's a general overview of how to use the generated Query hooks in your code:

- If the Query has no variables, the Query hook function does not require arguments.
- If the Query has any required variables, the Query hook function will require at least one argument: an object that contains all the required variables for the Query.
- If the Query has some required and some optional variables, only required variables are necessary in the variables argument object, and optional variables may be provided as well.
- If all of the Query's variables are optional, the Query hook function does not require any arguments.
- Query hook functions can be called with or without passing in a `DataConnect` instance as an argument. If no `DataConnect` argument is passed in, then the generated SDK will call `getDataConnect(connectorConfig)` behind the scenes for you.
- Query hooks functions can be called with or without passing in an `options` argument of type `useDataConnectQueryOptions`. To learn more about the `options` argument, see the [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/guides/query-options).
  - ***Special case:***  If the Query has all optional variables and you would like to provide an `options` argument to the Query hook function without providing any variables, you must pass `undefined` where you would normally pass the Query's variables, and then may provide the `options` argument.

Below are examples of how to use the `example` connector's generated Query hook functions to execute each Query. You can also follow the examples from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#operations-react-angular).

## GetMyLists
You can execute the `GetMyLists` Query using the following Query hook function, which is defined in [dataconnect-generated/react/index.d.ts](./index.d.ts):

```javascript
useGetMyLists(dc: DataConnect, options?: useDataConnectQueryOptions<GetMyListsData>): UseDataConnectQueryResult<GetMyListsData, undefined>;
```
You can also pass in a `DataConnect` instance to the Query hook function.
```javascript
useGetMyLists(options?: useDataConnectQueryOptions<GetMyListsData>): UseDataConnectQueryResult<GetMyListsData, undefined>;
```

### Variables
The `GetMyLists` Query has no variables.
### Return Type
Recall that calling the `GetMyLists` Query hook function returns a `UseQueryResult` object. This object holds the state of your Query, including whether the Query is loading, has completed, or has succeeded/failed, and any data returned by the Query, among other things.

To check the status of a Query, use the `UseQueryResult.status` field. You can also check for pending / success / error status using the `UseQueryResult.isPending`, `UseQueryResult.isSuccess`, and `UseQueryResult.isError` fields.

To access the data returned by a Query, use the `UseQueryResult.data` field. The data for the `GetMyLists` Query is of type `GetMyListsData`, which is defined in [dataconnect-generated/index.d.ts](../index.d.ts). It has the following fields:
```javascript
export interface GetMyListsData {
  lists: ({
    id: UUIDString;
    name: string;
    description?: string | null;
    isPublic?: boolean | null;
    createdAt: TimestampString;
    updatedAt: TimestampString;
  } & List_Key)[];
}
```

To learn more about the `UseQueryResult` object, see the [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/reference/useQuery).

### Using `GetMyLists`'s Query hook function

```javascript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig } from '@dataconnect/generated';
import { useGetMyLists } from '@dataconnect/generated/react'

export default function GetMyListsComponent() {
  // You don't have to do anything to "execute" the Query.
  // Call the Query hook function to get a `UseQueryResult` object which holds the state of your Query.
  const query = useGetMyLists();

  // You can also pass in a `DataConnect` instance to the Query hook function.
  const dataConnect = getDataConnect(connectorConfig);
  const query = useGetMyLists(dataConnect);

  // You can also pass in a `useDataConnectQueryOptions` object to the Query hook function.
  const options = { staleTime: 5 * 1000 };
  const query = useGetMyLists(options);

  // You can also pass both a `DataConnect` instance and a `useDataConnectQueryOptions` object.
  const dataConnect = getDataConnect(connectorConfig);
  const options = { staleTime: 5 * 1000 };
  const query = useGetMyLists(dataConnect, options);

  // Then, you can render your component dynamically based on the status of the Query.
  if (query.isPending) {
    return <div>Loading...</div>;
  }

  if (query.isError) {
    return <div>Error: {query.error.message}</div>;
  }

  // If the Query is successful, you can access the data returned using the `UseQueryResult.data` field.
  if (query.isSuccess) {
    console.log(query.data.lists);
  }
  return <div>Query execution {query.isSuccess ? 'successful' : 'failed'}!</div>;
}
```

## GetMoviesInList
You can execute the `GetMoviesInList` Query using the following Query hook function, which is defined in [dataconnect-generated/react/index.d.ts](./index.d.ts):

```javascript
useGetMoviesInList(dc: DataConnect, vars: GetMoviesInListVariables, options?: useDataConnectQueryOptions<GetMoviesInListData>): UseDataConnectQueryResult<GetMoviesInListData, GetMoviesInListVariables>;
```
You can also pass in a `DataConnect` instance to the Query hook function.
```javascript
useGetMoviesInList(vars: GetMoviesInListVariables, options?: useDataConnectQueryOptions<GetMoviesInListData>): UseDataConnectQueryResult<GetMoviesInListData, GetMoviesInListVariables>;
```

### Variables
The `GetMoviesInList` Query requires an argument of type `GetMoviesInListVariables`, which is defined in [dataconnect-generated/index.d.ts](../index.d.ts). It has the following fields:

```javascript
export interface GetMoviesInListVariables {
  listId: UUIDString;
}
```
### Return Type
Recall that calling the `GetMoviesInList` Query hook function returns a `UseQueryResult` object. This object holds the state of your Query, including whether the Query is loading, has completed, or has succeeded/failed, and any data returned by the Query, among other things.

To check the status of a Query, use the `UseQueryResult.status` field. You can also check for pending / success / error status using the `UseQueryResult.isPending`, `UseQueryResult.isSuccess`, and `UseQueryResult.isError` fields.

To access the data returned by a Query, use the `UseQueryResult.data` field. The data for the `GetMoviesInList` Query is of type `GetMoviesInListData`, which is defined in [dataconnect-generated/index.d.ts](../index.d.ts). It has the following fields:
```javascript
export interface GetMoviesInListData {
  list?: {
    movies_via_ListItem: ({
      id: UUIDString;
      title: string;
      year: number;
      summary?: string | null;
      runtime?: number | null;
      genres?: string[] | null;
    } & Movie_Key)[];
  };
}
```

To learn more about the `UseQueryResult` object, see the [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/reference/useQuery).

### Using `GetMoviesInList`'s Query hook function

```javascript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig, GetMoviesInListVariables } from '@dataconnect/generated';
import { useGetMoviesInList } from '@dataconnect/generated/react'

export default function GetMoviesInListComponent() {
  // The `useGetMoviesInList` Query hook requires an argument of type `GetMoviesInListVariables`:
  const getMoviesInListVars: GetMoviesInListVariables = {
    listId: ..., 
  };

  // You don't have to do anything to "execute" the Query.
  // Call the Query hook function to get a `UseQueryResult` object which holds the state of your Query.
  const query = useGetMoviesInList(getMoviesInListVars);
  // Variables can be defined inline as well.
  const query = useGetMoviesInList({ listId: ..., });

  // You can also pass in a `DataConnect` instance to the Query hook function.
  const dataConnect = getDataConnect(connectorConfig);
  const query = useGetMoviesInList(dataConnect, getMoviesInListVars);

  // You can also pass in a `useDataConnectQueryOptions` object to the Query hook function.
  const options = { staleTime: 5 * 1000 };
  const query = useGetMoviesInList(getMoviesInListVars, options);

  // You can also pass both a `DataConnect` instance and a `useDataConnectQueryOptions` object.
  const dataConnect = getDataConnect(connectorConfig);
  const options = { staleTime: 5 * 1000 };
  const query = useGetMoviesInList(dataConnect, getMoviesInListVars, options);

  // Then, you can render your component dynamically based on the status of the Query.
  if (query.isPending) {
    return <div>Loading...</div>;
  }

  if (query.isError) {
    return <div>Error: {query.error.message}</div>;
  }

  // If the Query is successful, you can access the data returned using the `UseQueryResult.data` field.
  if (query.isSuccess) {
    console.log(query.data.list);
  }
  return <div>Query execution {query.isSuccess ? 'successful' : 'failed'}!</div>;
}
```

# Mutations

The React generated SDK provides Mutations hook functions that call and return [`useDataConnectMutation`](https://react-query-firebase.invertase.dev/react/data-connect/mutations) hooks from TanStack Query Firebase.

Calling these hook functions will return a `UseMutationResult` object. This object holds the state of your Mutation, including whether the Mutation is loading, has completed, or has succeeded/failed, and the most recent data returned by the Mutation, among other things. To learn more about these hooks and how to use them, see the [TanStack Query Firebase documentation](https://react-query-firebase.invertase.dev/react/data-connect/mutations).

Mutation hooks do not execute their Mutations automatically when called. Rather, after calling the Mutation hook function and getting a `UseMutationResult` object, you must call the `UseMutationResult.mutate()` function to execute the Mutation.

To learn more about TanStack React Query's Mutations, see the [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/guides/mutations).

## Using Mutation Hooks
Here's a general overview of how to use the generated Mutation hooks in your code:

- Mutation hook functions are not called with the arguments to the Mutation. Instead, arguments are passed to `UseMutationResult.mutate()`.
- If the Mutation has no variables, the `mutate()` function does not require arguments.
- If the Mutation has any required variables, the `mutate()` function will require at least one argument: an object that contains all the required variables for the Mutation.
- If the Mutation has some required and some optional variables, only required variables are necessary in the variables argument object, and optional variables may be provided as well.
- If all of the Mutation's variables are optional, the Mutation hook function does not require any arguments.
- Mutation hook functions can be called with or without passing in a `DataConnect` instance as an argument. If no `DataConnect` argument is passed in, then the generated SDK will call `getDataConnect(connectorConfig)` behind the scenes for you.
- Mutation hooks also accept an `options` argument of type `useDataConnectMutationOptions`. To learn more about the `options` argument, see the [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/guides/mutations#mutation-side-effects).
  - `UseMutationResult.mutate()` also accepts an `options` argument of type `useDataConnectMutationOptions`.
  - ***Special case:*** If the Mutation has no arguments (or all optional arguments and you wish to provide none), and you want to pass `options` to `UseMutationResult.mutate()`, you must pass `undefined` where you would normally pass the Mutation's arguments, and then may provide the options argument.

Below are examples of how to use the `example` connector's generated Mutation hook functions to execute each Mutation. You can also follow the examples from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#operations-react-angular).

## CreateNewList
You can execute the `CreateNewList` Mutation using the `UseMutationResult` object returned by the following Mutation hook function (which is defined in [dataconnect-generated/react/index.d.ts](./index.d.ts)):
```javascript
useCreateNewList(options?: useDataConnectMutationOptions<CreateNewListData, FirebaseError, CreateNewListVariables>): UseDataConnectMutationResult<CreateNewListData, CreateNewListVariables>;
```
You can also pass in a `DataConnect` instance to the Mutation hook function.
```javascript
useCreateNewList(dc: DataConnect, options?: useDataConnectMutationOptions<CreateNewListData, FirebaseError, CreateNewListVariables>): UseDataConnectMutationResult<CreateNewListData, CreateNewListVariables>;
```

### Variables
The `CreateNewList` Mutation requires an argument of type `CreateNewListVariables`, which is defined in [dataconnect-generated/index.d.ts](../index.d.ts). It has the following fields:

```javascript
export interface CreateNewListVariables {
  name: string;
  description?: string | null;
  isPublic?: boolean | null;
}
```
### Return Type
Recall that calling the `CreateNewList` Mutation hook function returns a `UseMutationResult` object. This object holds the state of your Mutation, including whether the Mutation is loading, has completed, or has succeeded/failed, among other things.

To check the status of a Mutation, use the `UseMutationResult.status` field. You can also check for pending / success / error status using the `UseMutationResult.isPending`, `UseMutationResult.isSuccess`, and `UseMutationResult.isError` fields.

To execute the Mutation, call `UseMutationResult.mutate()`. This function executes the Mutation, but does not return the data from the Mutation.

To access the data returned by a Mutation, use the `UseMutationResult.data` field. The data for the `CreateNewList` Mutation is of type `CreateNewListData`, which is defined in [dataconnect-generated/index.d.ts](../index.d.ts). It has the following fields:
```javascript
export interface CreateNewListData {
  list_insert: List_Key;
}
```

To learn more about the `UseMutationResult` object, see the [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/reference/useMutation).

### Using `CreateNewList`'s Mutation hook function

```javascript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig, CreateNewListVariables } from '@dataconnect/generated';
import { useCreateNewList } from '@dataconnect/generated/react'

export default function CreateNewListComponent() {
  // Call the Mutation hook function to get a `UseMutationResult` object which holds the state of your Mutation.
  const mutation = useCreateNewList();

  // You can also pass in a `DataConnect` instance to the Mutation hook function.
  const dataConnect = getDataConnect(connectorConfig);
  const mutation = useCreateNewList(dataConnect);

  // You can also pass in a `useDataConnectMutationOptions` object to the Mutation hook function.
  const options = {
    onSuccess: () => { console.log('Mutation succeeded!'); }
  };
  const mutation = useCreateNewList(options);

  // You can also pass both a `DataConnect` instance and a `useDataConnectMutationOptions` object.
  const dataConnect = getDataConnect(connectorConfig);
  const options = {
    onSuccess: () => { console.log('Mutation succeeded!'); }
  };
  const mutation = useCreateNewList(dataConnect, options);

  // After calling the Mutation hook function, you must call `UseMutationResult.mutate()` to execute the Mutation.
  // The `useCreateNewList` Mutation requires an argument of type `CreateNewListVariables`:
  const createNewListVars: CreateNewListVariables = {
    name: ..., 
    description: ..., // optional
    isPublic: ..., // optional
  };
  mutation.mutate(createNewListVars);
  // Variables can be defined inline as well.
  mutation.mutate({ name: ..., description: ..., isPublic: ..., });

  // You can also pass in a `useDataConnectMutationOptions` object to `UseMutationResult.mutate()`.
  const options = {
    onSuccess: () => { console.log('Mutation succeeded!'); }
  };
  mutation.mutate(createNewListVars, options);

  // Then, you can render your component dynamically based on the status of the Mutation.
  if (mutation.isPending) {
    return <div>Loading...</div>;
  }

  if (mutation.isError) {
    return <div>Error: {mutation.error.message}</div>;
  }

  // If the Mutation is successful, you can access the data returned using the `UseMutationResult.data` field.
  if (mutation.isSuccess) {
    console.log(mutation.data.list_insert);
  }
  return <div>Mutation execution {mutation.isSuccess ? 'successful' : 'failed'}!</div>;
}
```

## AddMovieToList
You can execute the `AddMovieToList` Mutation using the `UseMutationResult` object returned by the following Mutation hook function (which is defined in [dataconnect-generated/react/index.d.ts](./index.d.ts)):
```javascript
useAddMovieToList(options?: useDataConnectMutationOptions<AddMovieToListData, FirebaseError, AddMovieToListVariables>): UseDataConnectMutationResult<AddMovieToListData, AddMovieToListVariables>;
```
You can also pass in a `DataConnect` instance to the Mutation hook function.
```javascript
useAddMovieToList(dc: DataConnect, options?: useDataConnectMutationOptions<AddMovieToListData, FirebaseError, AddMovieToListVariables>): UseDataConnectMutationResult<AddMovieToListData, AddMovieToListVariables>;
```

### Variables
The `AddMovieToList` Mutation requires an argument of type `AddMovieToListVariables`, which is defined in [dataconnect-generated/index.d.ts](../index.d.ts). It has the following fields:

```javascript
export interface AddMovieToListVariables {
  listId: UUIDString;
  movieId: UUIDString;
  note?: string | null;
  position: number;
}
```
### Return Type
Recall that calling the `AddMovieToList` Mutation hook function returns a `UseMutationResult` object. This object holds the state of your Mutation, including whether the Mutation is loading, has completed, or has succeeded/failed, among other things.

To check the status of a Mutation, use the `UseMutationResult.status` field. You can also check for pending / success / error status using the `UseMutationResult.isPending`, `UseMutationResult.isSuccess`, and `UseMutationResult.isError` fields.

To execute the Mutation, call `UseMutationResult.mutate()`. This function executes the Mutation, but does not return the data from the Mutation.

To access the data returned by a Mutation, use the `UseMutationResult.data` field. The data for the `AddMovieToList` Mutation is of type `AddMovieToListData`, which is defined in [dataconnect-generated/index.d.ts](../index.d.ts). It has the following fields:
```javascript
export interface AddMovieToListData {
  listItem_insert: ListItem_Key;
}
```

To learn more about the `UseMutationResult` object, see the [TanStack React Query documentation](https://tanstack.com/query/v5/docs/framework/react/reference/useMutation).

### Using `AddMovieToList`'s Mutation hook function

```javascript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig, AddMovieToListVariables } from '@dataconnect/generated';
import { useAddMovieToList } from '@dataconnect/generated/react'

export default function AddMovieToListComponent() {
  // Call the Mutation hook function to get a `UseMutationResult` object which holds the state of your Mutation.
  const mutation = useAddMovieToList();

  // You can also pass in a `DataConnect` instance to the Mutation hook function.
  const dataConnect = getDataConnect(connectorConfig);
  const mutation = useAddMovieToList(dataConnect);

  // You can also pass in a `useDataConnectMutationOptions` object to the Mutation hook function.
  const options = {
    onSuccess: () => { console.log('Mutation succeeded!'); }
  };
  const mutation = useAddMovieToList(options);

  // You can also pass both a `DataConnect` instance and a `useDataConnectMutationOptions` object.
  const dataConnect = getDataConnect(connectorConfig);
  const options = {
    onSuccess: () => { console.log('Mutation succeeded!'); }
  };
  const mutation = useAddMovieToList(dataConnect, options);

  // After calling the Mutation hook function, you must call `UseMutationResult.mutate()` to execute the Mutation.
  // The `useAddMovieToList` Mutation requires an argument of type `AddMovieToListVariables`:
  const addMovieToListVars: AddMovieToListVariables = {
    listId: ..., 
    movieId: ..., 
    note: ..., // optional
    position: ..., 
  };
  mutation.mutate(addMovieToListVars);
  // Variables can be defined inline as well.
  mutation.mutate({ listId: ..., movieId: ..., note: ..., position: ..., });

  // You can also pass in a `useDataConnectMutationOptions` object to `UseMutationResult.mutate()`.
  const options = {
    onSuccess: () => { console.log('Mutation succeeded!'); }
  };
  mutation.mutate(addMovieToListVars, options);

  // Then, you can render your component dynamically based on the status of the Mutation.
  if (mutation.isPending) {
    return <div>Loading...</div>;
  }

  if (mutation.isError) {
    return <div>Error: {mutation.error.message}</div>;
  }

  // If the Mutation is successful, you can access the data returned using the `UseMutationResult.data` field.
  if (mutation.isSuccess) {
    console.log(mutation.data.listItem_insert);
  }
  return <div>Mutation execution {mutation.isSuccess ? 'successful' : 'failed'}!</div>;
}
```
</file>

<file path="src/dataconnect-generated/README.md">
# Generated TypeScript README
This README will guide you through the process of using the generated JavaScript SDK package for the connector `example`. It will also provide examples on how to use your generated SDK to call your Data Connect queries and mutations.

**If you're looking for the `React README`, you can find it at [`dataconnect-generated/react/README.md`](./react/README.md)**

***NOTE:** This README is generated alongside the generated SDK. If you make changes to this file, they will be overwritten when the SDK is regenerated.*

# Table of Contents
- [**Overview**](#generated-javascript-readme)
- [**Accessing the connector**](#accessing-the-connector)
  - [*Connecting to the local Emulator*](#connecting-to-the-local-emulator)
- [**Queries**](#queries)
  - [*GetMyLists*](#getmylists)
  - [*GetMoviesInList*](#getmoviesinlist)
- [**Mutations**](#mutations)
  - [*CreateNewList*](#createnewlist)
  - [*AddMovieToList*](#addmovietolist)

# Accessing the connector
A connector is a collection of Queries and Mutations. One SDK is generated for each connector - this SDK is generated for the connector `example`. You can find more information about connectors in the [Data Connect documentation](https://firebase.google.com/docs/data-connect#how-does).

You can use this generated SDK by importing from the package `@dataconnect/generated` as shown below. Both CommonJS and ESM imports are supported.

You can also follow the instructions from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#set-client).

```typescript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig } from '@dataconnect/generated';

const dataConnect = getDataConnect(connectorConfig);
```

## Connecting to the local Emulator
By default, the connector will connect to the production service.

To connect to the emulator, you can use the following code.
You can also follow the emulator instructions from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#instrument-clients).

```typescript
import { connectDataConnectEmulator, getDataConnect } from 'firebase/data-connect';
import { connectorConfig } from '@dataconnect/generated';

const dataConnect = getDataConnect(connectorConfig);
connectDataConnectEmulator(dataConnect, 'localhost', 9399);
```

After it's initialized, you can call your Data Connect [queries](#queries) and [mutations](#mutations) from your generated SDK.

# Queries

There are two ways to execute a Data Connect Query using the generated Web SDK:
- Using a Query Reference function, which returns a `QueryRef`
  - The `QueryRef` can be used as an argument to `executeQuery()`, which will execute the Query and return a `QueryPromise`
- Using an action shortcut function, which returns a `QueryPromise`
  - Calling the action shortcut function will execute the Query and return a `QueryPromise`

The following is true for both the action shortcut function and the `QueryRef` function:
- The `QueryPromise` returned will resolve to the result of the Query once it has finished executing
- If the Query accepts arguments, both the action shortcut function and the `QueryRef` function accept a single argument: an object that contains all the required variables (and the optional variables) for the Query
- Both functions can be called with or without passing in a `DataConnect` instance as an argument. If no `DataConnect` argument is passed in, then the generated SDK will call `getDataConnect(connectorConfig)` behind the scenes for you.

Below are examples of how to use the `example` connector's generated functions to execute each query. You can also follow the examples from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#using-queries).

## GetMyLists
You can execute the `GetMyLists` query using the following action shortcut function, or by calling `executeQuery()` after calling the following `QueryRef` function, both of which are defined in [dataconnect-generated/index.d.ts](./index.d.ts):
```typescript
getMyLists(): QueryPromise<GetMyListsData, undefined>;

interface GetMyListsRef {
  ...
  /* Allow users to create refs without passing in DataConnect */
  (): QueryRef<GetMyListsData, undefined>;
}
export const getMyListsRef: GetMyListsRef;
```
You can also pass in a `DataConnect` instance to the action shortcut function or `QueryRef` function.
```typescript
getMyLists(dc: DataConnect): QueryPromise<GetMyListsData, undefined>;

interface GetMyListsRef {
  ...
  (dc: DataConnect): QueryRef<GetMyListsData, undefined>;
}
export const getMyListsRef: GetMyListsRef;
```

If you need the name of the operation without creating a ref, you can retrieve the operation name by calling the `operationName` property on the getMyListsRef:
```typescript
const name = getMyListsRef.operationName;
console.log(name);
```

### Variables
The `GetMyLists` query has no variables.
### Return Type
Recall that executing the `GetMyLists` query returns a `QueryPromise` that resolves to an object with a `data` property.

The `data` property is an object of type `GetMyListsData`, which is defined in [dataconnect-generated/index.d.ts](./index.d.ts). It has the following fields:
```typescript
export interface GetMyListsData {
  lists: ({
    id: UUIDString;
    name: string;
    description?: string | null;
    isPublic?: boolean | null;
    createdAt: TimestampString;
    updatedAt: TimestampString;
  } & List_Key)[];
}
```
### Using `GetMyLists`'s action shortcut function

```typescript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig, getMyLists } from '@dataconnect/generated';


// Call the `getMyLists()` function to execute the query.
// You can use the `await` keyword to wait for the promise to resolve.
const { data } = await getMyLists();

// You can also pass in a `DataConnect` instance to the action shortcut function.
const dataConnect = getDataConnect(connectorConfig);
const { data } = await getMyLists(dataConnect);

console.log(data.lists);

// Or, you can use the `Promise` API.
getMyLists().then((response) => {
  const data = response.data;
  console.log(data.lists);
});
```

### Using `GetMyLists`'s `QueryRef` function

```typescript
import { getDataConnect, executeQuery } from 'firebase/data-connect';
import { connectorConfig, getMyListsRef } from '@dataconnect/generated';


// Call the `getMyListsRef()` function to get a reference to the query.
const ref = getMyListsRef();

// You can also pass in a `DataConnect` instance to the `QueryRef` function.
const dataConnect = getDataConnect(connectorConfig);
const ref = getMyListsRef(dataConnect);

// Call `executeQuery()` on the reference to execute the query.
// You can use the `await` keyword to wait for the promise to resolve.
const { data } = await executeQuery(ref);

console.log(data.lists);

// Or, you can use the `Promise` API.
executeQuery(ref).then((response) => {
  const data = response.data;
  console.log(data.lists);
});
```

## GetMoviesInList
You can execute the `GetMoviesInList` query using the following action shortcut function, or by calling `executeQuery()` after calling the following `QueryRef` function, both of which are defined in [dataconnect-generated/index.d.ts](./index.d.ts):
```typescript
getMoviesInList(vars: GetMoviesInListVariables): QueryPromise<GetMoviesInListData, GetMoviesInListVariables>;

interface GetMoviesInListRef {
  ...
  /* Allow users to create refs without passing in DataConnect */
  (vars: GetMoviesInListVariables): QueryRef<GetMoviesInListData, GetMoviesInListVariables>;
}
export const getMoviesInListRef: GetMoviesInListRef;
```
You can also pass in a `DataConnect` instance to the action shortcut function or `QueryRef` function.
```typescript
getMoviesInList(dc: DataConnect, vars: GetMoviesInListVariables): QueryPromise<GetMoviesInListData, GetMoviesInListVariables>;

interface GetMoviesInListRef {
  ...
  (dc: DataConnect, vars: GetMoviesInListVariables): QueryRef<GetMoviesInListData, GetMoviesInListVariables>;
}
export const getMoviesInListRef: GetMoviesInListRef;
```

If you need the name of the operation without creating a ref, you can retrieve the operation name by calling the `operationName` property on the getMoviesInListRef:
```typescript
const name = getMoviesInListRef.operationName;
console.log(name);
```

### Variables
The `GetMoviesInList` query requires an argument of type `GetMoviesInListVariables`, which is defined in [dataconnect-generated/index.d.ts](./index.d.ts). It has the following fields:

```typescript
export interface GetMoviesInListVariables {
  listId: UUIDString;
}
```
### Return Type
Recall that executing the `GetMoviesInList` query returns a `QueryPromise` that resolves to an object with a `data` property.

The `data` property is an object of type `GetMoviesInListData`, which is defined in [dataconnect-generated/index.d.ts](./index.d.ts). It has the following fields:
```typescript
export interface GetMoviesInListData {
  list?: {
    movies_via_ListItem: ({
      id: UUIDString;
      title: string;
      year: number;
      summary?: string | null;
      runtime?: number | null;
      genres?: string[] | null;
    } & Movie_Key)[];
  };
}
```
### Using `GetMoviesInList`'s action shortcut function

```typescript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig, getMoviesInList, GetMoviesInListVariables } from '@dataconnect/generated';

// The `GetMoviesInList` query requires an argument of type `GetMoviesInListVariables`:
const getMoviesInListVars: GetMoviesInListVariables = {
  listId: ..., 
};

// Call the `getMoviesInList()` function to execute the query.
// You can use the `await` keyword to wait for the promise to resolve.
const { data } = await getMoviesInList(getMoviesInListVars);
// Variables can be defined inline as well.
const { data } = await getMoviesInList({ listId: ..., });

// You can also pass in a `DataConnect` instance to the action shortcut function.
const dataConnect = getDataConnect(connectorConfig);
const { data } = await getMoviesInList(dataConnect, getMoviesInListVars);

console.log(data.list);

// Or, you can use the `Promise` API.
getMoviesInList(getMoviesInListVars).then((response) => {
  const data = response.data;
  console.log(data.list);
});
```

### Using `GetMoviesInList`'s `QueryRef` function

```typescript
import { getDataConnect, executeQuery } from 'firebase/data-connect';
import { connectorConfig, getMoviesInListRef, GetMoviesInListVariables } from '@dataconnect/generated';

// The `GetMoviesInList` query requires an argument of type `GetMoviesInListVariables`:
const getMoviesInListVars: GetMoviesInListVariables = {
  listId: ..., 
};

// Call the `getMoviesInListRef()` function to get a reference to the query.
const ref = getMoviesInListRef(getMoviesInListVars);
// Variables can be defined inline as well.
const ref = getMoviesInListRef({ listId: ..., });

// You can also pass in a `DataConnect` instance to the `QueryRef` function.
const dataConnect = getDataConnect(connectorConfig);
const ref = getMoviesInListRef(dataConnect, getMoviesInListVars);

// Call `executeQuery()` on the reference to execute the query.
// You can use the `await` keyword to wait for the promise to resolve.
const { data } = await executeQuery(ref);

console.log(data.list);

// Or, you can use the `Promise` API.
executeQuery(ref).then((response) => {
  const data = response.data;
  console.log(data.list);
});
```

# Mutations

There are two ways to execute a Data Connect Mutation using the generated Web SDK:
- Using a Mutation Reference function, which returns a `MutationRef`
  - The `MutationRef` can be used as an argument to `executeMutation()`, which will execute the Mutation and return a `MutationPromise`
- Using an action shortcut function, which returns a `MutationPromise`
  - Calling the action shortcut function will execute the Mutation and return a `MutationPromise`

The following is true for both the action shortcut function and the `MutationRef` function:
- The `MutationPromise` returned will resolve to the result of the Mutation once it has finished executing
- If the Mutation accepts arguments, both the action shortcut function and the `MutationRef` function accept a single argument: an object that contains all the required variables (and the optional variables) for the Mutation
- Both functions can be called with or without passing in a `DataConnect` instance as an argument. If no `DataConnect` argument is passed in, then the generated SDK will call `getDataConnect(connectorConfig)` behind the scenes for you.

Below are examples of how to use the `example` connector's generated functions to execute each mutation. You can also follow the examples from the [Data Connect documentation](https://firebase.google.com/docs/data-connect/web-sdk#using-mutations).

## CreateNewList
You can execute the `CreateNewList` mutation using the following action shortcut function, or by calling `executeMutation()` after calling the following `MutationRef` function, both of which are defined in [dataconnect-generated/index.d.ts](./index.d.ts):
```typescript
createNewList(vars: CreateNewListVariables): MutationPromise<CreateNewListData, CreateNewListVariables>;

interface CreateNewListRef {
  ...
  /* Allow users to create refs without passing in DataConnect */
  (vars: CreateNewListVariables): MutationRef<CreateNewListData, CreateNewListVariables>;
}
export const createNewListRef: CreateNewListRef;
```
You can also pass in a `DataConnect` instance to the action shortcut function or `MutationRef` function.
```typescript
createNewList(dc: DataConnect, vars: CreateNewListVariables): MutationPromise<CreateNewListData, CreateNewListVariables>;

interface CreateNewListRef {
  ...
  (dc: DataConnect, vars: CreateNewListVariables): MutationRef<CreateNewListData, CreateNewListVariables>;
}
export const createNewListRef: CreateNewListRef;
```

If you need the name of the operation without creating a ref, you can retrieve the operation name by calling the `operationName` property on the createNewListRef:
```typescript
const name = createNewListRef.operationName;
console.log(name);
```

### Variables
The `CreateNewList` mutation requires an argument of type `CreateNewListVariables`, which is defined in [dataconnect-generated/index.d.ts](./index.d.ts). It has the following fields:

```typescript
export interface CreateNewListVariables {
  name: string;
  description?: string | null;
  isPublic?: boolean | null;
}
```
### Return Type
Recall that executing the `CreateNewList` mutation returns a `MutationPromise` that resolves to an object with a `data` property.

The `data` property is an object of type `CreateNewListData`, which is defined in [dataconnect-generated/index.d.ts](./index.d.ts). It has the following fields:
```typescript
export interface CreateNewListData {
  list_insert: List_Key;
}
```
### Using `CreateNewList`'s action shortcut function

```typescript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig, createNewList, CreateNewListVariables } from '@dataconnect/generated';

// The `CreateNewList` mutation requires an argument of type `CreateNewListVariables`:
const createNewListVars: CreateNewListVariables = {
  name: ..., 
  description: ..., // optional
  isPublic: ..., // optional
};

// Call the `createNewList()` function to execute the mutation.
// You can use the `await` keyword to wait for the promise to resolve.
const { data } = await createNewList(createNewListVars);
// Variables can be defined inline as well.
const { data } = await createNewList({ name: ..., description: ..., isPublic: ..., });

// You can also pass in a `DataConnect` instance to the action shortcut function.
const dataConnect = getDataConnect(connectorConfig);
const { data } = await createNewList(dataConnect, createNewListVars);

console.log(data.list_insert);

// Or, you can use the `Promise` API.
createNewList(createNewListVars).then((response) => {
  const data = response.data;
  console.log(data.list_insert);
});
```

### Using `CreateNewList`'s `MutationRef` function

```typescript
import { getDataConnect, executeMutation } from 'firebase/data-connect';
import { connectorConfig, createNewListRef, CreateNewListVariables } from '@dataconnect/generated';

// The `CreateNewList` mutation requires an argument of type `CreateNewListVariables`:
const createNewListVars: CreateNewListVariables = {
  name: ..., 
  description: ..., // optional
  isPublic: ..., // optional
};

// Call the `createNewListRef()` function to get a reference to the mutation.
const ref = createNewListRef(createNewListVars);
// Variables can be defined inline as well.
const ref = createNewListRef({ name: ..., description: ..., isPublic: ..., });

// You can also pass in a `DataConnect` instance to the `MutationRef` function.
const dataConnect = getDataConnect(connectorConfig);
const ref = createNewListRef(dataConnect, createNewListVars);

// Call `executeMutation()` on the reference to execute the mutation.
// You can use the `await` keyword to wait for the promise to resolve.
const { data } = await executeMutation(ref);

console.log(data.list_insert);

// Or, you can use the `Promise` API.
executeMutation(ref).then((response) => {
  const data = response.data;
  console.log(data.list_insert);
});
```

## AddMovieToList
You can execute the `AddMovieToList` mutation using the following action shortcut function, or by calling `executeMutation()` after calling the following `MutationRef` function, both of which are defined in [dataconnect-generated/index.d.ts](./index.d.ts):
```typescript
addMovieToList(vars: AddMovieToListVariables): MutationPromise<AddMovieToListData, AddMovieToListVariables>;

interface AddMovieToListRef {
  ...
  /* Allow users to create refs without passing in DataConnect */
  (vars: AddMovieToListVariables): MutationRef<AddMovieToListData, AddMovieToListVariables>;
}
export const addMovieToListRef: AddMovieToListRef;
```
You can also pass in a `DataConnect` instance to the action shortcut function or `MutationRef` function.
```typescript
addMovieToList(dc: DataConnect, vars: AddMovieToListVariables): MutationPromise<AddMovieToListData, AddMovieToListVariables>;

interface AddMovieToListRef {
  ...
  (dc: DataConnect, vars: AddMovieToListVariables): MutationRef<AddMovieToListData, AddMovieToListVariables>;
}
export const addMovieToListRef: AddMovieToListRef;
```

If you need the name of the operation without creating a ref, you can retrieve the operation name by calling the `operationName` property on the addMovieToListRef:
```typescript
const name = addMovieToListRef.operationName;
console.log(name);
```

### Variables
The `AddMovieToList` mutation requires an argument of type `AddMovieToListVariables`, which is defined in [dataconnect-generated/index.d.ts](./index.d.ts). It has the following fields:

```typescript
export interface AddMovieToListVariables {
  listId: UUIDString;
  movieId: UUIDString;
  note?: string | null;
  position: number;
}
```
### Return Type
Recall that executing the `AddMovieToList` mutation returns a `MutationPromise` that resolves to an object with a `data` property.

The `data` property is an object of type `AddMovieToListData`, which is defined in [dataconnect-generated/index.d.ts](./index.d.ts). It has the following fields:
```typescript
export interface AddMovieToListData {
  listItem_insert: ListItem_Key;
}
```
### Using `AddMovieToList`'s action shortcut function

```typescript
import { getDataConnect } from 'firebase/data-connect';
import { connectorConfig, addMovieToList, AddMovieToListVariables } from '@dataconnect/generated';

// The `AddMovieToList` mutation requires an argument of type `AddMovieToListVariables`:
const addMovieToListVars: AddMovieToListVariables = {
  listId: ..., 
  movieId: ..., 
  note: ..., // optional
  position: ..., 
};

// Call the `addMovieToList()` function to execute the mutation.
// You can use the `await` keyword to wait for the promise to resolve.
const { data } = await addMovieToList(addMovieToListVars);
// Variables can be defined inline as well.
const { data } = await addMovieToList({ listId: ..., movieId: ..., note: ..., position: ..., });

// You can also pass in a `DataConnect` instance to the action shortcut function.
const dataConnect = getDataConnect(connectorConfig);
const { data } = await addMovieToList(dataConnect, addMovieToListVars);

console.log(data.listItem_insert);

// Or, you can use the `Promise` API.
addMovieToList(addMovieToListVars).then((response) => {
  const data = response.data;
  console.log(data.listItem_insert);
});
```

### Using `AddMovieToList`'s `MutationRef` function

```typescript
import { getDataConnect, executeMutation } from 'firebase/data-connect';
import { connectorConfig, addMovieToListRef, AddMovieToListVariables } from '@dataconnect/generated';

// The `AddMovieToList` mutation requires an argument of type `AddMovieToListVariables`:
const addMovieToListVars: AddMovieToListVariables = {
  listId: ..., 
  movieId: ..., 
  note: ..., // optional
  position: ..., 
};

// Call the `addMovieToListRef()` function to get a reference to the mutation.
const ref = addMovieToListRef(addMovieToListVars);
// Variables can be defined inline as well.
const ref = addMovieToListRef({ listId: ..., movieId: ..., note: ..., position: ..., });

// You can also pass in a `DataConnect` instance to the `MutationRef` function.
const dataConnect = getDataConnect(connectorConfig);
const ref = addMovieToListRef(dataConnect, addMovieToListVars);

// Call `executeMutation()` on the reference to execute the mutation.
// You can use the `await` keyword to wait for the promise to resolve.
const { data } = await executeMutation(ref);

console.log(data.listItem_insert);

// Or, you can use the `Promise` API.
executeMutation(ref).then((response) => {
  const data = response.data;
  console.log(data.listItem_insert);
});
```
</file>

<file path="src/hooks/useAppNavigation.js">
import { useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import { ROUTES } from '../config/routes';

export const useAppNavigation = () => {
  const navigate = useNavigate();

  return {
    goToTest: useCallback(() => navigate(ROUTES.TEST), [navigate]),
    goToTest: useCallback(() => navigate(ROUTES.HOME), [navigate]),
    goToFullExam: useCallback(() => navigate(ROUTES.FULL_EXAM), [navigate]),
    goToGrammar: useCallback(() => navigate(ROUTES.GRAMMAR), [navigate]),
    goToVocabulary: useCallback(() => navigate(ROUTES.VOCABULARY), [navigate]),
    goToProfile: useCallback(() => navigate(ROUTES.PROFILE), [navigate]),
    goToAnswers: useCallback(() => navigate(ROUTES.ANSWERS), [navigate]),
  };
};
</file>

<file path="src/hooks/useAudio.js">
import { useState, useRef, useCallback, useEffect } from 'react';

export const useAudio = (maleVoice, femaleVoice, rate = 1) => {
  // States
  const [status, setStatus] = useState('ready');
  const [progress, setProgress] = useState(0);
  const [repeatCount, setRepeatCount] = useState(0);
  const [isPaused, setIsPaused] = useState(false);
  const [error, setError] = useState(null);

  // Refs
  const utteranceRef = useRef(null);
  const synthRef = useRef(window.speechSynthesis);
  const isPlayingRef = useRef(false);
  const shouldStopRef = useRef(false);
  const currentTimeoutRef = useRef(null);

  // Constants
  const SPEAKER_CONFIG = {
    male: { keywords: ['man', 'customer', 'professor', 'father', 'boy'], pitch: 0.9 },
    female: { keywords: ['woman', 'sales', 'student', 'mother', 'girl'], pitch: 1.1 },
  };
  const PAUSE_BETWEEN_SPEAKERS = 800;
  const PAUSE_BETWEEN_UTTERANCES = 300;
  const BREAK_BETWEEN_REPEATS = 3000;
  const REPEAT_COUNT = 2;

  // Cleanup function
  const cleanup = useCallback(() => {
    // Clear any pending timeouts
    if (currentTimeoutRef.current) {
      clearTimeout(currentTimeoutRef.current);
      currentTimeoutRef.current = null;
    }

    // Cancel speech synthesis
    if (synthRef.current) {
      synthRef.current.cancel();
    }

    // Reset refs
    utteranceRef.current = null;
    isPlayingRef.current = false;
    shouldStopRef.current = false;
  }, []);

  // Cleanup on unmount
  useEffect(() => {
    return () => {
      cleanup();
    };
  }, [cleanup]);

  // Validate voices
  useEffect(() => {
    if (!maleVoice && !femaleVoice) {
      setError('No voices provided');
    } else {
      setError(null);
    }
  }, [maleVoice, femaleVoice]);

  const getVoiceAndPitchForSpeaker = useCallback((speaker) => {
    if (!speaker) {
      return { voice: maleVoice || femaleVoice, pitch: 1 };
    }

    const lowerSpeaker = speaker.toLowerCase();

    // Check male keywords
    if (SPEAKER_CONFIG.male.keywords.some(keyword => lowerSpeaker.includes(keyword))) {
      return { voice: maleVoice, pitch: SPEAKER_CONFIG.male.pitch };
    }

    // Check female keywords
    if (SPEAKER_CONFIG.female.keywords.some(keyword => lowerSpeaker.includes(keyword))) {
      return { voice: femaleVoice, pitch: SPEAKER_CONFIG.female.pitch };
    }

    // Fallback
    return { voice: maleVoice || femaleVoice, pitch: 1 };
  }, [maleVoice, femaleVoice]);

  const parseScriptToUtterances = useCallback((script) => {
    if (!script || typeof script !== 'string') return [];

    const utteranceRegex = /(?:^|\n)([A-Z][a-z]+):?\s*(.*?)(?=\n[A-Z][a-z]+:|$)/gs;
    const matches = [...script.matchAll(utteranceRegex)];

    return matches
      .map(match => ({
        speaker: match[1].trim(),
        text: match[2].trim().replace(/^\s+|\s+$/g, '')
      }))
      .filter(u => u.text.length > 0);
  }, []);

  const speakUtterance = useCallback(
    (text, voice, pitch) => {
      return new Promise((resolve, reject) => {
        // Check if should stop
        if (shouldStopRef.current) {
          resolve();
          return;
        }

        if (!voice) {
          console.warn('Voice not available');
          resolve();
          return;
        }

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.voice = voice;
        utterance.rate = Math.max(0.1, Math.min(2, rate));
        utterance.pitch = Math.max(0.1, Math.min(2, pitch));
        utterance.volume = 1;

        utterance.onend = () => {
          utteranceRef.current = null;
          resolve();
        };

        utterance.onerror = (e) => {
          console.error('Speech synthesis error:', e.error);
          utteranceRef.current = null;
          
          // Don't treat 'interrupted' as error (happens on stop)
          if (e.error === 'interrupted' || e.error === 'canceled') {
            resolve();
          } else {
            setError(`Speech error: ${e.error}`);
            reject(e);
          }
        };

        utteranceRef.current = utterance;
        
        // Double-check before speaking
        if (!shouldStopRef.current) {
          synthRef.current.speak(utterance);
        } else {
          resolve();
        }
      });
    },
    [rate]
  );

  const delay = useCallback((ms) => {
    return new Promise((resolve) => {
      // Check if should stop immediately
      if (shouldStopRef.current) {
        resolve();
        return;
      }

      currentTimeoutRef.current = setTimeout(() => {
        currentTimeoutRef.current = null;
        resolve();
      }, ms);
    });
  }, []);

  const stopAudio = useCallback(() => {
    try {
      console.log(' Stopping audio...');
      
      // Set stop flag first
      shouldStopRef.current = true;
      isPlayingRef.current = false;
      
      // Clear any pending timeouts
      if (currentTimeoutRef.current) {
        clearTimeout(currentTimeoutRef.current);
        currentTimeoutRef.current = null;
      }

      // Cancel speech synthesis multiple times for reliability
      synthRef.current.cancel();
      
      // Small delay then cancel again (iOS/Safari fix)
      setTimeout(() => {
        synthRef.current.cancel();
      }, 10);

      // Reset all state
      utteranceRef.current = null;
      setIsPaused(false);
      setRepeatCount(0);
      setStatus('  dng');
      setProgress(0);
      
      console.log(' Audio stopped successfully');
    } catch (err) {
      console.error(' Stop error:', err);
      setError('Failed to stop audio');
    }
  }, []);

  const pauseAudio = useCallback(() => {
    try {
      if (synthRef.current.speaking && !isPaused && isPlayingRef.current) {
        synthRef.current.pause();
        setIsPaused(true);
        setStatus('  tm dng');
      }
    } catch (err) {
      console.error('Pause error:', err);
      setError('Failed to pause audio');
    }
  }, [isPaused]);

  const playAudio = useCallback(
    async (script) => {
      try {
        // If paused, resume
        if (isPaused) {
          synthRef.current.resume();
          setIsPaused(false);
          setStatus(' Tip tc pht...');
          return;
        }

        // Check for voices
        if (!maleVoice && !femaleVoice) {
          setError('Voices not available. Please wait for voices to load.');
          setStatus(' Ging ni khng kh dng');
          return;
        }

        // Stop any existing playback first
        stopAudio();
        
        // Wait a bit for cleanup
        await new Promise(resolve => setTimeout(resolve, 100));

        // Reset flags
        shouldStopRef.current = false;
        isPlayingRef.current = true;
        setRepeatCount(0);
        setError(null);

        const utterances = parseScriptToUtterances(script);
        if (utterances.length === 0) {
          setError('No valid utterances found in script');
          setStatus(' Script khng hp l');
          isPlayingRef.current = false;
          return;
        }

        const isMultiSpeaker = utterances.length > 1;

        for (let repeat = 0; repeat < REPEAT_COUNT; repeat++) {
          // Check if stopped
          if (shouldStopRef.current) {
            console.log(' Playback stopped by user');
            break;
          }

          setRepeatCount(repeat + 1);
          setStatus(` ang pht ln ${repeat + 1}/${REPEAT_COUNT}...`);

          if (isMultiSpeaker) {
            for (let i = 0; i < utterances.length; i++) {
              // Check if stopped
              if (shouldStopRef.current) {
                break;
              }

              const { speaker, text } = utterances[i];
              const { voice, pitch } = getVoiceAndPitchForSpeaker(speaker);

              await speakUtterance(text, voice, pitch);

              // Check if stopped after speaking
              if (shouldStopRef.current) {
                break;
              }

              // Pause between utterances
              if (i < utterances.length - 1) {
                const nextSpeaker = utterances[i + 1]?.speaker;
                const pauseTime = 
                  speaker !== nextSpeaker
                    ? PAUSE_BETWEEN_SPEAKERS
                    : PAUSE_BETWEEN_UTTERANCES;

                await delay(pauseTime);
              }

              // Update progress
              const currentProgress = ((repeat + (i + 1) / utterances.length) / REPEAT_COUNT) * 100;
              setProgress(currentProgress);
            }
          } else {
            // Monologue: use default voice
            if (shouldStopRef.current) {
              break;
            }

            const { voice, pitch } = getVoiceAndPitchForSpeaker('');
            await speakUtterance(script, voice, pitch);
            setProgress(((repeat + 1) / REPEAT_COUNT) * 100);
          }

          // Check if stopped
          if (shouldStopRef.current) {
            break;
          }

          // Pause between repeats (except after last repeat)
          if (repeat < REPEAT_COUNT - 1) {
            setStatus(' Ngh 3 giy...');
            await delay(BREAK_BETWEEN_REPEATS);
          }
        }

        // Only show completion if not stopped
        if (!shouldStopRef.current) {
          setStatus(' Hon thnh ( c 2 ln)');
          setProgress(100);
        }

        isPlayingRef.current = false;
      } catch (err) {
        console.error('Playback error:', err);
        setError(err.message);
        setStatus(' Li pht m thanh');
        isPlayingRef.current = false;
      }
    },
    [
      isPaused, 
      maleVoice, 
      femaleVoice, 
      parseScriptToUtterances, 
      getVoiceAndPitchForSpeaker, 
      speakUtterance,
      delay,
      stopAudio
    ]
  );

  const resetError = useCallback(() => {
    setError(null);
  }, []);

  return {
    status,
    progress,
    repeatCount,
    isPaused,
    error,
    playAudio,
    pauseAudio,
    stopAudio,
    resetError,
  };
};
export default useAudio;
</file>

<file path="src/hooks/useAutoSaveProgress.js">
import { useEffect, useRef } from 'react';
import { useUserProgress } from './useUserProgress';

/**
 * Hook t ng lu progress sau 30 giy khng c thay i
 * H tr c Clerk v Firebase Authentication
 */
export const useAutoSaveProgress = (answers, selectedExam, selectedPart, partData) => {
  const { saveProgress, currentUser } = useUserProgress();
  const saveTimeoutRef = useRef(null);
  const lastSavedAnswersRef = useRef('{}');

  useEffect(() => {
    // Clear previous timeout
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }

    //  FIX 1: Kim tra currentUser ng cch
    if (!currentUser || !currentUser.provider) {
      console.log(' Auto-save skipped: User not logged in or provider missing', {
        currentUser,
      });
      return;
    }

    // Don't auto-save if no part data
    if (!partData || !partData.questions) {
      console.log(' Auto-save skipped: No part data');
      return;
    }

    // Check if answers changed
    const currentAnswersStr = JSON.stringify(answers);
    const answersChanged = currentAnswersStr !== lastSavedAnswersRef.current;
    const hasAnswers = Object.keys(answers).length > 0;

    console.log(' Auto-save check:', {
      hasAnswers,
      answersChanged,
      answerCount: Object.keys(answers).length,
      userId: currentUser.id,
      provider: currentUser.provider,
      clerkId: currentUser.clerkId,
      firebaseUid: currentUser.firebaseUid,
    });

    if (answersChanged && hasAnswers) {
      console.log(` Auto-save scheduled in 30 seconds (${currentUser.provider})...`);

      // Auto-save after 30 seconds of inactivity
      saveTimeoutRef.current = setTimeout(async () => {
        try {
          // Calculate score
          const correct = Object.entries(answers).filter(([questionId, answerIndex]) => {
            const question = partData.questions.find(q => q.id === questionId);
            return question && question.correct === answerIndex;
          }).length;

          const total = partData.questions.length;
          const percentage = total > 0 ? (correct / total) * 100 : 0;
          const correctAnswers = correct;

          console.log(` Auto-saving progress (${currentUser.provider})...`, {
            exam: selectedExam,
            part: selectedPart,
            score: percentage,
            correctAnswers,
            totalQuestions: total,
            answersCount: Object.keys(answers).length,
            userId: currentUser.id,
            clerkId: currentUser.clerkId,
            firebaseUid: currentUser.firebaseUid,
          });

          //  FIX 2: Pass correct data structure
          const result = await saveProgress({
            exam: selectedExam,
            part: selectedPart,
            score: percentage,
            answers: answers,
            totalQuestions: total,
            correctAnswers: correctAnswers,
            isDraft: true, // Mark as draft (not submitted)
            testType: 'auto-save',
          });

          if (result) {
            lastSavedAnswersRef.current = currentAnswersStr;
            console.log(` Auto-save successful (${currentUser.provider})!`);
          } else {
            console.warn(` Auto-save returned false (${currentUser.provider})`);
          }
        } catch (error) {
          console.error(' Error auto-saving:', {
            message: error.message,
            code: error.code,
            provider: currentUser.provider,
          });
        }
      }, 30000); // 30 seconds
    }

    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [answers, selectedExam, selectedPart, partData, saveProgress, currentUser]);
};

export default useAutoSaveProgress;
</file>

<file path="src/hooks/useClerkAuth.js">
import { useAuth as useClerkAuth, useUser } from '@clerk/clerk-react';

export const useClerkAuthentication = () => {
  const { isSignedIn, isLoaded } = useClerkAuth();
  const { user } = useUser();

  return {
    isSignedIn,
    isLoaded,
    user: user
      ? {
          id: user.id,
          email: user.emailAddresses[0]?.emailAddress,
          displayName: user.firstName ? `${user.firstName} ${user.lastName}` : user.emailAddresses[0]?.emailAddress,
          photoURL: user.profileImageUrl,
        }
      : null,
  };
};
export default useClerkAuthentication;
</file>

<file path="src/hooks/useClerkFirebaseSync.js">
import { useEffect } from 'react';
import { useUser } from '@clerk/clerk-react';

export const useClerkFirebaseSync = () => {
  const { user, isLoaded, isSignedIn } = useUser();

  useEffect(() => {
    if (!isLoaded || !isSignedIn || !user) {
      return;
    }

    const initializeUser = async () => {
      try {
        console.log(' User authenticated:', user.id);
        console.log(' Email:', user.primaryEmailAddress?.emailAddress);
        console.log(' Name:', user.fullName);
        
        //  Khng cn sync vo collection 'users'
        // Clerk  qun l thng tin user
        // Collection 'userProgress'  c rule: allow write: if true
        
        console.log(' Ready to use userProgress collection');
      } catch (error) {
        console.error(' Error initializing user:', error);
      }
    };

    initializeUser();
  }, [user, isLoaded, isSignedIn]);

  // Return user info for components that need it
  return {
    userId: user?.id,
    email: user?.primaryEmailAddress?.emailAddress,
    fullName: user?.fullName,
    imageUrl: user?.imageUrl,
    isLoaded,
    isSignedIn
  };
};
export default useClerkFirebaseSync;
</file>

<file path="src/hooks/useFirebaseAuth.js">
import { useState, useEffect } from 'react';
import { 
  signInWithPopup, 
  signOut, 
  onAuthStateChanged, 
  GoogleAuthProvider,
  setPersistence,
  browserLocalPersistence
} from 'firebase/auth';
import { auth } from '../config/firebase';

/**
 * Hook Firebase Authentication vi Google Sign-in
 *  Fix: Popup lag, promise issue, COOP policy
 */
export const useFirebaseAuth = () => {
  const [user, setUser] = useState(null);
  const [isSignedIn, setIsSignedIn] = useState(false);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isLoaded, setIsLoaded] = useState(false);

  //  FIX 1: Set persistence ti mount
  useEffect(() => {
    const initializePersistence = async () => {
      try {
        await setPersistence(auth, browserLocalPersistence);
        console.log(' Firebase persistence initialized');
      } catch (err) {
        console.error(' Persistence error:', err.message);
      }
    };

    initializePersistence();
  }, []);

  //  FIX 2: Listen to auth state changes
  useEffect(() => {
    const unsubscribe = onAuthStateChanged(
      auth,
      (firebaseUser) => {
        if (firebaseUser) {
          console.log(' [Firebase Auth] User signed in:', firebaseUser.email);
          setUser(firebaseUser);
          setIsSignedIn(true);
          setError(null);
        } else {
          console.log(' [Firebase Auth] User signed out');
          setUser(null);
          setIsSignedIn(false);
        }
        setLoading(false);
        setIsLoaded(true);
      },
      (err) => {
        console.error(' [Firebase Auth] State change error:', err.message);
        setError(err.message);
        setLoading(false);
        setIsLoaded(true);
      }
    );

    return unsubscribe;
  }, []);

  //  FIX 3: Google Sign-in vi error handling
  const signInWithGoogle = async () => {
    try {
      setLoading(true);
      setError(null);

      console.log(' Starting Google Sign-in...');

      // Initialize Google Provider
      const provider = new GoogleAuthProvider();
      
      //  FIX 4: Set persistence before popup
      await setPersistence(auth, browserLocalPersistence);

      // Add scopes for additional info
      provider.addScope('profile');
      provider.addScope('email');

      //  FIX 5: Open popup with redirect fallback
      let result;
      
      try {
        // Th popup trc
        result = await signInWithPopup(auth, provider);
        console.log(' Google Sign-in successful (popup)');
      } catch (popupError) {
        // Nu popup b block, th redirect
        if (popupError.code === 'auth/popup-blocked' || 
            popupError.code === 'auth/popup-closed-by-user' ||
            popupError.message.includes('Cross-Origin-Opener-Policy')) {
          
          console.warn(' Popup blocked, trying alternative method...');
          // Popup b block - return error message
          throw new Error('Popup b block. Vui lng cho php popup trong trnh duyt hoc th li.');
        }
        throw popupError;
      }

      // Extract user info
      const signedInUser = result.user;
      
      console.log(' User signed in:', {
        uid: signedInUser.uid,
        email: signedInUser.email,
        displayName: signedInUser.displayName,
        photoURL: signedInUser.photoURL,
      });

      setUser(signedInUser);
      setIsSignedIn(true);
      setError(null);
      setLoading(false);

      return {
        success: true,
        user: signedInUser,
        message: 'ng nhp thnh cng!'
      };

    } catch (err) {
      console.error(' Error signing in with Google:', {
        code: err.code,
        message: err.message,
      });

      const errorMessage = 
        err.code === 'auth/popup-closed-by-user' ? 'Bn  ng popup ng nhp' :
        err.code === 'auth/popup-blocked' ? 'Popup b trnh duyt block' :
        err.message.includes('Cross-Origin') ? 'Li bo mt: COOP policy' :
        err.message;

      setError(errorMessage);
      setLoading(false);

      return {
        success: false,
        error: errorMessage,
        code: err.code
      };
    }
  };

  //  FIX 6: Sign out
  const handleSignOut = async () => {
    try {
      setLoading(true);
      console.log(' Signing out...');
      
      await signOut(auth);
      
      setUser(null);
      setIsSignedIn(false);
      setError(null);
      setLoading(false);
      
      console.log(' Sign out successful');
      return { success: true };
    } catch (err) {
      console.error(' Error signing out:', err.message);
      setError(err.message);
      setLoading(false);
      
      return { success: false, error: err.message };
    }
  };

  return {
    user,
    isSignedIn,
    loading,
    error,
    isLoaded,
    signInWithGoogle,
    signOut: handleSignOut,
  };
};

export default useFirebaseAuth;
</file>

<file path="src/hooks/useFirebaseUserSync.js">
import { useEffect, useState } from 'react';
import { doc, setDoc, getDoc, serverTimestamp } from 'firebase/firestore';
import { auth, db } from '../config/firebase';

/**
 * Hook  sync Firebase Auth user vo Firestore
 * Tng t nh useClerkFirebaseSync nhng cho Firebase Authentication
 */
export const useFirebaseUserSync = () => {
  const [syncing, setSyncing] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    const unsubscribe = auth.onAuthStateChanged(async (firebaseUser) => {
      if (!firebaseUser) {
        return;
      }

      try {
        setSyncing(true);
        setError(null);

        const userRef = doc(db, 'users', firebaseUser.uid);
        const userSnap = await getDoc(userRef);

        const userData = {
          email: firebaseUser.email,
          displayName: firebaseUser.displayName,
          photoURL: firebaseUser.photoURL,
          authProvider: 'firebase',
          updatedAt: serverTimestamp(),
        };

        if (!userSnap.exists()) {
          // To user mi
          await setDoc(userRef, {
            ...userData,
            createdAt: serverTimestamp(),
          });
          console.log(' Firebase user synced to Firestore:', firebaseUser.uid);
        } else {
          // Cp nht thng tin user
          await setDoc(userRef, userData, { merge: true });
          console.log(' Firebase user info updated:', firebaseUser.uid);
        }
      } catch (err) {
        console.error(' Error syncing Firebase user:', err);
        setError(err.message);
      } finally {
        setSyncing(false);
      }
    });

    return unsubscribe;
  }, []);

  return { syncing, error };
};
export default useFirebaseUserSync;
</file>

<file path="src/hooks/useFirestoreData.js">
import { useState, useEffect } from 'react';
import { collection, getDocs, doc, getDoc } from 'firebase/firestore';
import { db } from '../config/firebase';

export const useFirestoreData = () => {
  const [examData, setExamData] = useState({});
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // Fetch tt c exam data
  useEffect(() => {
    const fetchExamData = async () => {
      try {
        setLoading(true);
        const examCollection = collection(db, 'examData');
        const snapshot = await getDocs(examCollection);
        
        const data = {};
        snapshot.docs.forEach(doc => {
          const docData = doc.data();
          if (docData.examId) {
            // y l part document
            const examId = docData.examId;
            const partId = docData.partId;
            
            if (!data[examId]) {
              data[examId] = { parts: {} };
            }
            
            data[examId].parts[partId] = {
              title: docData.title,
              description: docData.description,
              script: docData.script,
              questions: docData.questions,
            };
          } else {
            // y l exam metadata
            data[doc.id] = {
              ...docData,
              parts: data[doc.id]?.parts || {}
            };
          }
        });
        
        setExamData(data);
        setError(null);
      } catch (err) {
        console.error('Error fetching exam data:', err);
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchExamData();
  }, []);

  // Fetch single exam
  const getExam = async (examId) => {
    try {
      const docRef = doc(db, 'examData', examId);
      const docSnap = await getDoc(docRef);
      return docSnap.exists() ? docSnap.data() : null;
    } catch (err) {
      console.error('Error fetching exam:', err);
      throw err;
    }
  };

  return { examData, loading, error, getExam };
};

export default useFirestoreData;
</file>

<file path="src/hooks/usePresence.js">
// src/hooks/usePresence.js
import { useEffect } from 'react';
import { onDisconnect, ref, set, serverTimestamp } from 'firebase/database';
import { rtdb } from '../config/firebase.js';
import { useFirebaseAuth } from './contexts/FirebaseAuthContext';

export const usePresence = () => {
  const { user, isSignedIn } = useFirebaseAuth();

  useEffect(() => {
    if (!isSignedIn || !user?.uid) return;

    const userStatusRef = ref(rtdb, `presence/${user.uid}`);

    // Ghi trng thi online
    const goOnline = () => {
      set(userStatusRef, {
        online: true,
        lastSeen: serverTimestamp(),
      });
    };

    // Khi disconnect (ng tab, mt mng)  t ng offline
    const goOffline = () => {
      set(userStatusRef, {
        online: false,
        lastSeen: serverTimestamp(),
      });
    };

    // nh du online
    goOnline();

    // T ng offline khi disconnect
    onDisconnect(userStatusRef).set({
      online: false,
      lastSeen: serverTimestamp(),
    });

    // Cp nht lastSeen mi 30s (gi kt ni)
    const interval = setInterval(goOnline, 30_000);

    // Cleanup
    return () => {
      clearInterval(interval);
      goOffline();
    };
  }, [isSignedIn, user?.uid]);
};
</file>

<file path="src/hooks/usePreviousAttempts.js">
import { useState, useEffect } from 'react';
import { useUser } from '@clerk/clerk-react';
import { collection, query, where, onSnapshot } from 'firebase/firestore';
import { db } from '../config/firebase';

export const usePreviousAttempts = (selectedExam, selectedPart) => {
  const { user: clerkUser, isLoaded } = useUser();
  const [attempts, setAttempts] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!isLoaded || !clerkUser || !selectedExam || !selectedPart) {
      setAttempts([]);
      setLoading(false);
      return;
    }

    console.log(' Fetching previous attempts for:', { selectedExam, selectedPart });

    try {
      const q = query(
        collection(db, 'userProgress'),
        where('clerkId', '==', clerkUser.id),
        where('exam', '==', selectedExam),
        where('part', '==', selectedPart)
      );

      const unsubscribe = onSnapshot(
        q,
        (snapshot) => {
          const data = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
            completedAt: doc.data().completedAt?.toDate?.() || new Date(doc.data().completedAt),
          }));

          // Sort by completedAt in memory (no need for Firestore index)
          const sortedData = data.sort((a, b) => {
            const dateA = a.completedAt instanceof Date ? a.completedAt : new Date(0);
            const dateB = b.completedAt instanceof Date ? b.completedAt : new Date(0);
            return dateB - dateA; // Descending (newest first)
          });

          console.log(' Previous attempts loaded:', sortedData.length);
          setAttempts(sortedData);
          setLoading(false);
        },
        (err) => {
          console.error(' Error fetching attempts:', err.code, err.message);
          setAttempts([]);
          setLoading(false);
        }
      );

      return unsubscribe;
    } catch (err) {
      console.error(' Error setting up attempts listener:', err);
      setAttempts([]);
      setLoading(false);
    }
  }, [clerkUser, isLoaded, selectedExam, selectedPart]);

  return { attempts, loading };
};
</file>

<file path="src/hooks/useResponsiveTTS.js">
// import { useState, useRef, useCallback, useEffect } from 'react';

// const useResponsiveTTS = (ttsOptions = { rate: 0.9, pitch: 1.0, volume: 1 }) => {
//   const [isPlaying, setIsPlaying] = useState(false);
//   const [currentIndex, setCurrentIndex] = useState(-1);
//   const [isInitialized, setIsInitialized] = useState(false);
//   const [error, setError] = useState(null);
//   const [useFallback, setUseFallback] = useState(false); // New: Track fallback usage
//   const queueRef = useRef([]);

//   // Speaker lists (unchanged)
//   const FEMALE_SPEAKERS = ['Woman', 'Sarah', 'Anna', 'Client 2', 'Sales Associate', 'Older Woman', 'Student B', 'Student 2', 'Counselor'];
//   const MALE_SPEAKERS = ['Man', 'Mark', 'Ben', 'Client 1', 'Professor', 'John', 'Mike', 'Waiter', 'Customer', 'Manager', 'HR Rep', 'Interviewer 1', 'Interviewer 2', 'Candidate', 'Professor A', 'Student 1', 'Student', 'Parent', 'Travel Agent', 'Narrator'];

//   // Voices (unchanged)
//   const voices = useRef([
//     { name: 'UK English Female', gender: 'female' },
//     { name: 'UK English Male', gender: 'male' },
//     { name: 'US English Female', gender: 'female' },
//     { name: 'US English Male', gender: 'male' },
//   ]);

//   const getSpeakerVoice = useCallback((speaker) => {
//     const isFemale = FEMALE_SPEAKERS.some(name => speaker.includes(name));
//     const isMale = MALE_SPEAKERS.some(name => speaker.includes(name));
//     if (isFemale) return voices.current.find(v => v.gender === 'female')?.name || 'US English Female';
//     if (isMale) return voices.current.find(v => v.gender === 'male')?.name || 'US English Male';
//     return 'US English Female';
//   }, []);

//   const isMaleSpeaker = useCallback((speaker) => MALE_SPEAKERS.some(name => speaker.includes(name)), []);

//   // Prepare text (unchanged)
//   const prepareTextForTTS = useCallback((text) => {
//     const sentences = text.split(/(?<=[.!?])\s+/).map(sentence => sentence.trim()).filter(Boolean);
//     let expressiveText = '';
//     sentences.forEach((sentence, idx) => {
//       const emphasized = sentence.replace(/\b[A-Z][a-z]+\b/, (match) => `<emphasis level="strong">${match}</emphasis>`);
//       expressiveText += emphasized;
//       if (idx < sentences.length - 1) expressiveText += ' [pause 800ms] ';
//     });
//     return expressiveText;
//   }, []);

//   // Fallback: Native Web Speech API
//   const speakWithFallback = useCallback((text, speaker, options) => {
//     if (!('speechSynthesis' in window)) {
//       setError('Browser does not support native TTS.');
//       return;
//     }
//     const utterance = new SpeechSynthesisUtterance(text);
//     const voice = speechSynthesis.getVoices().find(v => v.lang.startsWith('en'));
//     utterance.voice = voice;
//     utterance.rate = options.rate || ttsOptions.rate;
//     utterance.pitch = isMaleSpeaker(speaker) ? 0.7 : ttsOptions.pitch;
//     utterance.volume = options.volume || ttsOptions.volume;
//     utterance.onend = () => setIsPlaying(false);
//     speechSynthesis.speak(utterance);
//   }, [ttsOptions, isMaleSpeaker]);

//   // Speak next (enhanced with fallback)
//   const speakNext = useCallback(() => {
//     const next = queueRef.current.shift();
//     if (!next) {
//       setIsPlaying(false);
//       setCurrentIndex(-1);
//       return;
//     }
//     setCurrentIndex(next.index);
//     setIsPlaying(true);
//     const preparedText = prepareTextForTTS(next.text);
//     if (window.responsiveVoice && !useFallback) {
//       // Primary: ResponsiveVoice
//       const voice = getSpeakerVoice(next.speaker);
//       const pitch = isMaleSpeaker(next.speaker) ? 0.7 : ttsOptions.pitch;
//       window.responsiveVoice.speak(preparedText, voice, {
//         rate: next.options.rate || ttsOptions.rate,
//         pitch: pitch,
//         volume: next.options.volume || ttsOptions.volume,
//         onend: () => queueRef.current.length > 0 ? speakNext() : (setIsPlaying(false), setCurrentIndex(-1)),
//         onerror: (e) => {
//           console.error('ResponsiveVoice error:', e);
//           setUseFallback(true); // Switch to fallback
//           speakWithFallback(preparedText, next.speaker, next.options);
//         }
//       });
//     } else {
//       // Fallback: Native API
//       speakWithFallback(preparedText, next.speaker, next.options);
//       setTimeout(() => { // Simulate onend
//         if (queueRef.current.length > 0) speakNext();
//         else (setIsPlaying(false), setCurrentIndex(-1));
//       }, preparedText.length * 50); // Rough timing estimate
//     }
//   }, [ttsOptions, getSpeakerVoice, isMaleSpeaker, prepareTextForTTS, useFallback, speakWithFallback]);

//   // Play functions (unchanged structure, with fallback awareness)
//   const playScript = useCallback((conversations, filterSpeaker = null) => {
//     if (!isInitialized) {
//       setError('TTS service unavailable. Ensure browser audio is enabled.');
//       return;
//     }
//     if (window.responsiveVoice) window.responsiveVoice.cancel();
//     else if ('speechSynthesis' in window) speechSynthesis.cancel();
//     queueRef.current = conversations
//       .filter(conv => !filterSpeaker || conv.speaker === filterSpeaker)
//       .map((conv, idx) => ({ text: conv.text, speaker: conv.speaker, options: ttsOptions, index: idx }));
//     setIsPlaying(queueRef.current.length > 0);
//     setCurrentIndex(-1);
//     setError(null);
//     if (queueRef.current.length > 0) speakNext();
//   }, [ttsOptions, isInitialized, speakNext]);

//   const playSingle = useCallback((conv, index) => {
//     if (!isInitialized) return;
//     if (window.responsiveVoice) window.responsiveVoice.cancel();
//     else if ('speechSynthesis' in window) speechSynthesis.cancel();
//     queueRef.current = [{ text: conv.text, speaker: conv.speaker, options: ttsOptions, index }];
//     setIsPlaying(true);
//     setCurrentIndex(index);
//     setError(null);
//     speakNext();
//   }, [ttsOptions, isInitialized, speakNext]);

//   const pauseScript = useCallback(() => {
//     if (window.responsiveVoice) window.responsiveVoice.cancel();
//     else if ('speechSynthesis' in window) speechSynthesis.cancel();
//     queueRef.current = [];
//     setIsPlaying(false);
//     setCurrentIndex(-1);
//     setError(null);
//   }, []);

//   // Initialization (enhanced logging and fallback)
//   useEffect(() => {
//     let intervalId, timeoutId;
//     const checkInit = () => {
//       console.log('TTS Check: ResponsiveVoice available?', !!window.responsiveVoice); // Debug log
//       if (window.responsiveVoice && !isInitialized) {
//         setIsInitialized(true);
//         console.log('Primary TTS (ResponsiveVoice) initialized.');
//       } else if (!window.responsiveVoice && 'speechSynthesis' in window && !isInitialized) {
//         setIsInitialized(true);
//         setUseFallback(true);
//         console.log('Fallback TTS (Native Web Speech) activated.');
//       }
//     };
//     checkInit();
//     intervalId = setInterval(checkInit, 1000);
//     timeoutId = setTimeout(() => {
//       clearInterval(intervalId);
//       if (!isInitialized) setError('TTS connection failed. Check console for details and retry.');
//     }, 5000);
//     return () => {
//       clearInterval(intervalId);
//       clearTimeout(timeoutId);
//     };
//   }, [isInitialized]);

//   useEffect(() => {
//     return () => {
//       if (window.responsiveVoice) window.responsiveVoice.cancel();
//       else if ('speechSynthesis' in window) speechSynthesis.cancel();
//     };
//   }, []);

//   return { isPlaying, currentIndex, playScript, playSingle, pauseScript, isInitialized, error, useFallback };
// };

// export default useResponsiveTTS;
</file>

<file path="src/hooks/useSplashScreen.js">
// src/hooks/useSplashScreen.js
import { useEffect, useState } from 'react';

export const useSplashScreen = (duration = 3000) => {
  const [showSplash, setShowSplash] = useState(true);

  useEffect(() => {
    const timer = setTimeout(() => {
      setShowSplash(false);
    }, duration);

    return () => clearTimeout(timer);
  }, [duration]);

  return showSplash;
};

export default useSplashScreen;
</file>

<file path="src/hooks/useVoices.js">
import { useState, useEffect, useRef, useCallback, useMemo } from 'react';

export const useVoices = () => {
  // ========== STATE ==========
  const [allVoices, setAllVoices] = useState([]);
  const [selectedMaleIndex, setSelectedMaleIndex] = useState(-1);
  const [selectedFemaleIndex, setSelectedFemaleIndex] = useState(-1);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);
  
  // ========== NEW: INDIVIDUAL SPEAKER VOICES ==========
  // Travel Agent Scenario
  const [travelAgentVoiceIndex, setTravelAgentVoiceIndex] = useState(-1);
  const [client1VoiceIndex, setClient1VoiceIndex] = useState(-1);
  const [client2VoiceIndex, setClient2VoiceIndex] = useState(-1);

  // Professor Scenario
  const [professorVoiceIndex, setProfessorVoiceIndex] = useState(-1);
  const [student1VoiceIndex, setStudent1VoiceIndex] = useState(-1);
  const [student2VoiceIndex, setStudent2VoiceIndex] = useState(-1);

  // Exam 1 Speakers
  const [markVoiceIndex, setMarkVoiceIndex] = useState(-1);
  const [sarahVoiceIndex, setSarahVoiceIndex] = useState(-1);

  // Exam 2 Speakers
  const [annaVoiceIndex, setAnnaVoiceIndex] = useState(-1);
  const [benVoiceIndex, setBenVoiceIndex] = useState(-1);

  // ========== REFS ==========
  const synthRef = useRef(null);
  const voiceLoadAttemptsRef = useRef(0);
  const loadTimeoutRef = useRef(null);
  const isMountedRef = useRef(true);

  const MAX_LOAD_ATTEMPTS = 20;
  const LOAD_RETRY_DELAY = 150;

  // ========== SPEAKER CONFIGURATION ==========
  const SPEAKER_VOICES = useMemo(() => ({
    // Travel Agent Scenario
    'Travel Agent': {
      gender: 'male',
      index: travelAgentVoiceIndex,
      setIndex: setTravelAgentVoiceIndex,
    },
    'Client 1': {
      gender: 'male',
      index: client1VoiceIndex,
      setIndex: setClient1VoiceIndex,
    },
    'Client 2': {
      gender: 'female',
      index: client2VoiceIndex,
      setIndex: setClient2VoiceIndex,
    },

    // Professor Scenario
    'Professor': {
      gender: 'male',
      index: professorVoiceIndex,
      setIndex: setProfessorVoiceIndex,
    },
    'Student 1': {
      gender: 'male',
      index: student1VoiceIndex,
      setIndex: setStudent1VoiceIndex,
    },
    'Student 2': {
      gender: 'female',
      index: student2VoiceIndex,
      setIndex: setStudent2VoiceIndex,
    },

    // Exam 1
    'Mark': {
      gender: 'male',
      index: markVoiceIndex,
      setIndex: setMarkVoiceIndex,
    },
    'Sarah': {
      gender: 'female',
      index: sarahVoiceIndex,
      setIndex: setSarahVoiceIndex,
    },

    // Exam 2
    'Anna': {
      gender: 'female',
      index: annaVoiceIndex,
      setIndex: setAnnaVoiceIndex,
    },
    'Ben': {
      gender: 'male',
      index: benVoiceIndex,
      setIndex: setBenVoiceIndex,
    },
  }), [
    travelAgentVoiceIndex, client1VoiceIndex, client2VoiceIndex,
    professorVoiceIndex, student1VoiceIndex, student2VoiceIndex,
    markVoiceIndex, sarahVoiceIndex, annaVoiceIndex, benVoiceIndex
  ]);

  // ========== VOICE SELECTION PREDICATES ==========
  const VOICE_PREDICATES = useMemo(
    () => ({
      female: (v) => {
        if (!v?.name || !v?.lang) return false;
        const nameLower = v.name.toLowerCase();
        const lang = v.lang.toLowerCase();

        // Priority 1: Explicit female markers
        if (nameLower.includes('female') || nameLower.includes('woman')) return true;
        
        // Priority 2: Female names
        const femaleNames = [
          'zira', 'hazel', 'samantha', 'victoria', 'susan', 
          'karen', 'moira', 'kate', 'salli', 'joanna', 'aria', 'jenny'
        ];
        if (femaleNames.some(name => nameLower.includes(name))) return true;

        // Priority 3: UK/AU English thng c ging n p
        if (lang.includes('en-gb') || lang.includes('en-au')) return true;

        return false;
      },

      male: (v) => {
        if (!v?.name || !v?.lang) return false;
        const nameLower = v.name.toLowerCase();
        const lang = v.lang.toLowerCase();

        // Priority 1: Explicit male markers
        if (nameLower.includes('male') || nameLower.includes('man')) return true;
        
        // Priority 2: Male names
        const maleNames = [
          'david', 'mark', 'george', 'james', 'daniel', 
          'alex', 'thomas', 'matthew', 'joey', 'justin', 'ryan', 'tom'
        ];
        if (maleNames.some(name => nameLower.includes(name))) return true;

        // Priority 3: US English thng c ging nam
        if (lang.includes('en-us')) return true;

        return false;
      },
    }),
    []
  );

  // SA I: Hm shuffle mng  ngu nhin ha gn ging
  const shuffleArray = useCallback((array) => {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  }, []);

  // SA I: Hm gn ging duy nht cho tng speaker da trn gii tnh
  const assignUniqueVoices = useCallback((filteredVoices) => {
    // Phn loi ging theo gii tnh
    const maleCandidates = filteredVoices
      .map((voice, idx) => ({ voice, idx }))
      .filter(({ voice }) => VOICE_PREDICATES.male(voice));
    const femaleCandidates = filteredVoices
      .map((voice, idx) => ({ voice, idx }))
      .filter(({ voice }) => VOICE_PREDICATES.female(voice));

    // Shuffle  a dng
    const shuffledMales = shuffleArray(maleCandidates);
    const shuffledFemales = shuffleArray(femaleCandidates);

    // Danh sch speaker theo gii tnh
    const maleSpeakers = ['Travel Agent', 'Client 1', 'Professor', 'Student 1', 'Mark', 'Ben'];
    const femaleSpeakers = ['Client 2', 'Student 2', 'Sarah', 'Anna'];

    // Gn cho nam, u tin duy nht
    maleSpeakers.forEach((speaker, i) => {
      const availableIdx = i < shuffledMales.length ? shuffledMales[i].idx : shuffledMales[i % shuffledMales.length].idx;
      const config = SPEAKER_VOICES[speaker];
      if (config) config.setIndex(availableIdx);
    });

    // Gn cho n, tng t
    femaleSpeakers.forEach((speaker, i) => {
      const availableIdx = i < shuffledFemales.length ? shuffledFemales[i].idx : shuffledFemales[i % shuffledFemales.length].idx;
      const config = SPEAKER_VOICES[speaker];
      if (config) config.setIndex(availableIdx);
    });

    // Cp nht male/female mc nh t speaker u tin
    setSelectedMaleIndex(shuffledMales[0]?.idx ?? 0);
    setSelectedFemaleIndex(shuffledFemales[0]?.idx ?? 0);

    console.log(' Assigned unique voices:', {
      males: maleSpeakers.map(s => ({ speaker: s, voice: filteredVoices[SPEAKER_VOICES[s].index]?.name })),
      females: femaleSpeakers.map(s => ({ speaker: s, voice: filteredVoices[SPEAKER_VOICES[s].index]?.name })),
    });
  }, [VOICE_PREDICATES, SPEAKER_VOICES, shuffleArray]);

  // ========== INITIALIZATION ==========
  useEffect(() => {
    if (typeof window !== 'undefined' && 'speechSynthesis' in window) {
      synthRef.current = window.speechSynthesis;
      
      try {
        synthRef.current.cancel();
      } catch (e) {
        console.warn('Initial cancel failed:', e);
      }
    } else {
      setError('Trnh duyt khng h tr Speech Synthesis');
      setIsLoading(false);
    }

    return () => {
      isMountedRef.current = false;
    };
  }, []);

  // ========== VOICE LOADING LOGIC ==========
  const loadVoices = useCallback(() => {
    try {
      if (!synthRef.current) {
        setError('Speech Synthesis khng kh dng trn trnh duyt ny');
        setIsLoading(false);
        return;
      }

      if (synthRef.current.speaking || synthRef.current.pending) {
        synthRef.current.cancel();
      }

      const availableVoices = synthRef.current.getVoices();

      if (availableVoices.length === 0) {
        if (voiceLoadAttemptsRef.current < MAX_LOAD_ATTEMPTS) {
          voiceLoadAttemptsRef.current++;
          loadTimeoutRef.current = setTimeout(loadVoices, LOAD_RETRY_DELAY);
          return;
        }
        setError('Khng tm thy ging ni trn thit b ny. Vui lng th trnh duyt khc.');
        setIsLoading(false);
        return;
      }

      // Lc cc ging ting Anh
      const filteredVoices = availableVoices.filter(v => {
        try {
          return v?.lang && v.lang.toLowerCase().startsWith('en');
        } catch {
          return false;
        }
      });

      if (filteredVoices.length === 0) {
        setError('Khng tm thy ging Ting Anh. Vui lng ci t ngn ng Ting Anh trn thit b.');
        setIsLoading(false);
        return;
      }

      console.log(` Loaded ${filteredVoices.length} English voices`);

      if (!isMountedRef.current) return;

      setAllVoices(filteredVoices);

      // SA I: S dng hm mi  gn ging duy nht cho tng speaker
      assignUniqueVoices(filteredVoices);

      setError(null);
      setIsLoading(false);
      voiceLoadAttemptsRef.current = 0;
    } catch (err) {
      console.error(' Error loading voices:', err);
      if (isMountedRef.current) {
        setError(`Li khi ti ging ni: ${err.message}`);
        setIsLoading(false);
      }
    }
  }, [assignUniqueVoices]);  // SA I: Dependency mi

  // Cc phn cn li gi nguyn (SETUP EVENT LISTENERS, VOICE GETTERS, UPDATE HANDLERS, v.v.)
  // ... (ti rt gn  tp trung, nhng bn c th copy nguyn t m gc)

  // ========== SETUP EVENT LISTENERS ==========
  useEffect(() => {
    if (!synthRef.current) return;

    loadVoices();

    const handleVoicesChanged = () => {
      console.log(' Voices changed event triggered');
      voiceLoadAttemptsRef.current = 0;
      loadVoices();
    };

    if ('onvoiceschanged' in synthRef.current) {
      synthRef.current.onvoiceschanged = handleVoicesChanged;
    }
    
    if (synthRef.current.addEventListener) {
      synthRef.current.addEventListener('voiceschanged', handleVoicesChanged);
    }

    return () => {
      if (loadTimeoutRef.current) {
        clearTimeout(loadTimeoutRef.current);
        loadTimeoutRef.current = null;
      }

      try {
        if (synthRef.current?.speaking) {
          synthRef.current.cancel();
        }
      } catch (err) {
        console.error('Cleanup error:', err);
      }

      if (synthRef.current) {
        if ('onvoiceschanged' in synthRef.current) {
          synthRef.current.onvoiceschanged = null;
        }
        if (synthRef.current.removeEventListener) {
          synthRef.current.removeEventListener('voiceschanged', handleVoicesChanged);
        }
      }

      isMountedRef.current = false;
    };
  }, [loadVoices]);

  // ========== VOICE GETTERS ==========
  const maleVoice = useMemo(
    () => (selectedMaleIndex >= 0 && allVoices[selectedMaleIndex] 
      ? allVoices[selectedMaleIndex] 
      : null),
    [selectedMaleIndex, allVoices]
  );

  const femaleVoice = useMemo(
    () => (selectedFemaleIndex >= 0 && allVoices[selectedFemaleIndex]
      ? allVoices[selectedFemaleIndex]
      : null),
    [selectedFemaleIndex, allVoices]
  );

  // ========== GET SPEAKER VOICE ==========
  const getSpeakerVoice = useCallback((speaker) => {
    const config = SPEAKER_VOICES[speaker];
    if (!config || config.index < 0 || config.index >= allVoices.length) {
      return null;
    }
    return allVoices[config.index];
  }, [SPEAKER_VOICES, allVoices]);

  // ========== VOICE UPDATE HANDLERS ==========
  const updateVoiceIndex = useCallback(
    (isMale, index) => {
      if (!Array.isArray(allVoices) || index < -1 || index >= allVoices.length) {
        console.warn(` Invalid voice index: ${index}, max: ${allVoices.length - 1}`);
        setError(`Ch s ging ni khng hp l: ${index}`);
        return false;
      }

      try {
        if (synthRef.current?.speaking) {
          synthRef.current.cancel();
        }

        if (isMale) {
          setSelectedMaleIndex(index);
          console.log(` Male voice updated to index ${index}: ${allVoices[index]?.name}`);
        } else {
          setSelectedFemaleIndex(index);
          console.log(` Female voice updated to index ${index}: ${allVoices[index]?.name}`);
        }
        
        setError(null);
        return true;
      } catch (err) {
        console.error(' Error updating voice index:', err);
        setError(`Li khi cp nht ging ni: ${err.message}`);
        return false;
      }
    },
    [allVoices]
  );

  // ========== UPDATE INDIVIDUAL SPEAKER VOICE ==========
  const updateSpeakerVoice = useCallback((speaker, voiceIndex) => {
    if (!Array.isArray(allVoices) || voiceIndex < -1 || voiceIndex >= allVoices.length) {
      console.warn(` Invalid voice index for ${speaker}: ${voiceIndex}`);
      setError(`Ch s ging ni khng hp l cho ${speaker}`);
      return false;
    }

    try {
      if (synthRef.current?.speaking) {
        synthRef.current.cancel();
      }

      const config = SPEAKER_VOICES[speaker];
      if (!config) {
        console.warn(` Unknown speaker: ${speaker}`);
        return false;
      }

      config.setIndex(voiceIndex);
      console.log(` ${speaker} voice updated to index ${voiceIndex}: ${allVoices[voiceIndex]?.name}`);
      setError(null);
      return true;
    } catch (err) {
      console.error(` Error updating ${speaker} voice:`, err);
      setError(`Li khi cp nht ging ni cho ${speaker}: ${err.message}`);
      return false;
    }
  }, [allVoices, SPEAKER_VOICES]);

  // Legacy API support
  const updateVoice = useCallback(
    (isMale, index, speaker = null) => {
      if (speaker && SPEAKER_VOICES[speaker]) {
        return updateSpeakerVoice(speaker, index);
      }
      return updateVoiceIndex(isMale, index);
    },
    [updateVoiceIndex, updateSpeakerVoice, SPEAKER_VOICES]
  );

  // ========== FORCE RELOAD VOICES ==========
  const reloadVoices = useCallback(() => {
    console.log(' Force reloading voices...');
    voiceLoadAttemptsRef.current = 0;
    setIsLoading(true);
    setError(null);
    loadVoices();
  }, [loadVoices]);

  // ========== GET SPEAKER VOICE INDEX ==========
  const getSpeakerVoiceIndex = useCallback((speaker) => {
    const config = SPEAKER_VOICES[speaker];
    return config ? config.index : -1;
  }, [SPEAKER_VOICES]);

  // ========== RETURN PUBLIC API ==========
  return {
    // Voice data
    allVoices,
    maleVoice,
    femaleVoice,
    
    // Voice indices
    selectedMaleIndex,
    selectedFemaleIndex,

    // ========== NEW: INDIVIDUAL SPEAKER VOICES ==========
    // Travel Agent
    travelAgentVoiceIndex,
    client1VoiceIndex,
    client2VoiceIndex,

    // Professor
    professorVoiceIndex,
    student1VoiceIndex,
    student2VoiceIndex,

    // Exam 1
    markVoiceIndex,
    sarahVoiceIndex,

    // Exam 2
    annaVoiceIndex,
    benVoiceIndex,

    // Speaker configuration
    SPEAKER_VOICES,

    // Update functions
    updateVoice, // Legacy
    updateVoiceIndex, // For male/female
    updateSpeakerVoice, // NEW: Update individual speaker
    getSpeakerVoice, // NEW: Get voice object for speaker
    getSpeakerVoiceIndex, // NEW: Get voice index for speaker
    reloadVoices,
    
    // Refs
    synthRef,
    
    // Status
    isLoading,
    error,
    
    // Voice info
    voiceInfo: {
      total: allVoices.length,
      male: maleVoice?.name || 'Not selected',
      female: femaleVoice?.name || 'Not selected',
      speakers: {
        'Travel Agent': allVoices[travelAgentVoiceIndex]?.name || 'Not selected',
        'Client 1': allVoices[client1VoiceIndex]?.name || 'Not selected',
        'Client 2': allVoices[client2VoiceIndex]?.name || 'Not selected',
        'Professor': allVoices[professorVoiceIndex]?.name || 'Not selected',
        'Student 1': allVoices[student1VoiceIndex]?.name || 'Not selected',
        'Student 2': allVoices[student2VoiceIndex]?.name || 'Not selected',
        'Mark': allVoices[markVoiceIndex]?.name || 'Not selected',
        'Sarah': allVoices[sarahVoiceIndex]?.name || 'Not selected',
        'Anna': allVoices[annaVoiceIndex]?.name || 'Not selected',
        'Ben': allVoices[benVoiceIndex]?.name || 'Not selected',
      }
    }
  };
};
</file>

<file path="src/styles/animations.css">
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slideDown {
  animation: slideDown 0.3s ease-out forwards;
}

@keyframes blob {
  0% {
    transform: translate(0px, 0px) scale(1);
  }
  33% {
    transform: translate(30px, -50px) scale(1.1);
  }
  66% {
    transform: translate(-20px, 20px) scale(0.9);
  }
  100% {
    transform: translate(0px, 0px) scale(1);
  }
}

.animate-blob {
  animation: blob 7s infinite;
}

.animation-delay-2000 {
  animation-delay: 2s;
}
</file>

<file path="src/utils/helpers.js">
export const calculateProgress = (completedWords, vocabularyData) => {
    if (!vocabularyData) return 0;
    const allWords = Object.values(vocabularyData.categories)
        .flat()
        .map(cat => cat.words)
        .flat();
    return allWords.length > 0 ? Math.round((completedWords.length / allWords.length) * 100) : 0;
};

export const toggleWord = (wordId, completedWords, setCompletedWords) => {
    setCompletedWords(prev => 
        prev.includes(wordId) ? prev.filter(id => id !== wordId) : [...prev, wordId]
    );
};

export const handleFlashcardNav = (direction, flashcardIndex, flashcards) => {
    if (direction === 'next') {
        return (flashcardIndex + 1) % flashcards.length;
    } else {
        return flashcardIndex === 0 ? flashcards.length - 1 : flashcardIndex - 1;
    }
};
</file>

<file path="src/views/CategoriesView.jsx">
import React from "react";
import { motion } from "framer-motion";
import Card from "../components/ui/Card";
import { LEVELS } from "../constants/levels";
import { BookOpen } from "lucide-react";

export default function CategoriesView() {
  const categories = [
    { name: "Cng vic", words: 20 },
    { name: "Kinh doanh", words: 25 },
    { name: "Cng ngh", words: 15 },
    { name: "Du lch", words: 18 },
    { name: "Mua sm", words: 22 },
  ];

  return (
    <motion.div
      className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: 0.4 }}
    >
      {categories.map((cat, index) => (
        <Card key={index} className="p-6 hover:shadow-2xl cursor-pointer">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-indigo-100 rounded-full">
              <BookOpen className="text-indigo-600 w-6 h-6" />
            </div>
            <div>
              <h3 className="text-lg font-semibold text-gray-900">{cat.name}</h3>
              <p className="text-sm text-gray-500">
                {cat.words} t vng  Cp {" "}
                <span className="font-medium text-indigo-600">
                  {LEVELS[index % LEVELS.length]}
                </span>
              </p>
            </div>
          </div>
        </Card>
      ))}
    </motion.div>
  );
}
</file>

<file path="src/views/FlashcardsView.jsx">
import React from "react";
import { motion } from "framer-motion";
import WordCard from "../components/WordCard";

export default function FlashcardsView({
  vocabularyData,
  completedWords,
  onSpeak,
  playingId,
  onComplete,
}) {
  return (
    <motion.div
      className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: 0.4 }}
    >
      {vocabularyData.map((word, index) => (
        <WordCard
          key={index}
          {...word}
          onSpeak={() => onSpeak(word.word, index)}
          isPlaying={playingId === index}
          onComplete={() => onComplete(word.word)}
          isCompleted={completedWords.includes(word.word)}
        />
      ))}
    </motion.div>
  );
}
</file>

<file path="src/views/QuizView.jsx">
import React, { useState } from "react";
import { motion } from "framer-motion";
import Card from "../components/ui/Card";
import Button from "../components/ui/Button";

export default function QuizView() {
  const questions = [
    {
      question: "T no c ngha l 'cuc hp'?",
      options: ["meeting", "factory", "product", "price"],
      correct: "meeting",
    },
    {
      question: "T no c ngha l 'my tnh xch tay'?",
      options: ["phone", "tablet", "laptop", "keyboard"],
      correct: "laptop",
    },
  ];

  const [current, setCurrent] = useState(0);
  const [selected, setSelected] = useState(null);
  const [score, setScore] = useState(0);
  const [finished, setFinished] = useState(false);

  const handleAnswer = (option) => {
    setSelected(option);
    if (option === questions[current].correct) setScore(score + 1);
    setTimeout(() => {
      if (current + 1 < questions.length) {
        setCurrent(current + 1);
        setSelected(null);
      } else {
        setFinished(true);
      }
    }, 800);
  };

  if (finished)
    return (
      <motion.div
        className="text-center space-y-4"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
      >
        <h2 className="text-3xl font-extrabold text-indigo-700">Hon thnh!</h2>
        <p className="text-lg text-gray-600">
          Bn tr li ng{" "}
          <span className="text-indigo-600 font-bold">{score}</span> /
          {questions.length} cu.
        </p>
        <Button variant="primary" onClick={() => window.location.reload()}>
          Lm li
        </Button>
      </motion.div>
    );

  return (
    <Card className="max-w-xl mx-auto p-8 text-center space-y-6">
      <h3 className="text-xl font-semibold text-gray-800">
        Cu {current + 1} / {questions.length}
      </h3>
      <p className="text-2xl font-bold text-indigo-700">
        {questions[current].question}
      </p>
      <div className="grid gap-3">
        {questions[current].options.map((option, index) => (
          <Button
            key={index}
            variant={
              selected === option
                ? option === questions[current].correct
                  ? "success"
                  : "danger"
                : "secondary"
            }
            onClick={() => handleAnswer(option)}
            disabled={!!selected}
          >
            {option}
          </Button>
        ))}
      </div>
    </Card>
  );
}
</file>

<file path="src/views/StatsView.jsx">
import React from "react";
import { motion } from "framer-motion";
import StatBox from "../components/ui/StatBox";
import { CheckCircle, Book, BarChart3 } from "lucide-react";

export default function StatsView({ completedWords, totalWords }) {
  const percent = ((completedWords.length / totalWords) * 100).toFixed(1);

  return (
    <motion.div
      className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: 0.4 }}
    >
      <StatBox
        label="T  hc"
        value={completedWords.length}
        icon={CheckCircle}
        trend={+percent}
      />
      <StatBox
        label="Tng s t"
        value={totalWords}
        icon={Book}
        trend={0}
      />
      <StatBox
        label="Tin "
        value={`${percent}%`}
        icon={BarChart3}
        trend={percent > 50 ? +percent : 0}
      />
    </motion.div>
  );
}
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{jsx,js,ts,tsx}",
  ],
  theme: {
    extend: {
      fontFamily: {
        inter: ['Inter', 'Segoe UI', 'system-ui', '-apple-system', 'sans-serif'],
      },
      colors: {
        // Primary gradient colors
        'primary-orange': '#f97316',
        'primary-yellow': '#fbbf24',
        'primary-dark': '#0f172a',
        'primary-darker': '#1f2937',
        'purple-1': '#667eea',
        'purple-2': '#764ba2',
        'pink-1': '#f093fb',
        // Grammar / Education module
        grammar: {
          primary: '#00358E',
          'primary-hover': '#002a70',
          accent: '#FF7D00',
          'accent-hover': '#e67000',
          'accent-soft': 'rgba(255, 125, 0, 0.12)',
          blue: '#2563eb',
          'blue-soft': 'rgba(37, 99, 235, 0.08)',
          'blue-light': '#e0eaff',
        },
      },
      backgroundImage: {
        'gradient-app': 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)',
        'gradient-primary': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        'gradient-success': 'linear-gradient(90deg, #10b981 0%, #059669 50%, #047857 100%)',
        'gradient-navbar': 'linear-gradient(to right, #f97316, #fbbf24, #f97316)',
        'gradient-orange': 'linear-gradient(135deg, #f97316, #fbbf24)',
      },
      boxShadow: {
        'app': '0 30px 90px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.8)',
        'glass': '0 4px 6px -1px rgba(249, 115, 22, 0.1), 0 2px 4px -1px rgba(251, 191, 36, 0.06)',
      },
      animation: {
        'float': 'float 6s ease-in-out infinite',
        'gradient-shift': 'gradientShift 3s ease infinite',
        'progress-shine': 'progressShine 2s linear infinite',
        'score-shine': 'scoreShine 2s ease infinite',
        'glow': 'glow 2s ease-in-out infinite',
        'pulse-custom': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'slide-down': 'slideDown 0.3s ease',
        'blob': 'blob 7s infinite', 
        'confetti': 'confetti 3s ease-out forwards',
        'shimmer': 'shimmer 2s infinite',
        'grammar-confetti': 'grammarConfetti 3s ease-out forwards',
      },
      keyframes: {
        float: {
          '0%, 100%': { transform: 'translateY(0px)' },
          '50%': { transform: 'translateY(-5px)' },
        },
        blob: {
          "0%, 100%": { transform: "translate(0px, 0px) scale(1)" },
          "33%": { transform: "translate(30px, -50px) scale(1.1)" },
          "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
        },
        gradientShift: {
          '0%, 100%': { backgroundPosition: '0% 50%' },
          '50%': { backgroundPosition: '100% 50%' },
        },
        progressShine: {
          '0%': { backgroundPosition: '0% 50%' },
          '100%': { backgroundPosition: '200% 50%' },
        },
        scoreShine: {
          '0%, 100%': { backgroundPosition: '0% 50%' },
          '50%': { backgroundPosition: '100% 50%' },
        },
        glow: {
          '0%, 100%': { boxShadow: '0 0 20px rgba(102, 126, 234, 0.3)' },
          '50%': { boxShadow: '0 0 30px rgba(102, 126, 234, 0.6)' },
        },
        slideDown: {
          'from': { opacity: '0', transform: 'translateY(-10px)' },
          'to': { opacity: '1', transform: 'translateY(0)' },
        },
        shimmer: {
          '0%': { transform: 'translateX(-100%)' },
          '100%': { transform: 'translateX(100%)' },
        },
        grammarConfetti: {
          '0%': { transform: 'translateY(0) rotate(0deg)', opacity: '1' },
          '100%': { transform: 'translateY(100vh) rotate(720deg)', opacity: '0' },
        },
      },
      spacing: {
        'safe': 'max(1rem, env(safe-area-inset-bottom))',
      },
      borderWidth: {
        '5': '5px',
      },
      backdropBlur: {
        'xl': '20px',
        '3xl': '32px',
      },
      screens: {
        'xs': '320px',
        'sm': '480px',
        'md': '768px',
        'lg': '1024px',
        'xl': '1280px',
        '2xl': '1536px',
      },
      // Thm max-width responsive
      maxWidth: {
        'screen-xs': '320px',
        'screen-sm': '480px',
        'screen-md': '768px',
        'screen-lg': '1024px',
        'screen-xl': '1280px',
        'screen-2xl': '1536px',
      },
    },
  },
  plugins: [
    function ({ addBase, addComponents, addUtilities, theme }) {
      // Add base styles to prevent overflow
      addBase({
        'html': {
          overflowX: 'hidden',
          width: '100%',
          maxWidth: '100vw',
        },
        'body': {
          overflowX: 'hidden',
          width: '100%',
          maxWidth: '100vw',
          position: 'relative',
        },
        // Prevent horizontal scroll on all elements
        '*': {
          boxSizing: 'border-box',
        },
        // Mobile-specific optimizations
        '@media (max-width: 768px)': {
          'html, body': {
            overscrollBehavior: 'none',
            WebkitOverflowScrolling: 'touch',
          },
        },
      });

      // Add custom utilities
      addUtilities({
        '.letter-spacing-tight': {
          letterSpacing: '-0.3px',
        },
        '.text-shadow': {
          textShadow: '0 2px 20px rgba(102, 126, 234, 0.2)',
        },
        '.bg-glass': {
          backgroundColor: 'rgba(255, 255, 255, 0.98)',
          backdropFilter: 'blur(20px)',
        },
        '.border-gradient': {
          borderImage: 'linear-gradient(90deg, #667eea, #764ba2) 1',
        },
        '.animation-delay-2000': {
          'animationDelay': '2000ms',
        },
        '.animation-delay-4000': {
          'animationDelay': '4000ms',
        },
        // Utilities to prevent overflow
        '.no-scrollbar': {
          '-ms-overflow-style': 'none',
          'scrollbar-width': 'none',
          '&::-webkit-scrollbar': {
            display: 'none',
          },
        },
        '.prevent-overflow': {
          overflowX: 'hidden',
          maxWidth: '100vw',
          width: '100%',
        },
        '.safe-padding-x': {
          paddingLeft: 'max(1rem, env(safe-area-inset-left))',
          paddingRight: 'max(1rem, env(safe-area-inset-right))',
        },
        '.safe-padding-y': {
          paddingTop: 'max(1rem, env(safe-area-inset-top))',
          paddingBottom: 'max(1rem, env(safe-area-inset-bottom))',
        },
        // Text overflow utilities
        '.text-ellipsis-2': {
          display: '-webkit-box',
          '-webkit-line-clamp': '2',
          '-webkit-box-orient': 'vertical',
          overflow: 'hidden',
          textOverflow: 'ellipsis',
        },
        '.text-ellipsis-3': {
          display: '-webkit-box',
          '-webkit-line-clamp': '3',
          '-webkit-box-orient': 'vertical',
          overflow: 'hidden',
          textOverflow: 'ellipsis',
        },
        // Container utilities for responsive layouts
        '.container-fluid': {
          width: '100%',
          maxWidth: '100vw',
          paddingLeft: '1rem',
          paddingRight: '1rem',
          marginLeft: 'auto',
          marginRight: 'auto',
          '@screen sm': {
            paddingLeft: '1.5rem',
            paddingRight: '1.5rem',
          },
          '@screen md': {
            paddingLeft: '2rem',
            paddingRight: '2rem',
          },
          '@screen lg': {
            paddingLeft: '2.5rem',
            paddingRight: '2.5rem',
          },
        },
      });

      // Add custom components with responsive improvements
      addComponents({
        '.btn-base': {
          '@apply px-4 py-3 sm:px-6 sm:py-4 rounded-xl sm:rounded-2xl font-bold cursor-pointer transition-all duration-300 shadow-lg hover:shadow-xl hover:-translate-y-1 active:-translate-y-0.5 text-sm sm:text-base': {},
        },
        '.btn-primary': {
          '@apply btn-base bg-gradient-primary text-white': {},
        },
        '.btn-secondary': {
          '@apply btn-base bg-slate-700 text-white hover:bg-slate-600': {},
        },
        '.btn-gradient-primary': {
          '@apply btn-base bg-gradient-to-r from-purple-1 to-purple-2 text-white': {},
        },
        '.card-glass': {
          '@apply bg-white/98 backdrop-blur-3xl rounded-2xl sm:rounded-3xl shadow-lg border border-white/50 p-4 sm:p-6': {},
        },
        '.input-base': {
          '@apply px-4 py-2.5 sm:px-5 sm:py-3 border-2 border-gray-300 rounded-lg sm:rounded-xl text-sm sm:text-base bg-white transition-all font-medium hover:border-purple-1 focus:outline-none focus:border-purple-1 w-full': {},
        },
        // Responsive container
        '.container-responsive': {
          '@apply w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8': {},
        },
        // Grid responsive
        '.grid-responsive': {
          '@apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6': {},
        },
        // Card responsive
        '.card-responsive': {
          '@apply p-3 sm:p-4 md:p-6 rounded-lg sm:rounded-xl md:rounded-2xl': {},
        },
      });
    },
  ],
};
</file>

<file path="Backend/.gitignore">
# backend/.gitignore
node_modules/
.env
.env.local
.env.*.local
dist/
build/
*.log
.DS_Store
.vscode/
*.pem
firebase-key.json
.vercel
</file>

<file path="Backend/controllers/chatController.js">
// backend/controllers/chatController.js
import { db, isFirebaseEnabled } from '../firebase-config.js';
import admin from 'firebase-admin';

// In-memory storage for online users only
let users = new Map();

// In-memory message cache (fallback when Firebase unavailable)
let messageCache = [];

/**
 * Handle user join event
 */
export const handleUserJoin = async (socket, io, data) => {
  try {
    const { userId, userName, avatar } = data;

    const user = {
      socketId: socket.id,
      userId,
      userName,
      avatar,
      joinedAt: new Date(),
      isOnline: true,
    };

    users.set(socket.id, user);

    // Broadcast user joined
    io.emit('user-joined', {
      message: `${userName}  tham gia phng chat`,
      user,
      users: Array.from(users.values()),
      timestamp: new Date(),
    });

    console.log(' Online users:', users.size);
    console.log(' User joined:', userName);
  } catch (error) {
    console.error(' Error in handleUserJoin:', error.message);
  }
};

/**
 * Handle send message event - Save to Firestore or cache
 */
export const handleSendMessage = async (socket, io, data) => {
  try {
    const { content, sender, senderId } = data;

    const message = {
      id: Date.now(),
      content,
      sender,
      senderId,
      timestamp: isFirebaseEnabled ? admin.firestore.Timestamp.now() : new Date(),
      socketId: socket.id,
    };

    // Try to save to Firestore
    if (isFirebaseEnabled) {
      try {
        await db.collection('messages').doc(String(message.id)).set(message);
        console.log(' Message saved to Firestore:', sender);
      } catch (firestoreError) {
        console.warn(' Firestore save failed, using cache:', firestoreError.message);
        messageCache.push(message);
      }
    } else {
      // Use cache if Firebase disabled
      messageCache.push(message);
      console.log(' Message cached (Firebase disabled)');
    }

    // Broadcast message to all clients
    const broadcastMessage = {
      ...message,
      timestamp: message.timestamp instanceof admin.firestore.Timestamp 
        ? new Date(message.timestamp.toMillis())
        : message.timestamp,
    };

    io.emit('receive-message', broadcastMessage);
    console.log(' Message broadcast:', sender, '-', content);
  } catch (error) {
    console.error(' Error in handleSendMessage:', error.message);
  }
};

/**
 * Handle delete message event
 */
export const handleDeleteMessage = async (socket, io, messageId) => {
  try {
    // Delete from Firestore if enabled
    if (isFirebaseEnabled) {
      try {
        await db.collection('messages').doc(String(messageId)).delete();
        console.log(' Message deleted from Firestore:', messageId);
      } catch (firestoreError) {
        console.warn(' Firestore delete failed:', firestoreError.message);
      }
    }

    // Delete from cache
    messageCache = messageCache.filter(msg => msg.id !== messageId);
    console.log(' Message removed from cache');

    io.emit('message-deleted', messageId);
    console.log(' Message deleted:', messageId);
  } catch (error) {
    console.error(' Error in handleDeleteMessage:', error.message);
  }
};

/**
 * Handle user disconnect event
 */
export const handleUserDisconnect = (socket, io) => {
  try {
    const user = users.get(socket.id);

    if (user) {
      users.delete(socket.id);
      
      io.emit('user-left', {
        message: `${user.userName}  ri phng chat`,
        userId: user.userId,
        userName: user.userName,
        users: Array.from(users.values()),
        timestamp: new Date(),
      });

      console.log(' User disconnected:', user.userName, `(${socket.id})`);
      console.log(' Remaining online users:', users.size);
    }
  } catch (error) {
    console.error(' Error in handleUserDisconnect:', error.message);
  }
};

/**
 * Get all messages from Firestore or cache
 */
export const getAllMessages = async () => {
  try {
    let messages = [];

    // Try to fetch from Firestore if enabled
    if (isFirebaseEnabled) {
      try {
        const snapshot = await db.collection('messages')
          .orderBy('timestamp', 'asc')
          .limit(100)
          .get();

        messages = snapshot.docs.map((doc) => {
          const data = doc.data();
          return {
            ...data,
            timestamp: data.timestamp instanceof admin.firestore.Timestamp
              ? new Date(data.timestamp.toMillis())
              : data.timestamp,
          };
        });

        console.log(' Fetched', messages.length, 'messages from Firestore');
      } catch (firestoreError) {
        console.warn(' Firestore fetch failed, using cache:', firestoreError.message);
        messages = messageCache;
      }
    } else {
      // Use cache if Firebase disabled
      messages = messageCache;
      console.log(' Using cached messages:', messages.length);
    }

    return messages;
  } catch (error) {
    console.error(' Error fetching messages:', error.message);
    return messageCache; // Fallback to cache
  }
};

/**
 * Get all online users
 */
export const getAllUsers = () => {
  const userArray = Array.from(users.values());
  console.log(' Active users:', userArray.length);
  return userArray;
};

/**
 * Clear all messages from Firestore and cache
 */
export const clearMessages = async () => {
  try {
    // Clear from Firestore if enabled
    if (isFirebaseEnabled) {
      try {
        const batch = db.batch();
        const snapshot = await db.collection('messages').get();

        snapshot.docs.forEach((doc) => {
          batch.delete(doc.ref);
        });

        await batch.commit();
        console.log(' Cleared messages from Firestore');
      } catch (firestoreError) {
        console.warn(' Firestore clear failed:', firestoreError.message);
      }
    }

    // Clear cache
    const count = messageCache.length;
    messageCache = [];
    console.log(' Cleared', count, 'messages from cache');
  } catch (error) {
    console.error(' Error clearing messages:', error.message);
  }
};

/**
 * Clear all users (admin only)
 */
export const clearUsers = () => {
  try {
    const count = users.size;
    users.clear();
    console.log(' Cleared all', count, 'users');
  } catch (error) {
    console.error(' Error clearing users:', error.message);
  }
};

/**
 * Get message count
 */
export const getMessageCount = () => {
  return messageCache.length;
};

/**
 * Get user count
 */
export const getUserCount = () => {
  return users.size;
};

/**
 * Get system stats
 */
export const getSystemStats = () => {
  return {
    onlineUsers: users.size,
    cachedMessages: messageCache.length,
    firebaseEnabled: isFirebaseEnabled,
    timestamp: new Date(),
  };
};
</file>

<file path="Backend/package.json">
{
  "name": "huflit-chat-backend",
  "version": "1.0.0",
  "description": "HUFLIT Chat Server - Socket.IO Backend",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "dev": "nodemon",
    "start": "node index.js",
    "build": "echo 'No build needed'",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [
    "chat",
    "socket.io",
    "express",
    "real-time"
  ],
  "author": "",
  "license": "ISC",
  "engines": {
    "node": "20.x"
  },
  "dependencies": {
    "cors": "^2.8.5",
    "dotenv": "^17.2.3",
    "express": "^5.1.0",
    "socket.io": "^4.8.1",
    "firebase-admin": "^13.6.0"
  },
  "devDependencies": {
    "nodemon": "^3.1.11"
  }
}
</file>

<file path="firebase.json">
{
  "emulators": {
    "dataconnect": {
      "dataDir": "dataconnect/.dataconnect/pgliteData"
    }
  },
  "dataconnect": {
    "source": "dataconnect"
  },
  "firestore": {
    "database": "(default)",
    "location": "nam5",
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  },
  "storage": {
    "rules": "  "
  },
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "disallowLegacyRuntimeConfig": true,
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log",
        "*.local"
      ],
      "predeploy": [
        "npm --prefix \"$RESOURCE_DIR\" run lint"
      ]
    }
  ]
}
</file>

<file path="README.md">
<div align="center">

#  HUFLIT Test Practice

### *Nn tng luyn thi TOEIC vi cng ngh hin i*

[![Live Demo](https://img.shields.io/badge/_Live_Demo-Visit_Site-ff8c42?style=for-the-badge&labelColor=1a1a1a)](https://huflit-test.vercel.app)
[![Vercel](https://img.shields.io/badge/Deployed_on-Vercel-000000?style=for-the-badge&logo=vercel&logoColor=white)](https://vercel.com)
[![React](https://img.shields.io/badge/React_18-61DAFB?style=for-the-badge&logo=react&logoColor=black)](https://reactjs.org)
[![Firebase](https://img.shields.io/badge/Firebase_10-FFCA28?style=for-the-badge&logo=firebase&logoColor=black)](https://firebase.google.com)
[![License](https://img.shields.io/badge/License-MIT-10b981?style=for-the-badge)](LICENSE)

**[ Truy cp ng dng](https://huflit-test.vercel.app)  [ Ti liu](https://github.com/khoale-dev-code/huflit-test)  [ Bo li](https://github.com/khoale-dev-code/huflit-test/issues)  [ Tho lun](https://github.com/khoale-dev-code/huflit-test/discussions)**

</div>

---

##  Mc lc

- [ Tnh nng ni bt](#-tnh-nng-ni-bt)
- [ Demo & Screenshots](#-demo--screenshots)
- [ Bt u nhanh](#-bt-u-nhanh)
- [ Stack cng ngh](#-stack-cng-ngh)
- [ Cu trc d n](#-cu-trc-d-n)
- [ Hng dn s dng](#-hng-dn-s-dng)
- [ Cu hnh & Trin khai](#-cu-hnh--trin-khai)
- [ Bo mt](#-bo-mt)
- [ Tnh nng nng cao](#-tnh-nng-nng-cao)
- [ Testing](#-testing)
- [ Troubleshooting](#-troubleshooting)
- [ Changelog](#-changelog)
- [ ng gp](#-ng-gp)
- [ Lin h & H tr](#-lin-h--h-tr)
- [ License](#-license)
- [ Acknowledgments](#-acknowledgments)

---

##  Tnh nng ni bt

###  **Bi thi Nghe (Listening)**

| Tnh nng | M t |
|-----------|-------|
|  **a ging ni** | Nam/N t nhin, c th iu chnh |
|  **Tc  linh hot** | 0.5x - 2.0x (ph hp n luyn) |
|  **Nghe li khng gii hn** | Ti pht tng phn bt c lc no |
|  **y  4 Parts** | Part 1-4 theo chun TOEIC |
|  **Ch  practise & test** | Linh hot chn luyn tp hoc thi th |

###  **Bi thi c (Reading)**

| Tnh nng | M t |
|-----------|-------|
|  **c hiu hon chnh** | Part 5, 6, 7 theo  chun TOEIC |
|  **Bi tp ng php** | Tng tc, gii thch chi tit |
|  **Hc t vng theo ch ** | H thng t vng c sp xp |
|  **Chm im t ng** | Kt qu tc th + phn tch |
|  **Xem gii thch** | p n + l do chi tit |

###  **Ti khon & Tin **

| Tnh nng | M t |
|-----------|-------|
|  **Xc thc an ton** | Google OAuth + Email (Clerk) |
|  **Lu tin  t ng** | ng b Firebase Firestore |
|  **Thng k chi tit** | im theo tng part & bi lm |
|  **Lch s bi thi** | Xem li tt c bi lm trc  |
|  **Phn tch hiu sut** | Theo di tin b qua thi gian |

###  **Giao din & Tri nghim**

| Tnh nng | M t |
|-----------|-------|
|  **Responsive thit k** | Hon ho trn mobile/tablet/desktop |
|  **Theme gradient cam-vng** | p mt, hin i, d s dng |
|  **Animation mt m** | Hiu ng chuyn tip t nhin |
|  **Tc  ti cc nhanh** | Optimized build, code splitting |
|  **Dark mode support** | (Ty chn trong ci t) |

---

##  Demo & Screenshots

###  Trang ch & Dashboard

```

  HUFLIT Test Practice               
   
  [ Listening]  [ Reading]       
  [ Grammar]    [ Vocabulary]    
  [ My Results]                    

```

###  Ch  Listening

```

  Part 1 - Photographs      

 Question 1/10                
    00:15 / 01:00    
  Speed: 1.0x              
  Voice: Female             

 (A)   (B)   (C)  (D)    
  Prev    Next             

 [Submit] [Review]            

```

###  Ch  Reading (2 ct trn desktop)

```

  Part 7 - Reading Comprehension              

  Passage     Question 1/5                
                
 Long text      What is the main topic?    
 here...                                   
                (A)   (B)               
                (C)   (D)               
                                           
                 Prev    Next          
                [Submit]                   

```

###  Kt qu & Thng k

```

  Results - Part 1             

 Score: 8/10  80%     
 Time: 12:45 / 15:00            
 Accuracy: 80%                  

  Correct: 8      Wrong: 2   
  Skipped: 0                   

 [Review] [Try Again] [Next]    

```

>  **Live demo**: Truy cp [huflit-test.vercel.app](https://huflit-test.vercel.app)  xem giao din thc t

---

##  Bt u nhanh

###  Yu cu h thng

```bash
 Node.js >= 16.x (khuyn ngh 18.x+)
 npm >= 8.x hoc yarn >= 1.22.x
 Git >= 2.0
```

###  Ci t & Chy

**Bc 1: Clone repository**

```bash
git clone https://github.com/khoale-dev-code/huflit-test.git
cd huflit-test
```

**Bc 2: Ci t dependencies**

```bash
npm install
# hoc
yarn install
```

**Bc 3: To file `.env.local`**

```bash
cp .env.example .env.local
# Ri in thng tin (xem mc Cu hnh)
```

**Bc 4: Chy development server**

```bash
npm run dev
# Server s chy ti http://localhost:5173
```

**Bc 5: M trnh duyt**

```
 M http://localhost:5173 trong trnh duyt yu thch
```

---

##  Stack cng ngh

###  Frontend

```
React 18.2.0           Th vin UI hin i
 React Router v6     Navigation & routing
 Vite 5.x            Build tool siu nhanh
 Tailwind CSS 3      Styling utility-first
 Lucide Icons        Icon library p
 Zustand/Context API State management
```

###  Backend & Services

```
Firebase 10+           Backend-as-a-Service
 Firestore           NoSQL realtime database
 Authentication      User auth & management
 Storage             Cloud file storage
 Analytics           User behavior tracking

Clerk v4+              Modern auth platform
 Google OAuth        SSO vi Google
 Email/Password      Auth traditional
 User Management     Dashboard qun l user
```

###  DevOps & Deployment

```
Vercel                 Hosting & CI/CD
 Auto-deploy         T ng deploy khi push
 Edge Functions      Serverless functions
 Analytics           Performance monitoring
```

###  Dependencies chnh

```json
{
  "react": "^18.2.0",
  "react-dom": "^18.2.0",
  "react-router-dom": "^6.20.0",
  "firebase": "^10.7.0",
  "@clerk/clerk-react": "^4.29.0",
  "zustand": "^4.4.0",
  "tailwindcss": "^3.4.0",
  "lucide-react": "^0.302.0",
  "@hookform/resolvers": "^3.3.0",
  "react-hook-form": "^7.48.0"
}
```

---

##  Cu trc d n

```
huflit-test/

  public/                      # Static files
    favicon.ico
    audio/                      # Audio files
        listening/
        pronunciations/

  src/
   
     components/              # React components
        layout/
           MainLayout.jsx
           Navbar.jsx
           Footer.jsx
      
        auth/
           AuthModal.jsx
           UserProfile.jsx
           LoginButton.jsx
      
        display/
           PartSelector.jsx
           QuestionDisplay.jsx
           ContentDisplay.jsx
           ResultsDisplay.jsx
           ProgressBar.jsx
      
        controls/
           AudioControls.jsx
           VoiceControls.jsx
           PlaybackSpeed.jsx
           VoiceSelector.jsx
      
        common/
           LoadingSpinner.jsx
           ErrorBoundary.jsx
           Button.jsx
           Modal.jsx
      
        voca/
           VocabularyPractice.jsx
           VocabCard.jsx
      
        grammar/
           GrammarReview.jsx
      
        fullexam/
            FullExamMode.jsx
            ExamTimer.jsx
            ExamResults.jsx
   
     hooks/                  # Custom React hooks
        useAppState.js       # App-wide state
        useAudio.js          # Audio playback
        useVoices.js         # Text-to-speech
        useUserProgress.js   # Progress tracking
        useClerkAuth.js      # Clerk authentication
        useFirebaseSync.js   # Firebase sync
        useAutoSave.js       # Auto-save logic
        useOnlineUsers.js    # Real-time user count
   
     data/                   # Exam data
        examData.js          # All test questions
        vocabularyData.js    # Vocabulary list
        grammarRules.js      # Grammar explanations
   
     config/                 # Configuration
        firebase.js          # Firebase config
        routes.js            # App routes
        constants.js         # App constants
   
     utils/                  # Utility functions
        formatters.js        # Data formatters
        validators.js        # Input validation
        scoringEngine.js     # Score calculation
        audioProcessor.js    # Audio utilities
   
     pages/                  # Page components
        HomePage.jsx
        TestPage.jsx
        ResultsPage.jsx
        ProfilePage.jsx
   
     App.jsx                 # Main app component
     main.jsx                # Entry point
     index.css               # Global styles
     tailwind.css            # Tailwind directives

  .env.example                # Environment template
  .env.local                  # Local environment ( KHNG commit)
  .gitignore                  # Git ignore rules
  package.json                # Dependencies
  package-lock.json
  vite.config.js              # Vite configuration
  tailwind.config.js          # Tailwind config
  postcss.config.js           # PostCSS config
  eslint.config.js            # ESLint rules
  README.md                   # Documentation
```

---

##  Hng dn s dng

### 1 ng nhp / ng k

```
 Cch thc hin:
1. Click nt "ng nhp"  gc trn phi
2. Chn mt trong cc ty chn:
    ng nhp vi Google
    ng nhp vi Email
3. Hon thnh xc thc
4. Bm "Cho php"  lu tin 
```

### 2 Chn bi thi

```
 Bc chn bi:

 LISTENING ()
 Part 1: Photographs
 Part 2: Question-Response  
 Part 3: Conversations
 Part 4: Short Talks

 READING ()
 Part 5: Incomplete Sentences
 Part 6: Text Completion
 Part 7: Reading Comprehension

 PRACTICE ()
 Grammar Review
 Vocabulary Practice
 Full Mock Test
```

### 3 Lm bi Listening

**Chun b:**

```bash
1. Chn ging ni (nam/n) cho tng vai din
2. iu chnh tc  pht (0.5x - 2.0x)
3. Kim tra m lng
```

**Trong khi lm:**

```bash
  Play          Bt u nghe
  Pause         Tm dng
  Replay        Nghe li t u
  Skip          B qua cu ny
  Progress      Xem tin  (X/Y cu)
```

**Chn p n:**

```bash
(A)   Click  chn p n A
(B)   Click  chn p n B
(C)   Click  chn p n C
(D)   Click  chn p n D
```

**Kt thc:**

```bash
[Submit]         Np bi
[Review]         Xem li cu tr li
[Try Again]      Lm li t u
```

### 4 Lm bi Reading

**Layout:**

```
Trn desktop (2 ct):
 on vn (TRI)    Cu hi (PHI) 
  c               chn p n  
 T ng scroll      Xem li on   

Trn mobile (1 ct):
 on vn 
 Cu hi  
 p n   
```

**Quy trnh:**

```
1. c k on vn/cu hi
2. Phn tch tng p n
3. Chn cu tr li ph hp
4. Click "Next"  cu tip theo
5. Xem tng hp kt qu
```

### 5 Xem kt qu & Phn tch

```
 Bng im:
 Tng im: XX/100
 Cu ng: XX 
 Cu sai: XX 
 T l: XX%

 Phn tch:
 im tng part
 Thi gian/cu
 Cu d b nhm
 Gi  ci thin
```

### 6 Theo di tin 

```
 H s c nhn:
  Dashboard: Tng hp thng k
  Progress: Biu  tin b
  Rankings: Xp hng (nu c)
  Settings: Ci t c nhn

 Thng k chi tit:
 Tng bi lm: XX
 Thi gian hc: XXh
 im trung bnh: XX%
 Mc tiu: Cp t mc tiu
```

---

##  Cu hnh & Trin khai

###  Cu hnh Environment Variables

To file `.env.local` trong th mc gc:

```env
#  FIREBASE CONFIGURATION
# Ly t Firebase Console > Project Settings
VITE_FIREBASE_API_KEY=AIzaSyDxxxxxxxxxxxxxxxxxxxx
VITE_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your-project-id
VITE_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=123456789
VITE_FIREBASE_APP_ID=1:123456789:web:abc123def456

#  CLERK CONFIGURATION
# Ly t Clerk Dashboard > API Keys
VITE_CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxx

#  GOOGLE ANALYTICS (ty chn)
VITE_GA_TRACKING_ID=G-XXXXXXXXXX

#  APP CONFIGURATION
VITE_APP_URL=http://localhost:5173
VITE_API_URL=https://api.example.com
```

**Cch ly thng tin:**

#### Firebase:
1. Truy cp [Firebase Console](https://console.firebase.google.com)
2. To hoc chn d n
3. Vo Settings > Project Settings
4. Copy config t SDK setup

#### Clerk:
1. Truy cp [Clerk Dashboard](https://dashboard.clerk.com)
2. Vo Settings > API Keys
3. Copy `Publishable Key`

###  Build cho Production

```bash
# Build optimized
npm run build

# Preview build locally
npm run preview

# Kim tra size bundle
npm run build -- --stats
```

###  Trin khai ln Vercel

**Cch 1: Automatic Deployment (Khuyn ngh)**

```bash
# 1. Push code ln GitHub
git add .
git commit -m "Initial commit"
git push origin main

# 2. Vo https://vercel.com/new
# 3. Import repository
# 4. Vercel t ng deploy mi khi push
```

**Cch 2: Manual Deployment**

```bash
# Ci Vercel CLI
npm i -g vercel

# Login vo Vercel
vercel login

# Deploy
vercel --prod
```

**Cch 3: Deploy khc (Netlify, GitHub Pages)**

```bash
# Netlify
npm run build
# Ko th folder `dist` vo Netlify

# GitHub Pages
npm run build
git subtree push --prefix dist origin gh-pages
```

---

##  Bo mt

###  Files KHNG c commit

```gitignore
#  Sensitive files
.env
.env.local
.env.production.local
.env.development.local
serviceAccountKey.json
credentials.json
**/*.key
**/*.pem

#  Dependencies & Build
node_modules/
dist/
build/
.cache/

#  IDE & OS
.vscode/
.idea/
*.swp
.DS_Store
Thumbs.db

#  Logs
npm-debug.log*
yarn-debug.log*
```

###  Best Practices

|  DO |  DON'T |
|-------|----------|
| Dng environment variables | Hard-code API keys |
| Gitignore .env file | Commit secrets |
| Rotate keys nu b l | Reuse compromised keys |
| S dng HTTPS | HTTP cho production |
| Enable Firebase Security Rules | Public database |
| Regular security audits | Ignore vulnerabilities |
| Update dependencies | Outdated packages |

###  Firebase Security Rules

```javascript
// Firestore Rules (firestore.rules)
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // User data - ch user  mi truy cp
    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;
    }
    
    // Public data - ai cng xem c
    match /public/{document=**} {
      allow read: if true;
      allow write: if false;
    }
    
    // Test results - ch owner mi truy cp
    match /results/{resultId} {
      allow read, write: if request.auth.uid == resource.data.userId;
    }
  }
}
```

---

###  Ch  Pht trin

```
1 PRACTICE MODE (Luyn tp)
    Nghe li khng gii hn
    Xem p n ngay sau khi chn
    Khng tnh gi
    C th b qua cu
   
2 TEST MODE (Thi th)
    Nghe 1 ln duy nht
    Khng xem p n trc khi submit
    C b m thi gian
    Khng c b qua

3 REVIEW MODE (n tp)
    Xem li bi c
    So snh cu tr li
    Xem gii thch chi tit
    Theo di tin b
```

###  Text-to-Speech Engine

```javascript
// Web Speech API Integration
const { speak, voices, setVoice, setRate } = useVoices();

//  Tnh nng h tr:
- Ging nam/n t chn
- Tc  t 0.5x - 2.0x
- Trng m TOEIC chun
- H tr a ngn ng
- Pht m t nhin

//  Cch s dng:
// 1. Chn ging
setVoice('Google US English Female');

// 2. iu chnh tc 
setRate(1.2); // 120% tc  bnh thng

// 3. Pht m
speak('Hello, welcome to HUFLIT Test Practice!');

// 4. Dng pht
stopSpeaking();
```

**Danh sch ging c h tr:**

| Ging | M t | Use Case |
|-------|-------|----------|
|  US Female | Ging n M | Narrator, Instructions |
|  US Male | Ging nam M | Questions, Conversations |
|  UK Female | Ging n Anh | Formal texts |
|  UK Male | Ging nam Anh | Business scenarios |
|  AU Female | Ging n c | Diverse accents |
|  CA Male | Ging nam Canada | International contexts |

###  Auto-Save System

```javascript
// T ng lu mi khi c thay i
useEffect(() => {
  const timer = setTimeout(() => {
    saveProgress({
      answers,
      currentQuestion,
      timeSpent,
      timestamp: new Date().toISOString(),
      examId: selectedExam,
      partId: selectedPart
    });
  }, 2000); // Debounce 2 giy
  
  return () => clearTimeout(timer);
}, [answers, currentQuestion, timeSpent]);

//  Features:
 Auto-save mi 2 giy
 Sync realtime vi Firestore
 Offline support vi IndexedDB
 Conflict resolution t ng
 Retry mechanism nu fail
 Visual indicator khi ang lu
```

**C ch hot ng:**

```

 User thay i cu tr li       

           
           

 Debounce 2 giy                 

           
           

 Kim tra kt ni                

 Online?   Offline?             
  Firebase   IndexedDB        

           
           

 Lu thnh cng                  
 Show: "  lu"               

```

###  Analytics & Tracking

```javascript
// Google Analytics Events
import { logEvent } from 'firebase/analytics';

// Track exam completion
logEvent(analytics, 'exam_complete', {
  exam_type: 'listening',
  part: 'part1',
  score: 85,
  time_spent: 720, // seconds
  user_id: userId
});

// Custom tracking events:
 Thi gian lm bi (time_tracking)
 T l hon thnh (completion_rate)
 im trung bnh (average_score)
 User engagement (session_duration)
 Popular sections (feature_usage)
 Error rates (error_tracking)
```

**Dashboard Analytics:**

```
 Real-time Metrics:
 Active users: 247
 Today's tests: 1,234
 Avg. score: 78.5%
 Completion rate: 92%
 Server uptime: 99.9%

 User Behavior:
 Most popular: Part 7
 Avg. session: 45 min
 Return rate: 68%
 Peak hours: 7PM-10PM
```

---

##  Testing

###  Chy Tests

```bash
# Unit tests
npm run test

# E2E tests with Playwright
npm run test:e2e

# Coverage report
npm run test:coverage

# Watch mode (development)
npm run test:watch

# UI mode (interactive)
npm run test:ui
```

###  Test Structure

```
tests/
 unit/
    components/
       QuestionDisplay.test.jsx
       AudioControls.test.jsx
       ResultsDisplay.test.jsx
       VocabularyPractice.test.jsx
    hooks/
       useAppState.test.js
       useAudio.test.js
       useVoices.test.js
       useAutoSave.test.js
    utils/
        scoringEngine.test.js
        validators.test.js
        formatters.test.js
 integration/
    auth-flow.test.jsx
    exam-flow.test.jsx
    progress-sync.test.jsx
    full-exam-mode.test.jsx
 e2e/
     complete-exam.spec.js
     user-journey.spec.js
     mobile-responsive.spec.js
     performance.spec.js
```

###  Test Coverage Goals

```
Component Tests:    > 80%  
Hook Tests:         > 90%  
Utility Tests:      > 95%  
Integration Tests:  > 70%  
E2E Tests:          Critical paths only
```

**Example Test:**

```javascript
import { render, screen, fireEvent } from '@testing-library/react';
import QuestionDisplay from './QuestionDisplay';

describe('QuestionDisplay Component', () => {
  test('renders question and options correctly', () => {
    const mockQuestion = {
      id: 1,
      text: 'What is the capital of France?',
      options: ['London', 'Paris', 'Berlin', 'Madrid']
    };

    render(<QuestionDisplay question={mockQuestion} />);
    
    expect(screen.getByText(/capital of France/i)).toBeInTheDocument();
    expect(screen.getByText('Paris')).toBeInTheDocument();
  });

  test('calls onAnswer when option selected', () => {
    const handleAnswer = jest.fn();
    render(<QuestionDisplay onAnswer={handleAnswer} />);
    
    fireEvent.click(screen.getByText('Paris'));
    expect(handleAnswer).toHaveBeenCalledWith('Paris');
  });
});
```

---

##  Troubleshooting

###  Cc vn  thng gp

#### 1.  Audio khng pht c

```bash
 Nguyn nhn:
- Browser chn autoplay
- Thiu quyn microphone
- File audio khng tn ti
- Web Speech API khng c h tr

 Gii php:
1. Click vo trang trc khi pht (Chrome requirement)
2. Cho php audio trong browser settings
3. Kim tra ng dn audio file
4. Clear cache v reload (Ctrl + Shift + R)
5. Th browser khc (Chrome/Edge recommended)
6. Kim tra console logs: F12 > Console
```

#### 2.  Firebase Authentication Failed

```bash
 Nguyn nhn:
- API key khng hp l
- Domain cha c whitelist
- Firebase project b disabled
- Quota exceeded

 Gii php:
1. Kim tra .env.local c ng khng
2. Thm domain vo Firebase Console:
   Authentication > Settings > Authorized domains
3. Enable Authentication providers:
   Authentication > Sign-in method
4. Kim tra Firebase quota & billing
5. Verify Firebase project is active
```

#### 3.  Clerk Authentication Issues

```bash
 Nguyn nhn:
- Publishable key sai
- Domain khng match
- Session expired
- CORS issues

 Gii php:
1. Verify VITE_CLERK_PUBLISHABLE_KEY in .env.local
2. Check allowed domains in Clerk Dashboard:
   Settings > Domains
3. Clear cookies v login li
4. Update Clerk SDK: npm update @clerk/clerk-react
5. Check Clerk status: status.clerk.com
```

#### 4.  Build Errors

```bash
 Nguyn nhn:
- Dependencies version conflicts
- Missing environment variables
- Syntax errors in code
- Node version mismatch

 Gii php:
1. Clean install:
   rm -rf node_modules package-lock.json
   npm install

2. Check Node version:
   node -v  # Should be >= 16.x
   nvm use 18  # If using nvm

3. Verify .env.local exists and complete

4. Run linting:
   npm run lint
   npm run lint:fix

5. Check build logs for specific errors
```

#### 5.  Slow Performance

```bash
 Nguyn nhn:
- Large bundle size
- Unoptimized images
- Too many re-renders
- Memory leaks
- Network issues

 Gii php:
1. Analyze bundle:
   npm run build -- --stats
   
2. Optimize images:
   - Convert to WebP format
   - Compress vi TinyPNG
   - Lazy load images

3. Use React.memo() cho heavy components:
   const MemoComponent = memo(Component);

4. Check re-renders vi React DevTools:
   - Highlight updates
   - Profile component renders

5. Enable code splitting:
   const Component = lazy(() => import('./Component'));

6. Clear browser cache & cookies
```

#### 6.  Mobile Display Issues

```bash
 Nguyn nhn:
- Viewport khng responsive
- Fixed positioning problems
- Font size qu nh
- Touch targets too small
- CSS overflow issues

 Gii php:
1. Check viewport meta tag:
   <meta name="viewport" content="width=device-width, initial-scale=1">

2. Test trn DevTools mobile mode:
   F12 > Toggle device toolbar (Ctrl+Shift+M)

3. Use Tailwind responsive classes:
   className="text-sm sm:text-base md:text-lg"

4. Test on real devices:
   - Android: Chrome DevTools remote debugging
   - iOS: Safari Web Inspector

5. Check CSS:
   - Avoid fixed widths
   - Use flexbox/grid
   - Test landscape orientation
```

#### 7.  Data Not Saving

```bash
 Nguyn nhn:
- Firestore rules blocking writes
- Network connectivity issues
- User not authenticated
- Quota exceeded

 Gii php:
1. Check Firestore rules in Firebase Console

2. Verify user is logged in:
   console.log(user);

3. Check browser console for errors

4. Test with Firebase Emulator:
   npm run firebase:emulators

5. Verify Firestore quota not exceeded
```

###  Bo li

Nu gp vn  khng c lit k:

```bash
1.  Check console logs (F12 > Console)
2.  Search existing issues on GitHub
3.  Try incognito/private mode
4.  Test on different browser
5.  Create new issue vi template di y
```

**Template bo li:**

```markdown
###  Bug Report

**M t ngn gn:**
[M t vn  bng 1-2 cu]

**Steps to reproduce:**
1. Go to '...'
2. Click on '...'
3. See error

**Expected behavior:**
[iu bn mong i xy ra]

**Actual behavior:**
[iu thc s xy ra]

**Screenshots:**
[nh km nh chp mn hnh nu c]

**Console Logs:**
```
[Paste error logs from console]
```

**Environment:**
- OS: [e.g. Windows 11 / macOS 14.0 / Ubuntu 22.04]
- Browser: [e.g. Chrome 120.0 / Firefox 119.0 / Safari 17.0]
- Device: [e.g. Desktop / iPhone 14 / Samsung Galaxy S23]
- App Version: [e.g. 1.0.0]
- Node Version: [e.g. 18.17.0]

**Additional context:**
[Thng tin b sung,  th g cha hiu qu]

**Checklist:**
- [ ]  check console logs
- [ ]  clear cache & cookies
- [ ]  th trn browser khc
- [ ]  search existing issues
```

---

##  Changelog

###  Version 1.0.0 (Current - December 2024)

```
 Initial Release

 New Features:

 Complete TOEIC Listening (Part 1-4)
   - 60 questions vi audio files
   - Text-to-speech vi ging nam/n
   - Adjustable playback speed (0.5x-2.0x)
   
 Complete TOEIC Reading (Part 5-7)
   - 100 questions y 
   - Split-screen layout cho Part 6,7
   - Highlight text support
   
 Full Mock Exam Mode
   - 160 questions (60 Listening + 100 Reading)
   - Real-time timer
   - Auto-submit khi ht gi
   
 Grammar Review System
   - 50+ grammar rules
   - Interactive exercises
   - Detailed explanations
   
 Vocabulary Practice
   - 1000+ t vng theo ch 
   - Flashcard system
   - Spaced repetition algorithm
   
 User Authentication
   - Clerk integration
   - Google OAuth
   - Email/Password login
   
 Progress Tracking
   - Firebase Firestore sync
   - Auto-save every 2 seconds
   - Detailed statistics
   
 Results Analytics
   - Score breakdown by part
   - Time spent analysis
   - Mistake patterns
   - Performance trends

 UI/UX Improvements:

 Modern gradient theme (Orange-Yellow)
 Smooth animations & transitions
 Loading states & skeleton screens
 Error boundaries & fallbacks
 Responsive design (Mobile/Tablet/Desktop)
 Accessibility improvements (WCAG 2.1)

 Technical Enhancements:

 React 18 with Concurrent Features
 Vite for lightning-fast builds
 Firebase v10 integration
 React Router v6 with lazy loading
 Tailwind CSS v3 utility classes
 Code splitting & optimization
 Service Worker for offline support

 Performance Metrics:

 Lighthouse Score: 95+
 First Contentful Paint: < 1.5s
 Time to Interactive: < 3s
 Bundle size: < 500KB (gzipped)
 99.9% uptime on Vercel
```

###  Version 1.1.0 (Planned - Q1 2025)

```
 Upcoming Features:

 Dark Mode support
   - Toggle switch in settings
   - Persistent preference
   - Eye-friendly colors

 Leaderboard System
   - Global rankings
   - Weekly/Monthly boards
   - Friend comparisons
   
 Social Features
   - Share scores on social media
   - Challenge friends
   - Study groups
   
 More Exam Sets
   - 10+ additional test sets
   - Various difficulty levels
   - Topic-specific tests
   
 PDF Export Results
   - Detailed score reports
   - Progress charts
   - Study recommendations
   
 Email Notifications
   - Daily reminders
   - Achievement alerts
   - Study streak tracking
   
 Advanced Filtering
   - Filter by difficulty
   - Filter by topic
   - Custom test creation
```

###  Version 1.2.0 (Planned - Q2 2025)

```
 Advanced Features:

 AI-Powered Feedback
   - Personalized study tips
   - Weakness analysis
   - Smart recommendations
   
 Personalized Study Plans
   - Adaptive learning paths
   - Goal-based schedules
   - Progress milestones
   
 Speaking Practice (Experimental)
   - Voice recognition
   - Pronunciation feedback
   - Conversation simulation
   
 Writing Practice
   - Essay prompts
   - Auto-grading (basic)
   - Sample answers
   
 Mobile App
   - React Native version
   - Offline mode
   - Push notifications
   
 Offline Mode Improvements
   - Download test sets
   - Sync when online
   - Better IndexedDB usage
```

###  Version 2.0.0 (Vision - Q3 2025)

```
 Premium & Enterprise:

 Premium Subscription
   - Unlimited test sets
   - Ad-free experience
   - Priority support
   - Advanced analytics
   
 Live Classes Integration
   - Video lessons
   - Live Q&A sessions
   - Expert tutors
   
 Tutor Matching
   - Find qualified tutors
   - Book 1-on-1 sessions
   - In-app video calls
   
 Advanced Analytics Dashboard
   - Detailed insights
   - Comparison with peers
   - Predictive scoring
   
 Custom Exam Creator
   - Build your own tests
   - Share with community
   - Monetization options
   
 API for Integration
   - Public API
   - Webhooks
   - Third-party integrations
   - LMS compatibility
```

---

##  ng gp

###  Cch ng gp

Chng ti rt hoan nghnh mi ng gp! Di y l cc cch bn c th tham gia:

#### 1 Bo li (Bug Reports)

```bash
# To issue mi ti:
https://github.com/khoale-dev-code/huflit-test/issues/new

# Chn template "Bug Report"
# in y  thng tin theo form
```

#### 2  xut tnh nng (Feature Requests)

```bash
# To issue vi label "enhancement"
# M t chi tit:
- Use case c th
- Li ch mang li
-  xut implementation (nu c)
```

#### 3 Pull Requests

```bash
# 1. Fork repository
git clone https://github.com/YOUR_USERNAME/huflit-test.git
cd huflit-test

# 2. To branch mi
git checkout -b feature/amazing-feature
# hoc
git checkout -b fix/bug-description

# 3. Make changes & commit
git add .
git commit -m "feat: add amazing feature"
# hoc
git commit -m "fix: resolve audio playback issue"

# 4. Push to branch
git push origin feature/amazing-feature

# 5. To Pull Request trn GitHub
# in description y , link issue lin quan
```

###  Contribution Guidelines

####  DO:

```markdown
 Follow existing code style
   - Use Prettier & ESLint configs
   - Match indentation (2 spaces)
   - Consistent naming conventions

 Write clear commit messages
   - feat: new feature
   - fix: bug fix
   - docs: documentation
   - style: formatting
   - refactor: code restructure
   - test: adding tests
   - chore: maintenance

 Add comments for complex logic
   - Explain "why", not just "what"
   - Use JSDoc for functions
   - Keep comments up-to-date

 Update documentation
   - README if needed
   - Inline code comments
   - API documentation

 Test your changes
   - Write unit tests
   - Test manually
   - Check on mobile

 Keep PRs focused and small
   - One feature/fix per PR
   - Max 400 lines changed
   - Easy to review
```

####  DON'T:

```markdown
 Break existing functionality
   - Run tests before pushing
   - Check backward compatibility

 Commit directly to main
   - Always use feature branches
   - Never force push to main

 Include unrelated changes
   - Keep commits focused
   - No "drive-by" fixes

 Ignore linting errors
   - Fix all ESLint warnings
   - Use `npm run lint:fix`

 Skip testing
   - Test edge cases
   - Verify on different browsers

 Use placeholder text
   - Complete all TODOs
   - Remove debug code
   - No console.logs
```

###  Code Style Guide

#### JavaScript/React:

```javascript
//  GOOD: Descriptive names, clean code
const calculateTotalScore = (answers, correctAnswers) => {
  return answers.reduce((score, answer, index) => {
    return answer === correctAnswers[index] 
      ? score + 1 
      : score;
  }, 0);
};

// Component with proper memo usage
const QuestionCard = memo(({ question, onAnswer }) => {
  return (
    <div className="p-4 bg-white rounded-lg shadow">
      <h3 className="text-lg font-bold">{question.text}</h3>
      <button onClick={() => onAnswer(question.id)}>
        Submit
      </button>
    </div>
  );
});

//  BAD: Unclear, no comments, poor naming
const calc = (a, b) => {
  let x = 0;
  for (let i = 0; i < a.length; i++) {
    if (a[i] === b[i]) x++;
  }
  return x;
};

// Component without memo (unnecessary re-renders)
const QuestionCard = ({ q, fn }) => {
  return <div>{q.t}</div>;
};
```

#### CSS/Tailwind:

```javascript
//  GOOD: Organized, responsive
<div className="
  flex flex-col gap-4
  p-4 sm:p-6 md:p-8
  bg-white rounded-lg shadow-md
  hover:shadow-lg transition-shadow
">

//  BAD: Messy, hard to read
<div className="flex p-4 bg-white gap-4 flex-col rounded-lg shadow-md sm:p-6 hover:shadow-lg md:p-8 transition-shadow">
```

###  Contributors

<div align="center">

**Cm n nhng ngi  ng gp cho d n ny! **

| Avatar | Name | Role | Contribution |
|--------|------|------|--------------|
|  | **Khoa Le** | Creator & Maintainer | Core development, Architecture |
|  | **Contributors** | Designers | UI/UX improvements |
|  | **Beta Testers** | QA Team | Bug reports & testing |
|  | **Community** | Documentation | Translations, guides |

<a href="https://github.com/khoale-dev-code/huflit-test/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=khoale-dev-code/huflit-test" />
</a>

**[Xem tt c contributors ](https://github.com/khoale-dev-code/huflit-test/graphs/contributors)**

</div>

###  Recognition

Chng ti ghi nhn nhng ng gp xut sc vi:

```
 Top Contributor Badge
 Special Mention in Release Notes
 Access to Beta Features
 Certificate of Appreciation
 Exclusive Swag (for major contributions)
```

---

##  Lin h & H tr

###  Knh h tr

<div align="center">

|  Website | [huflit-test.vercel.app](https://huflit-test.vercel.app) |
|------------|-----------------------------------------------------------|
|  Email | khoale.dev.code@gmail.com |
|  LinkedIn | [linkedin.com/in/khoale-dev](https://linkedin.com/in/khoale-dev) |
|  GitHub | [github.com/khoale-dev-code](https://github.com/khoale-dev-code) |
|  Discord | [Join Server](https://discord.gg/huflit-test) |
|  Telegram | [@huflit_test_group](https://t.me/huflit_test_group) |
|  Twitter | [@huflit_test](https://twitter.com/huflit_test) |

</div>

###  Tr gip nhanh

```markdown
 c ti liu y :
    https://github.com/khoale-dev-code/huflit-test/wiki

 Tm kim trong Issues:
    https://github.com/khoale-dev-code/huflit-test/issues

 Tho lun cng ng:
    https://github.com/khoale-dev-code/huflit-test/discussions

 Cu hi thng gp (FAQ):
    https://github.com/khoale-dev-code/huflit-test/wiki/FAQ

 Video hng dn:
    https://youtube.com/@huflit-test

 Blog & Tutorials:
    https://blog.huflit-test.com
```

###  Response Time

<div align="center">

| Priority | Response Time | Resolution Time |
|----------|---------------|-----------------|
|  Critical bugs | < 24 hours | < 3 days |
|  Feature requests | < 1 week | Best effort |
|  General questions | < 3 days | N/A |
|  Enhancements | Best effort | Scheduled |

</div>

###  Support Checklist

Trc khi lin h h tr, hy m bo bn :

```
 Check FAQ & Documentation
 Search existing issues
 Try troubleshooting steps
 Clear cache & cookies
 Test on different browser
 Gather error logs/screenshots
 Note steps to reproduce
 Check system requirements
```

---

##  License

```
MIT License

Copyright (c) 2024 Khoa Le

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

###  License Explanation

```
 You CAN:
   - Use for personal projects
   - Use for commercial projects
   - Modify the source code
   - Distribute copies
   - Sublicense
   - Use privately

 You CANNOT:
   - Hold author liable
   - Use author's name for promotion
   - Remove copyright notices

 You MUST:
   - Include original license
   - Include copyright notice
   - State changes made
```

---

##  Acknowledgments

###  Cm n c bit

<div align="center">

####  **HUFLIT University (Trng i hc Ngoi ng - Tin hc TP.HCM)**

*Cm hng ban u v mi trng hc tp tuyt vi  to nn d n ny*

####  **Beta Testers & Early Users**

*Nhng ngi dng u tin  tin tng, th nghim v ng gp feedback qu bu*

####  **Open Source Community**

*Cng ng m ngun m  cung cp nhng cng c tuyt vi*

</div>

---

###  Built With Love Using

<div align="center">

####  **Frontend Technologies**

![React](https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB)
![Vite](https://img.shields.io/badge/Vite-646CFF?style=for-the-badge&logo=vite&logoColor=white)
![Tailwind CSS](https://img.shields.io/badge/Tailwind_CSS-38B2AC?style=for-the-badge&logo=tailwind-css&logoColor=white)
![React Router](https://img.shields.io/badge/React_Router-CA4245?style=for-the-badge&logo=react-router&logoColor=white)
![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black)

####  **Backend & Services**

![Firebase](https://img.shields.io/badge/Firebase-FFCA28?style=for-the-badge&logo=firebase&logoColor=black)
![Clerk](https://img.shields.io/badge/Clerk-6C47FF?style=for-the-badge&logo=clerk&logoColor=white)
![Vercel](https://img.shields.io/badge/Vercel-000000?style=for-the-badge&logo=vercel&logoColor=white)

####  **Development Tools**

![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=git&logoColor=white)
![GitHub](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white)
![VS Code](https://img.shields.io/badge/VS_Code-007ACC?style=for-the-badge&logo=visual-studio-code&logoColor=white)
![npm](https://img.shields.io/badge/npm-CB3837?style=for-the-badge&logo=npm&logoColor=white)
![ESLint](https://img.shields.io/badge/ESLint-4B32C3?style=for-the-badge&logo=eslint&logoColor=white)
![Prettier](https://img.shields.io/badge/Prettier-F7B93E?style=for-the-badge&logo=prettier&logoColor=black)

</div>

---

###  **Libraries & Frameworks**

```
 Core Dependencies:

 react@18.2.0              - UI Library
 react-dom@18.2.0          - DOM Rendering
 react-router-dom@6.20.0   - Routing
 vite@5.0.0                - Build Tool
 tailwindcss@3.4.0         - CSS Framework

 Firebase Ecosystem:

 firebase@10.7.0           - Backend SDK
 firestore                 - Database
 firebase-auth             - Authentication
 firebase-analytics        - Analytics

 Authentication:

 @clerk/clerk-react@4.29.0 - Auth Platform

 UI Components:

 lucide-react@0.302.0      - Icons
 react-hook-form@7.48.0    - Forms
 @hookform/resolvers@3.3.0 - Form Validation

 State Management:

 zustand@4.4.0             - State Library
 Context API               - React Context

 Testing:

 vitest                    - Test Runner
 @testing-library/react    - Component Testing
 playwright                - E2E Testing
```

---

###  **Special Thanks To**

####  **Audio Resources**

```
 Text-to-Speech:
    Web Speech API
      Browser-native TTS engine
        Cung cp ging c t nhin min ph
   
    Google Text-to-Speech
      High-quality voices
        Ging ni cht lng cao, t nhin
   
    ResponsiveVoice API (Deprecated)
       Legacy support cho browsers c

 Audio Processing:
    Web Audio API
      Real-time audio manipulation
        X l m thanh realtime
   
    Howler.js (Considered)
       Cross-browser audio library
```

####  **Design Inspiration**

```
 UI/UX References:
    Material Design (Google)
      Design principles & guidelines
        Nguyn tc thit k hin i
   
    Tailwind UI
      Component examples
        Th vin component p
   
    DaisyUI
      Tailwind component library
        Components Tailwind c sn
   
    Shadcn/ui
      Beautifully designed components
        Components p, accessible
   
    Dribbble & Behance
       Creative inspiration
         Cm hng thit k sng to
```

####  **Educational Content**

```
 TOEIC Content Sources:
    Educational Testing Service (ETS)
      Official TOEIC test format
        nh dng thi chnh thc
   
    Cambridge English
      Language testing standards
        Tiu chun kim tra ngn ng
   
    British Council
      English learning resources
        Ti nguyn hc ting Anh
   
    Public Domain Resources
       Free educational materials
         Ti liu gio dc min ph
```

####  **Development Tools**

```
 Essential Tools:
    Visual Studio Code
      By Microsoft
        Editor mnh m, extensions phong ph
   
    Chrome DevTools
      By Google
        Debug & performance profiling
   
    Firefox Developer Tools
      By Mozilla
        Accessibility testing
   
    React Developer Tools
      By Meta
        Component inspection
   
    Redux DevTools
      By Redux Team
        State management debugging
   
    Postman
       By Postman Inc.
         API testing & documentation
```

####  **Learning Resources**

```
 Documentation & Tutorials:
    React Documentation
      https://react.dev
        Official React docs (excellent!)
   
    MDN Web Docs
      https://developer.mozilla.org
        Web standards reference
   
    Firebase Documentation
      https://firebase.google.com/docs
        Comprehensive guides
   
    Tailwind CSS Documentation
      https://tailwindcss.com/docs
        Utility-first CSS guide
   
    Stack Overflow
      Community Q&A
        Gii p thc mc lp trnh
   
    Dev.to & Medium
       Developer blogs
         Bi vit k thut cht lng
```

---

###  **Community & Contributors**

```
 Amazing People Who Helped:

 Core Team:
    Khoa Le (@khoale-dev-code)
      Project Creator & Lead Developer
   
    [Your Name]
      Contributor
   
    [Your Name]
       Contributor

 Bug Hunters:
    All users who reported issues
    Beta testers who found edge cases
    QA volunteers

 Feature Suggesters:
    Community members with great ideas
    Students who shared feedback
    Teachers who provided insights

 Documentation Writers:
    Translation contributors
    Tutorial creators
    Wiki maintainers

 Designers:
    UI/UX feedback providers
    Icon & asset contributors
    Theme designers
```

---

###  **Awards & Recognition**

```
 Achievements:
     100+ GitHub Stars
     50+ Forks
     1,000+ Active Users
     50,000+ Monthly Pageviews
     4.8/5 User Rating

 Featured On:
    Hacker News Front Page
    Reddit r/webdev
    Dev.to Featured Post
    GitHub Trending (React)
    Vietnamese Tech Community
```

---

###  **Personal Thanks**

```
 Heartfelt Gratitude To:

 Family & Friends:
    For endless support and patience during late-night coding sessions

 Teachers & Mentors:
    For inspiring the love of learning and teaching

 HUFLIT Community:
    For being the reason this project exists

 Open Source Community:
    For proving that collaboration beats competition

 Every Single User:
    Your usage and feedback make this project meaningful

"Alone we can do so little; together we can do so much."
                                        - Helen Keller
```

---

##  Project Statistics

<div align="center">

###  **GitHub Stats**

![GitHub stars](https://img.shields.io/github/stars/khoale-dev-code/huflit-test?style=social)
![GitHub forks](https://img.shields.io/github/forks/khoale-dev-code/huflit-test?style=social)
![GitHub watchers](https://img.shields.io/github/watchers/khoale-dev-code/huflit-test?style=social)
![GitHub followers](https://img.shields.io/github/followers/khoale-dev-code?style=social)

###  **Repository Info**

![GitHub repo size](https://img.shields.io/github/repo-size/khoale-dev-code/huflit-test)
![GitHub language count](https://img.shields.io/github/languages/count/khoale-dev-code/huflit-test)
![GitHub top language](https://img.shields.io/github/languages/top/khoale-dev-code/huflit-test)
![Lines of code](https://img.shields.io/tokei/lines/github/khoale-dev-code/huflit-test)

###  **Activity**

![GitHub last commit](https://img.shields.io/github/last-commit/khoale-dev-code/huflit-test)
![GitHub commit activity](https://img.shields.io/github/commit-activity/m/khoale-dev-code/huflit-test)
![GitHub contributors](https://img.shields.io/github/contributors/khoale-dev-code/huflit-test)

###  **Issues & PRs**

![GitHub issues](https://img.shields.io/github/issues/khoale-dev-code/huflit-test)
![GitHub closed issues](https://img.shields.io/github/issues-closed/khoale-dev-code/huflit-test)
![GitHub pull requests](https://img.shields.io/github/issues-pr/khoale-dev-code/huflit-test)
![GitHub closed pull requests](https://img.shields.io/github/issues-pr-closed/khoale-dev-code/huflit-test)

###  **Performance**

![Website](https://img.shields.io/website?url=https%3A%2F%2Fhuflit-test.vercel.app)
![Uptime Robot status](https://img.shields.io/uptimerobot/status/m793740595-2f98c1d6f29e7d4f62b3e1e6)
![Lighthouse Score](https://img.shields.io/badge/Lighthouse-95%2B-success)

</div>

---

##  Project Goals & Mission

###  **Educational Mission**

```
 Our Core Mission:


 Democratize TOEIC Preparation
    Make quality test prep accessible to everyone
      Regardless of economic background

 Provide Free Quality Resources
    No paywalls for essential features
      Premium content should remain affordable

 Support Vietnamese Students
    Localized content & interface
      Understand local learning needs

 Build Learning Community
    Foster collaboration over competition
      Students helping students succeed
```

###  **Technical Excellence**

```
 Technical Goals:


 Modern Web Technologies
    Stay current with latest standards
    Adopt best practices early
    Performance-first approach

 Best Practices & Patterns
    Clean, maintainable code
    Comprehensive documentation
    Test-driven development

 Performance Optimization
    Sub-second load times
    Smooth 60fps animations
    Efficient bundle sizes

 Scalable Architecture
    Modular component design
    Flexible data structures
    Easy to extend & customize
```

###  **Community Growth**

```
 Community Goals:


 Open Source Contributions
    Welcome first-time contributors
    Mentorship for new developers
    Collaborative decision-making

 Knowledge Sharing
    Write tutorials & guides
    Share lessons learned
    Document best practices

 Collaborative Development
    Code reviews & feedback
    Pair programming sessions
    Open discussions on features

 Continuous Improvement
    Regular updates & fixes
    User feedback integration
    Performance monitoring
```

---

##  Quick Links & Resources

<div align="center">

###  **Essential Links**

| Resource | URL | Description |
|----------|-----|-------------|
|  **Homepage** | [huflit-test.vercel.app](https://huflit-test.vercel.app) | Live application |
|  **Documentation** | [Wiki](https://github.com/khoale-dev-code/huflit-test/wiki) | Full documentation |
|  **Report Bug** | [Issues](https://github.com/khoale-dev-code/huflit-test/issues) | Bug tracker |
|  **Request Feature** | [Discussions](https://github.com/khoale-dev-code/huflit-test/discussions) | Feature requests |
|  **Star Project** | [GitHub](https://github.com/khoale-dev-code/huflit-test) | Show support |
|  **Fork Project** | [Fork](https://github.com/khoale-dev-code/huflit-test/fork) | Create your copy |
|  **Project Board** | [Projects](https://github.com/khoale-dev-code/huflit-test/projects) | Development roadmap |
|  **Analytics** | [Insights](https://github.com/khoale-dev-code/huflit-test/pulse) | Project activity |

</div>

---

##  Related Projects

```
 Check Out These Similar Projects:

 TOEIC Practice Apps:
 TOEIC Test Pro
   Mobile-first TOEIC practice

 English Central
   Video-based English learning

 Duolingo English Test
    Adaptive testing platform

 Educational Platforms:
 Khan Academy
   Free education for all

 Coursera
   Online learning platform

 edX
    University-level courses

 Open Source Learning:
 FreeCodeCamp
   Learn to code for free

 The Odin Project
   Full-stack curriculum

 Exercism
    Code practice & mentorship
```

---

##  Support the Project

<div align="center">

###  **Show Your Support**

If you find this project helpful, please consider:

[![Star on GitHub](https://img.shields.io/badge/_Star_on_GitHub-yellow?style=for-the-badge&logo=github)](https://github.com/khoale-dev-code/huflit-test)
[![Share on Twitter](https://img.shields.io/badge/Share_on_Twitter-1DA1F2?style=for-the-badge&logo=twitter&logoColor=white)](https://twitter.com/intent/tweet?text=Check%20out%20HUFLIT%20Test%20Practice%20-%20Free%20TOEIC%20prep%20platform!&url=https://github.com/khoale-dev-code/huflit-test)
[![Share on Facebook](https://img.shields.io/badge/Share_on_Facebook-1877F2?style=for-the-badge&logo=facebook&logoColor=white)](https://www.facebook.com/sharer/sharer.php?u=https://github.com/khoale-dev-code/huflit-test)
[![Share on LinkedIn](https://img.shields.io/badge/Share_on_LinkedIn-0077B5?style=for-the-badge&logo=linkedin&logoColor=white)](https://www.linkedin.com/sharing/share-offsite/?url=https://github.com/khoale-dev-code/huflit-test)

###  **Ways to Support**

```
 Star the repository
 Fork and contribute
 Report bugs & issues
 Suggest new features
 Improve documentation
 Translate to other languages
 Spread the word
 Sponsor the project (coming soon)
```

</div>

---

##  Stay Connected

<div align="center">

###  **Get Updates**

[![Watch on GitHub](https://img.shields.io/badge/Watch-Releases-green?style=for-the-badge&logo=github)](https://github.com/khoale-dev-code/huflit-test/subscription)
[![Follow on Twitter](https://img.shields.io/badge/Follow-Twitter-1DA1F2?style=for-the-badge&logo=twitter&logoColor=white)](https://twitter.com/huflit_test)
[![Join Discord](https://img.shields.io/badge/Join-Discord-7289DA?style=for-the-badge&logo=discord&logoColor=white)](https://discord.gg/huflit-test)
[![Subscribe Newsletter](https://img.shields.io/badge/Subscribe-Newsletter-FF6B6B?style=for-the-badge&logo=gmail&logoColor=white)](https://huflit-test.vercel.app/newsletter)

###  **Project Status**

[![Maintenance](https://img.shields.io/badge/Maintained%3F-yes-green.svg?style=for-the-badge)](https://github.com/khoale-dev-code/huflit-test/graphs/commit-activity)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=for-the-badge)](http://makeapullrequest.com)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg?style=for-the-badge)](https://opensource.org/licenses/MIT)

</div>

---

##  For Students

```
 Tips for TOEIC Success:

 Study Smart:
 Practice consistently (30min/day better than 3hrs once/week)
 Focus on weak areas
 Review mistakes regularly
 Use spaced repetition

 Test Strategy:
 Time management is crucial
 Don't spend too long on one question
 Eliminate obviously wrong answers first
 Trust your first instinct

 Listening Tips:
 Listen to English daily (podcasts, news, TV shows)
 Practice with different accents
 Focus on understanding context
 Don't translate in your head

 Reading Tips:
 Read English content daily (articles, books)
 Build vocabulary systematically
 Learn common grammar patterns
 Practice skimming & scanning

 Target Score:
 Set realistic goals
 Track your progress
 Celebrate small wins
 Stay motivated!
```

---

##  For Developers

```
 Development Tips:

 Code Review Checklist:
 [ ] Code follows style guide
 [ ] All tests passing
 [ ] No console.logs left
 [ ] Documentation updated
 [ ] Performance optimized
 [ ] Accessibility checked

 Performance Best Practices:
 Use React.memo for expensive components
 Implement code splitting with lazy loading
 Optimize images (WebP, lazy load)
 Minimize bundle size
 Use production builds
 Monitor with Lighthouse

 Security Checklist:
 Never commit .env files
 Use environment variables
 Validate all user inputs
 Sanitize data before display
 Keep dependencies updated
 Use HTTPS in production

 Testing Strategy:
 Write tests for critical paths
 Test edge cases
 Use snapshot testing wisely
 Mock external dependencies
 Aim for >80% coverage
```

---

<div align="center">

##  Thank You!

### **Made with  by [Khoa Le](https://github.com/khoale-dev-code)**

---

*"Education is the most powerful weapon which you can use to change the world."*  
** Nelson Mandela**

---

*"The beautiful thing about learning is that nobody can take it away from you."*  
** B.B. King**

---

###  **Star History**

[![Star History Chart](https://api.star-history.com/svg?repos=khoale-dev-code/huflit-test&type=Date)](https://star-history.com/#khoale-dev-code/huflit-test&Date)

---

###  **Last Updated:** December 2024

**Version:** 1.0.0  
**Status:**  Active Development  
**License:** MIT  

---

 2025 HUFLIT Test Practice. All rights reserved.

**Built with passion  for education **

[ Back to Top](#-huflit-test-practice)

</div>
</file>

<file path="src/admin/AdminApp.jsx">
// src/admin/AdminApp.jsx
import React from 'react';
import { Routes, Route, Navigate } from 'react-router-dom';
import { useAdminAuth } from './hooks/useAdminAuth';
import AdminLogin from './pages/AdminLogin';
import AdminDashboard from './pages/AdminDashboard';
import { LoadingSpinner } from '../components/common/LoadingSpinner';

const ProtectedRoute = ({ children }) => {
  const { isAdmin, loading } = useAdminAuth();

  if (loading) {
    return <LoadingSpinner />;
  }

  return isAdmin ? children : <Navigate to="/admin/login" replace />;
};

const AdminApp = () => {
  return (
    <Routes>
      <Route path="/login" element={<AdminLogin />} />
      
      {/*  ROUTE TM - XA SAU KHI TO ADMIN
      <Route path="/setup" element={<AdminSetup />} /> */}
      
      <Route 
        path="/dashboard" 
        element={
          <ProtectedRoute>
            <AdminDashboard />
          </ProtectedRoute>
        } 
      />
      
      <Route path="/" element={<Navigate to="/admin/dashboard" replace />} />
    </Routes>
  );
};

export default AdminApp;
</file>

<file path="src/admin/components/AdminSetup.jsx">
// // src/admin/components/AdminSetup.jsx
// import React, { useState } from 'react';
// import { Shield, CheckCircle, XCircle, AlertTriangle } from 'lucide-react';
// import createFirstAdmin from '../../../scripts/createFirstAdmin';

// const AdminSetup = () => {
//   const [status, setStatus] = useState(null);
//   const [loading, setLoading] = useState(false);

//   const handleCreateAdmin = async () => {
//     if (!window.confirm(' Bn c chc chn mun to admin vi UID: nxd50HYmtQXkaezI4c8b1bkhDug2?')) {
//       return;
//     }

//     setLoading(true);
//     setStatus(null);
    
//     const result = await createFirstAdmin();
    
//     setStatus(result);
//     setLoading(false);

//     if (result.success) {
//       setTimeout(() => {
//         alert(' Admin  c to thnh cng!\n\nBy gi bn c th:\n1. Xa route /admin/setup\n2. ng nhp ti /admin/login');
//       }, 500);
//     }
//   };

//   return (
//     <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4">
//       <div className="max-w-lg w-full bg-white rounded-2xl shadow-2xl p-8">
//         {/* Header */}
//         <div className="text-center mb-8">
//           <div className="inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mb-4">
//             <Shield className="w-10 h-10 text-blue-600" />
//           </div>
//           <h1 className="text-3xl font-bold text-gray-900 mb-2">
//             Khi to Admin
//           </h1>
//           <p className="text-gray-600">
//             To Super Admin u tin cho h thng
//           </p>
//         </div>

//         {/* Warning */}
//         <div className="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
//           <div className="flex items-start gap-3">
//             <AlertTriangle className="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" />
//             <div className="flex-1">
//               <p className="text-sm font-medium text-amber-900 mb-1">
//                 Lu  quan trng
//               </p>
//               <ul className="text-xs text-amber-800 space-y-1">
//                 <li> Ch chy script ny <strong>mt ln duy nht</strong></li>
//                 <li> m bo UID  c to trong Firebase Authentication</li>
//                 <li> Admin s c to trong collection <code>admin_accounts</code></li>
//                 <li> Sau khi to, xa route ny khi code</li>
//               </ul>
//             </div>
//           </div>
//         </div>

//         {/* Admin Info */}
//         <div className="space-y-4 mb-6">
//           <div className="bg-gray-50 rounded-lg p-4">
//             <p className="text-sm font-medium text-gray-700 mb-2">Admin UID:</p>
//             <code className="block text-xs bg-white p-3 rounded border border-gray-200 overflow-x-auto font-mono">
//               nxd50HYmtQXkaezI4c8b1bkhDug2
//             </code>
//           </div>

//           <div className="bg-gray-50 rounded-lg p-4">
//             <p className="text-sm font-medium text-gray-700 mb-2">Email:</p>
//             <code className="block text-xs bg-white p-3 rounded border border-gray-200 overflow-x-auto">
//               admin@example.com
//             </code>
//             <p className="text-xs text-amber-600 mt-2">
//                Nh thay email ny trong file script!
//             </p>
//           </div>

//           <div className="bg-gray-50 rounded-lg p-4">
//             <p className="text-sm font-medium text-gray-700 mb-2">Quyn:</p>
//             <div className="flex flex-wrap gap-2">
//               <span className="inline-flex items-center px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium">
//                 Super Admin
//               </span>
//               <span className="inline-flex items-center px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium">
//                 manage_users
//               </span>
//               <span className="inline-flex items-center px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium">
//                 manage_exams
//               </span>
//               <span className="inline-flex items-center px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-medium">
//                 manage_grammar
//               </span>
//               <span className="inline-flex items-center px-2 py-1 bg-pink-100 text-pink-700 rounded text-xs font-medium">
//                 manage_vocabulary
//               </span>
//             </div>
//           </div>
//         </div>

//         {/* Action Button */}
//         <button
//           onClick={handleCreateAdmin}
//           disabled={loading || status?.success}
//           className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
//         >
//           {loading ? (
//             <>
//               <div className="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div>
//               <span>ang to Admin...</span>
//             </>
//           ) : status?.success ? (
//             <>
//               <CheckCircle className="w-5 h-5" />
//               <span> to thnh cng!</span>
//             </>
//           ) : (
//             <>
//               <Shield className="w-5 h-5" />
//               <span>To Super Admin</span>
//             </>
//           )}
//         </button>

//         {/* Status Message */}
//         {status && (
//           <div className={`mt-4 flex items-start gap-3 p-4 rounded-lg ${
//             status.success 
//               ? 'bg-green-50 border border-green-200' 
//               : 'bg-red-50 border border-red-200'
//           }`}>
//             {status.success ? (
//               <>
//                 <CheckCircle className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
//                 <div className="flex-1">
//                   <p className="text-sm font-medium text-green-900 mb-2">
//                      To Super Admin thnh cng!
//                   </p>
//                   <div className="space-y-1 text-xs text-green-700">
//                     <p> Email: {status.email}</p>
//                     <p> UID: {status.adminUID}</p>
//                     <p> Collection: admin_accounts</p>
//                   </div>
//                   <p className="text-xs text-green-600 mt-3 font-medium">
//                      By gi bn c th ng nhp ti /admin/login
//                   </p>
//                 </div>
//               </>
//             ) : (
//               <>
//                 <XCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
//                 <div className="flex-1">
//                   <p className="text-sm font-medium text-red-900 mb-1">
//                     Li khi to admin
//                   </p>
//                   <p className="text-xs text-red-700">
//                     {status.error}
//                   </p>
//                 </div>
//               </>
//             )}
//           </div>
//         )}

//         {/* Footer */}
//         <div className="mt-6 pt-6 border-t border-gray-200">
//           <p className="text-xs text-gray-500 text-center">
//              Admin Panel - Collection: admin_accounts
//           </p>
//         </div>
//       </div>
//     </div>
//   );
// };

// export default AdminSetup;
</file>

<file path="src/admin/pages/AdminDashboard.jsx">
// src/admin/pages/AdminDashboard.jsx
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { 
  LogOut, Users, BookOpen, FileText, Languages, 
  BarChart3, Settings, Shield, Activity, Database,
  ChevronRight, UserCog, Bell, MessageSquare,
  HelpCircle, AlertCircle, CheckCircle, Clock,
  Eye, Download, Edit, Trash2, Search, Filter,
  Home, TrendingUp, Users as UsersIcon, FileCheck
} from 'lucide-react';
import { useAdminAuth } from '../hooks/useAdminAuth';

const AdminDashboard = () => {
  const navigate = useNavigate();
  const { admin, signOut } = useAdminAuth();
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    // Simulate loading
    const timer = setTimeout(() => {
      setIsLoading(false);
    }, 1000);
    return () => clearTimeout(timer);
  }, []);

  const handleSignOut = async () => {
    await signOut();
    navigate('/admin/login');
  };

  const mainMenuItems = [
    { 
      icon: Users, 
      label: 'Qun l Users', 
      path: '/admin/users',
      color: 'bg-gradient-to-br from-blue-500 to-cyan-500',
      count: '1.2K',
      description: 'Qun l ngi dng v phn quyn',
      badge: 'New'
    },
    { 
      icon: BookOpen, 
      label: 'Qun l Exams', 
      path: '/admin/exams',
      color: 'bg-gradient-to-br from-purple-500 to-pink-500',
      count: '45',
      description: 'To v chnh sa  thi',
      badge: ''
    },
    { 
      icon: FileText, 
      label: 'Qun l Grammar', 
      path: '/admin/grammar',
      color: 'bg-gradient-to-br from-green-500 to-emerald-500',
      count: '320',
      description: 'Ng php v bi hc',
      badge: 'Updated'
    },
    { 
      icon: Languages, 
      label: 'Qun l Vocabulary', 
      path: '/admin/vocabulary',
      color: 'bg-gradient-to-br from-orange-500 to-red-500',
      count: '5K+',
      description: 'T vng v flashcard',
      badge: ''
    },
    { 
      icon: Database, 
      label: 'Database', 
      path: '/admin/database',
      color: 'bg-gradient-to-br from-indigo-500 to-blue-500',
      count: '12GB',
      description: 'Qun l d liu h thng',
      badge: ''
    },
    { 
      icon: Settings, 
      label: 'Ci t', 
      path: '/admin/settings',
      color: 'bg-gradient-to-br from-gray-600 to-gray-800',
      count: '',
      description: 'Cu hnh h thng',
      badge: ''
    }
  ];

  const statsCards = [
    { 
      title: 'Total Users', 
      value: '1,254', 
      change: '+12%', 
      icon: UsersIcon,
      color: 'text-blue-600 bg-blue-100',
      trend: 'up'
    },
    { 
      title: 'Active Exams', 
      value: '45', 
      change: '+3', 
      icon: BookOpen,
      color: 'text-purple-600 bg-purple-100',
      trend: 'up'
    },
    { 
      title: 'Questions', 
      value: '1,845', 
      change: '+89', 
      icon: FileCheck,
      color: 'text-green-600 bg-green-100',
      trend: 'up'
    },
    { 
      title: 'Completion Rate', 
      value: '92%', 
      change: '+5%', 
      icon: TrendingUp,
      color: 'text-orange-600 bg-orange-100',
      trend: 'up'
    },
  ];

  const recentActivities = [
    { user: 'Nguyn Vn A', action: ' hon thnh bi test', time: '2 pht trc', type: 'success' },
    { user: 'Trn Th B', action: ' ng k ti khon mi', time: '15 pht trc', type: 'info' },
    { user: 'L Vn C', action: ' upload ti liu mi', time: '1 gi trc', type: 'warning' },
    { user: 'Phm Th D', action: ' bo co li', time: '2 gi trc', type: 'error' },
  ];

  const quickActions = [
    { icon: Download, label: 'Export Data', color: 'from-blue-500 to-cyan-500' },
    { icon: Edit, label: 'Edit Content', color: 'from-purple-500 to-pink-500' },
    { icon: Eye, label: 'Preview Site', color: 'from-green-500 to-emerald-500' },
    { icon: Filter, label: 'Filter Users', color: 'from-orange-500 to-red-500' },
  ];

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center">
        <div className="text-center">
          <div className="w-20 h-20 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600 font-medium">Loading Admin Dashboard...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
      {/* Animated Background */}
      <div className="fixed inset-0 overflow-hidden pointer-events-none">
        <div className="absolute -top-40 -right-40 w-80 h-80 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
        <div className="absolute -bottom-40 -left-40 w-80 h-80 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse animation-delay-2000"></div>
      </div>

      <style>
        {`
          @keyframes slideIn {
            from {
              transform: translateY(20px);
              opacity: 0;
            }
            to {
              transform: translateY(0);
              opacity: 1;
            }
          }
          .animate-slide-in {
            animation: slideIn 0.5s ease-out forwards;
          }
          .animation-delay-2000 {
            animation-delay: 2s;
          }
        `}
      </style>

      {/* Header */}
      <header className="sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-gray-200/50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg">
                <Shield className="w-6 h-6 text-white" />
              </div>
              <div>
                <h1 className="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                  Admin Dashboard
                </h1>
                <p className="text-sm text-gray-600 flex items-center gap-1">
                  <span>Xin cho,</span>
                  <span className="font-semibold text-blue-600">{admin?.email}</span>
                  <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                </p>
              </div>
            </div>
            
            <div className="flex items-center gap-4">
              <button className="relative p-2 rounded-xl hover:bg-gray-100 transition-colors group">
                <Bell className="w-5 h-5 text-gray-600 group-hover:text-blue-600 transition-colors" />
                <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
              </button>
              
              <div className="hidden md:flex items-center gap-2 px-4 py-2 bg-gray-100 rounded-xl">
                <Clock className="w-4 h-4 text-gray-500" />
                <span className="text-sm text-gray-600">Today: {new Date().toLocaleDateString('vi-VN')}</span>
              </div>
              
              <button
                onClick={handleSignOut}
                className="group flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-xl transition-all duration-300 shadow-sm hover:shadow-md transform hover:-translate-y-0.5"
              >
                <LogOut className="w-4 h-4 group-hover:rotate-12 transition-transform" />
                <span className="font-medium">ng xut</span>
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Welcome Section */}
        <div className="mb-8 animate-slide-in">
          <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-6 text-white shadow-lg">
            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
              <div>
                <h2 className="text-2xl font-bold mb-2 text-white">Cho mng tr li, Admin!</h2>
                <p className="text-blue-100">Bn c <span className="font-bold">12</span> cng vic mi cn x l hm nay.</p>
              </div>
              <button 
                onClick={() => navigate('/admin/tasks')}
                className="px-6 py-3 bg-white text-blue-600 hover:bg-blue-50 font-semibold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg"
              >
                Xem tt c cng vic
              </button>
            </div>
          </div>
        </div>

        {/* Stats Grid */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
          {statsCards.map((stat, index) => (
            <div 
              key={index}
              className="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1 animate-slide-in"
              style={{ animationDelay: `${index * 0.1}s` }}
            >
              <div className="flex items-center justify-between mb-4">
                <div className={`p-3 rounded-xl ${stat.color}`}>
                  <stat.icon className="w-6 h-6" />
                </div>
                <span className={`text-sm font-medium px-2 py-1 rounded-full ${stat.trend === 'up' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                  {stat.change}
                </span>
              </div>
              <p className="text-3xl font-bold text-gray-900 mb-1">{stat.value}</p>
              <p className="text-sm text-gray-600">{stat.title}</p>
              <div className="mt-4 h-2 bg-gray-200 rounded-full overflow-hidden">
                <div 
                  className={`h-full rounded-full ${stat.trend === 'up' ? 'bg-green-500' : 'bg-red-500'}`}
                  style={{ width: `${Math.min(100, parseInt(stat.value) / 20)}%` }}
                ></div>
              </div>
            </div>
          ))}
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Main Features Grid */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm mb-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-xl font-bold text-gray-900">Qun l H thng</h2>
                <div className="relative">
                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" />
                  <input
                    type="text"
                    placeholder="Tm kim module..."
                    className="pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {mainMenuItems.map((item, index) => (
                  <button
                    key={index}
                    onClick={() => navigate(item.path)}
                    className="group relative bg-white rounded-xl p-4 border border-gray-200 hover:border-blue-300 transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 text-left animate-slide-in"
                    style={{ animationDelay: `${index * 0.05}s` }}
                  >
                    <div className="flex items-start justify-between">
                      <div className="flex items-start gap-4">
                        <div className={`w-14 h-14 rounded-xl ${item.color} flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300`}>
                          <item.icon className="w-7 h-7 text-white" />
                        </div>
                        <div>
                          <div className="flex items-center gap-2 mb-1">
                            <h3 className="font-bold text-gray-900">{item.label}</h3>
                            {item.badge && (
                              <span className="text-xs font-medium px-2 py-1 rounded-full bg-blue-100 text-blue-700">
                                {item.badge}
                              </span>
                            )}
                          </div>
                          <p className="text-sm text-gray-600 mb-2">{item.description}</p>
                          {item.count && (
                            <p className="text-lg font-bold text-gray-900">{item.count}</p>
                          )}
                        </div>
                      </div>
                      <ChevronRight className="w-5 h-5 text-gray-400 group-hover:text-blue-500 group-hover:translate-x-2 transition-all duration-300" />
                    </div>
                  </button>
                ))}
              </div>
            </div>

            {/* Quick Actions */}
            <div className="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
              <h3 className="text-lg font-bold text-gray-900 mb-4">Quick Actions</h3>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                {quickActions.map((action, index) => (
                  <button
                    key={index}
                    className="group flex flex-col items-center justify-center p-4 rounded-xl border border-gray-200 hover:border-blue-300 transition-all duration-300 hover:shadow-md transform hover:-translate-y-1"
                  >
                    <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${action.color} flex items-center justify-center mb-3 group-hover:rotate-12 transition-transform duration-300`}>
                      <action.icon className="w-6 h-6 text-white" />
                    </div>
                    <span className="text-sm font-medium text-gray-900">{action.label}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* Right Sidebar */}
          <div className="space-y-6">
            {/* Recent Activities */}
            <div className="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
              <div className="flex items-center justify-between mb-6">
                <h3 className="text-lg font-bold text-gray-900">Hot ng gn y</h3>
                <button className="text-sm text-blue-600 hover:text-blue-700 font-medium hover:underline">
                  Xem tt c
                </button>
              </div>
              
              <div className="space-y-4">
                {recentActivities.map((activity, index) => (
                  <div 
                    key={index} 
                    className="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors animate-slide-in"
                    style={{ animationDelay: `${index * 0.1}s` }}
                  >
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                      activity.type === 'success' ? 'bg-green-100' :
                      activity.type === 'warning' ? 'bg-yellow-100' :
                      activity.type === 'error' ? 'bg-red-100' : 'bg-blue-100'
                    }`}>
                      {activity.type === 'success' && <CheckCircle className="w-4 h-4 text-green-600" />}
                      {activity.type === 'warning' && <AlertCircle className="w-4 h-4 text-yellow-600" />}
                      {activity.type === 'error' && <AlertCircle className="w-4 h-4 text-red-600" />}
                      {activity.type === 'info' && <UserCog className="w-4 h-4 text-blue-600" />}
                    </div>
                    <div className="flex-1 min-w-0">
                      <p className="text-sm font-medium text-gray-900">{activity.user}</p>
                      <p className="text-sm text-gray-600">{activity.action}</p>
                      <p className="text-xs text-gray-500 mt-1">{activity.time}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* System Status */}
            <div className="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
              <h3 className="text-lg font-bold text-gray-900 mb-4">Trng thi h thng</h3>
              
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between mb-1">
                    <span className="text-sm text-gray-600">Server Load</span>
                    <span className="text-sm font-medium text-green-600">42%</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div className="bg-green-500 h-2 rounded-full animate-pulse" style={{ width: '42%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between mb-1">
                    <span className="text-sm text-gray-600">Database</span>
                    <span className="text-sm font-medium text-green-600 flex items-center gap-1">
                      <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                      Online
                    </span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div className="bg-blue-500 h-2 rounded-full" style={{ width: '85%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between mb-1">
                    <span className="text-sm text-gray-600">Storage</span>
                    <span className="text-sm font-medium text-orange-600">12.5/20GB</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div className="bg-orange-500 h-2 rounded-full" style={{ width: '62.5%' }}></div>
                  </div>
                </div>
              </div>
              
              <div className="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <div className="flex items-center gap-3">
                  <AlertCircle className="w-5 h-5 text-blue-600" />
                  <div>
                    <p className="text-sm font-medium text-blue-900">H thng hot ng n nh</p>
                    <p className="text-xs text-blue-700">Uptime: 99.9% trong 30 ngy qua</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      {/* Footer */}
      <footer className="border-t border-gray-200 mt-8 py-6 bg-white/80 backdrop-blur-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex flex-col md:flex-row justify-between items-center gap-4">
            <div className="text-sm text-gray-600">
              <span className="font-medium"> 2024 Admin Panel</span>  Version 2.1.0
            </div>
            <div className="flex items-center gap-6">
              <div className="flex items-center gap-2 text-sm text-gray-600">
                <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span className="font-medium text-green-600">All Systems Operational</span>
              </div>
              <span className="text-sm text-gray-600 hidden md:block">
                Last updated: {new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })}
              </span>
            </div>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default AdminDashboard;
</file>

<file path="src/admin/pages/AdminLogin.jsx">
// src/admin/pages/AdminLogin.jsx
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Shield, Mail, Lock, AlertCircle } from 'lucide-react';
import { useAdminAuth } from '../hooks/useAdminAuth';

const AdminLogin = () => {
  const navigate = useNavigate();
  const { signIn, loading } = useAdminAuth();
  
  const [formData, setFormData] = useState({
    email: '',
    password: ''
  });
  const [error, setError] = useState('');

  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
    setError('');
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (!formData.email || !formData.password) {
      setError('Vui lng nhp y  thng tin');
      return;
    }

    const result = await signIn(formData.email, formData.password);
    
    if (result.success) {
      navigate('/admin/dashboard');
    } else {
      setError(result.error || 'ng nhp tht bi');
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4">
      <div className="max-w-md w-full">
        {/* Logo & Title */}
        <div className="text-center mb-8">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4">
            <Shield className="w-8 h-8 text-white" />
          </div>
          <h1 className="text-3xl font-bold text-white mb-2">Admin Panel</h1>
          <p className="text-slate-400">ng nhp  qun l h thng</p>
        </div>

        {/* Login Form */}
        <div className="bg-white rounded-2xl shadow-xl p-8">
          <form onSubmit={handleSubmit} className="space-y-6">
            {/* Email */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Email
              </label>
              <div className="relative">
                <Mail className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  type="email"
                  name="email"
                  value={formData.email}
                  onChange={handleChange}
                  className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="admin@example.com"
                  disabled={loading}
                />
              </div>
            </div>

            {/* Password */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Mt khu
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  type="password"
                  name="password"
                  value={formData.password}
                  onChange={handleChange}
                  className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder=""
                  disabled={loading}
                />
              </div>
            </div>

            {/* Error Message */}
            {error && (
              <div className="flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg">
                <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
                <p className="text-sm text-red-600">{error}</p>
              </div>
            )}

            {/* Submit Button */}
            <button
              type="submit"
              disabled={loading}
              className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? 'ang ng nhp...' : 'ng nhp'}
            </button>
          </form>
        </div>

        {/* Footer */}
        <p className="text-center text-slate-400 text-sm mt-6">
           2025 Admin Panel. Bo mt v ring t.
        </p>
      </div>
    </div>
  );
};

export default AdminLogin;
</file>

<file path="src/components/Audio/AudioControls.css">
/* @keyframes progressShine {
  0% {
    background-position: 0% 50%;
  }
  100% {
    background-position: 200% 50%;
  }
}

@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.audio-progress-bar {
  background: linear-gradient(90deg, #f97316 0%, #fbbf24 50%, #f97316 100%);
  background-size: 200% 100%;
  animation: progressShine 2s linear infinite;
}

.animate-shimmer {
  animation: shimmer 2s infinite;
} */
</file>

<file path="src/components/Audio/AudioControls.jsx">
// import React, { useState, useEffect } from 'react';
// import { 
//   Play, Pause, Square, RotateCcw, Volume2, VolumeX,
//   Radio, Waves, Headphones, Info, Zap, Timer, Activity
// } from 'lucide-react';

// const AudioControls = ({ 
//   status, 
//   progress, 
//   playAudio, 
//   pauseAudio, 
//   stopAudio, 
//   partData, 
//   selectedPart, 
//   currentQuestionIndex, 
//   testType 
// }) => {
//   const [volume, setVolume] = useState(1);
//   const [isMuted, setIsMuted] = useState(false);
//   const [playCount, setPlayCount] = useState(0);
//   const [showTip, setShowTip] = useState(true);

//   // Reset play count when question changes
//   useEffect(() => {
//     setPlayCount(0);
//   }, [currentQuestionIndex, selectedPart]);

//   if (testType !== 'listening' || !partData) return null;

//   const handlePlay = () => {
//     let script = '';
//     if (selectedPart === 'part1') {
//       // For Part 1: Use shared script for the whole conversation
//       script = partData.script || '';
//     } else {
//       // For other parts: Use question-specific script if available, else part script
//       script = partData.questions?.[currentQuestionIndex]?.script || partData.script || '';
//     }
    
//     if (!script.trim()) {
//       alert(' Vui lng chn mt Part c script trc!');
//       return;
//     }
//     setPlayCount(prev => prev + 1);
//     playAudio(script);
//   };

//   const toggleMute = () => {
//     setIsMuted(!isMuted);
//   };

//   // Determine current status
//   const isPlaying = status.includes('');
//   const isPaused = status.includes('');
//   const isStopped = !isPlaying && !isPaused;

//   // Status configuration vi mu theme
//   const statusConfig = {
//     playing: {
//       icon: Waves,
//       text: 'ang pht',
//       emoji: '',
//       bgGradient: 'from-orange-500 to-yellow-500',
//       bgColor: 'bg-orange-50',
//       textColor: 'text-orange-700',
//       borderColor: 'border-orange-400',
//       dotColor: 'bg-orange-500'
//     },
//     paused: {
//       icon: Radio,
//       text: 'Tm dng',
//       emoji: '',
//       bgGradient: 'from-amber-500 to-yellow-400',
//       bgColor: 'bg-amber-50',
//       textColor: 'text-amber-700',
//       borderColor: 'border-amber-400',
//       dotColor: 'bg-amber-500'
//     },
//     stopped: {
//       icon: Headphones,
//       text: 'Sn sng',
//       emoji: '',
//       bgGradient: 'from-gray-400 to-gray-500',
//       bgColor: 'bg-gray-50',
//       textColor: 'text-gray-700',
//       borderColor: 'border-gray-400',
//       dotColor: 'bg-gray-500'
//     }
//   };

//   const currentStatus = isPlaying ? statusConfig.playing : 
//                         isPaused ? statusConfig.paused : 
//                         statusConfig.stopped;

//   const StatusIcon = currentStatus.icon;

//   return (
//     <div className="w-full">
//       {/* CSS for animations */}
//       <style dangerouslySetInnerHTML={{__html: `
//         @keyframes shimmer {
//           0% { transform: translateX(-100%); }
//           100% { transform: translateX(100%); }
//         }
//         @keyframes wave {
//           0%, 100% { transform: scaleY(1); }
//           50% { transform: scaleY(1.5); }
//         }
//         .animate-shimmer {
//           animation: shimmer 2s infinite;
//         }
//         .animate-wave {
//           animation: wave 1s ease-in-out infinite;
//         }
//       `}} />

//       {/* Main Control Card */}
//       <div className="bg-gradient-to-br from-orange-50 via-yellow-50 to-amber-50 rounded-2xl sm:rounded-3xl shadow-xl overflow-hidden border-2 border-orange-200">
        
//         {/* Header Section */}
//         <div className="relative bg-white/80 backdrop-blur-sm p-3 sm:p-4 md:p-5 border-b-2 border-orange-200">
//           <div className="flex items-center justify-between gap-3">
//             {/* Status Display */}
//             <div className="flex items-center gap-2 sm:gap-3 flex-1 min-w-0">
//               <div className={`relative p-2 sm:p-2.5 rounded-xl bg-gradient-to-br ${currentStatus.bgGradient} shadow-lg flex-shrink-0`}>
//                 <StatusIcon className="w-4 h-4 sm:w-5 sm:h-5 text-white" />
//                 {isPlaying && (
//                   <>
//                     <div className="absolute inset-0 rounded-xl bg-white/30 animate-ping"></div>
//                     <div className="absolute -top-1 -right-1 w-2 h-2 sm:w-2.5 sm:h-2.5 bg-red-500 rounded-full animate-pulse"></div>
//                   </>
//                 )}
//               </div>
//               <div className="min-w-0 flex-1">
//                 <div className="flex items-center gap-1.5 sm:gap-2 mb-0.5">
//                   <h3 className="text-sm sm:text-base md:text-lg font-black text-gray-900 truncate">
//                     iu khin Audio
//                   </h3>
//                   <span className="text-xs sm:text-sm font-semibold text-orange-600 bg-orange-100 px-1.5 sm:px-2 py-0.5 rounded-lg border border-orange-300 flex-shrink-0">
//                     {selectedPart?.toUpperCase()}
//                   </span>
//                 </div>
//                 <div className="flex items-center gap-2 text-[10px] sm:text-xs text-gray-600">
//                   <span className={`flex items-center gap-1 font-semibold ${currentStatus.textColor}`}>
//                     <span className={`w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full ${currentStatus.dotColor} ${isPlaying ? 'animate-pulse' : ''}`}></span>
//                     {currentStatus.text}
//                   </span>
//                   <span className="text-gray-400"></span>
//                   <span className="font-semibold">
//                     {playCount > 0 ? `${playCount} ln pht` : 'Cha pht'}
//                   </span>
//                 </div>
//               </div>
//             </div>
            
//             {/* Volume Control */}
//             <div className="flex items-center gap-1.5 sm:gap-2 flex-shrink-0">
//               <button
//                 onClick={toggleMute}
//                 className="p-1.5 sm:p-2 rounded-lg bg-orange-100 hover:bg-orange-200 border border-orange-300 transition-all group"
//                 title={isMuted ? 'Bt m thanh' : 'Tt m thanh'}
//               >
//                 {isMuted ? (
//                   <VolumeX className="w-3.5 h-3.5 sm:w-4 sm:h-4 text-orange-700" />
//                 ) : (
//                   <Volume2 className="w-3.5 h-3.5 sm:w-4 sm:h-4 text-orange-700 group-hover:scale-110 transition-transform" />
//                 )}
//               </button>
              
//               {/* Volume Slider - Desktop only */}
//               <div className="hidden lg:flex items-center gap-2 bg-white/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-orange-200">
//                 <Volume2 className="w-3.5 h-3.5 text-orange-600 flex-shrink-0" />
//                 <input
//                   type="range"
//                   min="0"
//                   max="1"
//                   step="0.1"
//                   value={isMuted ? 0 : volume}
//                   onChange={(e) => {
//                     setVolume(parseFloat(e.target.value));
//                     if (parseFloat(e.target.value) > 0) setIsMuted(false);
//                   }}
//                   className="w-20 h-1.5 bg-orange-200 rounded-lg appearance-none cursor-pointer
//                     [&::-webkit-slider-thumb]:appearance-none
//                     [&::-webkit-slider-thumb]:w-3.5
//                     [&::-webkit-slider-thumb]:h-3.5
//                     [&::-webkit-slider-thumb]:rounded-full
//                     [&::-webkit-slider-thumb]:bg-gradient-to-r
//                     [&::-webkit-slider-thumb]:from-orange-500
//                     [&::-webkit-slider-thumb]:to-yellow-500
//                     [&::-webkit-slider-thumb]:cursor-pointer
//                     [&::-webkit-slider-thumb]:shadow-lg
//                     [&::-webkit-slider-thumb]:border-2
//                     [&::-webkit-slider-thumb]:border-white"
//                 />
//                 <span className="text-xs text-gray-700 font-bold w-8 text-right">
//                   {Math.round((isMuted ? 0 : volume) * 100)}%
//                 </span>
//               </div>
//             </div>
//           </div>
//         </div>

//         {/* Progress Section */}
//         <div className="p-3 sm:p-4 md:p-5">
//           {/* Progress Bar */}
//           <div className="mb-3 sm:mb-4">
//             <div className="flex items-center justify-between mb-2">
//               <span className="text-xs sm:text-sm font-bold text-gray-700 flex items-center gap-1.5">
//                 <Timer className="w-3 h-3 sm:w-4 sm:h-4 text-orange-600" />
//                 Tin  pht
//               </span>
//               <span className="text-xs sm:text-sm font-black text-orange-700 bg-orange-100 px-2 sm:px-3 py-1 rounded-lg border-2 border-orange-300">
//                 {Math.round(progress)}%
//               </span>
//             </div>
            
//             {/* Enhanced Progress Bar */}
//             <div className="relative h-3 sm:h-4 bg-white/80 backdrop-blur-sm rounded-full overflow-hidden border-2 border-orange-200 shadow-inner">
//               {/* Progress Fill */}
//               <div
//                 className="absolute inset-y-0 left-0 bg-gradient-to-r from-orange-500 via-yellow-500 to-orange-400 rounded-full transition-all duration-300 ease-out shadow-lg"
//                 style={{ width: `${progress}%` }}
//               >
//                 {/* Shimmer Effect */}
//                 <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent animate-shimmer"></div>
                
//                 {/* Animated Dot */}
//                 {isPlaying && progress > 0 && (
//                   <div className="absolute -right-1.5 sm:-right-2 top-1/2 -translate-y-1/2 flex items-center justify-center">
//                     <div className="w-3 h-3 sm:w-4 sm:h-4 bg-white rounded-full shadow-lg border-2 border-orange-500 animate-pulse"></div>
//                     <div className="absolute w-5 h-5 sm:w-6 sm:h-6 bg-orange-400/30 rounded-full animate-ping"></div>
//                   </div>
//                 )}
//               </div>
//             </div>

//             {/* Wave Animation */}
//             {isPlaying && (
//               <div className="flex items-center justify-center gap-0.5 sm:gap-1 mt-2 sm:mt-3">
//                 {[...Array(20)].map((_, i) => (
//                   <div
//                     key={i}
//                     className="w-0.5 sm:w-1 bg-gradient-to-t from-orange-500 to-yellow-500 rounded-full animate-wave"
//                     style={{
//                       height: `${Math.random() * 16 + 8}px`,
//                       animationDelay: `${i * 0.05}s`
//                     }}
//                   ></div>
//                 ))}
//               </div>
//             )}
//           </div>

//           {/* Control Buttons Grid */}
//           <div className="grid grid-cols-4 gap-2 sm:gap-3 mb-3 sm:mb-4">
//             {/* Play Button - 2 columns */}
//             <button
//               onClick={handlePlay}
//               disabled={isPlaying}
//               className="col-span-2 group relative bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 sm:py-4 rounded-xl transition-all duration-300 hover:shadow-xl hover:shadow-orange-500/50 hover:-translate-y-1 active:translate-y-0 disabled:hover:translate-y-0 disabled:hover:shadow-none overflow-hidden border-2 border-white/50"
//             >
//               <div className="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
//               <div className="relative z-10 flex items-center justify-center gap-1.5 sm:gap-2">
//                 <Play className="w-4 h-4 sm:w-5 sm:h-5" fill="currentColor" />
//                 <span className="text-xs sm:text-sm md:text-base font-black">Pht Audio</span>
//               </div>
//             </button>

//             {/* Pause Button */}
//             <button
//               onClick={pauseAudio}
//               disabled={!isPlaying}
//               className="group relative bg-gradient-to-r from-amber-500 to-yellow-400 hover:from-amber-600 hover:to-yellow-500 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 sm:py-4 rounded-xl transition-all duration-300 hover:shadow-xl hover:shadow-amber-500/50 hover:-translate-y-1 active:translate-y-0 disabled:hover:translate-y-0 disabled:hover:shadow-none overflow-hidden border-2 border-white/50"
//             >
//               <div className="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
//               <div className="relative z-10 flex flex-col items-center justify-center gap-0.5 sm:gap-1">
//                 <Pause className="w-4 h-4 sm:w-5 sm:h-5" fill="currentColor" />
//                 <span className="text-[10px] sm:text-xs font-bold">Tm dng</span>
//               </div>
//             </button>

//             {/* Stop Button */}
//             <button
//               onClick={stopAudio}
//               disabled={isStopped}
//               className="group relative bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 sm:py-4 rounded-xl transition-all duration-300 hover:shadow-xl hover:shadow-red-500/50 hover:-translate-y-1 active:translate-y-0 disabled:hover:translate-y-0 disabled:hover:shadow-none overflow-hidden border-2 border-white/50"
//             >
//               <div className="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
//               <div className="relative z-10 flex flex-col items-center justify-center gap-0.5 sm:gap-1">
//                 <Square className="w-4 h-4 sm:w-5 sm:h-5" fill="currentColor" />
//                 <span className="text-[10px] sm:text-xs font-bold">Dng</span>
//               </div>
//             </button>
//           </div>

//           {/* Repeat Button - Full Width */}
//           <button
//             onClick={handlePlay}
//             className="group w-full relative bg-gradient-to-r from-orange-400 via-yellow-400 to-orange-500 hover:from-orange-500 hover:via-yellow-500 hover:to-orange-600 text-white font-bold py-3 sm:py-4 rounded-xl transition-all duration-300 hover:shadow-xl hover:shadow-orange-400/50 hover:-translate-y-1 active:translate-y-0 overflow-hidden border-2 border-white/50"
//           >
//             <div className="absolute inset-0 bg-gradient-to-r from-white/0 via-white/30 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
//             <div className="relative z-10 flex items-center justify-center gap-2">
//               <RotateCcw className="w-4 h-4 sm:w-5 sm:h-5 group-hover:rotate-180 transition-transform duration-500" />
//               <span className="text-xs sm:text-sm md:text-base font-black">Nghe li (Repeat)</span>
//             </div>
//           </button>
//         </div>

//         {/* Info/Tip Section */}
//         {showTip && (
//           <div className="relative p-3 sm:p-4 md:p-5 border-t-2 border-orange-200 bg-gradient-to-br from-orange-100/50 to-yellow-100/50 backdrop-blur-sm">
//             <button
//               onClick={() => setShowTip(false)}
//               className="absolute top-2 right-2 sm:top-3 sm:right-3 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 rounded-lg p-1 hover:bg-white border border-orange-200"
//               title="ng"
//             >
//               
//             </button>
            
//             <div className="flex items-start gap-2 sm:gap-3 pr-6 sm:pr-8">
//               <div className="flex-shrink-0 p-1.5 sm:p-2 bg-orange-200 rounded-lg border border-orange-300">
//                 <Info className="w-4 h-4 sm:w-5 sm:h-5 text-orange-700" />
//               </div>
//               <div className="flex-1">
//                 <h4 className="text-xs sm:text-sm font-black text-gray-900 mb-1.5 sm:mb-2 flex items-center gap-1.5">
//                   <Zap className="w-3 h-3 sm:w-4 sm:h-4 text-yellow-600" />
//                   Mo s dng
//                 </h4>
//                 <ul className="space-y-1 sm:space-y-1.5 text-[10px] sm:text-xs text-gray-700">
//                   <li className="flex items-start gap-1.5">
//                     <span className="text-orange-600 font-bold mt-0.5 flex-shrink-0"></span>
//                     <span>Audio s c <strong className="text-gray-900">pht t ng 2 ln</strong> lin tip</span>
//                   </li>
//                   <li className="flex items-start gap-1.5">
//                     <span className="text-orange-600 font-bold mt-0.5 flex-shrink-0"></span>
//                     <span>Nhn <strong className="text-gray-900">Tm dng</strong>  dng tm thi, <strong className="text-gray-900">Nghe li</strong>  pht t u</span>
//                   </li>
//                   <li className="flex items-start gap-1.5">
//                     <span className="text-orange-600 font-bold mt-0.5 flex-shrink-0"></span>
//                     <span>Tri nghim tt nht vi <strong className="text-gray-900">tai nghe </strong></span>
//                   </li>
//                 </ul>
//               </div>
//             </div>
//           </div>
//         )}

//         {/* Stats Cards */}
//         <div className="grid grid-cols-3 gap-2 sm:gap-3 mt-3 sm:mt-4">
//           {/* Status Card */}
//           <div className="bg-white rounded-xl sm:rounded-2xl p-2 sm:p-3 md:p-4 shadow-lg border-2 border-orange-200 hover:border-orange-400 transition-all hover:shadow-xl group">
//             <div className="flex items-center gap-1.5 sm:gap-2 mb-1 sm:mb-1.5">
//               <div className={`${currentStatus.bgColor} p-1 sm:p-1.5 rounded-lg border ${currentStatus.borderColor} group-hover:scale-110 transition-transform`}>
//                 <Activity className="w-3 h-3 sm:w-4 sm:h-4 text-orange-600" />
//               </div>
//               <span className="text-[10px] sm:text-xs text-gray-600 font-bold">Trng thi</span>
//             </div>
//             <p className="text-xs sm:text-sm font-black text-gray-900 truncate">
//               {currentStatus.emoji} {currentStatus.text}
//             </p>
//           </div>

//           {/* Plays Card */}
//           <div className="bg-white rounded-xl sm:rounded-2xl p-2 sm:p-3 md:p-4 shadow-lg border-2 border-orange-200 hover:border-orange-400 transition-all hover:shadow-xl group">
//             <div className="flex items-center gap-1.5 sm:gap-2 mb-1 sm:mb-1.5">
//               <div className="bg-blue-100 p-1 sm:p-1.5 rounded-lg border border-blue-300 group-hover:scale-110 transition-transform">
//                 <Radio className="w-3 h-3 sm:w-4 sm:h-4 text-blue-600" />
//               </div>
//               <span className="text-[10px] sm:text-xs text-gray-600 font-bold">Lt pht</span>
//             </div>
//             <p className="text-xs sm:text-sm font-black text-gray-900">
//               {playCount} <span className="text-gray-400 text-[10px] sm:text-xs">/ </span>
//             </p>
//           </div>

//           {/* Volume Card */}
//           <div className="bg-white rounded-xl sm:rounded-2xl p-2 sm:p-3 md:p-4 shadow-lg border-2 border-orange-200 hover:border-orange-400 transition-all hover:shadow-xl group">
//             <div className="flex items-center gap-1.5 sm:gap-2 mb-1 sm:mb-1.5">
//               <div className="bg-orange-100 p-1 sm:p-1.5 rounded-lg border border-orange-300 group-hover:scale-110 transition-transform">
//                 <Volume2 className="w-3 h-3 sm:w-4 sm:h-4 text-orange-600" />
//               </div>
//               <span className="text-[10px] sm:text-xs text-gray-600 font-bold">m lng</span>
//             </div>
//             <p className="text-xs sm:text-sm font-black text-gray-900">
//               {isMuted ? ' Tt' : ` ${Math.round(volume * 100)}%`}
//             </p>
//           </div>
//         </div>
//       </div>
//     </div>
//   );
// };

// export default AudioControls;
</file>

<file path="src/components/Auth/UserProfile.jsx">
import React, { useState, useMemo, memo, useEffect } from 'react';
import { motion } from 'framer-motion';
import {
  User, Trophy, TrendingUp, BookOpen, Clock, Target, Award,
  Calendar, Flame, Star, Activity, BarChart3, Zap, Brain,
  CheckCircle2, AlertCircle
} from 'lucide-react';
import { collection, query, where, onSnapshot } from 'firebase/firestore';
import { db } from '../../config/firebase';
import { useUserProgress } from '../../hooks/useUserProgress';

//  Animation Variants
const fadeInUp = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0, transition: { duration: 0.5, ease: 'easeOut' } },
};

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: { staggerChildren: 0.08, delayChildren: 0.15 }
  }
};

const listItemVariants = {
  initial: { opacity: 0, y: 15 },
  animate: { opacity: 1, y: 0, transition: { duration: 0.4, ease: 'easeOut' } },
  exit: { opacity: 0, y: -10, transition: { duration: 0.2 } }
};

//  Score Badge
const ScoreBadge = memo(({ score, size = 'md' }) => {
  const getScoreColor = (s) => {
    if (s >= 85) return { bg: 'from-green-400 to-emerald-500', text: 'text-green-600', light: 'bg-green-100' };
    if (s >= 70) return { bg: 'from-blue-400 to-cyan-500', text: 'text-blue-600', light: 'bg-blue-100' };
    if (s >= 50) return { bg: 'from-amber-400 to-orange-500', text: 'text-amber-600', light: 'bg-amber-100' };
    return { bg: 'from-red-400 to-pink-500', text: 'text-red-600', light: 'bg-red-100' };
  };

  const colors = getScoreColor(score);
  const sizeClass = size === 'lg' ? 'w-20 h-20 text-4xl' : size === 'sm' ? 'w-14 h-14 text-lg' : 'w-16 h-16 text-2xl';

  return (
    <motion.div
      initial={{ scale: 0.5, opacity: 0 }}
      animate={{ scale: 1, opacity: 1 }}
      transition={{ type: 'spring', stiffness: 300, damping: 20 }}
      className={`${sizeClass} rounded-xl ${colors.light} border-2 ${colors.text} flex items-center justify-center font-black`}
    >
      {score.toFixed(0)}
    </motion.div>
  );
});

ScoreBadge.displayName = 'ScoreBadge';

//  Premium Stat Card
const StatCard = memo(({ icon: Icon, label, value, sublabel, color }) => {
  const colorConfig = {
    blue: { bg: 'from-blue-50 to-cyan-50', icon: 'text-blue-500', border: 'border-blue-200', accent: 'bg-blue-100' },
    orange: { bg: 'from-orange-50 to-amber-50', icon: 'text-orange-500', border: 'border-orange-200', accent: 'bg-orange-100' },
    green: { bg: 'from-green-50 to-emerald-50', icon: 'text-green-500', border: 'border-green-200', accent: 'bg-green-100' },
    purple: { bg: 'from-purple-50 to-pink-50', icon: 'text-purple-500', border: 'border-purple-200', accent: 'bg-purple-100' },
  };

  const cfg = colorConfig[color] || colorConfig.blue;

  return (
    <motion.div
      variants={fadeInUp}
      whileHover={{ y: -4 }}
      className={`group relative bg-gradient-to-br ${cfg.bg} rounded-2xl p-6 border-2 ${cfg.border} overflow-hidden cursor-pointer`}
    >
      <div className="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300" />
      <div className="relative z-10 space-y-3">
        <div className={`inline-flex p-3 rounded-xl ${cfg.accent}`}>
          <Icon className={`w-6 h-6 ${cfg.icon}`} />
        </div>
        <div>
          <p className="text-sm font-semibold text-gray-600 uppercase tracking-wide">{label}</p>
          <div className="flex items-baseline gap-2 mt-2">
            <span className="text-4xl font-black text-gray-900">{value}</span>
            {sublabel && <span className="text-sm font-medium text-gray-500">{sublabel}</span>}
          </div>
        </div>
      </div>
    </motion.div>
  );
});

StatCard.displayName = 'StatCard';

//  Timeline Activity Item
const TimelineItem = memo(({ item, index, isLast }) => {
  const score = parseFloat(item.score);
  const correctAnswers = Math.round(item.totalQuestions * (score / 100));

  const getScoreStatus = (s) => {
    if (s >= 85) return { icon: Star, color: 'text-green-600', label: 'Xut sc' };
    if (s >= 70) return { icon: CheckCircle2, color: 'text-blue-600', label: 'Tt' };
    return { icon: AlertCircle, color: 'text-amber-600', label: 'Cn ci thin' };
  };

  const status = getScoreStatus(score);
  const StatusIcon = status.icon;

  return (
    <motion.div
      variants={fadeInUp}
      className="relative flex gap-4 md:gap-6 w-full"
    >
      {/* Timeline dot */}
      <div className="flex flex-col items-center flex-shrink-0 pt-1">
        <motion.div
          initial={{ scale: 0 }}
          animate={{ scale: 1 }}
          transition={{ delay: index * 0.1 }}
          className="w-4 h-4 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 ring-4 ring-white relative z-20 flex-shrink-0 shadow-lg"
        />
        {!isLast && <div className="w-1 h-24 bg-gradient-to-b from-blue-300 to-blue-100 my-2 flex-shrink-0 rounded-full" />}
      </div>

      {/* Content */}
      <motion.div
        whileHover={{ x: 4 }}
        className="flex-1 pb-8 min-w-0 relative z-10"
      >
        <div className="bg-gradient-to-br from-white to-blue-50 rounded-xl p-4 md:p-5 border-2 border-blue-300 shadow-md hover:shadow-lg transition-all duration-200 w-full">
          <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-4">
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 mb-3 flex-wrap">
                <span className="px-3 py-1 rounded-lg bg-blue-200 text-blue-800 text-xs font-bold uppercase tracking-wide whitespace-nowrap">
                  {item.exam}
                </span>
                <span className="px-3 py-1 rounded-lg bg-orange-200 text-orange-800 text-xs font-bold uppercase tracking-wide whitespace-nowrap">
                  {item.part}
                </span>
              </div>
              <div className="flex flex-col gap-2 text-sm text-gray-700">
                <div className="flex items-center gap-2">
                  <Calendar className="w-4 h-4 flex-shrink-0 text-gray-500" />
                  <span className="truncate">{item.completedAt.toLocaleDateString('vi-VN', { weekday: 'short', month: 'short', day: 'numeric' })}</span>
                </div>
                <div className="flex items-center gap-2">
                  <Clock className="w-4 h-4 flex-shrink-0 text-gray-500" />
                  <span>{item.duration || 0} pht</span>
                </div>
              </div>
            </div>

            {/* Score */}
            <div className="text-right flex flex-col items-end gap-3 flex-shrink-0">
              <ScoreBadge score={score} size="md" />
              <div className="text-center">
                <p className={`text-sm font-bold flex items-center gap-1 whitespace-nowrap ${status.color}`}>
                  <StatusIcon className="w-4 h-4 flex-shrink-0" />
                  {status.label}
                </p>
              </div>
            </div>
          </div>

          {/* Progress bar */}
          <div className="space-y-2 pt-2 border-t border-blue-200">
            <div className="flex justify-between text-xs font-medium text-gray-600">
              <span> {correctAnswers}/{item.totalQuestions} cu</span>
              <span className="text-blue-600 font-bold">{score.toFixed(1)}%</span>
            </div>
            <div className="w-full h-2.5 bg-gray-200 rounded-full overflow-hidden">
              <motion.div
                initial={{ width: 0 }}
                whileInView={{ width: `${score}%` }}
                viewport={{ once: true }}
                transition={{ duration: 0.8, ease: 'easeOut' }}
                className={`h-full ${
                  score >= 85 ? 'bg-gradient-to-r from-green-400 to-emerald-500' :
                  score >= 70 ? 'bg-gradient-to-r from-blue-400 to-cyan-500' :
                  'bg-gradient-to-r from-amber-400 to-orange-500'
                } rounded-full shadow-md`}
              />
            </div>
          </div>
        </div>
      </motion.div>
    </motion.div>
  );
});

TimelineItem.displayName = 'TimelineItem';

//  Header Section
const ProfileHeader = memo(({ currentUser, stats }) => {
  return (
    <motion.div
      variants={fadeInUp}
      className="relative rounded-3xl overflow-hidden"
    >
      {/* Animated Background */}
      <div className="absolute inset-0 bg-gradient-to-br from-blue-600 via-blue-700 to-purple-800">
        <motion.div
          animate={{ opacity: [0.3, 0.5, 0.3] }}
          transition={{ duration: 8, repeat: Infinity }}
          className="absolute inset-0 bg-gradient-to-tr from-cyan-400 to-transparent opacity-30"
        />
      </div>

      {/* Content */}
      <div className="relative z-10 p-8 md:p-12">
        <div className="flex flex-col md:flex-row items-start md:items-center gap-8">
          {/* Avatar */}
          <motion.div
            initial={{ scale: 0.8, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            className="relative flex-shrink-0"
          >
            <div className="w-32 h-32 rounded-3xl bg-white/20 backdrop-blur-sm border-3 border-white/30 p-1 shadow-2xl overflow-hidden">
              {currentUser?.photoURL ? (
                <img
                  src={currentUser.photoURL}
                  alt={currentUser.name}
                  className="w-full h-full object-cover rounded-2xl"
                />
              ) : (
                <div className="w-full h-full rounded-2xl bg-gradient-to-br from-cyan-300 to-blue-500 flex items-center justify-center">
                  <User className="w-16 h-16 text-white/80" />
                </div>
              )}
            </div>

            {/* Streak Badge */}
            {stats.recentStreak > 0 && (
              <motion.div
                initial={{ scale: 0, rotate: -180 }}
                animate={{ scale: 1, rotate: 0 }}
                transition={{ type: 'spring', stiffness: 300, damping: 20 }}
                className="absolute -bottom-3 -right-3 flex items-center gap-2 px-4 py-2 bg-orange-400 text-white font-bold rounded-full shadow-lg border-3 border-white backdrop-blur-sm"
              >
                <Flame className="w-5 h-5" />
                <span>{stats.recentStreak}</span>
              </motion.div>
            )}
          </motion.div>

          {/* User Info */}
          <motion.div variants={fadeInUp} className="flex-1">
            <h1 className="text-5xl font-black text-white mb-3 leading-tight">
              {currentUser?.name || 'Ngi dng'}
            </h1>
            {currentUser?.email && (
              <p className="text-white/90 text-lg font-medium mb-4">{currentUser.email}</p>
            )}

            {/* Quick Stats - Row */}
            <div className="grid grid-cols-3 gap-4">
              <div className="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                <p className="text-white/70 text-sm font-semibold uppercase tracking-wide mb-1">Bi Tp</p>
                <p className="text-3xl font-black text-white">{stats.totalAttempts}</p>
              </div>
              <div className="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                <p className="text-white/70 text-sm font-semibold uppercase tracking-wide mb-1">Cao Nht</p>
                <p className="text-3xl font-black text-orange-300">{stats.bestScore.toFixed(0)}%</p>
              </div>
              <div className="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                <p className="text-white/70 text-sm font-semibold uppercase tracking-wide mb-1">Trung Bnh</p>
                <p className="text-3xl font-black text-cyan-300">{stats.averageScore.toFixed(0)}%</p>
              </div>
            </div>
          </motion.div>
        </div>
      </div>
    </motion.div>
  );
});

ProfileHeader.displayName = 'ProfileHeader';

//  Main Component
export default function UserProfile({ currentUser: currentUserProp }) {
  const { currentUser: currentUserFromHook } = useUserProgress();
  const currentUser = useMemo(
    () => currentUserProp || currentUserFromHook,
    [currentUserProp, currentUserFromHook]
  );

  const [progress, setProgress] = useState([]);
  const [loading, setLoading] = useState(true);
  const [itemsToShow, setItemsToShow] = useState(5);

  //  Firestore Listener
  useEffect(() => {
    if (!currentUser?.provider) {
      setLoading(false);
      return;
    }

    try {
      let q;
      if (currentUser.provider === 'firebase' && currentUser.firebaseUid) {
        q = query(collection(db, 'userProgress'), where('firebaseUid', '==', currentUser.firebaseUid));
      } else if (currentUser.provider === 'clerk' && currentUser.clerkId) {
        q = query(collection(db, 'userProgress'), where('clerkId', '==', currentUser.clerkId));
      } else {
        setLoading(false);
        return;
      }

      const unsubscribe = onSnapshot(q, (snapshot) => {
        const data = snapshot.docs.map(doc => {
          const d = doc.data();
          return {
            id: doc.id,
            ...d,
            completedAt: d.completedAt?.toDate?.() || new Date(d.completedAt),
          };
        }).sort((a, b) => {
          const dateA = a.completedAt instanceof Date ? a.completedAt : new Date(0);
          const dateB = b.completedAt instanceof Date ? b.completedAt : new Date(0);
          return dateB - dateA;
        });

        setProgress(data);
        setLoading(false);
      }, () => setLoading(false));

      return unsubscribe;
    } catch {
      setLoading(false);
    }
  }, [currentUser]);

  //  Calculate Stats
  const stats = useMemo(() => {
    if (!progress?.length) {
      return {
        totalAttempts: 0,
        bestScore: 0,
        averageScore: 0,
        totalQuestions: 0,
        correctAnswers: 0,
        recentStreak: 0,
        lastActivity: null
      };
    }

    const validScores = progress.map(p => parseFloat(p.score)).filter(s => !isNaN(s) && s >= 0);
    const totalQs = progress.reduce((sum, p) => sum + (p.totalQuestions || 0), 0);
    const correctQs = progress.reduce((sum, p) => sum + Math.round((p.totalQuestions || 0) * (parseFloat(p.score) || 0) / 100), 0);

    let streak = 0;
    const dates = progress
      .map(p => new Date(p.completedAt))
      .sort((a, b) => b - a);

    if (dates.length > 0) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      for (let i = 0; i < dates.length; i++) {
        const d = new Date(dates[i]);
        d.setHours(0, 0, 0, 0);
        const diff = Math.floor((today - d) / (1000 * 60 * 60 * 24));
        if (diff === streak) streak++;
        else if (diff > streak) break;
      }
    }

    return {
      totalAttempts: progress.length,
      bestScore: validScores.length ? Math.max(...validScores) : 0,
      averageScore: validScores.length ? (validScores.reduce((a, b) => a + b, 0) / validScores.length) : 0,
      totalQuestions: totalQs,
      correctAnswers: correctQs,
      recentStreak: streak,
      lastActivity: dates[0] || null
    };
  }, [progress]);

  const accuracy = stats.totalQuestions ? (stats.correctAnswers / stats.totalQuestions * 100) : 0;

  const trend = useMemo(() => {
    if (progress.length < 2) return 'stable';
    const recent = progress.slice(0, 5).map(p => parseFloat(p.score) || 0);
    const older = progress.slice(5, 10).map(p => parseFloat(p.score) || 0);
    if (!recent.length || !older.length) return 'stable';
    const rAvg = recent.reduce((a, b) => a + b, 0) / recent.length;
    const oAvg = older.reduce((a, b) => a + b, 0) / older.length;
    return rAvg > oAvg + 5 ? 'improving' : rAvg < oAvg - 5 ? 'declining' : 'stable';
  }, [progress]);

  if (loading) {
    return (
      <div className="w-full bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8">
        <motion.div
          variants={containerVariants}
          initial="hidden"
          animate="visible"
          className="space-y-6 sm:space-y-8"
        >
          <ProfileHeader currentUser={currentUser} stats={stats} />
          <div className="flex items-center justify-center py-12 sm:py-16 md:py-20">
            <div className="text-center">
              <div className="w-10 h-10 sm:w-12 sm:h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-3 sm:mb-4" />
              <p className="text-gray-600 font-semibold text-sm sm:text-base">ang ti d liu...</p>
            </div>
          </div>
        </motion.div>
      </div>
    );
  }

  if (!progress || progress.length === 0) {
    return (
      <div className="w-full bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8">
        <motion.div
          variants={containerVariants}
          initial="hidden"
          animate="visible"
          className="space-y-6 sm:space-y-8"
        >
          <ProfileHeader currentUser={currentUser} stats={stats} />
          <motion.div variants={fadeInUp} className="text-center py-12 sm:py-16 md:py-20 px-4">
            <motion.div
              initial={{ scale: 0 }}
              animate={{ scale: 1 }}
              className="inline-flex items-center justify-center w-20 h-20 sm:w-24 sm:h-24 rounded-2xl bg-gradient-to-br from-blue-100 to-cyan-100 mb-4 sm:mb-6"
            >
              <Brain className="w-10 h-10 sm:w-12 sm:h-12 text-blue-600" />
            </motion.div>
            <h3 className="text-2xl sm:text-3xl font-black text-gray-900 mb-2 sm:mb-3">Cha c bi tp no</h3>
            <p className="text-gray-600 text-sm sm:text-lg max-w-md mx-auto">Bt u lm bi  theo di tin  v thng k chi tit!</p>
          </motion.div>
        </motion.div>
      </div>
    );
  }

  return (
    <div className="w-full bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8">
      <motion.div
        variants={containerVariants}
        initial="hidden"
        animate="visible"
        className="space-y-6 sm:space-y-8 md:space-y-10 w-full"
      >
        {/* Header */}
        <ProfileHeader currentUser={currentUser} stats={stats} />

        {/* Stats Grid */}
        <motion.div variants={fadeInUp} className="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6">
          <StatCard icon={Activity} label="Tng Bi Tp" value={stats.totalAttempts} color="blue" />
          <StatCard icon={Trophy} label="Cao Nht" value={`${stats.bestScore.toFixed(0)}%`} color="orange" />
          <StatCard icon={BarChart3} label="Trung Bnh" value={`${stats.averageScore.toFixed(0)}%`} color="purple" />
          <StatCard icon={Target} label="Chnh Xc" value={`${accuracy.toFixed(0)}%`} color="green" />
        </motion.div>

        {/* Detail Cards */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
          {/* Streak Card */}
          <motion.div
            variants={fadeInUp}
            className="group relative bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg sm:rounded-xl md:rounded-2xl p-4 sm:p-6 border-2 border-orange-300 overflow-hidden shadow-md"
          >
            <div className="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-300" />
            <div className="relative z-10 space-y-3 sm:space-y-4">
              <div className="flex items-center justify-between">
                <h3 className="font-bold text-gray-900 flex items-center gap-2 text-sm sm:text-base">
                  <Flame className="w-4 h-4 sm:w-5 sm:h-5 text-orange-500" />
                  Chui Ngy
                </h3>
                <span className="text-2xl sm:text-3xl font-black text-orange-500">{stats.recentStreak}</span>
              </div>
              <div className="w-full h-2 bg-orange-200 rounded-full overflow-hidden">
                <motion.div
                  initial={{ width: 0 }}
                  whileInView={{ width: `${Math.min((stats.recentStreak / 30) * 100, 100)}%` }}
                  viewport={{ once: true }}
                  transition={{ duration: 0.6 }}
                  className="h-full bg-gradient-to-r from-orange-400 to-orange-500"
                />
              </div>
              <p className="text-xs sm:text-sm text-gray-700 font-medium">Tip tc duy tr phn thng!</p>
            </div>
          </motion.div>

          {/* Questions Card */}
          <motion.div
            variants={fadeInUp}
            className="group relative bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg sm:rounded-xl md:rounded-2xl p-4 sm:p-6 border-2 border-blue-300 overflow-hidden shadow-md"
          >
            <div className="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-300" />
            <div className="relative z-10 space-y-3 sm:space-y-4">
              <div className="flex items-center justify-between">
                <h3 className="font-bold text-gray-900 flex items-center gap-2 text-sm sm:text-base">
                  <Award className="w-4 h-4 sm:w-5 sm:h-5 text-blue-500" />
                  Tng Cu
                </h3>
                <span className="text-2xl sm:text-3xl font-black text-blue-500">{stats.totalQuestions}</span>
              </div>
              <div className="flex justify-between text-xs sm:text-sm font-semibold mb-2 text-gray-700">
                <span className="flex items-center gap-1"><CheckCircle2 className="w-3.5 h-3.5 sm:w-4 sm:h-4 text-green-500" /> {stats.correctAnswers}</span>
                <span className="flex items-center gap-1"><AlertCircle className="w-3.5 h-3.5 sm:w-4 sm:h-4 text-red-500" /> {stats.totalQuestions - stats.correctAnswers}</span>
              </div>
              <div className="w-full h-2 bg-blue-200 rounded-full overflow-hidden">
                <motion.div
                  initial={{ width: 0 }}
                  whileInView={{ width: `${accuracy}%` }}
                  viewport={{ once: true }}
                  transition={{ duration: 0.6 }}
                  className="h-full bg-gradient-to-r from-blue-400 to-cyan-500"
                />
              </div>
            </div>
          </motion.div>

          {/* Trend Card */}
          <motion.div
            variants={fadeInUp}
            className={`group relative rounded-lg sm:rounded-xl md:rounded-2xl p-4 sm:p-6 border-2 overflow-hidden shadow-md ${
              trend === 'improving' ? 'bg-gradient-to-br from-green-50 to-emerald-50 border-green-300' :
              trend === 'declining' ? 'bg-gradient-to-br from-red-50 to-pink-50 border-red-300' :
              'bg-gradient-to-br from-gray-50 to-slate-50 border-gray-300'
            }`}
          >
            <div className="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-300" />
            <div className="relative z-10 space-y-3 sm:space-y-4">
              <h3 className="font-bold text-gray-900 flex items-center gap-2 text-sm sm:text-base">
                <TrendingUp className="w-4 h-4 sm:w-5 sm:h-5" />
                Xu Hng
              </h3>
              <div className={`text-2xl sm:text-3xl font-black ${
                trend === 'improving' ? 'text-green-600' :
                trend === 'declining' ? 'text-red-600' :
                'text-gray-600'
              }`}>
                {trend === 'improving' ? ' Tin B' : trend === 'declining' ? ' Gim' : ' n nh'}
              </div>
              <p className="text-xs sm:text-sm font-medium text-gray-700">
                {trend === 'improving' ? 'im tng ln!' :
                 trend === 'declining' ? 'Hy c gng thm!' :
                 'n nh'}
              </p>
            </div>
          </motion.div>
        </div>

        {/* Timeline Activity */}
        {progress && progress.length > 0 && (
          <motion.div variants={fadeInUp} className="space-y-4 sm:space-y-6 md:space-y-8">
            <div className="flex items-center justify-between gap-2">
              <h2 className="text-xl sm:text-2xl md:text-3xl font-black text-gray-900 flex items-center gap-2 sm:gap-3">
                <Zap className="w-6 h-6 sm:w-7 sm:h-7 text-orange-500" />
                <span className="truncate">Hot ng</span>
              </h2>
              <span className="px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-orange-100 text-orange-700 text-xs sm:text-sm font-bold whitespace-nowrap">
                {progress.length}
              </span>
            </div>

            {/* Timeline Items */}
            <div className="space-y-2 sm:space-y-3">
              {progress.slice(0, itemsToShow).map((item, index) => (
                <TimelineItem
                  key={item.id || index}
                  item={item}
                  index={index}
                  isLast={index === Math.min(itemsToShow - 1, progress.length - 1)}
                />
              ))}
            </div>

            {/* Load More Button */}
            {itemsToShow < progress.length && (
              <motion.button
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={() => setItemsToShow(prev => Math.min(prev + 5, progress.length))}
                className="w-full py-2.5 sm:py-3 px-4 sm:px-6 rounded-lg sm:rounded-xl bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-bold uppercase tracking-wide text-xs sm:text-sm shadow-md hover:shadow-lg transition-all duration-300"
              >
                <span>Xem Thm</span>
                <span className="text-xs ml-2">({itemsToShow} / {progress.length})</span>
              </motion.button>
            )}

            {/* Show All Loaded Message */}
            {itemsToShow >= progress.length && progress.length > 5 && (
              <motion.div
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                className="text-center py-3 sm:py-4"
              >
                <p className="text-gray-500 font-medium text-sm sm:text-base">  hin th tt c {progress.length} bi</p>
              </motion.div>
            )}
          </motion.div>
        )}
      </motion.div>
    </div>
  );
}
</file>

<file path="src/components/Display/PreviousResults.jsx">
import React from 'react';
import { TrendingUp, Trophy, Clock, CheckCircle, XCircle, Activity } from 'lucide-react';

export default function PreviousResults({ attempts, loading, selectedExam, selectedPart }) {
  if (loading) {
    return (
      <div className="bg-white border border-slate-200 rounded-xl p-5 shadow-sm">
        <div className="flex items-center gap-3">
          <div className="w-4 h-4 bg-slate-300 rounded-full animate-pulse" />
          <p className="text-slate-600 font-medium text-sm">ang ti kt qu...</p>
        </div>
      </div>
    );
  }

  if (!attempts || attempts.length === 0) {
    return (
      <div className="bg-slate-50 border border-slate-200 rounded-xl p-6">
        <p className="text-slate-900 font-semibold text-sm mb-1">Ln u tin</p>
        <p className="text-slate-600 text-sm">Kt qu s c lu sau khi np bi</p>
      </div>
    );
  }

  const bestAttempt = attempts.reduce((best, current) => 
    (current.score > best.score) ? current : best
  );
  
  const latestAttempt = attempts[0];
  const scoreImprovement = latestAttempt.score - bestAttempt.score;
  const isImproving = scoreImprovement >= 0;

  return (
    <div className="space-y-5">
      {/* Summary Stats Grid - Flat & Minimal */}
      <div className="grid grid-cols-3 gap-3">
        {/* Best Score */}
        <div className="bg-white border border-slate-200 rounded-xl p-4 hover:shadow-sm transition-shadow duration-200">
          <div className="flex items-start justify-between mb-3">
            <Trophy className="w-4 h-4 text-slate-700" strokeWidth={1.5} />
            <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Cao nht</span>
          </div>
          <p className="text-3xl font-bold text-slate-900">
            {bestAttempt.score?.toFixed(0)}%
          </p>
          <p className="text-xs text-slate-500 mt-2">im tt nht</p>
        </div>

        {/* Latest Score */}
        <div className="bg-white border border-slate-200 rounded-xl p-4 hover:shadow-sm transition-shadow duration-200">
          <div className="flex items-start justify-between mb-3">
            <TrendingUp className="w-4 h-4 text-slate-700" strokeWidth={1.5} />
            <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Gn nht</span>
          </div>
          <p className="text-3xl font-bold text-slate-900">
            {latestAttempt.score?.toFixed(0)}%
          </p>
          <p className="text-xs text-slate-500 mt-2">Ln lm cui</p>
        </div>

        {/* Attempts Count */}
        <div className="bg-white border border-slate-200 rounded-xl p-4 hover:shadow-sm transition-shadow duration-200">
          <div className="flex items-start justify-between mb-3">
            <Activity className="w-4 h-4 text-slate-700" strokeWidth={1.5} />
            <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">S ln</span>
          </div>
          <p className="text-3xl font-bold text-slate-900">
            {attempts.length}
          </p>
          <p className="text-xs text-slate-500 mt-2">Ln np bi</p>
        </div>
      </div>

      {/* Trend Indicator - Subtle Progress */}
      {attempts.length > 1 && (
        <div className="bg-slate-50 border border-slate-200 rounded-xl p-4">
          <div className="flex items-center justify-between mb-3">
            <p className="text-sm font-semibold text-slate-900">Xu hng</p>
            <span className={`text-xs font-bold ${
              isImproving 
                ? 'text-emerald-600' 
                : 'text-amber-600'
            }`}>
              {isImproving ? '' : ''} {Math.abs(scoreImprovement).toFixed(1)}%
            </span>
          </div>
          <div className="w-full bg-slate-200 rounded-lg h-2">
            <div
              className={`h-2 rounded-lg transition-all duration-500 ${
                isImproving
                  ? 'bg-emerald-500'
                  : 'bg-amber-500'
              }`}
              style={{ width: `${Math.min(latestAttempt.score, 100)}%` }}
            />
          </div>
          <p className="text-xs text-slate-600 mt-2">
            {isImproving 
              ? `Tng ${scoreImprovement.toFixed(1)}% so vi ln trc` 
              : `Gim ${Math.abs(scoreImprovement).toFixed(1)}% so vi ln trc`}
          </p>
        </div>
      )}

      {/* Attempts History - Clean Timeline */}
      <div className="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
        {/* Header */}
        <div className="px-5 py-3.5 border-b border-slate-200 bg-slate-50">
          <div className="flex items-center gap-2">
            <Clock className="w-4 h-4 text-slate-700" strokeWidth={1.5} />
            <h3 className="font-semibold text-slate-900 text-sm">Lch s np bi</h3>
            <span className="ml-auto text-xs font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded-full">
              {attempts.length}
            </span>
          </div>
        </div>

        {/* Attempts List */}
        <div className="divide-y divide-slate-200 max-h-96 overflow-y-auto">
          {attempts.map((attempt, index) => {
            const correct = Object.entries(attempt.answers || {}).filter(
              ([questionId, answerIndex]) => answerIndex !== undefined
            ).length;

            const total = attempt.totalQuestions || 0;
            const isBest = attempt.score === bestAttempt.score;
            const isDraft = attempt.isDraft;
            const attemptNumber = attempts.length - index;

            return (
              <div
                key={attempt.id}
                className={`px-5 py-4 transition-colors duration-200 hover:bg-slate-50 ${
                  isBest ? 'bg-amber-50/30' : ''
                }`}
              >
                <div className="flex items-center justify-between gap-3">
                  {/* Left: Meta Info */}
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-2 flex-wrap">
                      <span className="font-semibold text-slate-900 text-sm">
                        Ln {attemptNumber}
                      </span>
                      {isBest && (
                        <span className="text-xs font-bold text-amber-700 bg-amber-100 px-2 py-1 rounded-md">
                           Tt nht
                        </span>
                      )}
                      {isDraft && (
                        <span className="text-xs font-bold text-slate-600 bg-slate-100 px-2 py-1 rounded-md">
                           Nhp
                        </span>
                      )}
                    </div>
                    <p className="text-xs text-slate-600">
                      {attempt.completedAt
                        ? new Date(attempt.completedAt).toLocaleString('vi-VN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                          })
                        : 'ang lm'}
                    </p>
                  </div>

                  {/* Right: Score & Status */}
                  <div className="flex items-center gap-3 flex-shrink-0">
                    {/* Stats */}
                    <div className="text-right">
                      <p className="text-2xl font-bold text-slate-900">
                        {attempt.score?.toFixed(0)}%
                      </p>
                      <p className="text-xs text-slate-500 mt-0.5">
                        {correct}/{total}
                      </p>
                    </div>

                    {/* Icon Status */}
                    {attempt.score >= 70 ? (
                      <div className="p-2 bg-emerald-50 rounded-lg">
                        <CheckCircle className="w-5 h-5 text-emerald-600" strokeWidth={1.5} />
                      </div>
                    ) : (
                      <div className="p-2 bg-rose-50 rounded-lg">
                        <XCircle className="w-5 h-5 text-rose-600" strokeWidth={1.5} />
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {/* Performance Summary */}
      {attempts.length > 2 && (
        <div className="bg-indigo-50 border border-indigo-200 rounded-xl p-4">
          <p className="text-sm font-semibold text-indigo-900 mb-2">
             Phn tch hiu sut
          </p>
          <div className="grid grid-cols-2 gap-3 text-xs text-indigo-800">
            <div>
              <p className="text-slate-600 text-xs mb-1">im trung bnh</p>
              <p className="font-bold text-lg">
                {(attempts.reduce((sum, a) => sum + a.score, 0) / attempts.length).toFixed(1)}%
              </p>
            </div>
            <div>
              <p className="text-slate-600 text-xs mb-1">Ci thin</p>
              <p className={`font-bold text-lg ${
                bestAttempt.score > latestAttempt.score 
                  ? 'text-amber-600' 
                  : 'text-emerald-600'
              }`}>
                {Math.abs(bestAttempt.score - attempts[attempts.length - 1].score).toFixed(1)}%
              </p>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/Display/ResultsDisplay.jsx">
import React, { useState, useMemo } from 'react';
import { Trophy, Target, CheckCircle, XCircle, RotateCcw, Award, TrendingUp, Flame, Award as AwardIcon, ArrowRight } from 'lucide-react';
import ExplanationSection from './ExplanationDisplay';

/**
 * ==========================================
 * RESULTS DISPLAY - EXPERT PROFESSIONAL
 * ==========================================
 * 
 * Design Philosophy:
 * - Visual Hierarchy & Gestalt Principles
 * - Color Psychology for emotional engagement
 * - Minimalism with luxury refinement
 * - Marketing Psychology & Conversion Optimization
 * - Pixel-perfect responsive design
 */

// ==========================================
// SUB-COMPONENT: Score Card
// ==========================================
const ScoreCard = ({ icon: Icon, label, value, suffix, accentColor, bgColor }) => (
  <article className={`${bgColor} rounded-2xl border border-slate-200 p-6 md:p-8 text-center shadow-sm hover:shadow-md transition-shadow duration-300`}>
    <div className="flex justify-center mb-4">
      <div className={`w-14 h-14 rounded-xl bg-gradient-to-br ${accentColor} flex items-center justify-center shadow-md`}>
        <Icon className="w-7 h-7 text-white" strokeWidth={2} />
      </div>
    </div>
    
    <p className="text-sm font-semibold text-slate-600 uppercase tracking-wider mb-2">
      {label}
    </p>
    
    <p className="text-4xl md:text-5xl font-bold text-slate-900 mb-1">
      {value}
      <span className="text-2xl md:text-3xl text-slate-400 font-semibold ml-1.5">
        {suffix}
      </span>
    </p>
  </article>
);

// ==========================================
// SUB-COMPONENT: Performance Badge
// ==========================================
const PerformanceBadge = ({ performance, score }) => {
  const bgGradients = {
    emerald: 'from-emerald-50 to-emerald-50/70 border-emerald-300',
    teal: 'from-teal-50 to-teal-50/70 border-teal-300',
    blue: 'from-blue-50 to-blue-50/70 border-blue-300',
    amber: 'from-amber-50 to-amber-50/70 border-amber-300',
    orange: 'from-orange-50 to-orange-50/70 border-orange-300',
    red: 'from-red-50 to-red-50/70 border-red-300'
  };

  const textColors = {
    emerald: 'text-emerald-900',
    teal: 'text-teal-900',
    blue: 'text-blue-900',
    amber: 'text-amber-900',
    orange: 'text-orange-900',
    red: 'text-red-900'
  };

  const iconGradients = {
    emerald: 'from-emerald-600 to-emerald-500',
    teal: 'from-teal-600 to-teal-500',
    blue: 'from-blue-600 to-blue-500',
    amber: 'from-amber-600 to-amber-500',
    orange: 'from-orange-600 to-orange-500',
    red: 'from-red-600 to-red-500'
  };

  return (
    <div className={`bg-gradient-to-br ${bgGradients[performance.color]} border-2 rounded-2xl p-6 md:p-8 text-center`}>
      <div className="flex justify-center mb-4">
        <div className={`text-5xl md:text-6xl filter drop-shadow-lg`}>
          {performance.emoji}
        </div>
      </div>
      
      <p className={`text-2xl md:text-3xl font-bold ${textColors[performance.color]} mb-2`}>
        {performance.label}
      </p>
      
      <p className="text-sm font-semibold text-slate-600 uppercase tracking-wider">
        {score.percentage.toFixed(0)}% chnh xc
      </p>
    </div>
  );
};

// ==========================================
// SUB-COMPONENT: Progress Ring
// ==========================================
const ProgressRing = ({ percentage, size = 120 }) => {
  const radius = size / 2 - 8;
  const circumference = radius * 2 * Math.PI;
  const offset = circumference - (percentage / 100) * circumference;

  const getColor = (pct) => {
    if (pct >= 90) return '#10b981';
    if (pct >= 80) return '#14b8a6';
    if (pct >= 70) return '#0ea5e9';
    if (pct >= 60) return '#f59e0b';
    if (pct >= 50) return '#f97316';
    return '#ef4444';
  };

  return (
    <div className="relative inline-flex items-center justify-center">
      <svg width={size} height={size} className="transform -rotate-90">
        {/* Background circle */}
        <circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          stroke="#e2e8f0"
          strokeWidth="8"
          fill="none"
        />
        {/* Progress circle */}
        <circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          stroke={getColor(percentage)}
          strokeWidth="8"
          fill="none"
          strokeDasharray={circumference}
          strokeDashoffset={offset}
          strokeLinecap="round"
          style={{ transition: 'stroke-dashoffset 1.2s ease-out' }}
        />
      </svg>
      
      {/* Center text */}
      <div className="absolute text-center">
        <p className="text-2xl md:text-3xl font-bold text-slate-900">
          {percentage.toFixed(0)}%
        </p>
        <p className="text-xs font-semibold text-slate-600 uppercase tracking-wider mt-1">
          t c
        </p>
      </div>
    </div>
  );
};

// ==========================================
// SUB-COMPONENT: Quick Stats
// ==========================================
const QuickStat = ({ icon: Icon, label, value, color }) => (
  <div className={`bg-gradient-to-br from-${color}-50 to-${color}-50/70 rounded-xl border border-${color}-200 p-4 md:p-5`}>
    <div className="flex items-center gap-3">
      <div className={`w-10 h-10 rounded-lg bg-${color}-100 flex items-center justify-center flex-shrink-0`}>
        <Icon className={`w-5 h-5 text-${color}-700`} strokeWidth={2.2} />
      </div>
      
      <div>
        <p className={`text-xs font-semibold text-${color}-700 uppercase tracking-wider`}>
          {label}
        </p>
        <p className={`text-2xl md:text-3xl font-bold text-${color}-900 mt-0.5`}>
          {value}
        </p>
      </div>
    </div>
  </div>
);

// ==========================================
// SUB-COMPONENT: Answer Review Card
// ==========================================
const AnswerReviewCard = ({ question, isCorrect, userAnswer, correctAnswer, options }) => {
  const [expanded, setExpanded] = useState(false);

  const userAnswerText = userAnswer !== undefined ? String.fromCharCode(65 + userAnswer) : 'Cha chn';
  const correctAnswerText = String.fromCharCode(65 + correctAnswer);

  return (
    <article 
      className={`
        rounded-xl border-2 overflow-hidden transition-all duration-200
        ${isCorrect
          ? 'bg-emerald-50/80 border-emerald-300 hover:shadow-md'
          : 'bg-red-50/80 border-red-300 hover:shadow-md'
        }
      `}
    >
      {/* Header */}
      <button
        onClick={() => setExpanded(!expanded)}
        className="w-full p-4 md:p-5 flex items-start gap-4 text-left hover:bg-black/5 transition-colors"
      >
        {/* Status Icon */}
        <div className={`
          w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center flex-shrink-0 
          ${isCorrect ? 'bg-emerald-500' : 'bg-red-500'}
        `}>
          {isCorrect ? (
            <CheckCircle className="w-5 h-5 md:w-6 md:h-6 text-white" strokeWidth={2.5} />
          ) : (
            <XCircle className="w-5 h-5 md:w-6 md:h-6 text-white" strokeWidth={2.5} />
          )}
        </div>

        {/* Question Info */}
        <div className="flex-1 min-w-0">
          <p className={`font-bold text-sm md:text-base mb-2 ${isCorrect ? 'text-emerald-900' : 'text-red-900'}`}>
            Cu {question.id}: {question.question}
          </p>

          {/* Answer Summary */}
          <div className="flex flex-wrap items-center gap-2">
            <span className="text-xs font-semibold text-slate-700">Bn chn:</span>
            <span className={`
              text-xs font-bold px-3 py-1 rounded-full text-white
              ${isCorrect ? 'bg-emerald-500' : 'bg-red-500'}
            `}>
              ({userAnswerText}) {options?.[userAnswer]?.substring(0, 20) || 'Cha chn'}
            </span>

            {!isCorrect && (
              <>
                <span className="text-xs font-semibold text-slate-700">| p n:</span>
                <span className="text-xs font-bold px-3 py-1 rounded-full bg-emerald-500 text-white">
                  ({correctAnswerText}) {options?.[correctAnswer]?.substring(0, 20)}
                </span>
              </>
            )}
          </div>
        </div>

        {/* Expand Indicator */}
        <div className={`flex-shrink-0 transition-transform duration-300 ${expanded ? 'rotate-180' : ''}`}>
          <ArrowRight className="w-5 h-5 text-slate-400" strokeWidth={2} />
        </div>
      </button>

      {/* Explanation Section */}
      {expanded && question.explanation && (
        <div className="border-t border-slate-300/50 px-4 md:px-5 py-4 md:py-5 bg-black/2.5">
          <ExplanationSection 
            explanation={question.explanation}
            question={question.question}
            userAnswer={userAnswer}
            correctAnswer={correctAnswer}
            isCorrect={isCorrect}
            questionId={question.id}
            options={question.options}
          />
        </div>
      )}
    </article>
  );
};

// ==========================================
// SUB-COMPONENT: Motivational Message
// ==========================================
const MotivationalMessage = ({ score }) => {
  const getMotivation = (percentage) => {
    if (percentage >= 90) {
      return {
        emoji: '',
        title: 'Xut sc!',
        message: 'Bn  lm rt tuyt vi! Kin thc ca bn rt vng chc.',
        color: 'emerald'
      };
    }
    if (percentage >= 80) {
      return {
        emoji: '',
        title: 'Rt tt!',
        message: 'Tuyt vi! Tip tc pht huy v c gng vt qua 90%.',
        color: 'teal'
      };
    }
    if (percentage >= 70) {
      return {
        emoji: '',
        title: 'Kh tt!',
        message: 'Bn ang trn ng ng. Hy luyn tp thm nhng phn yu.',
        color: 'blue'
      };
    }
    if (percentage >= 60) {
      return {
        emoji: '',
        title: 'Vn c!',
        message: 'Mi ln luyn tp bn s tin b hn. Tip tc c gng!',
        color: 'amber'
      };
    }
    return {
      emoji: '',
      title: 'ng nn lng!',
      message: 'y l bc u tin ca hnh trnh. C tip tc luyn tp!',
      color: 'orange'
    };
  };

  const motivation = getMotivation(score.percentage);

  return (
    <div className={`
      bg-gradient-to-br from-${motivation.color}-50 to-${motivation.color}-50/70
      border-2 border-${motivation.color}-300
      rounded-2xl p-6 md:p-8 text-center
    `}>
      <p className="text-5xl md:text-6xl mb-3 filter drop-shadow-lg">
        {motivation.emoji}
      </p>
      
      <h3 className={`text-2xl md:text-3xl font-bold text-${motivation.color}-900 mb-2`}>
        {motivation.title}
      </h3>
      
      <p className={`text-base font-[450] text-${motivation.color}-800 mb-4`}>
        {motivation.message}
      </p>
      
      <p className="text-sm font-semibold text-slate-600 uppercase tracking-wider">
        Luyn tp u n = Tin b nhanh 
      </p>
    </div>
  );
};

// ==========================================
// SUB-COMPONENT: Action Buttons
// ==========================================
const ActionButtons = ({ onReset }) => (
  <div className="flex flex-col sm:flex-row gap-4">
    <button
      onClick={onReset}
      className={`
        flex-1 flex items-center justify-center gap-2.5
        px-6 py-4 rounded-xl
        bg-gradient-to-r from-blue-700 to-blue-600
        hover:from-blue-800 hover:to-blue-700
        text-white font-bold text-base
        shadow-md hover:shadow-lg
        transition-all duration-300
        active:scale-95
      `}
    >
      <RotateCcw className="w-5 h-5" strokeWidth={2.2} />
      <span>Lm li bi ny</span>
      <ArrowRight className="w-4 h-4 opacity-60" strokeWidth={2.2} />
    </button>

    <button
      onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
      className={`
        flex-1 flex items-center justify-center gap-2.5
        px-6 py-4 rounded-xl
        bg-white hover:bg-slate-50
        text-slate-900 font-bold text-base
        border-2 border-slate-200 hover:border-slate-300
        shadow-sm hover:shadow-md
        transition-all duration-300
        active:scale-95
      `}
    >
      <Target className="w-5 h-5" strokeWidth={2.2} />
      <span>Chn bi khc</span>
    </button>
  </div>
);

// ==========================================
// MAIN COMPONENT: ResultsDisplay
// ==========================================
const ResultsDisplay = ({ score, partData, answers, onReset }) => {
  if (!partData) return null;

  // ===== COMPUTED VALUES =====
  const getPerformanceLevel = (percentage) => {
    if (percentage >= 90) return { label: 'Xut sc', color: 'emerald', emoji: '' };
    if (percentage >= 80) return { label: 'Rt tt', color: 'teal', emoji: '' };
    if (percentage >= 70) return { label: 'Tt', color: 'blue', emoji: '' };
    if (percentage >= 60) return { label: 'Kh', color: 'amber', emoji: '' };
    if (percentage >= 50) return { label: 'Trung bnh', color: 'orange', emoji: '' };
    return { label: 'Cn c gng', color: 'red', emoji: '' };
  };

  const performance = useMemo(() => getPerformanceLevel(score.percentage), [score.percentage]);
  const wrongCount = useMemo(() => score.total - score.correct, [score.total, score.correct]);

  // ===== RENDER =====
  return (
    <div className="relative min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50 overflow-hidden">
      
      {/* Ambient Background */}
      <div className="absolute inset-0 pointer-events-none overflow-hidden">
        <div className="absolute top-0 right-0 w-96 h-96 bg-blue-100/20 rounded-full blur-3xl" />
        <div className="absolute bottom-0 left-0 w-96 h-96 bg-emerald-100/20 rounded-full blur-3xl" />
      </div>

      {/* Main Content */}
      <div className="relative z-10 max-w-6xl mx-auto px-4 sm:px-6 py-8 md:py-12 space-y-8 md:space-y-10">
        
        {/* ===== HERO SECTION ===== */}
        <div className="text-center space-y-4">
          <div className="flex justify-center mb-4">
            <div className="relative">
              <div className="absolute inset-0 bg-gradient-to-r from-blue-600 to-emerald-500 rounded-full blur-2xl opacity-20" />
              <Trophy className="w-20 h-20 md:w-24 md:h-24 text-blue-700 relative" strokeWidth={1.5} />
            </div>
          </div>

          <h1 className="text-4xl md:text-5xl font-bold text-slate-900 tracking-tight">
            Kt qu bi thi
          </h1>

          <p className="text-base md:text-lg text-slate-600 font-[450] max-w-2xl mx-auto">
            Xem chi tit tng cu hi v nhng lnh vc cn ci thin
          </p>
        </div>

        {/* ===== SCORE CARDS - GRID ===== */}
        <div className="grid grid-cols-1 sm:grid-cols-3 gap-5 md:gap-6">
          <ScoreCard
            icon={CheckCircle}
            label="Kt qu"
            value={score.correct}
            suffix={`/${score.total}`}
            accentColor="from-blue-700 to-blue-600"
            bgColor="bg-white"
          />

          <ScoreCard
            icon={TrendingUp}
            label="T l"
            value={score.percentage.toFixed(0)}
            suffix="%"
            accentColor="from-emerald-700 to-emerald-600"
            bgColor="bg-white"
          />

          <PerformanceBadge 
            performance={performance}
            score={score}
          />
        </div>

        {/* ===== PROGRESS RING & STATS ===== */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
          
          {/* Progress Ring */}
          <div className="lg:col-span-1 flex justify-center items-center bg-white rounded-2xl border border-slate-200 p-6 md:p-8 shadow-sm">
            <ProgressRing percentage={score.percentage} size={160} />
          </div>

          {/* Stats Grid */}
          <div className="lg:col-span-2 grid grid-cols-2 gap-4 md:gap-5">
            <QuickStat
              icon={CheckCircle}
              label="ng"
              value={score.correct}
              color="emerald"
            />
            <QuickStat
              icon={XCircle}
              label="Sai"
              value={wrongCount}
              color="red"
            />
            <QuickStat
              icon={Award}
              label="Xp loi"
              value={performance.label}
              color={performance.color}
            />
            <QuickStat
              icon={Flame}
              label=" kh"
              value={score.percentage >= 80 ? 'D' : score.percentage >= 50 ? 'Va' : 'Kh'}
              color={score.percentage >= 80 ? 'blue' : score.percentage >= 50 ? 'amber' : 'red'}
            />
          </div>
        </div>

        {/* ===== MOTIVATIONAL MESSAGE ===== */}
        <MotivationalMessage score={score} />

        {/* ===== ACTION BUTTONS ===== */}
        <ActionButtons onReset={onReset} />

        {/* ===== ANSWERS REVIEW SECTION ===== */}
        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
          
          {/* Header */}
          <div className="px-6 md:px-8 py-5 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-white">
            <div className="flex items-center justify-between gap-4">
              <h2 className="text-2xl md:text-3xl font-bold text-slate-900">
                Chi tit p n
              </h2>
              <span className="text-sm font-bold text-slate-600 bg-slate-100 px-4 py-2 rounded-full">
                {partData.questions.length} cu
              </span>
            </div>
          </div>

          {/* Answers List */}
          <div className="px-6 md:px-8 py-6 md:py-8 space-y-3 md:space-y-4">
            {partData.questions.map((q, index) => {
              const isCorrect = answers[q.id] === q.correct;
              const userAnswer = answers[q.id];

              return (
                <AnswerReviewCard
                  key={q.id}
                  question={q}
                  isCorrect={isCorrect}
                  userAnswer={userAnswer}
                  correctAnswer={q.correct}
                  options={q.options}
                />
              );
            })}
          </div>
        </div>

        {/* ===== FOOTER ===== */}
        <div className="text-center py-4 border-t border-slate-200">
          <p className="text-sm font-semibold text-slate-600 uppercase tracking-wider">
             Luyn tp thm  nng cao im s
          </p>
        </div>
      </div>
    </div>
  );
};

export default ResultsDisplay;
</file>

<file path="src/components/footer/Footer.css">

</file>

<file path="src/components/hooks/useScriptParser.js">
import { useMemo } from 'react';

export const useScriptParser = (script) => {
  //  Parse script v tnh ton speakers + counts trong 1 ln duyt
  const { parsedScript, speakers, speakerCounts } = useMemo(() => {
    // Early return cho cc trng hp khng hp l
    if (!script || typeof script !== 'string') {
      return { parsedScript: [], speakers: [], speakerCounts: {} };
    }

    //  Ti u: S dng regex compiled mt ln
    const SPEAKER_PATTERN = /^([A-Za-z\s\d\-]+(?:\s*\([A-Z0-9]\))?)\s*:\s*(.+)$/;
    const SPEAKER_LABEL_PATTERN = /\s*\([A-Z0-9]\)\s*$/;
    
    // Preprocessing: Split v filter trong 1 bc
    const lines = script
      .split('\n')
      .map(line => line.trim())
      .filter(Boolean);

    // Nu khng c lines hp l
    if (lines.length === 0) {
      return { parsedScript: [], speakers: [], speakerCounts: {} };
    }

    //  Parse conversations
    const conversations = [];
    const speakerSet = new Set();
    const counts = {};
    
    let currentSpeaker = null;
    let currentText = '';

    // Helper function  push conversation
    const pushConversation = () => {
      if (currentSpeaker && currentText) {
        const trimmedText = currentText.trim();
        if (trimmedText) {
          conversations.push({ 
            speaker: currentSpeaker, 
            text: trimmedText 
          });
          
          //  Tnh ton speakers v counts ngay trong qu trnh parse
          speakerSet.add(currentSpeaker);
          counts[currentSpeaker] = (counts[currentSpeaker] || 0) + 1;
        }
      }
    };

    // Main parsing loop
    for (let i = 0; i < lines.length; i++) {
      const line = lines[i];
      const match = line.match(SPEAKER_PATTERN);

      if (match) {
        // Tm thy dng mi vi speaker
        pushConversation();
        
        // Clean speaker name (remove label nh (A), (B))
        currentSpeaker = match[1].replace(SPEAKER_LABEL_PATTERN, '').trim();
        currentText = match[2].trim();
      } else if (currentSpeaker) {
        // Continuation ca text hin ti
        currentText += ' ' + line;
      } else {
        // Dng khng c speaker  gn cho Narrator
        if (currentText) currentText += ' ';
        currentText += line;
        currentSpeaker = 'Narrator';
      }
    }

    // Push conversation cui cng
    pushConversation();

    //  To sorted speakers list (loi b Narrator)
    const sortedSpeakers = Array.from(speakerSet)
      .filter(speaker => speaker !== 'Narrator')
      .sort();

    return {
      parsedScript: conversations,
      speakers: sortedSpeakers,
      speakerCounts: counts
    };
  }, [script]);

  return { parsedScript, speakers, speakerCounts };
};
</file>

<file path="src/components/hooks/useSpeech.js">
// src/components/hooks/useSpeech.js
import { useState, useEffect, useCallback, useRef } from 'react';

export const useSpeech = () => {
    const synth = window.speechSynthesis;
    const [playingId, setPlayingId] = useState(null);
    const [sentenceId, setSentenceId] = useState(null); // <-- THM DNG NY
    const [isSupported, setIsSupported] = useState(true);
    const [error, setError] = useState(null);
    const [rate, setRate] = useState(0.8);
    const [pitch, setPitch] = useState(1);
    const voicesRef = useRef([]);

    useEffect(() => {
        if (!synth) {
            setIsSupported(false);
            return;
        }
        const updateVoices = () => {
            voicesRef.current = synth.getVoices();
        };
        updateVoices();
        synth.addEventListener('voiceschanged', updateVoices);
        return () => synth.removeEventListener('voiceschanged', updateVoices);
    }, [synth]);

    const getVoiceByLanguage = useCallback((lang = 'en') => {
        if (!voicesRef.current.length) return null;
        let voice = voicesRef.current.find(v => v.lang.startsWith(lang));
        if (!voice && lang !== 'en') voice = voicesRef.current.find(v => v.lang.includes('en'));
        return voice || voicesRef.current[0];
    }, []);

    const speak = useCallback((text, id = null, lang = 'en', isSentence = false) => {
        if (!isSupported || !text) return;

        try {
            setError(null);
            synth.cancel();

            // X l ring cho cu v d
            if (isSentence) {
                if (sentenceId === id) {
                    setSentenceId(null);
                    return;
                }
                setSentenceId(id);
            } else {
                if (playingId === id) {
                    setPlayingId(null);
                    return;
                }
                setPlayingId(id);
            }

            const utterance = new SpeechSynthesisUtterance(text);
            const voice = getVoiceByLanguage(lang);
            if (voice) utterance.voice = voice;
            utterance.rate = rate;
            utterance.pitch = pitch;
            utterance.lang = lang;

            utterance.onend = () => {
                if (isSentence) setSentenceId(null);
                else setPlayingId(null);
            };
            utterance.onerror = (event) => {
                setError(`Speech error: ${event.error}`);
                if (isSentence) setSentenceId(null);
                else setPlayingId(null);
            };

            synth.speak(utterance);
        } catch (err) {
            setError(err.message);
            setPlayingId(null);
            setSentenceId(null);
        }
    }, [synth, playingId, sentenceId, isSupported, rate, pitch, getVoiceByLanguage]);

    const stop = useCallback(() => {
        synth.cancel();
        setPlayingId(null);
        setSentenceId(null);
    }, [synth]);

    const pause = useCallback(() => {
        synth.paused ? synth.resume() : synth.pause();
    }, [synth]);

    useEffect(() => () => synth?.cancel(), [synth]);

    return {
        speak,
        stop,
        pause,
        playingId,
        sentenceId, // <-- TR V
        isSupported,
        error,
        rate,
        setRate,
        pitch,
        setPitch,
        voices: voicesRef.current,
    };
};
</file>

<file path="src/components/hooks/useTextToSpeechWithExpression.js">
import { useState, useCallback, useRef, useEffect } from 'react';
import { useVoiceExpression } from './useVoiceExpression';
import { VOICE_EMOTIONS } from '../config/voiceExpression';


export const useTextToSpeechWithExpression = ({
  getSpeakerVoice,
  synthRef,
  isScriptPlaying,
  filteredConversations
}) => {
  const [currentPlayingIndex, setCurrentPlayingIndex] = useState(-1);
  const [playingTime, setPlayingTime] = useState(0);
  const [isPaused, setIsPaused] = useState(false);
  const [globalEmotion, setGlobalEmotion] = useState('NEUTRAL');
  const [enableExpression, setEnableExpression] = useState(true);

  const utteranceQueueRef = useRef([]);
  const currentUtteranceRef = useRef(null);
  const isPlayingRef = useRef(false);
  const pausedUtteranceRef = useRef(null);
  const metricsRef = useRef({
    totalUtterances: 0,
    emotionsUsed: {},
    emphasisCount: 0
  });

  const { 
    applyVoiceExpression,
    createExpressionUtterance,
    extractEmotionMarker
  } = useVoiceExpression();

  // Clean up utterance
  const cleanupUtterance = useCallback(() => {
    if (currentUtteranceRef.current) {
      currentUtteranceRef.current.onend = null;
      currentUtteranceRef.current.onerror = null;
      currentUtteranceRef.current = null;
    }
  }, []);

  // Stop all speech
  const stopAllSpeech = useCallback(() => {
    try {
      if (synthRef.current) {
        synthRef.current.cancel();
      }
    } catch (err) {
      console.error('Error stopping speech:', err);
    }
  }, [synthRef]);

  // Pause speech
  const pauseScript = useCallback(() => {
    if (!synthRef.current) return;

    try {
      if (synthRef.current.speaking && !synthRef.current.paused) {
        pausedUtteranceRef.current = currentUtteranceRef.current;
        synthRef.current.pause();
        setIsPaused(true);
        isPlayingRef.current = false;
      }
    } catch (err) {
      console.error('Error pausing speech:', err);
      stopAllSpeech();
    }
  }, [synthRef, stopAllSpeech]);

  // Resume speech
  const resumeScript = useCallback(() => {
    if (!synthRef.current) return;

    try {
      if (synthRef.current.paused) {
        synthRef.current.resume();
        setIsPaused(false);
        isPlayingRef.current = true;
      }
    } catch (err) {
      console.error('Error resuming speech:', err);
    }
  }, [synthRef]);

  // Stop and reset
  const stopScript = useCallback(() => {
    stopAllSpeech();
    cleanupUtterance();
    utteranceQueueRef.current = [];
    pausedUtteranceRef.current = null;
    setCurrentPlayingIndex(-1);
    setPlayingTime(0);
    setIsPaused(false);
    isPlayingRef.current = false;
  }, [stopAllSpeech, cleanupUtterance]);

  // Play next with expression
  const speakNextInQueue = useCallback(() => {
    if (!synthRef.current || currentUtteranceRef.current) {
      return;
    }

    if (utteranceQueueRef.current.length === 0) {
      if (isPlayingRef.current) {
        setCurrentPlayingIndex(-1);
        setPlayingTime(0);
        isPlayingRef.current = false;
      }
      return;
    }

    const next = utteranceQueueRef.current.shift();
    if (!next) return;

    // Find index in filtered conversations
    const newIndex = filteredConversations.findIndex(
      conv => conv.text === next.text && conv.speaker === next.speaker
    );

    if (newIndex !== -1) {
      setCurrentPlayingIndex(newIndex);
    }

    // Get voice for speaker
    const voice = getSpeakerVoice(next.speaker);
    if (!voice) {
      console.warn(`No voice available for ${next.speaker}`);
      return speakNextInQueue();
    }

    try {
      // p dng voice expression
      const expressionResult = enableExpression
        ? applyVoiceExpression(next.text, next.options)
        : {
            params: next.options,
            text: next.text,
            emotion: 'NEUTRAL',
            hasEmphasis: false
          };

      // Track metrics
      metricsRef.current.totalUtterances++;
      metricsRef.current.emotionsUsed[expressionResult.emotion] = 
        (metricsRef.current.emotionsUsed[expressionResult.emotion] || 0) + 1;
      if (expressionResult.hasEmphasis) {
        metricsRef.current.emphasisCount++;
      }

      // Create utterance with expression
      const utterance = new SpeechSynthesisUtterance(expressionResult.text);
      utterance.voice = voice;
      utterance.rate = expressionResult.params.rate;
      utterance.pitch = expressionResult.params.pitch;
      utterance.volume = expressionResult.params.volume;
      utterance.lang = voice.lang;

      currentUtteranceRef.current = utterance;
      setPlayingTime(prev => prev + 1);

      utterance.onend = () => {
        cleanupUtterance();
        speakNextInQueue();
      };

      utterance.onerror = (event) => {
        console.error('Utterance error:', event.error);
        cleanupUtterance();
        speakNextInQueue();
      };

      synthRef.current.speak(utterance);
    } catch (err) {
      console.error('Error creating utterance:', err);
      cleanupUtterance();
      speakNextInQueue();
    }
  }, [synthRef, getSpeakerVoice, filteredConversations, cleanupUtterance, enableExpression, applyVoiceExpression]);

  // Queue conversations with expression support
  const queueConversations = useCallback((conversations, getTTSOptions) => {
    if (!synthRef.current) return false;

    try {
      stopAllSpeech();
      cleanupUtterance();
      utteranceQueueRef.current = [];
      pausedUtteranceRef.current = null;
      setPlayingTime(0);

      const queue = conversations.map(conv => {
        // Extract emotion marker if exists
        const { emotion, cleanText } = extractEmotionMarker(conv.text);
        const emotionToUse = emotion || (globalEmotion !== 'NEUTRAL' ? VOICE_EMOTIONS[globalEmotion] : null);

        return {
          text: conv.text,
          cleanText: cleanText,
          speaker: conv.speaker,
          options: getTTSOptions(conv.speaker),
          emotion: emotionToUse
        };
      });

      utteranceQueueRef.current = queue;
      isPlayingRef.current = true;
      return queue.length > 0;
    } catch (err) {
      console.error('Error queueing conversations:', err);
      return false;
    }
  }, [synthRef, stopAllSpeech, cleanupUtterance, globalEmotion, extractEmotionMarker]);

  // Get expression metrics
  const getExpressionMetrics = useCallback(() => {
    const { totalUtterances, emotionsUsed, emphasisCount } = metricsRef.current;
    
    return {
      totalUtterances,
      emphasisCount,
      emotionsUsed,
      emphasisRate: totalUtterances > 0 ? ((emphasisCount / totalUtterances) * 100).toFixed(2) : 0,
      dominantEmotion: Object.entries(emotionsUsed).sort(([, a], [, b]) => b - a)[0]?.[0] || 'NEUTRAL'
    };
  }, []);

  // Reset metrics
  const resetExpressionMetrics = useCallback(() => {
    metricsRef.current = {
      totalUtterances: 0,
      emotionsUsed: {},
      emphasisCount: 0
    };
  }, []);

  // Cleanup on unmount
  useEffect(() => {
    return () => {
      stopScript();
    };
  }, [stopScript]);

  return {
    // State & Control
    currentPlayingIndex,
    setCurrentPlayingIndex,
    playingTime,
    isPaused,
    pauseScript,
    resumeScript,
    stopScript,
    speakNextInQueue,
    queueConversations,

    // Expression controls
    globalEmotion,
    setGlobalEmotion,
    enableExpression,
    setEnableExpression,

    // Metrics
    getExpressionMetrics,
    resetExpressionMetrics,

    // Internal refs
    utteranceQueueRef,
    currentUtteranceRef
  };
};
</file>

<file path="src/components/hooks/useVoiceExpression.js">
import { useCallback, useMemo, useRef, useEffect } from 'react';
import {
  VOICE_EMOTIONS,
  EMPHASIS_PATTERNS,
  PAUSE_PATTERNS,
  detectEmotionFromText,
  getFinalVoiceParams,
  cleanTextMarkers,
  addPausesToText,
  extractEmotionMarker as extractEmotionMarkerConfig,
  extractStressWords,
  validateVoiceParams,
  debugEmotionDetection,
  getCacheStats
} from '../config/voiceExpression';

/**
 *  OPTIMIZED: useVoiceExpression Hook
 * Ci thin: performance, memory management, type safety, debugging
 */
export const useVoiceExpression = (enableDebug = false) => {
  const expressionCacheRef = useRef(new Map());
  const utteranceCacheRef = useRef(new Map());
  const maxCacheSize = 150; //  IMPROVEMENT: Configurable cache size

  // ==================== 1. PERFORMANCE IMPROVEMENTS ====================

  /**
   *  IMPROVEMENT: Memoize emotions  trnh recompute
   */
  const memoizedEmotions = useMemo(() => {
    return Object.entries(VOICE_EMOTIONS).map(([key, emotion]) => ({
      key,
      ...emotion
    }));
  }, []);

  /**
   *  IMPROVEMENT: Memoize emphasis patterns
   */
  const memoizedPatterns = useMemo(() => {
    return Object.entries(EMPHASIS_PATTERNS).map(([key, pattern]) => ({
      key,
      ...pattern
    }));
  }, []);

  // ==================== 2. CACHE MANAGEMENT ====================

  /**
   *  NEW: LRU Cache implementation (Least Recently Used)
   * Trnh memory leak t unlimited cache growth
   */
  const addToCache = useCallback((cacheRef, key, value) => {
    // Remove oldest if at capacity
    if (cacheRef.current.size >= maxCacheSize) {
      const firstKey = cacheRef.current.keys().next().value;
      cacheRef.current.delete(firstKey);
    }
    cacheRef.current.set(key, value);
  }, [maxCacheSize]);

  /**
   *  NEW: Get from cache with LRU (move to end = most recently used)
   */
  const getFromCache = useCallback((cacheRef, key) => {
    if (!cacheRef.current.has(key)) return null;
    
    const value = cacheRef.current.get(key);
    // Move to end (most recently used)
    cacheRef.current.delete(key);
    cacheRef.current.set(key, value);
    return value;
  }, []);

  /**
   *  NEW: Clear all caches
   */
  const clearAllCaches = useCallback(() => {
    expressionCacheRef.current.clear();
    utteranceCacheRef.current.clear();
    if (enableDebug) console.log(' All caches cleared');
  }, [enableDebug]);

  /**
   *  NEW: Get cache statistics
   */
  const getCacheInfo = useCallback(() => {
    return {
      expressionCache: expressionCacheRef.current.size,
      utteranceCache: utteranceCacheRef.current.size,
      totalCached: expressionCacheRef.current.size + utteranceCacheRef.current.size,
      estimatedMemory: `~${(expressionCacheRef.current.size * 0.3 + utteranceCacheRef.current.size * 0.5).toFixed(1)}KB`
    };
  }, []);

  // ==================== 3. CORE FUNCTIONS ====================

  /**
   *  IMPROVED: Extract emotion marker (use config version)
   */
  const extractEmotionMarker = useCallback((text) => {
    if (!text || typeof text !== 'string') {
      return { emotion: null, cleanText: text };
    }
    return extractEmotionMarkerConfig(text);
  }, []);

  /**
   *  IMPROVED: Apply voice expression with better caching
   */
  const applyVoiceExpression = useCallback((text, baseParams, options = {}) => {
    if (!text || !baseParams) {
      return { params: baseParams, text: '', emotion: 'Neutral', hasEmphasis: false };
    }

    //  IMPROVEMENT: Simple cache key (avoid JSON.stringify overhead)
    const cacheKey = `${text}|${baseParams.rate}|${baseParams.pitch}|${baseParams.volume}`;
    
    // Check cache with LRU
    const cached = getFromCache(expressionCacheRef, cacheKey);
    if (cached) return cached;

    // Extract emotion marker
    const { emotion, cleanText } = extractEmotionMarker(text);

    // Get final voice parameters
    const finalParams = getFinalVoiceParams(baseParams, cleanText, emotion);

    //  IMPROVEMENT: Validate params
    const { valid, issues } = validateVoiceParams(finalParams);
    if (!valid && enableDebug) {
      console.warn(' Voice params invalid:', issues);
    }

    // Check for emphasis patterns
    const hasEmphasis = memoizedPatterns.some(p => p.pattern.test(cleanText));

    const result = {
      params: finalParams,
      text: cleanTextMarkers(cleanText),
      emotion: emotion?.label || 'Neutral',
      hasEmphasis,
      stressWords: options.includeStress ? extractStressWords(cleanText) : [],
      valid
    };

    // Add to cache with LRU
    addToCache(expressionCacheRef, cacheKey, result);

    return result;
  }, [getFromCache, extractEmotionMarker, memoizedPatterns, addToCache, enableDebug]);

  /**
   *  IMPROVED: Create utterance with better error handling
   */
  const createExpressionUtterance = useCallback((text, baseParams, voice, options = {}) => {
    if (!text || !baseParams) {
      console.error(' Missing required params for utterance creation');
      return null;
    }

    // Check cache
    const cacheKey = `${text}|${voice?.name || 'default'}`;
    const cached = getFromCache(utteranceCacheRef, cacheKey);
    if (cached) return cached;

    // Apply expression
    const { params, text: cleanText } = applyVoiceExpression(text, baseParams, options);

    try {
      const utterance = new SpeechSynthesisUtterance(cleanText);
      utterance.voice = voice;
      utterance.rate = params.rate;
      utterance.pitch = params.pitch;
      utterance.volume = params.volume;
      utterance.lang = voice?.lang || options.lang || 'en-US';

      //  IMPROVEMENT: Add event listeners for debugging
      if (enableDebug) {
        utterance.onstart = () => console.log(' Speech started:', text);
        utterance.onend = () => console.log(' Speech ended');
        utterance.onerror = (e) => console.error(' Speech error:', e);
      }

      // Cache it
      addToCache(utteranceCacheRef, cacheKey, utterance);

      return utterance;
    } catch (error) {
      console.error(' Failed to create utterance:', error);
      return null;
    }
  }, [applyVoiceExpression, getFromCache, addToCache, enableDebug]);

  /**
   *  IMPROVED: Break text by expression with validation
   */
  const breakTextByExpression = useCallback((text) => {
    if (!text || typeof text !== 'string') return [];

    const chunks = text.split(/(?=\{[A-Z_]+\})/);

    return chunks
      .filter(chunk => chunk.trim())
      .map((chunk, index) => {
        const { emotion, cleanText } = extractEmotionMarker(chunk);
        return {
          index,
          text: cleanText.trim(),
          emotion: emotion?.label || 'Neutral',
          hasMarker: !!emotion,
          length: cleanText.trim().length
        };
      });
  }, [extractEmotionMarker]);

  /**
   *  IMPROVED: Analyze suggestions with more details
   */
  const analyzeSuggestions = useCallback((text) => {
    if (!text || typeof text !== 'string') return [];

    const suggestions = [];

    //  IMPROVEMENT: Pre-compiled regex test
    if (/[A-Z]{2,}/.test(text)) {
      suggestions.push({ type: 'emphasis', message: 'Uppercase found - will add emphasis' });
    }

    if (/!/.test(text)) {
      suggestions.push({ type: 'exclamation', message: 'Exclamation - will raise pitch' });
    }

    if (/\?/.test(text)) {
      suggestions.push({ type: 'question', message: 'Question mark - will adjust intonation' });
    }

    if (/\.{2,}|/.test(text)) {
      suggestions.push({ type: 'pause', message: 'Ellipsis detected - will slow down' });
    }

    // Emotion detection
    const emotion = detectEmotionFromText(text);
    if (emotion !== VOICE_EMOTIONS.NEUTRAL) {
      suggestions.push({ 
        type: 'emotion', 
        message: `Emotion detected: ${emotion.label}`,
        details: emotion
      });
    }

    //  NEW: Stress words detection
    const stressWords = extractStressWords(text);
    if (stressWords.length > 0) {
      suggestions.push({
        type: 'stress',
        message: `${stressWords.length} stress word(s): ${stressWords.join(', ')}`
      });
    }

    return suggestions;
  }, []);

  /**
   *  NEW: Detailed debug analysis
   */
  const debugTextExpression = useCallback((text) => {
    if (!enableDebug) {
      console.warn(' Debug mode not enabled. Pass enableDebug=true');
      return null;
    }

    return debugEmotionDetection(text);
  }, [enableDebug]);

  /**
   *  IMPROVED: Get expression stats with memory info
   */
  const getExpressionStats = useCallback(() => {
    return {
      cacheInfo: getCacheInfo(),
      emotionCount: Object.keys(VOICE_EMOTIONS).length,
      patternCount: Object.keys(EMPHASIS_PATTERNS).length,
      pauseTypes: Object.keys(PAUSE_PATTERNS),
      memoizedEmotions: memoizedEmotions.length,
      memoizedPatterns: memoizedPatterns.length
    };
  }, [getCacheInfo, memoizedEmotions, memoizedPatterns]);

  /**
   *  NEW: Batch process multiple texts efficiently
   */
  const batchApplyVoiceExpression = useCallback((texts, baseParams, options = {}) => {
    if (!Array.isArray(texts)) return [];

    return texts.map((text, index) => ({
      index,
      originalText: text,
      result: applyVoiceExpression(text, baseParams, options)
    }));
  }, [applyVoiceExpression]);

  /**
   *  NEW: Get available voices (with caching)
   */
  const getAvailableVoices = useMemo(() => {
    if (typeof window !== 'undefined' && window.speechSynthesis) {
      return window.speechSynthesis.getVoices();
    }
    return [];
  }, []);

  // ==================== 4. LIFECYCLE MANAGEMENT ====================

  /**
   *  NEW: Cleanup on unmount
   */
  useEffect(() => {
    return () => {
      clearAllCaches();
    };
  }, [clearAllCaches]);

  /**
   *  NEW: Optional cache size warning
   */
  useEffect(() => {
    if (!enableDebug) return;

    const interval = setInterval(() => {
      const { totalCached } = getCacheInfo();
      if (totalCached > maxCacheSize * 0.8) {
        console.warn(` Cache approaching limit: ${totalCached}/${maxCacheSize}`);
      }
    }, 5000);

    return () => clearInterval(interval);
  }, [enableDebug, maxCacheSize, getCacheInfo]);

  // ==================== RETURN ====================

  return {
    // Core functions
    applyVoiceExpression,
    createExpressionUtterance,
    extractEmotionMarker,
    
    // Text processing
    breakTextByExpression,
    batchApplyVoiceExpression,

    // Analysis & suggestions
    analyzeSuggestions,
    debugTextExpression,

    // Information
    getExpressionStats,
    getCacheInfo,
    getAvailableVoices,
    getAvailableEmotions: useCallback(() => memoizedEmotions, [memoizedEmotions]),

    // Cache management
    clearAllCaches,

    // Constants (memoized)
    VOICE_EMOTIONS,
    EMPHASIS_PATTERNS: memoizedPatterns,
    PAUSE_PATTERNS
  };
};

// ==================== USAGE EXAMPLES ====================

/**
 *  Basic Usage:
 * 
 * const { applyVoiceExpression, createExpressionUtterance } = useVoiceExpression();
 * 
 * const result = applyVoiceExpression("{EXCITED} Wow!", baseParams);
 * console.log(result); // { params, text, emotion, hasEmphasis, valid }
 * 
 * const utterance = createExpressionUtterance("{HAPPY} Great!", baseParams, voice);
 * window.speechSynthesis.speak(utterance);
 */

/**
 *  Debug Mode:
 * 
 * const { debugTextExpression, getCacheInfo } = useVoiceExpression(true);
 * 
 * console.log(debugTextExpression("{ANGRY} This is terrible!"));
 * console.log(getCacheInfo()); // { expressionCache: X, utteranceCache: Y, ... }
 */

/**
 *  Batch Processing:
 * 
 * const { batchApplyVoiceExpression } = useVoiceExpression();
 * 
 * const texts = ["{HAPPY} Great!", "{SAD} Oh no...", "Normal text"];
 * const results = batchApplyVoiceExpression(texts, baseParams);
 * results.forEach(({ originalText, result }) => {
 *   console.log(`${originalText} -> ${result.emotion}`);
 * });
 */

/**
 *  Advanced: Multiple utterances with cleanup:
 * 
 * const { createExpressionUtterance, clearAllCaches } = useVoiceExpression(true);
 * 
 * try {
 *   const u1 = createExpressionUtterance("First", baseParams, voice);
 *   const u2 = createExpressionUtterance("Second", baseParams, voice);
 *   window.speechSynthesis.speak(u1);
 *   // ...
 * } finally {
 *   clearAllCaches();
 * }
 */
</file>

<file path="src/components/hooks/useVoices.js">
import { useState, useCallback, useRef, useEffect } from 'react';
  import { VOICE_CONFIG } from '../../config/voiceConfig';
  import { 
    VOICE_EMOTIONS, 
    detectEmotionFromText,
    getFinalVoiceParams,
    cleanTextMarkers
  } from '../../config/voiceExpression';

  const VOICE_CACHE = new Map();
  const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes
  const VOICE_WARMUP_CACHE = new Set();
  const EXPRESSION_CACHE = new Map();

  export const useVoices = () => {
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState(null);
    const [enableExpression, setEnableExpression] = useState(true);
    const [globalEmotion, setGlobalEmotion] = useState('NEUTRAL');
    
    const synthRef = useRef(null);
    const [allVoices, setAllVoices] = useState([]);
    const voicesLoadedRef = useRef(false);
    const cacheTimerRef = useRef(null);
    
    const performanceMetricsRef = useRef({
      voiceLoadTime: 0,
      speakAttempts: 0,
      successCount: 0,
      errorCount: 0,
      emotionsUsed: {},
      emphasisCount: 0
    });

    // Initialize synth safely
    useEffect(() => {
      if (typeof window !== 'undefined' && window.speechSynthesis) {
        synthRef.current = window.speechSynthesis;
      }
    }, []);

    // ==================== VOICE SELECTION ====================

    const getSpeakerVoice = useCallback((speaker) => {
      if (!speaker || allVoices.length === 0) return null;

      // Check cache first
      if (VOICE_CACHE.has(speaker)) {
        const cached = VOICE_CACHE.get(speaker);
        if (Date.now() - cached.timestamp < CACHE_DURATION) {
          return cached.voice;
        }
        VOICE_CACHE.delete(speaker);
      }

      const isFemale = VOICE_CONFIG.FEMALE_SPEAKERS.some(name => speaker.includes(name));
      const isMale = VOICE_CONFIG.MALE_SPEAKERS.some(name => speaker.includes(name));

      let voice = null;

      if (isFemale) {
        voice = allVoices.find(v => v.name.toLowerCase().includes('female') || v.name.toLowerCase().includes('woman')) 
          || allVoices.find(v => !v.name.toLowerCase().includes('male')) 
          || allVoices[0];
      } else if (isMale) {
        voice = allVoices.find(v => v.name.toLowerCase().includes('male') || v.name.toLowerCase().includes('man')) 
          || allVoices.find(v => !v.name.toLowerCase().includes('female')) 
          || allVoices[0];
      } else {
        voice = allVoices[0];
      }

      // Cache voice
      if (voice) {
        VOICE_CACHE.set(speaker, { voice, timestamp: Date.now() });
      }

      return voice;
    }, [allVoices]);

    const reloadVoices = useCallback(() => {
      if (!synthRef.current) {
        setError("Speech Synthesis not available in this browser");
        setIsLoading(false);
        return;
      }

      try {
        const startTime = performance.now();
        const voices = synthRef.current.getVoices().filter(v => v.lang.startsWith('en'));
        
        performanceMetricsRef.current.voiceLoadTime = performance.now() - startTime;

        if (voices.length === 0) {
          setError("No voices available. Check browser settings.");
          setAllVoices([]);
        } else {
          setAllVoices(voices);
          setError(null);
          voicesLoadedRef.current = true;
        }
      } catch (err) {
        console.error('Error loading voices:', err);
        setError("Failed to load voices: " + err.message);
      } finally {
        setIsLoading(false);
      }
    }, []);

    // ==================== VOICE EXPRESSION ====================

    /**
     * Extract emotion marker t text
     * Example: "{HAPPY} Great job!" -> emotion = HAPPY
     */
    const extractEmotionFromText = useCallback((text) => {
      const match = text.match(/^\{([A-Z_]+)\}\s*/);
      if (match && VOICE_EMOTIONS[match[1]]) {
        return {
          emotion: VOICE_EMOTIONS[match[1]],
          cleanText: text.replace(/^\{[A-Z_]+\}\s*/, '')
        };
      }
      return {
        emotion: null,
        cleanText: text
      };
    }, []);

    /**
     * Apply voice expression to text
     */
    const applyVoiceExpression = useCallback((text, baseParams) => {
      if (!enableExpression) {
        return {
          params: baseParams,
          text: text,
          emotion: 'NEUTRAL',
          hasEmphasis: false
        };
      }

      const cacheKey = `${text}|${JSON.stringify(baseParams)}|${globalEmotion}`;

      // Check cache
      if (EXPRESSION_CACHE.has(cacheKey)) {
        return EXPRESSION_CACHE.get(cacheKey);
      }

      // Extract emotion marker from text
      const { emotion: markerEmotion, cleanText } = extractEmotionFromText(text);

      // Determine final emotion (marker > global > detected)
      let finalEmotion = markerEmotion;
      if (!finalEmotion && globalEmotion !== 'NEUTRAL') {
        finalEmotion = VOICE_EMOTIONS[globalEmotion];
      }
      if (!finalEmotion) {
        finalEmotion = detectEmotionFromText(cleanText);
      }

      // Get final parameters with all effects
      const finalParams = getFinalVoiceParams(baseParams, cleanText, finalEmotion);

      // Check if text has emphasis markers
      const hasEmphasis = /\*[^*]+\*|_[^_]+_|\[[^\]]+\]|[A-Z]{2,}/.test(cleanText);

      const result = {
        params: finalParams,
        text: cleanTextMarkers(cleanText),
        emotion: finalEmotion?.label || 'Neutral',
        hasEmphasis
      };

      // Cache result
      EXPRESSION_CACHE.set(cacheKey, result);

      // Limit cache size
      if (EXPRESSION_CACHE.size > 100) {
        const firstKey = EXPRESSION_CACHE.keys().next().value;
        EXPRESSION_CACHE.delete(firstKey);
      }

      return result;
    }, [enableExpression, globalEmotion, extractEmotionFromText]);

    /**
     * Create utterance with voice expression
     */
    const createExpressiveUtterance = useCallback((text, speaker, baseParams = null) => {
      const voice = getSpeakerVoice(speaker);
      if (!voice) return null;

      // Get speaker config or default
      const speakerConfig = VOICE_CONFIG.SPEAKER_CONFIG[speaker] || VOICE_CONFIG.SPEAKER_CONFIG.default;
      const params = baseParams || speakerConfig;

      // Apply expression
      const expressionResult = applyVoiceExpression(text, params);

      // Track metrics
      performanceMetricsRef.current.emotionsUsed[expressionResult.emotion] = 
        (performanceMetricsRef.current.emotionsUsed[expressionResult.emotion] || 0) + 1;
      if (expressionResult.hasEmphasis) {
        performanceMetricsRef.current.emphasisCount++;
      }

      // Create utterance
      const utterance = new SpeechSynthesisUtterance(expressionResult.text);
      utterance.voice = voice;
      utterance.rate = expressionResult.params.rate;
      utterance.pitch = expressionResult.params.pitch;
      utterance.volume = expressionResult.params.volume;
      utterance.lang = voice.lang || 'en-US';

      return {
        utterance,
        metadata: {
          emotion: expressionResult.emotion,
          hasEmphasis: expressionResult.hasEmphasis,
          originalText: text,
          cleanText: expressionResult.text
        }
      };
    }, [getSpeakerVoice, applyVoiceExpression]);

    // ==================== VOICE WARMUP ====================
    
    const warmupVoice = useCallback(async (speaker) => {
      if (!synthRef.current || !speaker) return false;

      if (VOICE_WARMUP_CACHE.has(speaker)) {
        return true;
      }

      try {
        const voice = getSpeakerVoice(speaker);
        if (!voice) return false;

        return new Promise((resolve) => {
          const utterance = new SpeechSynthesisUtterance('.');
          utterance.voice = voice;
          utterance.volume = 0;
          utterance.rate = 2;

          const timeoutId = setTimeout(() => {
            synthRef.current.cancel();
            resolve(false);
          }, 3000);

          utterance.onend = () => {
            clearTimeout(timeoutId);
            VOICE_WARMUP_CACHE.add(speaker);
            resolve(true);
          };

          utterance.onerror = () => {
            clearTimeout(timeoutId);
            resolve(false);
          };

          synthRef.current.speak(utterance);
        });
      } catch (err) {
        console.warn(`Warmup error for ${speaker}:`, err);
        return false;
      }
    }, [getSpeakerVoice, synthRef]);

    const warmupVoices = useCallback(async (speakers = []) => {
      if (!synthRef.current || speakers.length === 0) return;

      try {
        for (const speaker of speakers) {
          await warmupVoice(speaker);
          await new Promise(r => setTimeout(r, 100));
        }
      } catch (err) {
        console.warn('Batch warmup error:', err);
      }
    }, [warmupVoice, synthRef]);

    // ==================== SPEECH CONTROL ====================

    const pauseAllSpeech = useCallback(() => {
      if (!synthRef.current) return;
      
      try {
        if (synthRef.current.speaking) {
          synthRef.current.pause();
        }
      } catch (err) {
        console.error('Error pausing speech:', err);
      }
    }, []);

    const resumeSpeech = useCallback(() => {
      if (!synthRef.current) return;
      
      try {
        if (synthRef.current.paused) {
          synthRef.current.resume();
        }
      } catch (err) {
        console.error('Error resuming speech:', err);
      }
    }, []);

    const cancelAllSpeech = useCallback(() => {
      if (!synthRef.current) return;

      try {
        synthRef.current.cancel();
      } catch (err) {
        console.error('Error canceling speech:', err);
      }
    }, []);

    // ==================== PERFORMANCE DETECTION ====================

    const getPerformanceLevel = useCallback(() => {
      const memory = navigator.deviceMemory || 4;
      const connection = navigator.connection?.effectiveType || '4g';

      const levels = {
        '4g': { 
          rate: 1.1, 
          pitch: 1.0, 
          chunkSize: 250,
          warmupEnabled: true,
          cacheEnabled: true,
          label: 'Optimal'
        },
        '3g': { 
          rate: 0.9, 
          pitch: 0.95, 
          chunkSize: 150,
          warmupEnabled: true,
          cacheEnabled: true,
          label: 'Good'
        },
        '2g': { 
          rate: 0.7, 
          pitch: 0.9, 
          chunkSize: 100,
          warmupEnabled: false,
          cacheEnabled: true,
          label: 'Limited'
        },
        'slow-4g': { 
          rate: 0.8, 
          pitch: 0.9, 
          chunkSize: 120,
          warmupEnabled: false,
          cacheEnabled: true,
          label: 'Slow'
        }
      };

      return levels[connection] || levels['4g'];
    }, []);

    const autoOptimizeSettings = useCallback(() => {
      const quality = {
        HIGH: { pitch: 1.0, rate: 0.95, volume: 1.0 },
        MEDIUM: { pitch: 0.95, rate: 0.85, volume: 0.95 },
        LOW: { pitch: 0.9, rate: 0.75, volume: 0.9 }
      };

      try {
        const memUsage = performance.memory?.usedJSHeapSize || 0;
        const totalMemory = performance.memory?.jsHeapSizeLimit || 1;
        const usagePercent = memUsage / totalMemory;

        if (usagePercent > 0.8) return quality.LOW;
        if (usagePercent > 0.5) return quality.MEDIUM;
        return quality.HIGH;
      } catch (error) {
        return quality.HIGH;
      }
    }, []);

    // ==================== CACHE & METRICS ====================

    const clearVoiceCache = useCallback(() => {
      VOICE_CACHE.clear();
      VOICE_WARMUP_CACHE.clear();
      EXPRESSION_CACHE.clear();
    }, []);

    const getVoiceMetrics = useCallback(() => {
      const { voiceLoadTime, speakAttempts, successCount, errorCount, emotionsUsed, emphasisCount } = performanceMetricsRef.current;
      
      const dominantEmotion = Object.entries(emotionsUsed)
        .sort(([, a], [, b]) => b - a)[0]?.[0] || 'Neutral';
      
      return {
        voiceLoadTime: Math.round(voiceLoadTime),
        speakAttempts,
        successCount,
        errorCount,
        successRate: speakAttempts > 0 ? ((successCount / speakAttempts) * 100).toFixed(2) : 0,
        cachedVoices: VOICE_CACHE.size,
        warmedUpVoices: VOICE_WARMUP_CACHE.size,
        // Expression metrics
        emotionsUsed,
        emphasisCount,
        emphasisRate: speakAttempts > 0 ? ((emphasisCount / speakAttempts) * 100).toFixed(2) : 0,
        dominantEmotion,
        expressionCacheSize: EXPRESSION_CACHE.size
      };
    }, []);

    const resetMetrics = useCallback(() => {
      performanceMetricsRef.current = {
        voiceLoadTime: 0,
        speakAttempts: 0,
        successCount: 0,
        errorCount: 0,
        emotionsUsed: {},
        emphasisCount: 0
      };
    }, []);

    const trackSpeechAttempt = useCallback((success = true) => {
      performanceMetricsRef.current.speakAttempts++;
      if (success) {
        performanceMetricsRef.current.successCount++;
      } else {
        performanceMetricsRef.current.errorCount++;
      }
    }, []);

    // ==================== ERROR RECOVERY ====================

    const speakWithRetry = useCallback(async (utterance, maxRetries = 3) => {
      if (!synthRef.current) {
        throw new Error('Speech Synthesis not available');
      }

      for (let attempt = 0; attempt < maxRetries; attempt++) {
        try {
          return await new Promise((resolve, reject) => {
            const timeoutId = setTimeout(() => {
              synthRef.current.cancel();
              reject(new Error('Speech synthesis timeout'));
            }, 30000);

            utterance.onend = () => {
              clearTimeout(timeoutId);
              trackSpeechAttempt(true);
              resolve();
            };

            utterance.onerror = (event) => {
              clearTimeout(timeoutId);
              reject(new Error(`Speech error: ${event.error}`));
            };

            synthRef.current.speak(utterance);
          });
        } catch (error) {
          console.warn(`Speech attempt ${attempt + 1}/${maxRetries}:`, error.message);
          trackSpeechAttempt(false);

          try {
            synthRef.current.cancel();
          } catch (e) {
            console.error('Error during retry cleanup:', e);
          }

          if (attempt === maxRetries - 1) {
            throw error;
          }

          await new Promise(r => setTimeout(r, 500 * Math.pow(1.5, attempt)));
        }
      }
    }, [synthRef, trackSpeechAttempt]);

    // ==================== VOICE EXPRESSION UTILITIES ====================

    const getAvailableEmotions = useCallback(() => {
      return Object.entries(VOICE_EMOTIONS).map(([key, emotion]) => ({
        key,
        ...emotion
      }));
    }, []);

    const analyzeSuggestions = useCallback((text) => {
      const suggestions = [];

      if (/[A-Z]{2,}/.test(text)) {
        suggestions.push('Found uppercase - will add emphasis');
      }

      if (/!/.test(text)) {
        suggestions.push('Exclamation mark - will raise pitch');
      }

      if (/\?/.test(text)) {
        suggestions.push('Question mark - will adjust intonation');
      }

      if (/\.{2,}|/.test(text)) {
        suggestions.push('Ellipsis - will slow down');
      }

      const emotion = detectEmotionFromText(text);
      if (emotion !== VOICE_EMOTIONS.NEUTRAL) {
        suggestions.push(`Detected emotion: ${emotion.label}`);
      }

      return suggestions;
    }, []);

    // Load voices on mount
    useEffect(() => {
      if (!synthRef.current) return;

      setIsLoading(true);

      if (synthRef.current.getVoices().length > 0) {
        reloadVoices();
      } else {
        const handleVoicesChanged = () => {
          reloadVoices();
        };

        synthRef.current.addEventListener('voiceschanged', handleVoicesChanged);

        const timeoutId = setTimeout(() => {
          if (!voicesLoadedRef.current) {
            reloadVoices();
          }
        }, 2000);

        return () => {
          clearTimeout(timeoutId);
          if (synthRef.current) {
            synthRef.current.removeEventListener('voiceschanged', handleVoicesChanged);
          }
        };
      }
    }, [reloadVoices]);

    // Setup cache cleanup on unmount
    useEffect(() => {
      return () => {
        clearVoiceCache();
        cancelAllSpeech();
        if (cacheTimerRef.current) {
          clearTimeout(cacheTimerRef.current);
        }
      };
    }, [clearVoiceCache, cancelAllSpeech]);

    return {
      // Voices & Access
      allVoices,
      getSpeakerVoice,
      synthRef,
      
      // Loading & Errors
      isLoading,
      error,
      reloadVoices,
      
      // Speech Control
      pauseAllSpeech,
      resumeSpeech,
      cancelAllSpeech,
      
      // Voice Warmup
      warmupVoice,
      warmupVoices,
      
      // Performance & Optimization
      getPerformanceLevel,
      autoOptimizeSettings,
      
      // Metrics & Tracking
      getVoiceMetrics,
      trackSpeechAttempt,
      resetMetrics,
      
      // Error Recovery
      speakWithRetry,
      
      // Cache Management
      clearVoiceCache,
      getVoiceCacheSize: () => VOICE_CACHE.size,
      getWarmedUpVoicesCount: () => VOICE_WARMUP_CACHE.size,
      
      // ===== VOICE EXPRESSION =====
      enableExpression,
      setEnableExpression,
      globalEmotion,
      setGlobalEmotion,
      
      // Expression Functions
      applyVoiceExpression,
      createExpressiveUtterance,
      extractEmotionFromText,
      
      // Expression Utilities
      getAvailableEmotions,
      analyzeSuggestions,
      
      // Expression Constants
      VOICE_EMOTIONS
    };
  };
</file>

<file path="src/components/sections/InstructionsSection.jsx">
import React, { memo } from 'react';
import { BookOpen, Info, Zap } from 'lucide-react';
// Gi nh cc component ny  c ti u ha
import { CollapsibleSection } from '../common/CollapsibleSection'; 
import { InfoCard } from '../common/InfoCard'; 

// S dng memo  trnh re-render khng cn thit nu props khng i
export const InstructionsSection = memo(({ 
  isOpen, 
  onToggle, 
  isSignedIn, 
  authProvider 
}) => {
  
  // 1. Ti u ha d liu: Trc quan ha thng tin ng nhp
  const authStatus = isSignedIn 
    ? {
      text: `  ng nhp. Tin  c lu t ng! (Provider: ${authProvider === 'clerk' ? 'Clerk' : 'Firebase'})`,
      className: "text-green-700 font-bold",
    }
    : {
      text: "ng nhp  lu tin  hc tp v theo di thnh tch.",
      className: "text-red-600 font-bold",
    };

  const instructionItems = [
    { key: "1", label: "Navbar:", detail: "Chuyn i gia Listening, Reading, Ng Php, T Vng" },
    { key: "2", label: "Listening:", detail: "Chn ging nam/n, iu chnh tc , nhn Play  nghe" },
    { key: "3", label: "Reading:", detail: "c on vn v chn p n ph hp" },
    { key: "4", label: "Full Exam:", detail: "Thi th ton b bi thi vi timer t ng" },
    { key: "5", label: "", detail: authStatus.text, className: authStatus.className },
  ];

  const importantNotes = [
    { key: "1", label: "Listening:", detail: "Dng Chrome/Edge cho tri nghim tt nht" },
    { key: "2", label: "Chm im:", detail: "Listening 5/cu, Reading 2.5/cu" },
    { key: "3", label: "T ng lu:", detail: "Tin  c lu sau mi ln hon thnh bi tp khi  ng nhp" },
    { key: "4", label: "Full Exam:", detail: "Tng 90 pht. T ng chuyn section sau 30/60 pht" }
  ];

  // Hm chuyn i data thnh JSX (s dng list/table n gin thay v ch l span)
  const renderItems = (items) => {
    return items.map(item => (
      <li key={item.key} className={`text-gray-700 text-sm py-1 border-b border-gray-100 last:border-b-0 ${item.className || ''}`}>
        {item.label && <strong className="text-gray-800 mr-1">{item.label}</strong>}
        {item.detail}
      </li>
    ));
  };

  // --- Thay th InfoCard bng cu trc  ti u (nu khng th chnh sa InfoCard) ---
  // Nu InfoCard  ti u, ta vn gi n. Ti s gi nh InfoCard c ti u.
  
  return (
    // Thm mt container nh nhng, mt m cho ton b section
    <div className="space-y-4 md:space-y-6"> 
      {/* 1. Hng dn s dng (Collapsible) */}
      <CollapsibleSection
        title="Hng dn s dng"
        icon={BookOpen}
        iconColor="text-blue-500" // Thm mu cho icon  trc quan hn
        bgColor="bg-blue-50" // Thm mu nn nh nhng
        isOpen={isOpen}
        onToggle={onToggle}
      >
        <div className="p-4 bg-white border border-blue-200 rounded-lg shadow-inner">
          <ul className="list-none p-0 m-0">
            {renderItems(instructionItems)}
          </ul>
        </div>
      </CollapsibleSection>

      {/* 2. Lu  quan trng (Lun m) */}
      {/* S dng li InfoCard nhng vi style trc quan hn */}
      <div className="bg-orange-50 border-2 border-orange-300 rounded-xl p-4 md:p-6 shadow-lg transition duration-300 hover:shadow-xl">
        <div className="flex items-start gap-4 mb-4 border-b pb-3 border-orange-200">
          <Zap className="w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5" />
          <h3 className="text-xl font-bold text-orange-800">Lu  quan trng</h3>
        </div>
        
        <ul className="list-disc list-inside space-y-2 pl-2">
          {importantNotes.map(item => (
            <li key={item.key} className="text-sm text-gray-700">
              <strong className="text-orange-700 mr-1">{item.label}</strong>
              {item.detail}
            </li>
          ))}
        </ul>
      </div>
      
    </div>
  );
});

export default InstructionsSection;
</file>

<file path="src/components/styles/FullExamMode.css">
/* FullExamMode.css */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

* {
  box-sizing: border-box;
}

.exam-container {
  font-family: 'Inter', sans-serif;
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem;
  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
  min-height: 100vh;
}

/* Setup Screen Styles */
.exam-header {
  background: linear-gradient(135deg, #d97706 0%, #f59e0b 50%, #fbbf24 100%);
  border-radius: 1.5rem;
  padding: 2rem;
  text-align: center;
  color: white;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
}

.exam-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
  opacity: 0.3;
}

.exam-title {
  font-size: 2.5rem;
  font-weight: 900;
  margin-bottom: 0.5rem;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.exam-subtitle {
  font-size: 1.25rem;
  opacity: 0.9;
  margin-bottom: 0.5rem;
}

.user-greeting {
  font-size: 0.875rem;
  opacity: 0.8;
  background: rgba(255, 255, 255, 0.2);
  padding: 0.5rem 1rem;
  border-radius: 2rem;
  display: inline-block;
  margin-top: 0.5rem;
}

/* Exam Selection Card */
.exam-selection-card {
  background: white;
  border-radius: 1.5rem;
  border: 2px solid #fcd34d;
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: 0 10px 25px -5px rgba(251, 191, 36, 0.1);
  transition: all 0.3s ease;
}

.exam-selection-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 20px 40px -10px rgba(251, 191, 36, 0.2);
}

.selection-header {
  display: flex;
  align-items: center;
  margin-bottom: 1.5rem;
}

.selection-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 3rem;
  height: 3rem;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  border-radius: 0.75rem;
  margin-right: 1rem;
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.selection-icon .icon {
  width: 1.5rem;
  height: 1.5rem;
  color: white;
}

.selection-title {
  font-size: 1.875rem;
  font-weight: 800;
  background: linear-gradient(135deg, #d97706, #b45309);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.selection-container {
  position: relative;
  width: 100%;
  margin-bottom: 1rem;
}

.exam-select {
  width: 100;
  padding: 1rem 1.25rem;
  border-radius: 0.75rem;
  font-weight: 600;
  color: #1f2937;
  border: 2px solid #e5e7eb;
  background: white;
  appearance: none;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.exam-select:focus {
  outline: none;
  border-color: #f59e0b;
  box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
}

.exam-select:hover {
  border-color: #fbbf24;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.placeholder {
  color: #9ca3af;
}

.exam-option {
  font-weight: 500;
  padding: 0.75rem;
}

.select-arrow {
  pointer-events: none;
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: #f59e0b;
  transition: transform 0.3s ease;
}

.selection-container:hover .select-arrow {
  transform: translateY(-50%) scale(1.1);
}

.arrow-icon {
  width: 1.25rem;
  height: 1.25rem;
}

.selected-exam {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #fffbeb;
  border: 1px solid #fcd34d;
  border-radius: 0.75rem;
  padding: 1rem 1.5rem;
  animation: fade-in 0.5s ease-out;
}

.selected-indicator {
  display: flex;
  align-items: center;
}

.pulse-dot {
  width: 0.5rem;
  height: 0.5rem;
  background: #f59e0b;
  border-radius: 50%;
  margin-right: 0.5rem;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.7;
    transform: scale(1.1);
  }
}

.selected-label {
  font-size: 0.875rem;
  font-weight: 500;
  color: #6b7280;
}

.exam-name {
  font-weight: 700;
  color: #b45309;
  background: #fef3c7;
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  display: flex;
  align-items: center;
}

.exam-icon {
  width: 1rem;
  height: 1rem;
  margin-right: 0.5rem;
}

/* Exam Sections */
.exam-sections {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.section-card {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.section-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
}

.exam-card-listening {
  border-color: #3b82f6;
  box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1);
}

.exam-card-reading {
  border-color: #10b981;
  box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.1);
}

.section-header {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
}

.section-icon {
  width: 1.75rem;
  height: 1.75rem;
  margin-right: 0.75rem;
}

.exam-card-listening .section-icon {
  color: #3b82f6;
}

.exam-card-reading .section-icon {
  color: #10b981;
}

.section-title {
  font-size: 1.25rem;
  font-weight: 700;
}

.exam-card-listening .section-title {
  color: #1e40af;
}

.exam-card-reading .section-title {
  color: #065f46;
}

.section-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
}

@media (min-width: 768px) {
  .section-stats {
    grid-template-columns: repeat(4, 1fr);
  }
}

.stat-item {
  background: #f8fafc;
  border-radius: 0.5rem;
  padding: 1rem;
  text-align: center;
  border: 1px solid #e2e8f0;
}

.exam-card-listening .stat-item {
  background: #dbeafe;
  border-color: #bfdbfe;
}

.exam-card-reading .stat-item {
  background: #d1fae5;
  border-color: #a7f3d0;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 900;
  margin-bottom: 0.25rem;
}

.exam-card-listening .stat-value {
  color: #1d4ed8;
}

.exam-card-reading .stat-value {
  color: #047857;
}

.stat-label {
  font-size: 0.75rem;
  color: #6b7280;
  font-weight: 500;
}

/* Exam Notes */
.exam-notes {
  background: #fffbeb;
  border: 2px solid #fcd34d;
  border-radius: 1rem;
  padding: 1.5rem;
}

.notes-title {
  font-weight: 700;
  color: #b45309;
  margin-bottom: 0.75rem;
  font-size: 1.125rem;
}

.notes-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.notes-list li {
  font-size: 0.875rem;
  color: #6b7280;
  padding-left: 0;
}

/* Buttons */
.exam-btn-primary {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: white;
  font-weight: 800;
  border: none;
  border-radius: 0.75rem;
  padding: 1.25rem 2rem;
  font-size: 1.125rem;
  box-shadow: 0 4px 15px -3px rgba(245, 158, 11, 0.3);
  transition: all 0.3s ease;
  cursor: pointer;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.exam-btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px -5px rgba(245, 158, 11, 0.5);
  background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
}

.exam-btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.start-exam-btn {
  margin-top: 1rem;
}

.btn-icon {
  width: 1.25rem;
  height: 1.25rem;
  margin-right: 0.5rem;
}

/* Exam Mode Styles */
.exam-mode-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.exam-header-sticky {
  background: white;
  border-radius: 1rem;
  border: 2px solid #fcd34d;
  padding: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 1rem;
  z-index: 40;
}

.header-content {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 1rem;
  gap: 1rem;
}

.header-info {
  flex: 1;
  min-width: 0;
}

.section-header {
  font-size: 1.25rem;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 0.25rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.part-info {
  font-size: 0.875rem;
  color: #6b7280;
}

.auto-save-indicator {
  color: #059669;
  margin-left: 0.5rem;
  font-weight: 600;
}

.timer-container {
  text-align: right;
  flex-shrink: 0;
}

.timer-display {
  font-size: 2rem;
  font-weight: 900;
  margin-bottom: 0.25rem;
}

.timer-normal {
  color: #f59e0b;
}

.timer-warning {
  color: #ef4444;
  animation: pulse 1s infinite;
}

.timer-label {
  font-size: 0.75rem;
  color: #6b7280;
}

.progress-section {
  margin-bottom: 1rem;
}

.progress-labels {
  display: flex;
  justify-content: space-between;
  font-size: 0.75rem;
  color: #6b7280;
  margin-bottom: 0.5rem;
}

.progress-bar-container {
  height: 0.5rem;
  background: #e5e7eb;
  border-radius: 9999px;
  overflow: hidden;
}

.exam-progress-bar {
  height: 100%;
  border-radius: 9999px;
  transition: width 0.5s ease-in-out, background-color 0.3s ease;
  background: linear-gradient(90deg, #f59e0b, #fbbf24);
  position: relative;
}

.exam-progress-bar.warning {
  background: linear-gradient(90deg, #ef4444, #f87171);
}

.exam-progress-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}

.exam-controls {
  display: flex;
  gap: 0.5rem;
}

.control-btn {
  padding: 0.5rem 1rem;
  background: #f3f4f6;
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  font-weight: 600;
  font-size: 0.875rem;
  transition: all 0.2s ease;
  cursor: pointer;
  display: flex;
  align-items: center;
}

.control-btn:hover {
  background: #e5e7eb;
  border-color: #9ca3af;
}

.control-icon {
  width: 1rem;
  height: 1rem;
  margin-right: 0.25rem;
}

/* Alerts */
.warning-alert,
.error-alert {
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  animation: fade-in 0.3s ease-out;
}

.warning-alert {
  background: #fef2f2;
  border: 2px solid #fecaca;
}

.error-alert {
  background: #fffbeb;
  border: 2px solid #fcd34d;
}

.warning-icon,
.error-icon {
  width: 1.25rem;
  height: 1.25rem;
  flex-shrink: 0;
}

.warning-icon {
  color: #dc2626;
}

.error-icon {
  color: #d97706;
}

.warning-text,
.error-text {
  font-weight: 700;
  font-size: 0.875rem;
}

.warning-text {
  color: #dc2626;
}

.error-text {
  color: #92400e;
}

/* Part Navigation */
.part-navigation {
  background: linear-gradient(135deg, #fef3c7, #fde68a);
  border-radius: 1rem;
  border: 2px solid #f59e0b;
  padding: 1.5rem;
}

.part-nav-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.part-nav-title {
  font-weight: 700;
  color: #92400e;
  font-size: 0.875rem;
}

.part-nav-counter {
  font-size: 0.75rem;
  font-weight: 600;
  color: #6b7280;
}

.part-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.5rem;
}

.part-nav-btn {
  padding: 0.75rem 0.5rem;
  border-radius: 0.5rem;
  font-weight: 700;
  font-size: 0.75rem;
  transition: all 0.3s ease;
  cursor: pointer;
  border: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.part-nav-btn:not(.current):not(.completed) {
  background: #fef3c7;
  color: #1f2937;
  border: 2px solid #fcd34d;
}

.part-nav-btn:not(.current):not(.completed):hover {
  background: #fde68a;
  border-color: #f59e0b;
  transform: scale(1.05);
}

.part-nav-btn.current {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  transform: scale(1.05);
  box-shadow: 0 4px 15px -3px rgba(245, 158, 11, 0.4);
  border: 2px solid #d97706;
}

.part-nav-btn.completed {
  background: #10b981;
  color: white;
  border: 2px solid #059669;
}

.part-nav-btn.completed:hover {
  background: #059669;
  transform: scale(1.05);
}

.part-number {
  font-size: 1rem;
  font-weight: 800;
  margin-bottom: 0.25rem;
}

.part-progress {
  font-size: 0.625rem;
  opacity: 0.9;
}

/* Questions Container */
.questions-container {
  background: white;
  border-radius: 1rem;
  border: 1px solid #e5e7eb;
  padding: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.questions-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 1rem;
  padding-bottom: 0.75rem;
  border-bottom: 2px solid #fcd34d;
}

.part-description {
  font-size: 0.875rem;
  color: #6b7280;
  font-style: italic;
  background: #fffbeb;
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  border-left: 4px solid #f59e0b;
  margin-bottom: 1rem;
}

.questions-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.no-questions {
  text-align: center;
  padding: 3rem 1rem;
  color: #6b7280;
}

.no-questions-icon {
  width: 2.5rem;
  height: 2.5rem;
  margin: 0 auto 1rem;
  opacity: 0.5;
}

.no-questions-text {
  font-weight: 600;
  font-size: 1rem;
}

/* Question Card */
.question-card {
  background: white;
  border-radius: 0.75rem;
  border-left: 4px solid #f59e0b;
  padding: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

.question-card:hover {
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
  transform: translateY(-1px);
}

.question-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 1rem;
  gap: 1rem;
}

.question-title {
  font-size: 1rem;
  font-weight: 700;
  color: #1f2937;
  flex: 1;
  line-height: 1.5;
}

.question-number {
  color: #d97706;
}

.answered-badge {
  padding: 0.25rem 0.75rem;
  background: #d1fae5;
  color: #065f46;
  font-size: 0.75rem;
  font-weight: 700;
  border-radius: 9999px;
  white-space: nowrap;
  flex-shrink: 0;
}

.options-container {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.option-card {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 2px solid #e5e7eb;
  background: #f9fafb;
}

.option-card:hover {
  border-color: #fbbf24;
  background: #fef3c7;
}

.option-card.selected {
  background: #fef3c7;
  border-color: #f59e0b;
  box-shadow: 0 2px 10px -2px rgba(245, 158, 11, 0.3);
}

.option-indicator {
  width: 1.75rem;
  height: 1.75rem;
  border-radius: 50%;
  border: 2px solid #9ca3af;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.75rem;
  color: #6b7280;
  transition: all 0.2s ease;
  flex-shrink: 0;
}

.option-indicator.selected {
  background: #f59e0b;
  border-color: #d97706;
  color: white;
}

.option-text {
  font-size: 0.875rem;
  color: #374151;
  flex: 1;
  line-height: 1.4;
}

.option-text.selected {
  color: #1f2937;
  font-weight: 600;
}

.option-input {
  display: none;
}

.no-options {
  font-size: 0.875rem;
  color: #6b7280;
  font-style: italic;
  text-align: center;
  padding: 1rem;
}

/* Navigation Buttons */
.navigation-buttons {
  display: flex;
  gap: 0.75rem;
  padding-bottom: 1rem;
}

.nav-btn {
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  font-weight: 600;
  font-size: 0.875rem;
  transition: all 0.3s ease;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
}

.prev-btn {
  background: #f3f4f6;
  color: #374151;
  border: 1px solid #d1d5db;
}

.prev-btn:hover:not(:disabled) {
  background: #e5e7eb;
  border-color: #9ca3af;
}

.prev-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.next-btn {
  flex: 1;
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
}

.next-btn:hover {
  background: linear-gradient(135deg, #1d4ed8, #1e40af);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.complete-btn {
  flex: 1;
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
}

.complete-btn:hover {
  background: linear-gradient(135deg, #059669, #047857);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.nav-icon {
  width: 1rem;
  height: 1rem;
  margin-right: 0.25rem;
}

/* Results Screen */
.results-container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.results-header {
  border-radius: 1.5rem;
  padding: 2rem;
  text-align: center;
  color: white;
  position: relative;
  overflow: hidden;
}

.performance-excellent {
  background: linear-gradient(135deg, #10b981, #059669);
}

.performance-good {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}

.performance-average {
  background: linear-gradient(135deg, #f59e0b, #d97706);
}

.performance-fair {
  background: linear-gradient(135deg, #f59e0b, #d97706);
}

.performance-poor {
  background: linear-gradient(135deg, #f59e0b, #d97706);
}

.performance-fail {
  background: linear-gradient(135deg, #ef4444, #dc2626);
}

.trophy-icon {
  width: 5rem;
  height: 5rem;
  margin: 0 auto 1rem;
  animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

.results-title {
  font-size: 2.5rem;
  font-weight: 900;
  margin-bottom: 0.5rem;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.results-subtitle {
  font-size: 1.25rem;
  opacity: 0.9;
  margin-bottom: 1rem;
}

.performance-badge {
  display: inline-block;
  padding: 0.5rem 1.5rem;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 9999px;
  border: 2px solid rgba(255, 255, 255, 0.5);
  margin-bottom: 1rem;
}

.performance-text {
  font-weight: 700;
  font-size: 0.875rem;
}

.performance-level {
  font-size: 1.125rem;
}

.save-status {
  font-size: 0.875rem;
  font-weight: 600;
  background: rgba(255, 255, 255, 0.2);
  padding: 0.5rem 1rem;
  border-radius: 2rem;
  display: inline-block;
}

/* Score Cards */
.score-cards {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}

@media (min-width: 768px) {
  .score-cards {
    grid-template-columns: repeat(3, 1fr);
  }
}

.score-card {
  background: white;
  border-radius: 1rem;
  padding: 2rem;
  text-align: center;
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  border: 2px solid;
}

.score-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
}

.listening-card {
  border-color: #93c5fd;
}

.reading-card {
  border-color: #a7f3d0;
}

.average-card {
  border-color: #fcd34d;
}

.score-icon {
  width: 3rem;
  height: 3rem;
  margin: 0 auto 1rem;
}

.listening-card .score-icon {
  color: #3b82f6;
}

.reading-card .score-icon {
  color: #10b981;
}

.average-card .score-icon {
  color: #f59e0b;
}

.score-label {
  font-weight: 600;
  color: #6b7280;
  margin-bottom: 1rem;
  font-size: 0.875rem;
}

.score-value {
  font-size: 3rem;
  font-weight: 900;
  margin-bottom: 0.5rem;
}

.listening-card .score-value {
  color: #1d4ed8;
}

.reading-card .score-value {
  color: #047857;
}

.average-value {
  font-size: 3rem;
  font-weight: 900;
  margin-bottom: 0.5rem;
  background: linear-gradient(135deg, #d97706, #b45309);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.score-detail {
  font-size: 0.875rem;
  color: #6b7280;
}

/* Results Progress */
.results-progress {
  background: white;
  border-radius: 1rem;
  border: 2px solid #e5e7eb;
  padding: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.progress-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.progress-title {
  font-size: 1.125rem;
  font-weight: 700;
  color: #1f2937;
}

.progress-count {
  font-size: 0.875rem;
  font-weight: 600;
  color: #6b7280;
}

.progress-bar-background {
  background: #e5e7eb;
  border-radius: 9999px;
  height: 1.5rem;
  overflow: hidden;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.results-progress-bar {
  height: 100%;
  border-radius: 9999px;
  transition: width 1s ease-out;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: 0.75rem;
  position: relative;
}

.progress-percent {
  color: white;
  font-size: 0.75rem;
  font-weight: 700;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* Detailed Results */
.detailed-results {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}

@media (min-width: 1024px) {
  .detailed-results {
    grid-template-columns: 1fr 1fr;
  }
}

.section-results {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  border: 2px solid;
}

.listening-results {
  border-color: #93c5fd;
}

.reading-results {
  border-color: #a7f3d0;
}

.section-results-title {
  font-size: 1.125rem;
  font-weight: 700;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.listening-results .section-results-title {
  color: #1e40af;
}

.reading-results .section-results-title {
  color: #065f46;
}

.section-icon {
  width: 1.25rem;
  height: 1.25rem;
}

.results-stats {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.result-stat {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem;
  background: #f8fafc;
  border-radius: 0.5rem;
  font-size: 0.875rem;
}

.listening-results .result-stat {
  background: #dbeafe;
}

.reading-results .result-stat {
  background: #d1fae5;
}

.stat-value {
  font-weight: 700;
}

.listening-results .stat-value {
  color: #1d4ed8;
}

.reading-results .stat-value {
  color: #047857;
}

.part-breakdown {
  background: #f8fafc;
  border-radius: 0.75rem;
  padding: 1rem;
  border: 1px solid #e2e8f0;
}

.listening-results .part-breakdown {
  background: #dbeafe;
  border-color: #bfdbfe;
}

.reading-results .part-breakdown {
  background: #d1fae5;
  border-color: #a7f3d0;
}

.breakdown-title {
  font-weight: 700;
  font-size: 0.75rem;
  margin-bottom: 0.75rem;
}

.listening-results .breakdown-title {
  color: #1e40af;
}

.reading-results .breakdown-title {
  color: #065f46;
}

.parts-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.375rem;
}

.part-result {
  background: white;
  border-radius: 0.5rem;
  padding: 0.75rem 0.5rem;
  text-align: center;
  border: 1px solid #e2e8f0;
}

.listening-results .part-result {
  border-color: #93c5fd;
}

.reading-results .part-result {
  border-color: #a7f3d0;
}

.part-name {
  font-weight: 700;
  font-size: 0.75rem;
  color: #6b7280;
  margin-bottom: 0.25rem;
}

.part-score {
  font-size: 1.125rem;
  font-weight: 800;
  margin-bottom: 0.125rem;
}

.listening-results .part-score {
  color: #3b82f6;
}

.reading-results .part-score {
  color: #10b981;
}

.part-total {
  font-size: 0.625rem;
  color: #9ca3af;
}

/* Feedback */
.feedback {
  background: #fffbeb;
  border: 2px solid #fcd34d;
  border-radius: 1rem;
  padding: 1.5rem;
}

.feedback-title {
  font-size: 1.125rem;
  font-weight: 700;
  color: #b45309;
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.feedback-icon {
  width: 1.25rem;
  height: 1.25rem;
}

.feedback-content {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.feedback-content p {
  font-size: 0.875rem;
  color: #6b7280;
  line-height: 1.5;
}

/* Answer Review Sections */
.answer-review-section {
  background: white;
  border-radius: 1rem;
  border: 2px solid;
  padding: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.listening-review {
  border-color: #93c5fd;
}

.reading-review {
  border-color: #a7f3d0;
}

.review-title {
  font-size: 1.5rem;
  font-weight: 900;
  margin-bottom: 1.5rem;
  padding-bottom: 0.75rem;
  border-bottom: 4px solid;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.listening-review .review-title {
  color: #1e40af;
  border-bottom-color: #3b82f6;
}

.reading-review .review-title {
  color: #065f46;
  border-bottom-color: #10b981;
}

.review-icon {
  width: 1.75rem;
  height: 1.75rem;
}

/* Answer Review Container */
.answer-review-container {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.explanation-toggle {
  display: flex;
  justify-content: center;
}

.toggle-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: #4f46e5;
  color: white;
  border: none;
  border-radius: 0.75rem;
  font-weight: 700;
  box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3);
  transition: all 0.3s ease;
  cursor: pointer;
}

.toggle-btn:hover {
  background: #4338ca;
  box-shadow: 0 6px 20px -2px rgba(79, 70, 229, 0.4);
  transform: translateY(-1px);
}

.toggle-icon {
  width: 1.25rem;
  height: 1.25rem;
}

.answers-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.answer-item {
  padding: 1.25rem;
  border-radius: 0.75rem;
  border: 2px solid;
  transition: all 0.3s ease;
}

.answer-item:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transform: translateY(-1px);
}

.answer-item.correct {
  background: linear-gradient(135deg, #d1fae5, #a7f3d0);
  border-color: #10b981;
}

.answer-item.incorrect {
  background: linear-gradient(135deg, #fecaca, #fca5a5);
  border-color: #ef4444;
}

.answer-header {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  margin-bottom: 0.75rem;
}

.status-icon {
  padding: 0.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.status-icon.correct {
  background: #10b981;
}

.status-icon.incorrect {
  background: #ef4444;
}

.status-icon .icon {
  width: 1.5rem;
  height: 1.5rem;
  color: white;
}

.answer-info {
  flex: 1;
}

.question-meta {
  font-size: 0.875rem;
  font-weight: 600;
  color: #6b7280;
  margin-bottom: 0.25rem;
}

.question-text {
  font-weight: 700;
  color: #1f2937;
  font-size: 1.125rem;
  line-height: 1.4;
}

.answer-details {
  margin-left: 3.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.answer-comparison {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.answer-label {
  font-size: 0.875rem;
  font-weight: 600;
  color: #6b7280;
}

.user-answer,
.correct-answer {
  font-weight: 700;
  padding: 0.25rem 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
}

.user-answer.correct {
  background: #d1fae5;
  color: #065f46;
}

.user-answer.incorrect {
  background: #fecaca;
  color: #dc2626;
}

.correct-answer {
  background: #d1fae5;
  color: #065f46;
}

.explanation {
  margin-top: 0.75rem;
  padding: 1rem;
  background: #dbeafe;
  border-left: 4px solid #3b82f6;
  border-radius: 0.5rem;
}

.explanation-title {
  font-size: 0.875rem;
  font-weight: 700;
  color: #1e40af;
  margin-bottom: 0.25rem;
}

.explanation-text {
  font-size: 0.875rem;
  color: #374151;
  line-height: 1.5;
}

/* Action Buttons */
.action-buttons {
  display: grid;
  grid-template-columns: 1fr;
  gap: 0.75rem;
  padding-bottom: 1rem;
}

@media (min-width: 640px) {
  .action-buttons {
    grid-template-columns: 1fr 1fr;
  }
}

.action-btn {
  padding: 1rem 1.5rem;
  border-radius: 0.75rem;
  font-weight: 700;
  font-size: 0.875rem;
  transition: all 0.3s ease;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

@media (min-width: 768px) {
  .action-btn {
    font-size: 1rem;
    padding: 1.25rem 2rem;
  }
}

.retry-btn {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
}

.retry-btn:hover {
  background: linear-gradient(135deg, #d97706, #b45309);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px -5px rgba(245, 158, 11, 0.4);
}

.back-btn {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
}

.back-btn:hover {
  background: linear-gradient(135deg, #1d4ed8, #1e40af);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px -5px rgba(59, 130, 246, 0.4);
}

/* Motivational Message */
.motivational-message {
  border-radius: 1rem;
  border: 2px solid;
  padding: 1.5rem;
  text-align: center;
}

.motivational-message.success {
  background: linear-gradient(135deg, #d1fae5, #a7f3d0);
  border-color: #10b981;
}

.motivational-message.encourage {
  background: linear-gradient(135deg, #fed7aa, #fdba74);
  border-color: #f59e0b;
}

.message-text {
  font-size: 1.125rem;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 0.5rem;
  line-height: 1.4;
}

.message-subtext {
  font-size: 0.875rem;
  color: #6b7280;
  line-height: 1.5;
}

/* Animations */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fade-in 0.5s ease-out;
}

/* Responsive Design */
@media (max-width: 768px) {
  .exam-container,
  .exam-mode-container,
  .results-container {
    padding: 0.5rem;
  }
  
  .exam-title {
    font-size: 2rem;
  }
  
  .exam-subtitle {
    font-size: 1rem;
  }
  
  .exam-selection-card {
    padding: 1.5rem;
  }
  
  .selection-title {
    font-size: 1.5rem;
  }
  
  .results-title {
    font-size: 2rem;
  }
  
  .score-value,
  .average-value {
    font-size: 2.5rem;
  }
  
  .header-content {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  
  .timer-container {
    text-align: left;
  }
  
  .answer-details {
    margin-left: 0;
  }
  
  .answer-header {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .status-icon {
    align-self: flex-start;
  }
}

@media (max-width: 480px) {
  .exam-header {
    padding: 1.5rem 1rem;
  }
  
  .exam-title {
    font-size: 1.75rem;
  }
  
  .section-stats {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .part-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .navigation-buttons {
    flex-direction: column;
  }
  
  .action-buttons {
    grid-template-columns: 1fr;
  }
}

/* High Contrast Mode Support */
@media (prefers-contrast: high) {
  .exam-card,
  .section-card,
  .question-card,
  .score-card {
    border-width: 3px;
  }
  
  .option-card.selected {
    border-width: 3px;
  }
  
  .exam-btn-primary,
  .action-btn {
    border: 2px solid;
  }
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  .exam-progress-bar::after,
  .pulse-dot {
    animation: none;
  }
}

/* Print Styles */
@media print {
  .exam-btn-primary,
  .exam-btn-secondary,
  .control-btn,
  .nav-btn,
  .action-btn,
  .toggle-btn,
  .part-navigation,
  .exam-controls {
    display: none;
  }
  
  .exam-card,
  .section-card,
  .question-card,
  .score-card {
    box-shadow: none;
    border: 1px solid #d1d5db;
    break-inside: avoid;
  }
  
  .exam-container,
  .exam-mode-container,
  .results-container {
    padding: 0;
  }
}
/* ExamDropdown styles */
.exam-dropdown-container {
  position: relative;
  width: 100%;
  margin-bottom: 16px;
}

.exam-dropdown {
  position: relative;
}

.exam-dropdown-button {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 12px 16px;
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 500;
  color: #374151;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: left;
}

.exam-dropdown-button:hover {
  border-color: #3b82f6;
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
}

.exam-dropdown-button:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.exam-dropdown-button-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1;
}

.exam-dropdown-list {
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  width: 100%;
  background: white;
  border-radius: 8px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
  z-index: 1000;
  max-height: 300px;
  overflow-y: auto;
}

.exam-dropdown-list::-webkit-scrollbar {
  width: 6px;
}

.exam-dropdown-list::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.exam-dropdown-list::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.exam-dropdown-item {
  padding: 12px 16px;
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  gap: 12px;
  border-bottom: 1px solid #f3f4f6;
}

.exam-dropdown-item:last-child {
  border-bottom: none;
}

.exam-dropdown-item:hover {
  background-color: #f8fafc;
}

.exam-dropdown-item.selected {
  background-color: #eff6ff;
  color: #1d4ed8;
}

/* Dropdown animation */
.dropdown-enter {
  opacity: 0;
  transform: translateY(-10px) scale(0.95);
}

.dropdown-enter-active {
  opacity: 1;
  transform: translateY(0) scale(1);
  transition: opacity 200ms, transform 200ms;
}

.dropdown-exit {
  opacity: 1;
  transform: translateY(0) scale(1);
}

.dropdown-exit-active {
  opacity: 0;
  transform: translateY(-10px) scale(0.95);
  transition: opacity 200ms, transform 200ms;
}

/* Selection card styles */
.selection-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.selection-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 10px;
  color: white;
}

.selection-title {
  font-size: 20px;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
}

.selected-exam {
  margin-top: 16px;
  padding: 12px 16px;
  background: #f0f9ff;
  border: 1px solid #bae6fd;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 12px;
  animation: fadeIn 0.3s ease;
}

.selected-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
}

.pulse-dot {
  width: 8px;
  height: 8px;
  background: #10b981;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

.selected-label {
  font-size: 14px;
  font-weight: 500;
  color: #059669;
}

.exam-name {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 16px;
  font-weight: 500;
  color: #1f2937;
}

.exam-icon {
  width: 16px;
  height: 16px;
  color: #3b82f6;
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.7;
    transform: scale(1.1);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.selection-container {
  position: relative;
  width: 100%;
  max-width: 500px;
  margin: 0 auto;
}

.exam-select-button {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 16px 20px;
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border: 2px solid #e2e8f0;
  border-radius: 16px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  min-height: 56px;
  position: relative;
  overflow: hidden;
}

.exam-select-button::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.exam-select-button:hover {
  border-color: #3b82f6;
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15),
              0 2px 8px rgba(0, 0, 0, 0.05);
}

.exam-select-button:hover::before {
  opacity: 1;
}

.exam-select-button:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.12),
              0 4px 16px rgba(59, 130, 246, 0.2);
}

.exam-select-button:active {
  transform: translateY(0);
}

.placeholder-text {
  color: #94a3b8;
  font-weight: 400;
  letter-spacing: 0.01em;
}

.selected-text {
  color: #0f172a;
  font-weight: 600;
  letter-spacing: -0.01em;
}

.select-arrow {
  display: flex;
  align-items: center;
  color: #64748b;
  flex-shrink: 0;
  transition: color 0.3s ease;
}

.exam-select-button:hover .select-arrow {
  color: #3b82f6;
}

.arrow-icon {
  width: 22px;
  height: 22px;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.05));
}

.exam-dropdown-list {
  position: absolute;
  top: calc(100% + 12px);
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 16px;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12),
              0 4px 12px rgba(0, 0, 0, 0.08);
  max-height: 360px;
  overflow-y: auto;
  z-index: 50;
  padding: 8px;
  list-style: none;
  margin: 0;
  backdrop-filter: blur(10px);
  background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
}

.exam-option {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 16px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 15px;
  color: #334155;
  position: relative;
  overflow: hidden;
}

.exam-option::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(147, 51, 234, 0.08) 100%);
  opacity: 0;
  transition: opacity 0.2s ease;
}

.exam-option:hover {
  background: linear-gradient(135deg, #f1f5f9 0%, #f8fafc 100%);
  transform: translateX(4px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.exam-option:hover::before {
  opacity: 1;
}

.exam-option.active {
  background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
  color: #2563eb;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
  border: 1px solid rgba(59, 130, 246, 0.2);
}

.exam-option.active::before {
  opacity: 0;
}

.option-icon {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  color: #64748b;
  transition: all 0.2s ease;
}

.exam-option:hover .option-icon {
  color: #3b82f6;
  transform: scale(1.1);
}

.exam-option.active .option-icon {
  color: #2563eb;
  transform: scale(1.15);
  filter: drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3));
}

.option-text {
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.5;
  position: relative;
  z-index: 1;
}

.check-icon {
  color: #2563eb;
  font-weight: bold;
  font-size: 20px;
  flex-shrink: 0;
  filter: drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3));
  animation: checkBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes checkBounce {
  0% {
    transform: scale(0) rotate(-45deg);
    opacity: 0;
  }
  50% {
    transform: scale(1.2) rotate(10deg);
  }
  100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
}

/* Mobile responsiveness */
@media (max-width: 640px) {
  .exam-select-button {
    padding: 14px 18px;
    font-size: 15px;
    min-height: 52px;
    border-radius: 14px;
  }
  
  .exam-dropdown-list {
    max-height: 300px;
    border-radius: 14px;
    padding: 6px;
  }
  
  .exam-option {
    padding: 12px 14px;
    font-size: 14px;
    border-radius: 10px;
    gap: 12px;
  }

  .option-icon {
    width: 18px;
    height: 18px;
  }

  .check-icon {
    font-size: 18px;
  }
}

/* Tablet */
@media (max-width: 768px) and (min-width: 641px) {
  .exam-select-button {
    padding: 15px 19px;
  }
  
  .exam-dropdown-list {
    max-height: 320px;
  }
}

/* Scrollbar styling - Modern */
.exam-dropdown-list::-webkit-scrollbar {
  width: 8px;
}

.exam-dropdown-list::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.02);
  border-radius: 10px;
  margin: 8px 0;
}

.exam-dropdown-list::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #cbd5e1 0%, #94a3b8 100%);
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: padding-box;
  transition: background 0.3s ease;
}

.exam-dropdown-list::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, #94a3b8 0%, #64748b 100%);
  background-clip: padding-box;
}

/* Firefox scrollbar */
.exam-dropdown-list {
  scrollbar-width: thin;
  scrollbar-color: #cbd5e1 rgba(0, 0, 0, 0.02);
}

/* Touch device optimization */
@media (hover: none) and (pointer: coarse) {
  .exam-option {
    padding: 16px 14px;
    min-height: 48px;
  }
  
  .exam-select-button {
    min-height: 54px;
  }
}

/* Dark mode support (optional) */
@media (prefers-color-scheme: dark) {
  .exam-select-button {
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    border-color: #334155;
    color: #f1f5f9;
  }
  
  .exam-dropdown-list {
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    border-color: #334155;
  }
  
  .exam-option {
    color: #e2e8f0;
  }
  
  .exam-option:hover {
    background: linear-gradient(135deg, #334155 0%, #1e293b 100%);
  }
  
  .exam-option.active {
    background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
    color: #93c5fd;
  }
}
</file>

<file path="src/components/styles/GrammarReview.css">
/* GrammarReview  flashcard flip + tab fade. Rest in Tailwind. */

/* Flashcard flip (active recall) */
.grammar-flashcard-inner {
  transform-style: preserve-3d;
  transition: transform 0.4s ease;
}
.grammar-flashcard-inner.is-flipped {
  transform: rotateY(180deg);
}
.grammar-flashcard-front,
.grammar-flashcard-back {
  backface-visibility: hidden;
}
.grammar-flashcard-back {
  transform: rotateY(180deg);
}

/* Tab bar: gradient fade on right to hint more content */
.grammar-tabs-fade {
  mask-image: linear-gradient(to right, black 0%, black 85%, transparent 100%);
  -webkit-mask-image: linear-gradient(to right, black 0%, black 85%, transparent 100%);
}
</file>

<file path="src/components/styles/GrammarTopicPage.css">
/* GrammarTopicPage  minimal CSS (confetti + utilities). Layout/colors via Tailwind. */

.grammar-confetti-container {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 100;
}

.grammar-confetti-piece {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 2px;
  animation: grammar-confetti-fall 3s ease-out forwards;
}

@keyframes grammar-confetti-fall {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) rotate(720deg);
    opacity: 0;
  }
}

@media (prefers-reduced-motion: reduce) {
  .grammar-confetti-piece {
    animation-duration: 0.01ms;
  }
}
</file>

<file path="src/components/styles/Navbar.module.css">

</file>

<file path="src/config/routes.js">
export const ROUTES = {
  TEST: '/test',
  FULL_EXAM: '/full-exam',
  GRAMMAR: '/grammar',
  VOCABULARY: '/vocabulary',
  PROFILE: '/profile',
  ANSWERS: '/answers',
  HOME: '/',
  NOT_FOUND: '/not-found',
  // ADMIN: '/admin',
};

/**
 * Navigation helper functions
 */
export const gettestRoute = () => ROUTES.TEST;
export const getHomeRoute = () => ROUTES.HOME;
export const getFullExamRoute = () => ROUTES.FULL_EXAM;
export const getGrammarRoute = () => ROUTES.GRAMMAR;
export const getVocabularyRoute = () => ROUTES.VOCABULARY;
export const getProfileRoute = () => ROUTES.PROFILE;
export const getAnswersRoute = () => ROUTES.ANSWERS;
export const getNotFoundRoute = () => ROUTES.NOT_FOUND;


// export const getAdminRoute = () => ROUTES.ADMIN;
</file>

<file path="src/config/voiceExpression.js">
/**
 *  OPTIMIZED Voice Expression System
 * Ci thin performance, maintainability, v accuracy
 */

// ==================== 1. OPTIMIZED EMOTION DEFINITIONS ====================

export const VOICE_EMOTIONS = {
  NEUTRAL: { rate: 0.9, pitch: 1.0, volume: 0.9, label: 'Neutral', description: 'Normal speaking tone' },
  HAPPY: { rate: 1.1, pitch: 1.15, volume: 1.0, label: 'Happy', description: 'Cheerful, upbeat tone' },
  SAD: { rate: 0.75, pitch: 0.85, volume: 0.8, label: 'Sad', description: 'Slow, low tone' },
  ANGRY: { rate: 0.95, pitch: 1.25, volume: 1.0, label: 'Angry', description: 'Intense, high pitch' },
  EXCITED: { rate: 1.25, pitch: 1.3, volume: 1.0, label: 'Excited', description: 'Fast, energetic tone' },
  SERIOUS: { rate: 0.8, pitch: 0.9, volume: 0.95, label: 'Serious', description: 'Slow, formal tone' },
  CONFUSED: { rate: 0.85, pitch: 1.1, volume: 0.9, label: 'Confused', description: 'Questioning, slightly higher pitch' },
  WHISPER: { rate: 0.7, pitch: 0.95, volume: 0.6, label: 'Whisper', description: 'Soft, quiet tone' },
  LOUD: { rate: 0.9, pitch: 1.05, volume: 1.0, label: 'Loud', description: 'Prominent, confident tone' }
};

// ==================== 2. OPTIMIZED EMOTION KEYWORDS (Compiled Regex) ====================

/**
 *  IMPROVEMENT: Pre-compiled regex patterns untuk trnh recompile nhiu ln
 *  IMPROVEMENT: Grouped emotions logically
 *  IMPROVEMENT: Thm priority ordering (HAPPY trc SAD v HAPPY c word overlap)
 */
const EMOTION_PATTERNS = [
  {
    emotion: 'EXCITED',
    pattern: /\b(wow|amazing|incredible|awesome|fantastic|thrilling|exciting|urgent|genius|brilliant|outstanding)\b/i,
    priority: 1
  },
  {
    emotion: 'HAPPY',
    pattern: /\b(great|good|wonderful|excellent|love|happy|joy|yes|hurray|perfect|lovely|beautiful|fantastic|brilliant)\b/i,
    priority: 1
  },
  {
    emotion: 'ANGRY',
    pattern: /\b(angry|furious|mad|hate|terrible|awful|disgusting|unacceptable|horrible|annoyed|irritated)\b/i,
    priority: 2
  },
  {
    emotion: 'SAD',
    pattern: /\b(sad|depressed|unhappy|unfortunate|terrible|lost|pain|crying|devastated|miserable)\b/i,
    priority: 2
  },
  {
    emotion: 'SERIOUS',
    pattern: /\b(important|critical|serious|must|required|essential|vital|urgent|matter|crucial)\b/i,
    priority: 3
  },
  {
    emotion: 'CONFUSED',
    pattern: /\b(what|why|how|confused|unclear|not sure|question|don't understand|unclear)\b/i,
    priority: 4
  }
];

/**
 *  IMPROVEMENT: Cached emotion detection result
 */
const emotionCache = new Map();

export const detectEmotionFromText = (text, useCache = true) => {
  if (!text || typeof text !== 'string') return VOICE_EMOTIONS.NEUTRAL;

  // Check cache first
  if (useCache && emotionCache.has(text)) {
    return emotionCache.get(text);
  }

  const lowerText = text.toLowerCase();
  let detectedEmotion = VOICE_EMOTIONS.NEUTRAL;
  let highestPriority = Infinity;

  //  IMPROVEMENT: Single pass through patterns (not multiple .test() calls)
  for (const { emotion, pattern, priority } of EMOTION_PATTERNS) {
    if (priority < highestPriority && pattern.test(lowerText)) {
      detectedEmotion = VOICE_EMOTIONS[emotion];
      highestPriority = priority;
    }
  }

  if (useCache) {
    emotionCache.set(text, detectedEmotion);
  }

  return detectedEmotion;
};

// ==================== 3. OPTIMIZED EMPHASIS PATTERNS ====================

/**
 *  IMPROVEMENT: Pre-compile all regex patterns
 *  IMPROVEMENT: Consolidate apply logic
 *  IMPROVEMENT: Add caching for emphasis detection
 */
export const EMPHASIS_PATTERNS = {
  UPPERCASE: {
    pattern: /[A-Z]{2,}/,
    apply: (p) => ({ ...p, pitch: p.pitch * 1.15, volume: Math.min(p.volume * 1.1, 1.0), rate: p.rate * 0.95 }),
    label: 'Uppercase'
  },
  EXCLAMATION: {
    pattern: /!/,
    apply: (p) => ({ ...p, pitch: p.pitch * 1.2, volume: Math.min(p.volume * 1.05, 1.0), rate: p.rate * 0.9 }),
    label: 'Exclamation'
  },
  QUESTION: {
    pattern: /\?/,
    apply: (p) => ({ ...p, pitch: p.pitch * 1.1, rate: p.rate * 0.95 }),
    label: 'Question'
  },
  ELLIPSIS: {
    pattern: /\.{2,}|/,
    apply: (p) => ({ ...p, rate: p.rate * 0.7, pitch: p.pitch * 0.9 }),
    label: 'Ellipsis'
  },
  PARENTHESIS: {
    pattern: /\([^)]+\)/,
    apply: (p) => ({ ...p, volume: Math.max(p.volume * 0.85, 0.5), rate: p.rate * 1.05 }),
    label: 'Parenthesis'
  },
  BRACKET: {
    pattern: /\[[^\]]+\]/,
    apply: (p) => ({ ...p, volume: Math.min(p.volume * 1.15, 1.0), pitch: p.pitch * 1.1 }),
    label: 'Bracket'
  },
  STRESS: {
    pattern: /_[\w\s]+_|\*[\w\s]+\*/,
    apply: (p) => ({ ...p, pitch: p.pitch * 1.25, volume: Math.min(p.volume * 1.1, 1.0), rate: p.rate * 0.85 }),
    label: 'Stress'
  }
};

// ==================== 4. OPTIMIZED PAUSE PATTERNS ====================

export const PAUSE_PATTERNS = {
  SHORT: 200,
  MEDIUM: 500,
  LONG: 1000,
  VERY_LONG: 1500
};

/**
 *  IMPROVEMENT: Simplify pause addition (khng cn Unicode, dng marker instead)
 *  IMPROVEMENT: More efficient regex replacement
 */
export const addPausesToText = (text) => {
  if (!text) return text;
  
  return text
    .replace(/\./g, '.<pause-long/>')
    .replace(/,/g, ',<pause-short/>')
    .replace(/;/g, ';<pause-medium/>')
    .replace(/\?/g, '?<pause-long/>')
    .replace(/!/g, '!<pause-medium/>');
};

/**
 *  IMPROVEMENT: Extract pause info t marked text
 */
export const extractPausesFromText = (markedText) => {
  const pauses = [];
  const regex = /<pause-(short|medium|long)\/>/g;
  let match;

  while ((match = regex.exec(markedText)) !== null) {
    pauses.push({
      position: match.index,
      duration: PAUSE_PATTERNS[match[1].toUpperCase()]
    });
  }

  return pauses;
};

/**
 *  IMPROVEMENT: Remove pause markers  text cleaner
 */
export const removePauseMarkers = (text) => {
  return text.replace(/<pause-\w+\/>/g, '');
};

// ==================== 5. OPTIMIZED STRESS MARKERS ====================

export const STRESS_MARKERS = {
  ASTERISK: /\*([^*]+)\*/g,
  UNDERSCORE: /_([^_]+)_/g,
  DOUBLE_CAPS: /\b([A-Z]{2,})\b/g
};

/**
 *  IMPROVEMENT: Extract stress words in single pass
 */
export const extractStressWords = (text) => {
  const stressWords = new Set();
  
  for (const [, pattern] of Object.entries(STRESS_MARKERS)) {
    let match;
    const tempPattern = new RegExp(pattern.source, 'g');
    while ((match = tempPattern.exec(text)) !== null) {
      stressWords.add(match[1] || match[0]);
    }
  }

  return Array.from(stressWords);
};

// ==================== 6. OPTIMIZED EMOTION EXTRACTION ====================

/**
 *  IMPROVEMENT: Extract emotion marker quickly
 */
const EMOTION_MARKER_REGEX = /^\{([A-Z_]+)\}\s*/;

export const extractEmotionMarker = (text) => {
  if (!text || typeof text !== 'string') {
    return { emotion: null, cleanText: text };
  }

  const match = text.match(EMOTION_MARKER_REGEX);
  if (match && VOICE_EMOTIONS[match[1]]) {
    return {
      emotion: VOICE_EMOTIONS[match[1]],
      cleanText: text.slice(match[0].length)
    };
  }

  return { emotion: null, cleanText: text };
};

// ==================== 7. OPTIMIZED TEXT CLEANING ====================

/**
 *  IMPROVEMENT: Single pass text cleaning
 *  IMPROVEMENT: Efficient string manipulation
 */
const MARKER_PATTERNS = [
  { regex: /\*([^*]+)\*/g, replace: '$1' },      // *word* -> word
  { regex: /_([^_]+)_/g, replace: '$1' },        // _word_ -> word
  { regex: /\[[^\]]+\]/g, replace: (m) => m.slice(1, -1) }, // [text] -> text
  { regex: /\([^)]+\)/g, replace: (m) => m.slice(1, -1) }   // (text) -> text
];

export const cleanTextMarkers = (text) => {
  if (!text) return text;
  
  return MARKER_PATTERNS.reduce((acc, { regex, replace }) => 
    acc.replace(regex, replace), text
  );
};

// ==================== 8. MAIN OPTIMIZATION: getFinalVoiceParams ====================

/**
 *  IMPROVEMENT: Optimized parameter calculation
 *  IMPROVEMENT: Single calculation pass
 *  IMPROVEMENT: Avoid unnecessary multiplications
 */
const MULTIPLIER_BASE = 1.0 / VOICE_EMOTIONS.NEUTRAL.rate; // Pre-calculate

export const getFinalVoiceParams = (baseParams, text, emotionOverride = null) => {
  if (!baseParams || !text) {
    return { rate: 0.9, pitch: 1.0, volume: 0.9 };
  }

  // Step 1: Get emotion
  const emotion = emotionOverride || detectEmotionFromText(text, true);
  
  // Step 2: Calculate emotion multipliers (avoid division, pre-calculate if possible)
  const rateMultiplier = emotion.rate / VOICE_EMOTIONS.NEUTRAL.rate;
  const pitchMultiplier = emotion.pitch / VOICE_EMOTIONS.NEUTRAL.pitch;
  const volumeMultiplier = emotion.volume / VOICE_EMOTIONS.NEUTRAL.volume;

  // Step 3: Apply emotion to base
  let params = {
    rate: baseParams.rate * rateMultiplier,
    pitch: baseParams.pitch * pitchMultiplier,
    volume: baseParams.volume * volumeMultiplier
  };

  // Step 4: Apply emphasis patterns (early exit if no matches)
  for (const [, patternObj] of Object.entries(EMPHASIS_PATTERNS)) {
    if (patternObj.pattern.test(text)) {
      params = patternObj.apply(params);
    }
  }

  // Step 5: Clamp values (optimized)
  return {
    rate: Math.max(0.5, Math.min(2.0, params.rate)),
    pitch: Math.max(0.5, Math.min(2.0, params.pitch)),
    volume: Math.max(0.0, Math.min(1.0, params.volume))
  };
};

// ==================== 9. BATCH PROCESSING (NEW) ====================

/**
 *  NEW FEATURE: Process multiple texts efficiently
 * Trnh recompile regex + emotion detection nhiu ln
 */
export const getFinalVoiceParamsBatch = (baseParams, texts, emotionOverride = null) => {
  return texts.map((text, index) => ({
    index,
    text,
    params: getFinalVoiceParams(baseParams, text, emotionOverride),
    emotion: detectEmotionFromText(text, true)
  }));
};

// ==================== 10. CACHE MANAGEMENT ====================

export const clearEmotionCache = () => {
  emotionCache.clear();
  console.log(' Emotion cache cleared');
};

export const getCacheStats = () => {
  return {
    cachedEmotions: emotionCache.size,
    cacheMemory: `~${emotionCache.size * 0.1}KB` // Rough estimate
  };
};

// ==================== 11. VALIDATION & DEBUGGING ====================

/**
 *  NEW: Validate and debug voice parameters
 */
export const validateVoiceParams = (params) => {
  const issues = [];

  if (params.rate < 0.5 || params.rate > 2.0) issues.push(`Rate ${params.rate} out of range`);
  if (params.pitch < 0.5 || params.pitch > 2.0) issues.push(`Pitch ${params.pitch} out of range`);
  if (params.volume < 0.0 || params.volume > 1.0) issues.push(`Volume ${params.volume} out of range`);

  return {
    valid: issues.length === 0,
    issues
  };
};

/**
 *  NEW: Debug emotion detection
 */
export const debugEmotionDetection = (text) => {
  const { emotion, cleanText } = extractEmotionMarker(text);
  const detectedEmotion = detectEmotionFromText(cleanText || text, false); // No cache for debug
  const stressWords = extractStressWords(text);

  return {
    text,
    markerEmotion: emotion,
    detectedEmotion,
    stressWords,
    hasExclamation: /!/.test(text),
    hasQuestion: /\?/.test(text),
    hasEllipsis: /\.{2,}|/.test(text)
  };
};

// ==================== EXPORT DEFAULT ====================

export default {
  // Core
  VOICE_EMOTIONS,
  EMPHASIS_PATTERNS,
  PAUSE_PATTERNS,
  STRESS_MARKERS,

  // Detection & Processing
  detectEmotionFromText,
  extractEmotionMarker,
  extractStressWords,
  extractPausesFromText,
  
  // Text Cleaning
  cleanTextMarkers,
  addPausesToText,
  removePauseMarkers,

  // Voice Parameters
  getFinalVoiceParams,
  getFinalVoiceParamsBatch,
  validateVoiceParams,

  // Debugging
  debugEmotionDetection,
  clearEmotionCache,
  getCacheStats
};

// ==================== USAGE EXAMPLE ====================

/**
 *  USAGE:
 * 
 * // Basic usage
 * const baseParams = { rate: 1.0, pitch: 1.0, volume: 0.9 };
 * const text = "This is AMAZING!";
 * const voiceParams = getFinalVoiceParams(baseParams, text);
 * 
 * // With emotion marker
 * const markedText = "{EXCITED} This is amazing!";
 * const { emotion, cleanText } = extractEmotionMarker(markedText);
 * const voiceParams = getFinalVoiceParams(baseParams, cleanText, emotion);
 * 
 * // Batch processing
 * const texts = ["Great!", "Why?", "*Really* important"];
 * const results = getFinalVoiceParamsBatch(baseParams, texts);
 * 
 * // Debug
 * console.log(debugEmotionDetection("{EXCITED} Wow!"));
 * console.log(getCacheStats());
 */
</file>

<file path="src/data/vocabularyData.js">
// src/data/vocabularyData.js
import { vocabularyDataLevel1 } from './vocabulary/vocabularyDataLevel1.js';
import { vocabularyDataLevel2 } from './vocabulary/vocabularyDataLevel2.js';
import { vocabularyDataLevel3 } from './vocabulary/vocabularyDataLevel3.js';
import { vocabularyDataLevel4 } from './vocabulary/vocabularyDataLevel4.js';
import { vocabularyDataLevel5 } from './vocabulary/vocabularyDataLevel5.js';

const mergeData = () => {
  const result = {};
  [vocabularyDataLevel1, vocabularyDataLevel2, vocabularyDataLevel3, vocabularyDataLevel4, vocabularyDataLevel5].forEach(data => {
    Object.entries(data).forEach(([topic, subtopics]) => {
      if (!result[topic]) result[topic] = {};
      Object.entries(subtopics).forEach(([sub, words]) => {
        if (!result[topic][sub]) result[topic][sub] = [];
        result[topic][sub].push(...words);
      });
    });
  });
  return result;
};

export const vocabularyData = mergeData();
</file>

<file path="src/hooks/useAppState.js">
import { useReducer, useRef, useCallback } from 'react';

const initialState = {
  // UI States
  showInstructions: true,
  showVoiceControls: true,
  showAuthModal: false,
  
  // Test States
  selectedExam: 'exam1',
  testType: 'listening',
  practiceType: '',
  selectedPart: 'part1',
  currentQuestionIndex: 0,
  rate: 1.0,
  answers: {},
  showResults: false,
};

const actionTypes = {
  // UI Actions
  SET_SHOW_INSTRUCTIONS: 'SET_SHOW_INSTRUCTIONS',
  SET_SHOW_VOICE_CONTROLS: 'SET_SHOW_VOICE_CONTROLS',
  SET_SHOW_AUTH_MODAL: 'SET_SHOW_AUTH_MODAL',
  
  // Test Actions
  SET_EXAM: 'SET_EXAM',
  SET_TEST_TYPE: 'SET_TEST_TYPE',
  SET_PRACTICE_TYPE: 'SET_PRACTICE_TYPE',
  SET_PART: 'SET_PART',
  SET_QUESTION_INDEX: 'SET_QUESTION_INDEX',
  SET_RATE: 'SET_RATE',
  SET_ANSWER: 'SET_ANSWER',
  RESET_ANSWERS: 'RESET_ANSWERS',
  SET_SHOW_RESULTS: 'SET_SHOW_RESULTS',
  RESET_TEST: 'RESET_TEST',
};

const reducer = (state, action) => {
  switch (action.type) {
    case actionTypes.SET_SHOW_INSTRUCTIONS:
      return { ...state, showInstructions: action.payload };
    
    case actionTypes.SET_SHOW_VOICE_CONTROLS:
      return { ...state, showVoiceControls: action.payload };
    
    case actionTypes.SET_SHOW_AUTH_MODAL:
      return { ...state, showAuthModal: action.payload };
    
    case actionTypes.SET_EXAM:
      return {
        ...state,
        selectedExam: action.payload,
        selectedPart: 'part1',
        currentQuestionIndex: 0,
        answers: {},
        showResults: false,
      };
    
    case actionTypes.SET_TEST_TYPE:
      return {
        ...state,
        testType: action.payload,
        practiceType: '',
        selectedPart: action.payload === 'listening' ? 'part1' : 'part5',
        currentQuestionIndex: 0,
        answers: {},
        showResults: false,
      };
    
    case actionTypes.SET_PRACTICE_TYPE:
      return {
        ...state,
        practiceType: action.payload,
        testType: '',
        selectedPart: '',
        currentQuestionIndex: 0,
        answers: {},
        showResults: false,
      };
    
    case actionTypes.SET_PART:
      return {
        ...state,
        selectedPart: action.payload,
        currentQuestionIndex: 0,
        answers: {},
        showResults: false,
      };
    
    case actionTypes.SET_QUESTION_INDEX:
      return { ...state, currentQuestionIndex: action.payload };
    
    case actionTypes.SET_RATE:
      return { ...state, rate: action.payload };
    
    case actionTypes.SET_ANSWER:
      return {
        ...state,
        answers: { ...state.answers, [action.payload.questionId]: action.payload.answer },
      };
    
    case actionTypes.RESET_ANSWERS:
      return { ...state, answers: {}, showResults: false, currentQuestionIndex: 0 };
    
    case actionTypes.SET_SHOW_RESULTS:
      return { ...state, showResults: action.payload };
    
    case actionTypes.RESET_TEST:
      return {
        ...state,
        selectedPart: 'part1',
        currentQuestionIndex: 0,
        answers: {},
        showResults: false,
        rate: 1.0,
      };
    
    default:
      return state;
  }
};

// Helper to clear speech synthesis
const cancelSpeech = () => {
  try {
    window.speechSynthesis?.cancel();
  } catch (e) {
    console.error('Error canceling speech:', e);
  }
};

export const useAppState = () => {
  const [state, dispatch] = useReducer(reducer, initialState);
  const callbackCacheRef = useRef({});

  // Create callbacks only once - stored in ref to maintain stable references
  if (!callbackCacheRef.current.handleExamChange) {
    callbackCacheRef.current = {
      handleExamChange: (e) => {
        cancelSpeech();
        dispatch({ type: actionTypes.SET_EXAM, payload: e.target.value });
      },
      
      handleTestTypeChange: (value) => {
        cancelSpeech();
        dispatch({ type: actionTypes.SET_TEST_TYPE, payload: value });
      },
      
      handlePracticeTypeChange: (value) => {
        cancelSpeech();
        dispatch({ type: actionTypes.SET_PRACTICE_TYPE, payload: value });
      },
      
      handlePartChange: (e) => {
        cancelSpeech();
        dispatch({ type: actionTypes.SET_PART, payload: e.target.value });
      },
      
      handleAnswerSelect: (questionId, answerIndex) => {
        dispatch({ 
          type: actionTypes.SET_ANSWER, 
          payload: { questionId, answer: answerIndex } 
        });
      },
      
      handleSubmit: () => {
        dispatch({ type: actionTypes.SET_SHOW_RESULTS, payload: true });
      },
      
      handleReset: () => {
        cancelSpeech();
        dispatch({ type: actionTypes.RESET_ANSWERS });
      },
      
      // UI Handlers
      toggleInstructions: (value) => {
        dispatch({ type: actionTypes.SET_SHOW_INSTRUCTIONS, payload: value });
      },
      
      toggleVoiceControls: (value) => {
        dispatch({ type: actionTypes.SET_SHOW_VOICE_CONTROLS, payload: value });
      },
      
      toggleAuthModal: (value) => {
        dispatch({ type: actionTypes.SET_SHOW_AUTH_MODAL, payload: value });
      },
      
      setRate: (rate) => {
        dispatch({ type: actionTypes.SET_RATE, payload: rate });
      },
      
      setCurrentQuestionIndex: (index) => {
        dispatch({ type: actionTypes.SET_QUESTION_INDEX, payload: index });
      },
    };
  }

  return {
    // UI States
    showInstructions: state.showInstructions,
    showVoiceControls: state.showVoiceControls,
    showAuthModal: state.showAuthModal,
    
    // Test States
    selectedExam: state.selectedExam,
    testType: state.testType,
    practiceType: state.practiceType,
    selectedPart: state.selectedPart,
    currentQuestionIndex: state.currentQuestionIndex,
    rate: state.rate,
    answers: state.answers,
    showResults: state.showResults,
    
    // Event Handlers - stable references
    handleExamChange: callbackCacheRef.current.handleExamChange,
    handleTestTypeChange: callbackCacheRef.current.handleTestTypeChange,
    handlePracticeTypeChange: callbackCacheRef.current.handlePracticeTypeChange,
    handlePartChange: callbackCacheRef.current.handlePartChange,
    handleAnswerSelect: callbackCacheRef.current.handleAnswerSelect,
    handleSubmit: callbackCacheRef.current.handleSubmit,
    handleReset: callbackCacheRef.current.handleReset,
    toggleInstructions: callbackCacheRef.current.toggleInstructions,
    toggleVoiceControls: callbackCacheRef.current.toggleVoiceControls,
    toggleAuthModal: callbackCacheRef.current.toggleAuthModal,
    setRate: callbackCacheRef.current.setRate,
    setCurrentQuestionIndex: callbackCacheRef.current.setCurrentQuestionIndex,
  };
};

export default useAppState;
</file>

<file path="src/hooks/useFirestore.js">
import { useState, useEffect, useCallback, useRef } from "react";
import {
  collection,
  addDoc,
  updateDoc,
  deleteDoc,
  doc,
  getDocs,
  serverTimestamp,
  query,
  where,
  orderBy,
  limit,
  onSnapshot,
  getCountFromServer,
} from "firebase/firestore";
import { db } from "../config/firebase";

export const useFirestore = (collectionName) => {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const unsubscribeRef = useRef(null);

  // -----------------------------------------
  // 1. GET ALL DOCUMENTS (ONCE)
  // -----------------------------------------
  const getAll = useCallback(
    async (filters = [], sort = null, limitSize = null) => {
      try {
        setLoading(true);

        let q = collection(db, collectionName);

        // Apply filters WHERE
        if (filters.length > 0) {
          filters.forEach((f) => {
            q = query(q, where(f.field, f.op, f.value));
          });
        }

        // Apply ORDER BY
        if (sort) {
          q = query(q, orderBy(sort.field, sort.direction ?? "asc"));
        }

        // Apply LIMIT
        if (limitSize) {
          q = query(q, limit(limitSize));
        }

        const snapshot = await getDocs(q);
        const docs = snapshot.docs.map((d) => ({ id: d.id, ...d.data() }));
        setData(docs);
        setError(null);
        return docs;
      } catch (err) {
        setError(err.message);
        console.error(" getAll error:", err);
        return [];
      } finally {
        setLoading(false);
      }
    },
    [collectionName]
  );

  // -----------------------------------------
  // 2. REALTIME SUBSCRIBE
  // -----------------------------------------
  const subscribe = useCallback(
    (filters = [], sort = null, limitSize = null) => {
      try {
        let q = collection(db, collectionName);

        if (filters.length > 0) {
          filters.forEach((f) => {
            q = query(q, where(f.field, f.op, f.value));
          });
        }

        if (sort) {
          q = query(q, orderBy(sort.field, sort.direction ?? "asc"));
        }

        if (limitSize) {
          q = query(q, limit(limitSize));
        }

        if (unsubscribeRef.current) unsubscribeRef.current();

        const unsub = onSnapshot(
          q,
          (snapshot) => {
            const docs = snapshot.docs.map((d) => ({
              id: d.id,
              ...d.data(),
            }));
            setData(docs);
            setError(null);
          },
          (err) => {
            setError(err.message);
            console.error(" Snapshot error:", err);
          }
        );

        unsubscribeRef.current = unsub;

        return unsub;
      } catch (err) {
        setError(err.message);
        console.error(" subscribe error:", err);
      }
    },
    [collectionName]
  );

  // -----------------------------------------
  // 3. GET COUNT (AGGREGATION  SIU R)
  // -----------------------------------------
  const getCount = useCallback(async (filters = []) => {
    try {
      let q = collection(db, collectionName);

      if (filters.length > 0) {
        filters.forEach((f) => {
          q = query(q, where(f.field, f.op, f.value));
        });
      }

      const snapshot = await getCountFromServer(q);
      return snapshot.data().count;
    } catch (err) {
      console.error(" getCount error:", err);
      return 0;
    }
  }, [collectionName]);

  // -----------------------------------------
  // 4. LISTEN TO ONE DOCUMENT
  // -----------------------------------------
  const subscribeDoc = useCallback((docId, callback) => {
    try {
      const ref = doc(db, collectionName, docId);

      const unsub = onSnapshot(
        ref,
        (snapshot) => {
          callback(snapshot.exists() ? { id: snapshot.id, ...snapshot.data() } : null);
        },
        (err) => console.error(" subscribeDoc error:", err)
      );

      return unsub;
    } catch (err) {
      console.error(" subscribeDoc error:", err);
    }
  }, [collectionName]);

  // -----------------------------------------
  // 5. ADD DOCUMENT
  // -----------------------------------------
  const add = useCallback(
    async (newData) => {
      try {
        setLoading(true);
        const docRef = await addDoc(collection(db, collectionName), {
          ...newData,
          createdAt: serverTimestamp(),
        });
        setError(null);
        return docRef.id;
      } catch (err) {
        setError(err.message);
        console.error(" add error:", err);
      } finally {
        setLoading(false);
      }
    },
    [collectionName]
  );

  // -----------------------------------------
  // 6. UPDATE DOCUMENT
  // -----------------------------------------
  const update = useCallback(
    async (docId, updatedData) => {
      try {
        setLoading(true);
        await updateDoc(doc(db, collectionName, docId), {
          ...updatedData,
          updatedAt: serverTimestamp(),
        });
        setError(null);
      } catch (err) {
        setError(err.message);
        console.error(" update error:", err);
      } finally {
        setLoading(false);
      }
    },
    [collectionName]
  );

  // -----------------------------------------
  // 7. DELETE DOCUMENT
  // -----------------------------------------
  const remove = useCallback(
    async (docId) => {
      try {
        setLoading(true);
        await deleteDoc(doc(db, collectionName, docId));
        setError(null);
      } catch (err) {
        setError(err.message);
        console.error(" delete error:", err);
      } finally {
        setLoading(false);
      }
    },
    [collectionName]
  );

  // Cleanup listener on unmount
  useEffect(() => {
    return () => {
      if (unsubscribeRef.current) {
        unsubscribeRef.current();
      }
    };
  }, []);

  return {
    data,
    loading,
    error,

    // MAIN API
    getAll,
    subscribe,
    getCount,
    subscribeDoc,

    // CRUD
    add,
    update,
    remove,
  };
};

export default useFirestore;
</file>

<file path="src/hooks/useUnifiedAuth.js">
import { useFirebaseAuth } from './useFirebaseAuth';

/**
 * Hook thng nht authentication - ch dng Firebase
 * Clerk  b loi b khi d n
 */
export const useUnifiedAuth = () => {
  // Ch s dng Firebase authentication
  const firebaseAuth = useFirebaseAuth();

  const isLoaded = firebaseAuth.isLoaded;
  const isSignedIn = firebaseAuth.isSignedIn;
  
  // Ly user t Firebase
  let user = null;
  let authProvider = 'firebase'; // Lun l 'firebase' by gi

  if (firebaseAuth.isSignedIn && firebaseAuth.user) {
    user = firebaseAuth.user;
    console.log(' [useUnifiedAuth] Firebase user authenticated');
  } else if (isLoaded) {
    console.log(' [useUnifiedAuth] No user logged in (auth loaded)');
  }

  return {
    isSignedIn,
    isLoaded,
    user,
    authProvider, // Lun l 'firebase'
    firebaseAuth,
  };
};

export default useUnifiedAuth;
</file>

<file path="src/pages/HomePage.jsx">
import React, { memo, useCallback, useMemo } from 'react'
import { useNavigate } from 'react-router-dom'
import {
  Users, ArrowRight, Zap, TrendingUp,
  Headphones, FileText, Brain, Database, Rocket, MousePointer2, Star
} from 'lucide-react'

import { ROUTES } from '../config/routes'
import { useAppState } from '../hooks/useAppState'
import { useOnlineUsers } from '../hooks/useOnlineUsers'
import MemoizedHeaderSection from '../components/sections/HeaderSection'

/* ===================== SMALL PURE COMPONENTS ===================== */

const StatCard = memo(({ Icon, value, label }) => (
  <div className="flex flex-col items-center md:items-start p-6 bg-white rounded-3xl border border-slate-100 shadow-sm hover:shadow-md transition">
    <div className="w-10 h-10 rounded-xl bg-blue-50 flex items-center justify-center mb-4">
      <Icon className="w-5 h-5 text-blue-600" />
    </div>
    <span className="text-3xl font-black text-slate-900">{value}</span>
    <span className="text-xs font-bold text-slate-400 uppercase mt-1">{label}</span>
  </div>
))

const FeatureCard = memo(({ Icon, title, description, gradient, number, onClick }) => (
  <div
    onClick={onClick}
    className="group cursor-pointer bg-white border border-slate-100 p-6 sm:p-8 rounded-[2rem] shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 relative"
  >
    <div className={`w-12 h-12 rounded-2xl bg-gradient-to-br ${gradient} flex items-center justify-center mb-6`}>
      <Icon className="w-6 h-6 text-white" />
    </div>

    <h3 className="text-lg sm:text-xl font-bold text-slate-900 mb-2">{title}</h3>
    <p className="text-sm text-slate-500 font-medium leading-relaxed mb-6 line-clamp-3">{description}</p>

    <div className="flex items-center gap-2 text-blue-600 font-bold text-xs uppercase">
      <span>Khm ph bi hc</span>
      <ArrowRight className="w-4 h-4 group-hover:translate-x-1 transition" />
    </div>

    <div className="absolute top-4 right-6 text-5xl font-black text-slate-50 italic select-none">
      0{number}
    </div>
  </div>
))

/* ===================== MAIN ===================== */

const HomePage = memo(() => {
  const navigate = useNavigate()
  const { onlineCount } = useOnlineUsers()
  const { isSignedIn, user, handleTestTypeChange } = useAppState()

  /* stable callbacks */
  const goFullTest = useCallback(() => {
    handleTestTypeChange('full')
    navigate(ROUTES.FULL_EXAM)
  }, [navigate, handleTestTypeChange])

  const goListening = useCallback(() => {
    handleTestTypeChange('listening')
    navigate(ROUTES.TEST)
  }, [navigate, handleTestTypeChange])

  const goReading = useCallback(() => {
    handleTestTypeChange('reading')
    navigate(ROUTES.TEST)
  }, [navigate, handleTestTypeChange])

  const features = useMemo(() => [
    {
      number: '1',
      Icon: Headphones,
      title: 'Listening Lab',
      description: 'H thng bi nghe m phng thc t vi tc  linh hot.',
      gradient: 'from-blue-600 to-blue-400',
      onClick: goListening
    },
    {
      number: '2',
      Icon: FileText,
      title: 'Reading Pro',
      description: 'Kho d liu bi c phong ph km gii thch t vng.',
      gradient: 'from-cyan-500 to-teal-400',
      onClick: goReading
    },
    {
      number: '3',
      Icon: Brain,
      title: 'Grammar Master',
      description: 'Hc ng php qua s  t duy v bi tp p dng.',
      gradient: 'from-indigo-600 to-blue-500',
      onClick: () => navigate(ROUTES.GRAMMAR)
    },
    {
      number: '4',
      Icon: Database,
      title: 'Vocab Vault',
      description: 'Ghi nh t vng qua phng php Spaced Repetition.',
      gradient: 'from-violet-600 to-purple-500',
      onClick: () => navigate(ROUTES.VOCABULARY)
    }
  ], [goListening, goReading, navigate])

  return (
    <div className="min-h-screen bg-[#FDFEFF] text-slate-900 font-sans">
      <MemoizedHeaderSection isSignedIn={isSignedIn} user={user} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-28">

        {/* HERO */}
        <section className="grid lg:grid-cols-2 gap-12 items-center">
          <div className="space-y-8 text-center lg:text-left">
            <h1 className="text-4xl sm:text-6xl lg:text-7xl font-black leading-tight">
              Luyn thi <br />
              <span className="text-blue-600">Thng minh hn</span>
            </h1>

            <p className="text-base sm:text-lg text-slate-500 max-w-xl mx-auto lg:mx-0 font-medium">
              Prep.vn (HUFLIT Edition) ng hnh cng bn chinh phc chun u ra.
            </p>

            <div className="flex flex-col sm:flex-row gap-4">
              <button
                onClick={goFullTest}
                className="px-8 py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg hover:bg-blue-700 transition"
              >
                <Rocket className="w-5 h-5 inline mr-2" />
                Thi th Full Test
              </button>

              <button className="px-8 py-4 bg-white border border-slate-200 rounded-2xl font-bold hover:bg-slate-50 transition">
                <MousePointer2 className="w-5 h-5 inline mr-2" />
                Dng th Free
              </button>
            </div>
          </div>

          <div className="hidden lg:block">
            <img
              src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=800&q=80"
              alt="Students learning"
              loading="lazy"
              decoding="async"
              className="rounded-[3rem] shadow-xl"
            />
          </div>
        </section>

        {/* STATS */}
        <section className="grid grid-cols-2 lg:grid-cols-4 gap-6">
          <StatCard Icon={Users} value="5,000+" label="Hc vin tin dng" />
          <StatCard Icon={Zap} value={onlineCount || '320'} label="ang luyn tp" />
          <StatCard Icon={Star} value="4.9/5" label="nh gi cht lng" />
          <StatCard Icon={TrendingUp} value="95%" label="T l t chun" />
        </section>

        {/* FEATURES */}
        <section className="space-y-12">
          <h2 className="text-3xl sm:text-4xl font-black text-center lg:text-left">
            Luyn tp <span className="text-blue-600">a k nng</span>
          </h2>

          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            {features.map((f) => (
              <FeatureCard key={f.number} {...f} />
            ))}
          </div>
        </section>

        {/* CTA */}
        <section className="bg-blue-600 rounded-[3rem] px-8 py-16 text-center">
          <h2 className="text-4xl sm:text-6xl font-black text-white">
            Bt u l trnh t im cao ngay!
          </h2>
          <button
            onClick={goFullTest}
            className="mt-8 bg-white text-blue-600 px-12 py-5 rounded-2xl font-black text-xl shadow-lg hover:scale-105 transition"
          >
            VO THI NGAY <ArrowRight className="inline ml-2" />
          </button>
        </section>

      </main>
    </div>
  )
})

HomePage.displayName = 'HomePage'
export default HomePage
</file>

<file path="vercel.json">
{
  "rewrites": [
    {
      "source": "/((?!audio|assets|favicon.ico|robots.txt|manifest.json).*)",
      "destination": "/index.html"
    }
  ]
}
</file>

<file path="scripts/uploadExamData.js">
import admin from 'firebase-admin';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ============================================
// Initialize Firebase
// ============================================
const serviceAccountPath = path.join(__dirname, 'serviceAccountKey.json');

if (!fs.existsSync(serviceAccountPath)) {
  console.error('\nERROR: serviceAccountKey.json not found!');
  console.error('Expected: scripts/serviceAccountKey.json\n');
  console.error('How to fix: Generate from Firebase Console > Project Settings > Service Accounts > Generate New Private Key');
  process.exit(1);
}

const serviceAccount = JSON.parse(fs.readFileSync(serviceAccountPath, 'utf8'));

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  projectId: 'huflit-test-4ce25'
});

const db = admin.firestore();

// ============================================
// Import Individual Exam Files
// ============================================
let EXAMS = {}; // { exam1: EXAM1_DATA, exam2: EXAM2_DATA, ... exam12: EXAM12_DATA }

const examNumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];

try {
  for (const num of examNumbers) {
    const examKey = `exam${num}`;
    const examModule = await import(`../src/data/exams/${examKey}.js`);
    const dataKey = `EXAM${num}_DATA`;
    EXAMS[examKey] = examModule[dataKey] || examModule.default || {};
    console.log(`${examKey}.js loaded`);
  }
} catch (e) {
  console.error('Import error for one or more exam files:', e.message);
  console.error('Fix: Ensure files exist at src/data/exams/exam1.js through exam12.js and export const EXAMN_DATA = { ... };');
  process.exit(1);
}

if (Object.keys(EXAMS).length < 12) {
  console.error('Less than 12 exams loaded. Check files.');
  process.exit(1);
}

console.log('Loaded exams:', Object.keys(EXAMS).length);

// ============================================
// Utility Functions
// ============================================
function cleanData(obj) {
  if (obj === null || obj === undefined) return null;
  if (Array.isArray(obj)) {
    return obj.map(item => cleanData(item)).filter(item => item !== null);
  }
  if (typeof obj !== 'object') return obj;
  
  const cleaned = {};
  for (const [key, value] of Object.entries(obj)) {
    if (value !== undefined && value !== null) {
      if (typeof value === 'object') {
        cleaned[key] = cleanData(value);
      } else {
        cleaned[key] = value;
      }
    }
  }
  return cleaned;
}

function logSection(title) {
  console.log(`\n${'='.repeat(60)}`);
  console.log(title);
  console.log(`${'='.repeat(60)}`);
}

function logSuccess(msg) {
  console.log(`  ${msg}`);
}

function logInfo(msg) {
  console.log(`  ${msg}`);
}

function logError(msg) {
  console.log(`  ${msg}`);
}

// ============================================
// Upload Functions
// ============================================
async function uploadExamMetadata() {
  logSection('Uploading Exam Metadata');

  let totalExams = 0;

  for (const [examKey, examData] of Object.entries(EXAMS)) {
    const examId = examKey; // e.g., exam1
    console.log(`\n  Exam: ${examId}`);

    try {
      // Upload exam metadata
      await db.collection('examData').doc(examId).set(
        cleanData({
          id: examId,
          title: examData.title || examId,
          description: examData.description || '',
          type: 'exam',
          totalParts: Object.keys(examData.parts || {}).length,
          totalQuestions: Object.values(examData.parts || {}).reduce((acc, part) => acc + (part.questions || []).length, 0),
          createdAt: new Date()
        }),
        { merge: true }
      );
      logSuccess(`${examId} metadata`);

      totalExams++;
    } catch (error) {
      logError(`${examId}: ${error.message}`);
    }
  }

  console.log(`\nTotal exams metadata uploaded/updated: ${totalExams}`);
  return totalExams;
}

async function uploadExamParts() {
  logSection('Uploading Exam Parts');

  let totalParts = 0;

  for (const [examKey, examData] of Object.entries(EXAMS)) {
    const examId = examKey;
    if (!examData.parts) {
      logInfo(`${examId}: No parts found, skipping.`);
      continue;
    }

    for (const [partId, partData] of Object.entries(examData.parts)) {
      const docId = `${examId}__${partId}`;

      try {
        // Clean questions array - Ensure explanation exists for each
        const cleanQuestions = (partData.questions || []).map(q => ({
          id: q.id,
          question: q.question || '',
          options: q.options || [],
          correct: q.correct || 0,
          explanation: q.explanation || 'No explanation provided.' // Fallback if missing
        })).filter(q => q.question); // Only keep if question exists

        await db.collection('examData').doc(docId).set(
          cleanData({
            examId,
            examTitle: examData.title,
            partId,
            title: partData.title || partId,
            description: partData.description || '',
            type: partData.type || 'listening',
            script: partData.script || '', // For audio/text
            questionsCount: cleanQuestions.length,
            questions: cleanQuestions,
            createdAt: new Date()
          }),
          { merge: true }
        );

        totalParts++;
        logSuccess(`${examId} - ${partData.title || partId} (${cleanQuestions.length} questions)`);
      } catch (error) {
        logError(`${docId}: ${error.message}`);
      }
    }
  }

  console.log(`\nTotal exam parts uploaded/updated: ${totalParts}`);
  return totalParts;
}

async function uploadExamStats() {
  logSection('Uploading Exam Statistics');

  try {
    let totalQuestions = 0;
    let totalParts = 0;
    let totalExams = Object.keys(EXAMS).length;

    for (const examData of Object.values(EXAMS)) {
      for (const partData of Object.values(examData.parts || {})) {
        totalParts++;
        totalQuestions += (partData.questions || []).length;
      }
    }

    const stats = {
      totalExams,
      totalParts,
      totalQuestions,
      updatedAt: new Date()
    };

    await db.collection('metadata').doc('examStats').set(stats, { merge: true });
    
    logSuccess('Exam statistics updated');
    console.log(`   Exams: ${totalExams}`);
    console.log(`   Parts: ${totalParts}`);
    console.log(`   Questions: ${totalQuestions}`);
  } catch (error) {
    logError(`Statistics: ${error.message}`);
  }
}

// ============================================
// Main
// ============================================
async function main() {
  logSection('Firebase Exam Data Upload (Fixed Version - Separate Imports)');
  logInfo('This will upload data from exam1.js through exam12.js to Firebase');

  try {
    console.log('\nLoading exam files...\n');

    const exams = await uploadExamMetadata();
    const parts = await uploadExamParts();
    await uploadExamStats();

    logSection('Upload Complete!');
    console.log(`\nSummary:`);
    console.log(`   Exams: ${exams}`);
    console.log(`   Parts: ${parts}`);
    console.log(`\nAll exam data from 12 files successfully uploaded to Firebase Firestore!`);
    console.log(`\nView your data:`);
    console.log(`   https://console.firebase.google.com/u/0/project/huflit-test-4ce25/firestore (collection: examData)\n`);

    process.exit(0);
  } catch (error) {
    console.error('\nFatal error:', error.message);
    process.exit(1);
  }
}

main();
</file>

<file path="src/components/Display/PartSelector.jsx">
import React, { useCallback, useMemo, useState, memo, useEffect } from 'react';
import { ChevronDown, BookOpen, Headphones, Zap, Target, Award, ListChecks, Loader2, CheckCircle2, TrendingUp, Clock, Lightbulb } from 'lucide-react';
import { loadExamData, getAllExamMetadata, preloadExamData } from '../../data/examData';

// --- Memoized Sub-Components ---

const DropdownItem = memo(({ children, isActive, onClick }) => (
  <li>
    <button
      onClick={onClick}
      className={`w-full px-4 py-3 rounded-lg transition-all duration-200 text-sm text-left flex items-center justify-between ${
        isActive 
          ? 'bg-indigo-100 text-indigo-900 font-semibold shadow-sm' 
          : 'text-slate-700 hover:bg-slate-100 hover:text-slate-900 font-medium'
      }`}
    >
      <span>{children}</span>
      {isActive && <CheckCircle2 className="w-4 h-4 flex-shrink-0" />}
    </button>
  </li>
), (prev, next) => prev.isActive === next.isActive && prev.children === next.children);

DropdownItem.displayName = 'DropdownItem';

const OptimizedBackground = () => (
  <div className="fixed inset-0 pointer-events-none z-0 overflow-hidden">
    <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-slate-50 via-white to-slate-50" />
    <svg className="absolute inset-0 w-full h-full opacity-[0.03]" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
          <path d="M 40 0 L 0 0 0 40" fill="none" stroke="currentColor" strokeWidth="0.5"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#grid)" />
    </svg>
  </div>
);

const HeaderSectionPartPart = memo(() => (
  <div className="mb-10">
    <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-3">
      <div className="flex items-center gap-3.5">
        <div className="p-3 bg-gradient-to-br from-indigo-600 to-indigo-700 rounded-xl shadow-lg flex-shrink-0">
          <BookOpen className="w-6 h-6 text-white" />
        </div>
        <div className="min-w-0">
          <h1 className="text-3xl sm:text-4xl font-black text-slate-900 truncate">
            Luyn Tp
          </h1>
          <p className="text-slate-500 text-sm font-medium leading-tight mt-1">
            Chn bi tp ph hp vi mc tiu ca bn
          </p>
        </div>
      </div>
      
      <div className="hidden lg:flex items-center gap-2 px-4 py-2.5 rounded-lg bg-indigo-50 border border-indigo-200">
        <TrendingUp className="w-4 h-4 text-indigo-600" />
        <span className="text-xs font-semibold text-indigo-700">Tin  hc tp</span>
      </div>
    </div>
    <div className="h-1 w-full bg-gradient-to-r from-indigo-600 via-indigo-500 to-transparent rounded-full" />
  </div>
));

HeaderSectionPartPart.displayName = 'HeaderSectionPartPart';

// ===== EXAM SELECTION MODAL =====
const ExamSelectionModal = memo(({
  isOpen,
  examList,
  selectedExam,
  isLoading,
  onSelectExam,
  onClose
}) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-40 flex items-center justify-center md:items-end pointer-events-none">
      {/* Backdrop */}
      <div 
        className="fixed inset-0 bg-black/40 transition-opacity duration-300 pointer-events-auto"
        onClick={onClose}
      />
      
      {/* Modal */}
      <div className="relative bg-white rounded-t-2xl md:rounded-2xl shadow-2xl max-h-[70vh] md:max-h-96 w-full md:w-96 flex flex-col overflow-hidden animate-in fade-in slide-in-from-bottom-5 md:zoom-in-95 duration-300 pointer-events-auto">
        
        {/* Header */}
        <div className="flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-indigo-50 to-slate-50 flex-shrink-0">
          <div>
            <h3 className="text-lg font-bold text-slate-900">Chn B </h3>
            <p className="text-xs text-slate-500 mt-0.5">{examList.length} b  kh dng</p>
          </div>
          <button
            onClick={onClose}
            className="p-1.5 hover:bg-slate-200 rounded-lg transition-colors"
          >
            <svg className="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        {/* Exam List */}
        <div className="overflow-y-auto flex-1">
          <ul className="divide-y divide-slate-100 p-2">
            {examList.map(exam => (
              <li key={exam.id}>
                <button
                  onClick={() => onSelectExam(exam.id)}
                  disabled={isLoading}
                  className={`w-full text-left px-4 py-3 transition-all duration-200 flex items-center justify-between hover:bg-indigo-50 ${
                    selectedExam === exam.id 
                      ? 'bg-indigo-50 border-l-4 border-indigo-600' 
                      : 'border-l-4 border-transparent'
                  } disabled:opacity-50`}
                >
                  <div className="flex-1 min-w-0">
                    <p className="font-semibold text-slate-900 truncate">{exam.title}</p>
                    <p className="text-xs text-slate-500 mt-0.5">ID: {exam.id}</p>
                  </div>
                  {selectedExam === exam.id && (
                    <CheckCircle2 className="w-5 h-5 text-indigo-600 flex-shrink-0 ml-2" />
                  )}
                </button>
              </li>
            ))}
          </ul>
        </div>

        {/* Footer */}
        <div className="px-6 py-4 border-t border-slate-200 bg-slate-50 flex-shrink-0">
          <button
            onClick={onClose}
            className="w-full py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors shadow-sm"
          >
            Xc Nhn
          </button>
        </div>
      </div>
    </div>
  );
});

ExamSelectionModal.displayName = 'ExamSelectionModal';

// ===== HORIZONTAL CONTROL BAR =====
const ControlBar = memo(({
  selectedExam,
  isDropdownOpen,
  isLoading,
  onToggleDropdown,
  onSelectExam,
  examList,
  testType,
  onTestTypeChange
}) => {
  return (
    <div className="relative z-10 mb-10">
      <div className="bg-white border border-slate-200 rounded-2xl shadow-sm overflow-hidden">
        <div className="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-slate-200">
          
          {/* Exam Selection */}
          <div className="p-6">
            <label className="text-xs font-bold text-slate-600 tracking-wider uppercase block mb-3 flex items-center gap-2">
              <Target className="w-4 h-4 text-indigo-600" />
              B 
            </label>
            
            <button
              onClick={onToggleDropdown}
              disabled={isLoading}
              className="w-full flex items-center justify-between bg-slate-50 hover:bg-slate-100 border-2 border-slate-200 hover:border-indigo-400 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 font-semibold rounded-xl px-4 py-3 focus:outline-none transition-all duration-200 text-sm disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span className="truncate text-slate-900 flex items-center gap-2 flex-1 min-w-0">
                {isLoading && <Loader2 className="w-4 h-4 animate-spin text-indigo-600 flex-shrink-0" />}
                <span className="truncate">{selectedExam ? examList.find(e => e.id === selectedExam)?.title : '-- Chn b  --'}</span>
              </span>
              <ChevronDown className={`w-4 h-4 ml-2 flex-shrink-0 transition-transform duration-300 text-slate-600 ${
                isDropdownOpen ? 'rotate-180 text-indigo-600' : ''
              }`} />
            </button>
          </div>

          {/* Test Type - Segmented Control */}
          <div className="p-6">
            <label className="text-xs font-bold text-slate-600 tracking-wider uppercase block mb-3 flex items-center gap-2">
              <Zap className="w-4 h-4 text-indigo-600" />
              Loi Bi
            </label>
            
            <div className="flex gap-2 bg-slate-100 p-1.5 rounded-xl">
              {['listening', 'reading'].map(type => (
                <button
                  key={type}
                  onClick={() => onTestTypeChange(type)}
                  className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 ${
                    testType === type
                      ? 'bg-white text-indigo-700 shadow-md border-2 border-indigo-300'
                      : 'bg-transparent text-slate-700 border-2 border-transparent hover:text-indigo-700'
                  }`}
                >
                  {type === 'listening' ? (
                    <Headphones className="w-4 h-4" />
                  ) : (
                    <BookOpen className="w-4 h-4" />
                  )}
                  <span className="hidden sm:inline">{type === 'listening' ? 'Nghe' : 'c'}</span>
                  <span className="inline sm:hidden">{type === 'listening' ? 'N' : ''}</span>
                </button>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
});

ControlBar.displayName = 'ControlBar';

// ===== BENTO GRID PART BUTTON =====
const PartButton = memo(({
  partKey,
  info,
  isActive,
  onClick,
  hoveredPart,
  onHover,
  onHoverLeave
}) => {
  const isOtherHovered = hoveredPart && hoveredPart !== partKey;

  return (
    <button
      onClick={onClick}
      onMouseEnter={() => onHover(partKey)}
      onMouseLeave={onHoverLeave}
      className={`
        relative p-5 rounded-2xl transition-all duration-300 border-2 text-left
        overflow-hidden group
        ${isActive
          ? 'bg-white border-indigo-600 shadow-lg scale-100 z-20'
          : 'bg-white/60 border-slate-200 hover:border-indigo-400 shadow-sm hover:shadow-md'
        }
        ${isOtherHovered ? 'opacity-40 scale-95' : 'opacity-100 scale-100'}
      `}
    >
      {/* Background accent */}
      <div className={`absolute inset-0 opacity-0 transition-opacity duration-300 ${
        isActive ? 'bg-gradient-to-br from-indigo-50 to-slate-50' : ''
      }`} />
      
      <div className="relative z-10 space-y-3.5">
        {/* Part Number & Progress */}
        <div className="flex items-center justify-between">
          <div>
            <span className={`text-3xl font-black transition-colors block ${
              isActive ? 'text-indigo-700' : 'text-slate-600'
            }`}>
              {partKey.replace(/part(\d+)/i, 'P$1')}
            </span>
            <p className={`text-xs font-semibold mt-1 transition-colors ${
              isActive ? 'text-indigo-600' : 'text-slate-500'
            }`}>
              Part {partKey.replace(/part(\d+)/i, '$1')}
            </p>
          </div>
          
          {/* Progress Circle */}
          <div className="relative w-10 h-10 flex items-center justify-center flex-shrink-0">
            <svg className="absolute w-full h-full -rotate-90" viewBox="0 0 32 32">
              <circle cx="16" cy="16" r="14" fill="none" stroke={isActive ? '#e0e7ff' : '#f1f5f9'} strokeWidth="2" />
              <circle 
                cx="16" cy="16" r="14" 
                fill="none" 
                stroke={isActive ? '#4f46e5' : '#cbd5e1'} 
                strokeWidth="2" 
                strokeDasharray="87.96" 
                strokeDashoffset={isActive ? '0' : '43.98'}
                className="transition-all duration-500"
              />
            </svg>
            <span className={`text-xs font-bold ${isActive ? 'text-indigo-700' : 'text-slate-600'}`}>
              {Math.floor((info.questions / 30) * 100)}%
            </span>
          </div>
        </div>

        {/* Title */}
        <div>
          <h4 className={`text-sm font-bold line-clamp-2 transition-colors ${
            isActive ? 'text-slate-900' : 'text-slate-700'
          }`}>
            {info.title}
          </h4>
        </div>

        {/* Questions count */}
        <div className={`pt-3 border-t transition-colors ${
          isActive ? 'border-indigo-200' : 'border-slate-200'
        }`}>
          <div className="flex items-center justify-between">
            <div>
              <p className={`text-xs font-semibold ${
                isActive ? 'text-indigo-700' : 'text-slate-600'
              }`}>
                {info.questions} cu
              </p>
            </div>
            {isActive && <CheckCircle2 className="w-4 h-4 text-indigo-600" />}
          </div>
        </div>
      </div>
    </button>
  );
}, (prev, next) => {
  return prev.isActive === next.isActive && 
    prev.hoveredPart === next.hoveredPart &&
    prev.info.questions === next.info.questions;
});

PartButton.displayName = 'PartButton';

// ===== PARTS GRID LOADING =====
const PartsGridLoading = () => (
  <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
    {[...Array(8)].map((_, i) => (
      <div key={i} className="p-5 rounded-2xl bg-slate-100 animate-pulse border-2 border-slate-200 space-y-4">
        <div className="h-10 bg-slate-300 rounded-lg w-2/3" />
        <div className="h-4 bg-slate-200 rounded" />
        <div className="h-3 bg-slate-200 rounded w-3/4" />
        <div className="h-3 bg-slate-200 rounded w-1/2" />
      </div>
    ))}
  </div>
);

const PartsGrid = memo(({
  availableParts,
  partInfoMap,
  selectedPart,
  onPartChange,
  isLoading
}) => {
  const [hoveredPart, setHoveredPart] = useState(null);

  if (isLoading) {
    return <PartsGridLoading />;
  }

  if (availableParts.length === 0) {
    return (
      <div className="text-center py-12 bg-white border-2 border-dashed border-slate-300 rounded-2xl shadow-sm">
        <div className="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-4">
          <BookOpen className="w-6 h-6 text-slate-400" />
        </div>
        <p className="text-slate-600 font-semibold">Vui lng chn b </p>
        <p className="text-xs text-slate-500 mt-1"> xem danh sch cc phn thi</p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
      {availableParts.map(partKey => (
        <PartButton
          key={partKey}
          partKey={partKey}
          info={partInfoMap[partKey]}
          isActive={selectedPart === partKey}
          onClick={() => onPartChange(partKey)}
          hoveredPart={hoveredPart}
          onHover={setHoveredPart}
          onHoverLeave={() => setHoveredPart(null)}
        />
      ))}
    </div>
  );
}, (prev, next) => {
  return prev.selectedPart === next.selectedPart &&
    prev.availableParts.length === next.availableParts.length &&
    prev.isLoading === next.isLoading;
});

PartsGrid.displayName = 'PartsGrid';

// ===== PART DETAILS CARD (Summary Panel) =====
const PartDetailsCard = memo(({ partData, testType, isLoading }) => {
  if (isLoading) {
    return (
      <div className="bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-200 p-12 flex items-center justify-center">
        <Loader2 className="w-8 h-8 text-indigo-600 animate-spin" />
      </div>
    );
  }

  if (!partData) return null;

  const stats = [
    {
      label: 'Cu hi',
      value: partData.questions?.length || 0,
      icon: ListChecks,
      color: 'text-indigo-600',
      bgColor: 'bg-indigo-50'
    },
    {
      label: 'Loi bi',
      value: testType === 'listening' ? 'Nghe' : 'c',
      icon: testType === 'listening' ? Headphones : BookOpen,
      color: 'text-emerald-600',
      bgColor: 'bg-emerald-50'
    },
    {
      label: 'im/Cu',
      value: testType === 'listening' ? '~5' : '~2.5',
      icon: Award,
      color: 'text-amber-600',
      bgColor: 'bg-amber-50'
    }
  ];

  const tips = testType === 'listening' 
    ? [
        'c cu hi trc khi nghe  bit cn tm g',
        'Ch  cc t kha v cu trc cu',
        'Nghe ton b phn ri mi tr li, ng on',
        'Ghi ch nhanh gn trong qu trnh nghe'
      ]
    : [
      'Scan bi c  hiu cu trc chung trc',
      'nh v t kha t cu hi trong bi',
      'c cc dng xung quanh  hiu ng cnh',
      'Loi b p n sai r rng trc tin'
    ];

  return (
    <div className="space-y-8">
      {/* Main Details Card */}
      <div className="bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-200">
        {/* Header */}
        <div className="px-6 sm:px-8 py-6 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-white">
          <div className="flex items-start gap-4 mb-4">
            <div className={`p-3 rounded-xl flex-shrink-0 ${
              testType === 'listening' ? 'bg-purple-100' : 'bg-teal-100'
            }`}>
              {testType === 'listening' ? (
                <Headphones className="w-6 h-6 text-purple-700" strokeWidth={2} />
              ) : (
                <BookOpen className="w-6 h-6 text-teal-700" strokeWidth={2} />
              )}
            </div>
            <div className="flex-1 min-w-0">
              <p className="text-xs font-bold text-slate-600 uppercase mb-1.5 tracking-wider">
                Chi tit phn thi
              </p>
              <h3 className="text-xl font-bold text-slate-900 line-clamp-1">
                {partData.title}
              </h3>
              <p className="text-sm text-slate-600 line-clamp-2 mt-2">
                {partData.description}
              </p>
            </div>
          </div>
        </div>

        {/* Stats Grid */}
        <div className="p-6 sm:p-8 grid grid-cols-3 gap-4">
          {stats.map((stat, idx) => {
            const Icon = stat.icon;
            return (
              <div 
                key={idx}
                className={`${stat.bgColor} border border-slate-200 rounded-xl p-4 transition-all duration-300 hover:shadow-md hover:scale-105`}
              >
                <div className="flex items-center gap-2 mb-3">
                  <Icon className={`w-5 h-5 ${stat.color}`} strokeWidth={2} />
                </div>
                <p className="text-xs font-bold text-slate-600 uppercase tracking-wider mb-2">
                  {stat.label}
                </p>
                <p className="text-2xl sm:text-3xl font-black text-slate-900">
                  {stat.value}
                </p>
              </div>
            );
          })}
        </div>

        {/* Footer Info */}
        <div className="px-6 sm:px-8 py-4 bg-slate-50 border-t border-slate-200 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
          <div className="flex items-center gap-2 text-xs text-slate-600 font-medium">
            <Clock className="w-3.5 h-3.5 flex-shrink-0" />
            Thi gian: ~{testType === 'listening' ? '30' : '50'} pht
          </div>
          <div className="text-xs font-semibold text-indigo-700 px-3 py-1.5 bg-indigo-50 rounded-full border border-indigo-200">
            {testType === 'listening' ? 'K nng Nghe' : 'K nng c'}
          </div>
        </div>
      </div>

      {/* Tips Card */}
      <div className="bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 rounded-2xl shadow-sm border border-amber-200 overflow-hidden">
        {/* Header */}
        <div className="px-6 sm:px-8 py-4 border-b border-amber-200 bg-gradient-to-r from-amber-100 to-yellow-100 flex items-center gap-3">
          <div className="p-2.5 rounded-lg bg-amber-200/50 flex-shrink-0">
            <Lightbulb className="w-5 h-5 text-amber-700" strokeWidth={2} />
          </div>
          <div>
            <h4 className="text-sm font-bold text-amber-900"> Mo {testType === 'listening' ? 'Nghe' : 'c'} Hiu Qu</h4>
            <p className="text-xs text-amber-700 mt-0.5">p dng nhng mo ny  t im cao hn</p>
          </div>
        </div>

        {/* Tips Content */}
        <div className="p-6 sm:p-8">
          <div className="space-y-3">
            {tips.map((tip, idx) => (
              <div key={idx} className="flex gap-3.5 items-start group">
                {/* Number Badge */}
                <div className="flex-shrink-0 w-7 h-7 rounded-full bg-amber-200 border-2 border-amber-300 flex items-center justify-center">
                  <span className="text-xs font-bold text-amber-900">{idx + 1}</span>
                </div>
                
                {/* Tip Text */}
                <div className="flex-1 pt-0.5">
                  <p className="text-sm text-amber-900 font-medium leading-relaxed">
                    {tip}
                  </p>
                </div>
              </div>
            ))}
          </div>

          {/* Motivational Message */}
          <div className="mt-6 pt-6 border-t border-amber-200">
            <p className="text-xs text-amber-800 font-medium text-center italic">
              "Luyn tp thng xuyn vi cc mo trn s gip bn ci thin k nng ng k! "
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}, (prev, next) => {
  return prev.partData?.title === next.partData?.title && 
    prev.testType === next.testType && 
    prev.isLoading === next.isLoading;
});

PartDetailsCard.displayName = 'PartDetailsCard';

// ===== MAIN COMPONENT =====

const PartSelector = React.memo(({
  selectedExam = 'exam1',
  onExamChange = () => {},
  testType = 'listening',
  onTestTypeChange = () => {},
  selectedPart = 'part1',
  onPartChange = () => {}
}) => {
  const [isExamDropdownOpen, setIsExamDropdownOpen] = useState(false);
  const [examData, setExamData] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [examList] = useState(() => getAllExamMetadata());

  useEffect(() => {
    let cancelled = false;

    const loadData = async () => {
      if (!selectedExam) {
        setExamData(null);
        return;
      }

      setIsLoading(true);
      
      try {
        const data = await loadExamData(selectedExam);
        
        if (!cancelled) {
          setExamData(data);
          
          const currentIndex = examList.findIndex(e => e.id === selectedExam);
          if (currentIndex < examList.length - 1) {
            preloadExamData(examList[currentIndex + 1].id);
          }
        }
      } catch (error) {
        console.error('Error loading exam:', error);
        if (!cancelled) {
          setExamData(null);
        }
      } finally {
        if (!cancelled) {
          setIsLoading(false);
        }
      }
    };

    loadData();

    return () => {
      cancelled = true;
    };
  }, [selectedExam, examList]);

  const partInfoMap = useMemo(() => {
    if (!examData?.parts) return {};
    
    const map = {};
    const parts = Object.entries(examData.parts);
    
    for (let i = 0; i < parts.length; i++) {
      const [part, data] = parts[i];
      if (data.type === testType) {
        map[part] = {
          title: data.title || part,
          questions: data.questions?.length || 0,
          description: data.description || ''
        };
      }
    }
    return map;
  }, [examData, testType]);

  const availableParts = useMemo(
    () => Object.keys(partInfoMap),
    [partInfoMap]
  );

  const partData = useMemo(
    () => examData?.parts?.[selectedPart] || null,
    [examData, selectedPart]
  );

  const handleExamChange = useCallback((examKey) => {
    onExamChange({ target: { value: examKey } });
    setIsExamDropdownOpen(false);
  }, [onExamChange]);

  const handleTestTypeChange = useCallback((type) => {
    onTestTypeChange({ target: { value: type } });
  }, [onTestTypeChange]);

  const handlePartChange = useCallback((partKey) => {
    onPartChange({ target: { value: partKey } });
  }, [onPartChange]);

  const handleToggleDropdown = useCallback(() => {
    setIsExamDropdownOpen(prev => !prev);
  }, []);

  return (
    <div className="w-full bg-white relative overflow-visible">
      <OptimizedBackground />

      <div className="relative max-w-7xl mx-auto z-10 p-6 sm:p-8 lg:p-10">         
        <HeaderSectionPartPart /> 
        
        {/* Exam Selection Modal */}
        <ExamSelectionModal
          isOpen={isExamDropdownOpen}
          examList={examList}
          selectedExam={selectedExam}
          isLoading={isLoading}
          onSelectExam={handleExamChange}
          onClose={() => setIsExamDropdownOpen(false)}
        />
        
        {/* Control Bar - Exam & Test Type */}
        <ControlBar
          selectedExam={selectedExam}
          isDropdownOpen={isExamDropdownOpen}
          isLoading={isLoading}
          onToggleDropdown={handleToggleDropdown}
          onSelectExam={handleExamChange}
          examList={examList}
          testType={testType}
          onTestTypeChange={handleTestTypeChange}
        />

        {/* Parts Section */}
        {selectedExam && (
          <div className="mb-10">
            <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6">
              <div className="flex items-center gap-3">
                <div className="p-2.5 bg-indigo-100 rounded-xl flex-shrink-0">
                  <ListChecks className="w-5 h-5 text-indigo-700" />
                </div>
                <div className="min-w-0">
                  <h2 className="text-xl font-bold text-slate-900">Chn phn thi</h2>
                  <p className="text-xs text-slate-500 mt-0.5">C {availableParts.length} phn {testType === 'listening' ? 'Nghe' : 'c'}</p>
                </div>
              </div>
              <span className="text-xs font-bold text-indigo-700 px-4 py-2 bg-indigo-100 rounded-full border border-indigo-300 whitespace-nowrap">
                {availableParts.length} phn thi
              </span>
            </div>

            <PartsGrid
              availableParts={availableParts}
              partInfoMap={partInfoMap}
              selectedPart={selectedPart}
              onPartChange={handlePartChange}
              isLoading={isLoading}
            />
          </div>
        )}

        {/* Part Details */}
        <PartDetailsCard
          partData={partData}
          testType={testType}
          isLoading={isLoading}
        />
      </div>
    </div>
  );
});

PartSelector.displayName = 'PartSelector';

export default PartSelector;
</file>

<file path="src/components/footer/ScrollToTopButton.jsx">
// import React, { useState, useEffect, useRef } from 'react';
// import { ArrowUp } from 'lucide-react';

// const ScrollToTopButton = () => {
//   const [isVisible, setIsVisible] = useState(false);
//   const [scrollProgress, setScrollProgress] = useState(0);
//   const timeoutRef = useRef(null);

//   useEffect(() => {
//     const handleScroll = () => {
//       const scrolled = window.pageYOffset;
//       const docHeight = document.documentElement.scrollHeight - window.innerHeight;
//       const scrollPercent = docHeight > 0 ? (scrolled / docHeight) * 100 : 0;
      
//       setScrollProgress(scrollPercent);
//       setIsVisible(scrolled > 300);
//     };

//     // Throttle scroll event
//     let ticking = false;
//     const throttledScroll = () => {
//       if (!ticking) {
//         window.requestAnimationFrame(handleScroll);
//         ticking = true;
//         setTimeout(() => { ticking = false; }, 100);
//       }
//     };

//     window.addEventListener('scroll', throttledScroll, { passive: true });
//     return () => window.removeEventListener('scroll', throttledScroll);
//   }, []);

//   const scrollToTop = () => {
//     // Disable button during scroll
//     setIsVisible(false);
    
//     window.scrollTo({
//       top: 0,
//       behavior: 'smooth',
//     });

//     // Re-enable after scroll completes
//     if (timeoutRef.current) clearTimeout(timeoutRef.current);
//     timeoutRef.current = setTimeout(() => {
//       setIsVisible(window.pageYOffset > 300);
//     }, 1000);
//   };

//   return (
//     <>
//       {/* Progress Ring Background */}
//       <div className={`fixed bottom-8 right-8 w-14 h-14 z-40 transition-opacity duration-300 ${
//         isVisible ? 'opacity-100' : 'opacity-0 pointer-events-none'
//       }`}>
//         {/* Outer glow effect */}
//         <div className="absolute inset-0 bg-gradient-to-r from-orange-500 to-amber-500 rounded-full blur-lg opacity-20 group-hover:opacity-30 transition-opacity"></div>
        
//         {/* Progress ring */}
//         <svg className="absolute inset-0 w-full h-full -rotate-90 drop-shadow-lg">
//           <circle
//             cx="28"
//             cy="28"
//             r="26"
//             fill="none"
//             stroke="rgba(255, 255, 255, 0.1)"
//             strokeWidth="2"
//           />
//           <circle
//             cx="28"
//             cy="28"
//             r="26"
//             fill="none"
//             stroke="url(#gradient)"
//             strokeWidth="2"
//             strokeDasharray={`${(scrollProgress / 100) * 163.36} 163.36`}
//             className="transition-all duration-300"
//             strokeLinecap="round"
//           />
//           <defs>
//             <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
//               <stop offset="0%" stopColor="#f97316" />
//               <stop offset="100%" stopColor="#f59e0b" />
//             </linearGradient>
//           </defs>
//         </svg>
//       </div>

//       {/* Main Button */}
//       <button
//         onClick={scrollToTop}
//         disabled={!isVisible}
//         className={`fixed bottom-8 right-8 w-14 h-14 bg-gradient-to-br from-orange-500 to-amber-500 text-white rounded-full shadow-xl hover:shadow-2xl active:shadow-lg transition-all duration-300 z-50 flex items-center justify-center group transform ${
//           isVisible 
//             ? 'opacity-100 translate-y-0 hover:scale-110 active:scale-95' 
//             : 'opacity-0 translate-y-10 pointer-events-none'
//         }`}
//         title="Ln u trang"
//         aria-label="Scroll to top"
//       >
//         {/* Animated arrow icon */}
//         <ArrowUp className="w-6 h-6 transition-all duration-300 group-hover:-translate-y-1.5 group-active:translate-y-0.5" />
        
//         {/* Shine effect on hover */}
//         <div className="absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
//           <div className="absolute inset-0 rounded-full bg-gradient-to-r from-white/0 via-white/20 to-white/0 group-hover:animate-pulse"></div>
//         </div>
//       </button>
//     </>
//   );
// };

// export default ScrollToTopButton;
</file>

<file path="src/components/hooks/useTextToSpeech.js">
import { useState, useCallback, useRef, useEffect } from 'react';

export const useTextToSpeech = ({ 
  getSpeakerVoice, 
  synthRef, 
  isScriptPlaying, 
  filteredConversations 
}) => {
  // ==================== STATE ====================
  const [currentPlayingIndex, setCurrentPlayingIndex] = useState(-1);
  const [playingTime, setPlayingTime] = useState(0);
  const [isPaused, setIsPaused] = useState(false);
  
  // ==================== REFS ====================
  const utteranceQueueRef = useRef([]);
  const currentUtteranceRef = useRef(null);
  const isPlayingRef = useRef(false);
  const pausedUtteranceRef = useRef(null);
  const isStoppingRef = useRef(false);
  const isMountedRef = useRef(true);
  const playbackTimeoutRef = useRef(null);
  const retryCountRef = useRef(0);
  const lastSuccessTimeRef = useRef(Date.now());
  
  const metricsRef = useRef({
    totalUtterances: 0,
    totalDuration: 0,
    errorCount: 0,
    interruptCount: 0,
    retryCount: 0
  });

  // ==================== CONSTANTS ====================
  const CONFIG = {
    MAX_RETRY_ATTEMPTS: 3,
    RETRY_DELAY: 300,
    INTER_UTTERANCE_DELAY: 150, // Tng delay gia cc cu  t nhin hn
    CHUNK_SIZE: 180, // Gim chunk size  pht m chnh xc hn
    TIMEOUT_THRESHOLD: 5000,
    MIN_RATE: 0.7, // Tc  ti thiu chm hn  r rng
    MAX_RATE: 1.3, // Tc  ti a khng qu nhanh
    OPTIMAL_RATE: 0.95, // Tc  ti u cho s t nhin
  };

  // ==================== SAFETY CHECKS ====================

  const isSynthAvailable = useCallback(() => {
    return synthRef?.current && typeof synthRef.current.speak === 'function';
  }, [synthRef]);

  const safeSetState = useCallback((setter, value) => {
    if (isMountedRef.current) {
      setter(value);
    }
  }, []);

  // ==================== ADVANCED TEXT OPTIMIZATION ====================

  /**
   *  Ti u ha text cho TTS - Ci thin cht lng pht m
   */
  const optimizeText = useCallback((text) => {
    if (!text || typeof text !== 'string') return '';
    
    return text
      // Normalize whitespace
      .replace(/\s+/g, ' ')
      
      // Fix common abbreviations for better pronunciation
      .replace(/\bMr\./gi, 'Mister')
      .replace(/\bMrs\./gi, 'Missus')
      .replace(/\bMs\./gi, 'Miss')
      .replace(/\bDr\./gi, 'Doctor')
      .replace(/\bProf\./gi, 'Professor')
      .replace(/\bSt\./gi, 'Saint')
      
      // Fix numbers for natural reading
      .replace(/(\d+)%/g, '$1 percent')
      .replace(/\$(\d+)/g, '$1 dollars')
      .replace(/(\d+)C/g, '$1 degrees Celsius')
      .replace(/(\d+)F/g, '$1 degrees Fahrenheit')
      
      // Add natural pauses with SSML-like markers (converted to punctuation)
      .replace(/\s*\.\.\.\s*/g, '... ') // Ellipsis pause
      .replace(/\s*--\s*/g, '  ') // Em dash pause
      
      // Fix sentence spacing for natural rhythm
      .replace(/([.!?])\s+/g, '$1  ') // Double space after sentence
      .replace(/([,;:])\s*/g, '$1 ') // Single space after comma
      
      // Remove problematic characters but keep important punctuation
      .replace(/[^\w\s.,!?'"\-]/g, '')
      
      // Clean up multiple punctuation
      .replace(/([.!?]){2,}/g, '$1')
      
      // Final trim and normalize
      .trim()
      .replace(/\s+/g, ' ');
  }, []);

  /**
   *  Chunk text intelligently ti ranh gii t nhin
   */
  const chunkText = useCallback((text, maxLength = CONFIG.CHUNK_SIZE) => {
    if (!text || text.length <= maxLength) return [text];

    const chunks = [];
    
    // u tin ct ti du cu chnh
    const sentences = text.match(/[^.!?]+[.!?]+|[^.!?]+$/g) || [text];
    
    let currentChunk = '';
    
    for (const sentence of sentences) {
      const trimmed = sentence.trim();
      if (!trimmed) continue;
      
      // Nu cu hin ti + chunk qu di
      if ((currentChunk + trimmed).length > maxLength) {
        if (currentChunk) {
          chunks.push(currentChunk.trim());
          currentChunk = '';
        }
        
        // Nu cu n l qu di, ct ti du phy
        if (trimmed.length > maxLength) {
          const subParts = trimmed.split(/([,;:])/g);
          let subChunk = '';
          
          for (const part of subParts) {
            if ((subChunk + part).length > maxLength) {
              if (subChunk) chunks.push(subChunk.trim());
              subChunk = part;
            } else {
              subChunk += part;
            }
          }
          
          if (subChunk) currentChunk = subChunk;
        } else {
          currentChunk = trimmed;
        }
      } else {
        currentChunk += (currentChunk ? ' ' : '') + trimmed;
      }
    }
    
    if (currentChunk) chunks.push(currentChunk.trim());
    
    return chunks.length > 0 ? chunks : [text];
  }, []);

  /**
   *  Optimize ton b conversations
   */
  const optimizeConversations = useCallback((conversations, chunkSize = CONFIG.CHUNK_SIZE) => {
    if (!Array.isArray(conversations) || conversations.length === 0) return [];
    
    return conversations.flatMap((conv, convIndex) => {
      if (!conv || !conv.text) return [];
      
      const optimized = optimizeText(conv.text);
      if (!optimized) return [];
      
      const chunks = chunkText(optimized, chunkSize);
      
      return chunks.map((chunk, chunkIndex) => ({
        ...conv,
        text: chunk,
        chunkIndex,
        totalChunks: chunks.length,
        isChunked: chunks.length > 1,
        originalIndex: convIndex,
        // Thm metadata  x l tt hn
        isFirstChunk: chunkIndex === 0,
        isLastChunk: chunkIndex === chunks.length - 1
      }));
    });
  }, [optimizeText, chunkText]);

  // ==================== CLEANUP ====================

  const cleanupUtterance = useCallback(() => {
    if (currentUtteranceRef.current) {
      try {
        const utterance = currentUtteranceRef.current;
        utterance.onend = null;
        utterance.onerror = null;
        utterance.onpause = null;
        utterance.onresume = null;
        utterance.onstart = null;
        utterance.onboundary = null;
        currentUtteranceRef.current = null;
      } catch (err) {
        console.warn(' Error cleaning up utterance:', err);
      }
    }
  }, []);

  const clearPlaybackTimeout = useCallback(() => {
    if (playbackTimeoutRef.current) {
      clearTimeout(playbackTimeoutRef.current);
      playbackTimeoutRef.current = null;
    }
  }, []);

  // ==================== SPEECH CONTROL ====================

  const stopAllSpeech = useCallback(() => {
    isStoppingRef.current = true;
    clearPlaybackTimeout();
    
    try {
      if (isSynthAvailable()) {
        synthRef.current.cancel();
      }
    } catch (err) {
      console.error(' Error stopping speech:', err);
    }
    
    // Reset stopping flag sau khi cancel
    playbackTimeoutRef.current = setTimeout(() => {
      isStoppingRef.current = false;
    }, 100);
  }, [synthRef, isSynthAvailable, clearPlaybackTimeout]);

  const pauseScript = useCallback(() => {
    if (!isSynthAvailable()) return;

    try {
      if (synthRef.current.speaking && !synthRef.current.paused) {
        pausedUtteranceRef.current = currentUtteranceRef.current;
        synthRef.current.pause();
        safeSetState(setIsPaused, true);
        isPlayingRef.current = false;
        console.log(' Script paused');
      }
    } catch (err) {
      console.error(' Error pausing speech:', err);
      stopAllSpeech();
    }
  }, [synthRef, isSynthAvailable, stopAllSpeech, safeSetState]);

  const resumeScript = useCallback(() => {
    if (!isSynthAvailable()) return;

    try {
      if (synthRef.current.paused) {
        synthRef.current.resume();
        safeSetState(setIsPaused, false);
        isPlayingRef.current = true;
        console.log(' Script resumed');
      }
    } catch (err) {
      console.error(' Error resuming speech:', err);
      // Nu resume fail, th pht li t v tr hin ti
      if (pausedUtteranceRef.current) {
        speakNextInQueue();
      }
    }
  }, [synthRef, isSynthAvailable, safeSetState]);

  const stopScript = useCallback(() => {
    console.log(' Stopping script');
    stopAllSpeech();
    cleanupUtterance();
    utteranceQueueRef.current = [];
    pausedUtteranceRef.current = null;
    retryCountRef.current = 0;
    safeSetState(setCurrentPlayingIndex, -1);
    safeSetState(setPlayingTime, 0);
    safeSetState(setIsPaused, false);
    isPlayingRef.current = false;
  }, [stopAllSpeech, cleanupUtterance, safeSetState]);

  // ==================== ADVANCED PLAYBACK ====================

  /**
   *  Speak next utterance with advanced error handling
   */
  const speakNextInQueue = useCallback(() => {
    // Safety checks
    if (!isSynthAvailable() || !isMountedRef.current) {
      return;
    }

    // i utterance hin ti kt thc
    if (currentUtteranceRef.current) {
      return;
    }

    // Queue empty - kt thc script
    if (utteranceQueueRef.current.length === 0) {
      if (isPlayingRef.current) {
        console.log(' Script finished');
        safeSetState(setCurrentPlayingIndex, -1);
        safeSetState(setPlayingTime, 0);
        isPlayingRef.current = false;
      }
      return;
    }

    // Ly utterance tip theo
    const next = utteranceQueueRef.current.shift();
    if (!next || !next.text) {
      return speakNextInQueue();
    }

    // Tm index trong danh sch gc
    const newIndex = Array.isArray(filteredConversations) 
      ? filteredConversations.findIndex(
          conv => conv?.speaker === next.speaker && 
                  conv?.text?.includes(next.text.substring(0, 50))
        )
      : -1;

    if (newIndex !== -1) {
      safeSetState(setCurrentPlayingIndex, newIndex);
    }

    // Ly voice cho speaker
    const voice = getSpeakerVoice(next.speaker);
    if (!voice) {
      console.warn(` No voice for ${next.speaker}, skipping`);
      metricsRef.current.errorCount++;
      return speakNextInQueue();
    }

    try {
      //  To utterance vi cu hnh ti u
      const utterance = new SpeechSynthesisUtterance(next.text);
      utterance.voice = voice;
      
      //  Ti u ha tham s cho s t nhin
      const options = next.options || {};
      utterance.rate = Math.max(
        CONFIG.MIN_RATE, 
        Math.min(CONFIG.MAX_RATE, options.rate || CONFIG.OPTIMAL_RATE)
      );
      utterance.pitch = Math.max(0.8, Math.min(1.2, options.pitch || 1));
      utterance.volume = Math.max(0.8, Math.min(1, options.volume || 1));
      utterance.lang = voice.lang || 'en-US';

      currentUtteranceRef.current = utterance;
      lastSuccessTimeRef.current = Date.now();
      
      //  Update metrics
      safeSetState(setPlayingTime, prev => prev + 1);

      // ==================== EVENT HANDLERS ====================

      utterance.onstart = () => {
        if (!isMountedRef.current) return;
        retryCountRef.current = 0; // Reset retry khi bt u thnh cng
        console.log(` Speaking: "${next.text.substring(0, 30)}..."`);
      };

      utterance.onend = () => {
        if (!isMountedRef.current) return;
        
        //  Metrics
        metricsRef.current.totalUtterances++;
        const duration = Date.now() - lastSuccessTimeRef.current;
        metricsRef.current.totalDuration += duration;
        
        console.log(` Finished (${duration}ms)`);
        
        cleanupUtterance();
        
        //  Tip tc vi delay t nhin
        if (isPlayingRef.current) {
          const delay = next.isLastChunk 
            ? CONFIG.INTER_UTTERANCE_DELAY * 1.5  // Pause di hn gia cc speaker
            : CONFIG.INTER_UTTERANCE_DELAY;       // Pause ngn trong cng speaker
          
          playbackTimeoutRef.current = setTimeout(() => {
            if (isMountedRef.current && isPlayingRef.current) {
              speakNextInQueue();
            }
          }, delay);
        }
      };

      utterance.onerror = (event) => {
        if (!isMountedRef.current) return;
        
        const errorType = event.error;
        console.warn(` Speech error: ${errorType}`);
        
        // X l interrupted khi ang stopping
        if (errorType === 'interrupted' && isStoppingRef.current) {
          cleanupUtterance();
          return;
        }

        // X l interrupted khi queue empty (bnh thng)
        if (errorType === 'interrupted' && utteranceQueueRef.current.length === 0) {
          cleanupUtterance();
          return;
        }

        // X l canceled
        if (errorType === 'canceled') {
          cleanupUtterance();
          return;
        }

        // Track metrics
        if (errorType === 'interrupted') {
          metricsRef.current.interruptCount++;
        } else {
          metricsRef.current.errorCount++;
        }

        cleanupUtterance();
        
        //  Retry logic cho cc li khc
        if (errorType !== 'interrupted' && 
            errorType !== 'canceled' && 
            retryCountRef.current < CONFIG.MAX_RETRY_ATTEMPTS) {
          
          retryCountRef.current++;
          metricsRef.current.retryCount++;
          
          console.log(` Retry attempt ${retryCountRef.current}/${CONFIG.MAX_RETRY_ATTEMPTS}`);
          
          // a utterance li vo u queue
          utteranceQueueRef.current.unshift(next);
          
          playbackTimeoutRef.current = setTimeout(() => {
            if (isMountedRef.current && isPlayingRef.current) {
              speakNextInQueue();
            }
          }, CONFIG.RETRY_DELAY);
        } else {
          //  ht retry hoc li khng retry c
          if (retryCountRef.current >= CONFIG.MAX_RETRY_ATTEMPTS) {
            console.error(` Max retries reached for: "${next.text.substring(0, 30)}..."`);
          }
          
          // Skip v tip tc
          if (isPlayingRef.current) {
            playbackTimeoutRef.current = setTimeout(() => {
              if (isMountedRef.current) {
                retryCountRef.current = 0;
                speakNextInQueue();
              }
            }, CONFIG.RETRY_DELAY);
          }
        }
      };

      //  Speak!
      synthRef.current.speak(utterance);
      
    } catch (err) {
      console.error(' Error creating utterance:', err);
      metricsRef.current.errorCount++;
      cleanupUtterance();
      
      // Retry hoc skip
      if (retryCountRef.current < CONFIG.MAX_RETRY_ATTEMPTS) {
        retryCountRef.current++;
        utteranceQueueRef.current.unshift(next);
        
        playbackTimeoutRef.current = setTimeout(() => {
          if (isMountedRef.current) {
            speakNextInQueue();
          }
        }, CONFIG.RETRY_DELAY);
      } else {
        retryCountRef.current = 0;
        playbackTimeoutRef.current = setTimeout(() => {
          if (isMountedRef.current) {
            speakNextInQueue();
          }
        }, CONFIG.RETRY_DELAY);
      }
    }
  }, [
    synthRef, 
    getSpeakerVoice, 
    filteredConversations, 
    cleanupUtterance, 
    isSynthAvailable, 
    safeSetState
  ]);

  // ==================== QUEUE MANAGEMENT ====================

  /**
   *  Queue conversations vi ti u ha
   */
  const queueConversations = useCallback((conversations, getTTSOptions, autoOptimize = true) => {
    if (!isSynthAvailable() || !Array.isArray(conversations) || conversations.length === 0) {
      console.warn(' Cannot queue: invalid input or synth unavailable');
      return false;
    }

    try {
      console.log(` Queueing ${conversations.length} conversations`);
      
      // Stop hin ti
      isStoppingRef.current = true;
      stopAllSpeech();
      cleanupUtterance();
      
      // Reset state
      utteranceQueueRef.current = [];
      pausedUtteranceRef.current = null;
      retryCountRef.current = 0;
      safeSetState(setPlayingTime, 0);

      // Optimize conversations
      const toQueue = autoOptimize 
        ? optimizeConversations(conversations) 
        : conversations;
      
      console.log(` Optimized to ${toQueue.length} chunks`);
      
      // Build queue
      const queue = toQueue
        .filter(conv => conv && conv.text && conv.speaker)
        .map(conv => ({
          text: conv.text,
          speaker: conv.speaker,
          isFirstChunk: conv.isFirstChunk,
          isLastChunk: conv.isLastChunk,
          options: typeof getTTSOptions === 'function' 
            ? getTTSOptions(conv.speaker) 
            : { 
                rate: CONFIG.OPTIMAL_RATE, 
                pitch: 1, 
                volume: 1 
              }
        }));

      if (queue.length === 0) {
        console.warn(' No valid items to queue');
        isStoppingRef.current = false;
        return false;
      }

      utteranceQueueRef.current = queue;
      isPlayingRef.current = true;
      
      console.log(` Queued ${queue.length} utterances`);
      
      // Reset stopping flag
      playbackTimeoutRef.current = setTimeout(() => {
        isStoppingRef.current = false;
      }, 100);
      
      return true;
      
    } catch (err) {
      console.error(' Error queueing conversations:', err);
      isStoppingRef.current = false;
      isPlayingRef.current = false;
      return false;
    }
  }, [
    synthRef, 
    stopAllSpeech, 
    cleanupUtterance, 
    optimizeConversations, 
    isSynthAvailable, 
    safeSetState
  ]);

  // ==================== METRICS ====================

  const getTTSMetrics = useCallback(() => {
    const { totalUtterances, totalDuration, errorCount, interruptCount, retryCount } = metricsRef.current;
    
    const avgDuration = totalUtterances > 0 ? Math.round(totalDuration / totalUtterances) : 0;
    const errorRate = totalUtterances > 0 ? ((errorCount / totalUtterances) * 100).toFixed(2) : '0.00';
    const successRate = totalUtterances > 0 ? (((totalUtterances - errorCount) / totalUtterances) * 100).toFixed(2) : '0.00';
    
    return {
      totalUtterances,
      totalDuration: Math.round(totalDuration / 1000), // Convert to seconds
      errorCount,
      interruptCount,
      retryCount,
      avgDuration,
      errorRate: `${errorRate}%`,
      successRate: `${successRate}%`,
      queueLength: utteranceQueueRef.current.length,
      isPlaying: isPlayingRef.current
    };
  }, []);

  const resetMetrics = useCallback(() => {
    metricsRef.current = {
      totalUtterances: 0,
      totalDuration: 0,
      errorCount: 0,
      interruptCount: 0,
      retryCount: 0
    };
    console.log(' Metrics reset');
  }, []);

  const isSpeaking = useCallback(() => {
    return isSynthAvailable() && (synthRef.current?.speaking ?? false);
  }, [synthRef, isSynthAvailable]);

  // ==================== HEALTH CHECK ====================

  /**
   *  Kim tra health ca TTS engine
   */
  const checkHealth = useCallback(() => {
    const now = Date.now();
    const timeSinceLastSuccess = now - lastSuccessTimeRef.current;
    
    return {
      isHealthy: isSynthAvailable() && timeSinceLastSuccess < CONFIG.TIMEOUT_THRESHOLD,
      synthAvailable: isSynthAvailable(),
      timeSinceLastSuccess,
      currentUtterance: currentUtteranceRef.current !== null,
      queueLength: utteranceQueueRef.current.length,
      isPlaying: isPlayingRef.current
    };
  }, [isSynthAvailable]);

  // ==================== LIFECYCLE ====================

  useEffect(() => {
    isMountedRef.current = true;
    lastSuccessTimeRef.current = Date.now();
    
    console.log(' TTS Hook initialized');
    
    return () => {
      console.log(' TTS Hook cleanup');
      isMountedRef.current = false;
      clearPlaybackTimeout();
      stopScript();
    };
  }, [stopScript, clearPlaybackTimeout]);

  // ==================== RETURN ====================

  return {
    // State
    currentPlayingIndex,
    setCurrentPlayingIndex,
    playingTime,
    setPlayingTime,
    isPaused,
    
    // Controls
    pauseScript,
    resumeScript,
    stopScript,
    speakNextInQueue,
    queueConversations,
    isSpeaking,
    
    // Text optimization
    optimizeText,
    chunkText,
    optimizeConversations,
    
    // Metrics & Health
    getTTSMetrics,
    resetMetrics,
    checkHealth,
    
    // Refs (for advanced usage)
    utteranceQueueRef,
    currentUtteranceRef,
    
    // Config
    CONFIG
  };
};
</file>

<file path="src/components/sections/HeaderSection.jsx">
import React, { useState, useEffect } from 'react';
import { 
  Sparkles, 
  Zap, 
  BookOpen, 
  Headphones, 
  Play,
  Award,
  ChevronRight,
  User,
  LogOut,
  Settings
} from 'lucide-react';

// --- Styles Injection (Cho Animation mt m) ---
const styleTag = `
  @keyframes blob {
    0% { transform: translate(0px, 0px) scale(1); }
    33% { transform: translate(30px, -50px) scale(1.1); }
    66% { transform: translate(-20px, 20px) scale(0.9); }
    100% { transform: translate(0px, 0px) scale(1); }
  }
  @keyframes float-slow {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  @keyframes float-delayed {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(10px); }
  }
  .animate-blob { animation: blob 7s infinite; }
  .animation-delay-2000 { animation-delay: 2s; }
  .animation-delay-4000 { animation-delay: 4s; }
  .animate-float-slow { animation: float-slow 4s ease-in-out infinite; }
  .animate-float-delayed { animation: float-delayed 5s ease-in-out infinite; }
`;

// --- Floating Card Component (V tinh) ---
const OrbitCard = ({ icon: Icon, title, subtitle, className, delayClass }) => (
  <div className={`
    absolute hidden lg:flex items-center gap-3 p-3 rounded-2xl 
    bg-white/80 backdrop-blur-md border border-white/50 shadow-lg shadow-blue-500/5
    hover:scale-110 transition-transform duration-300 cursor-default select-none
    ${className} ${delayClass}
  `}>
    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-100 to-indigo-50 flex items-center justify-center text-blue-600">
      <Icon size={20} />
    </div>
    <div>
      <p className="text-xs font-bold text-slate-400 uppercase tracking-wider">{subtitle}</p>
      <p className="text-sm font-bold text-slate-700">{title}</p>
    </div>
  </div>
);

// --- Main Header ---
const HeaderSection = ({ isSignedIn, user, authProvider }) => {
  const [isScrolled, setIsScrolled] = useState(false);
  const [showUserMenu, setShowUserMenu] = useState(false);

  useEffect(() => {
    const handleScroll = () => setIsScrolled(window.scrollY > 20);
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  return (
    <div className="relative w-full min-h-[85vh] flex flex-col items-center justify-center overflow-hidden bg-slate-50 font-sans selection:bg-blue-200">
      <style>{styleTag}</style>

      {/* --- 1. Dynamic Background (Mu Prep nhng sng ng) --- */}
      <div className="absolute inset-0 w-full h-full overflow-hidden pointer-events-none">
        {/* Grid nn nh */}
        <div className="absolute inset-0 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:32px_32px]" />
        
        {/* Cc qu cu mu di chuyn (Blobs) */}
        <div className="absolute top-0 left-1/4 w-96 h-96 bg-blue-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob" />
        <div className="absolute top-0 right-1/4 w-96 h-96 bg-indigo-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000" />
        <div className="absolute -bottom-32 left-1/3 w-96 h-96 bg-cyan-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000" />
      </div>

      {/* --- 3. Center Hero Content (Tri tim ca giao din) --- */}
      <div className="relative z-10 text-center max-w-4xl px-4 mt-16 sm:mt-0">
        
        {/* Tagline Badge */}
        <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-blue-50 border border-blue-100 text-blue-700 text-sm font-bold mb-8 animate-float-slow">
          <span className="relative flex h-2.5 w-2.5">
            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
            <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-blue-500"></span>
          </span>
          Nn tng luyn thi thng minh 2026
        </div>

        {/* Big Headline */}
        <h1 className="text-5xl sm:text-6xl md:text-7xl font-black text-slate-900 tracking-tight leading-[1.1] mb-6">
          Luyn thi HUFLIT <br />
          <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-indigo-600 to-blue-600 bg-[length:200%_auto] animate-blob">
            Khng cn ni lo.
          </span>
        </h1>

        <p className="text-lg sm:text-xl text-slate-600 max-w-2xl mx-auto mb-10 leading-relaxed">
          Tri nghim phng thi o st thc t. Ngn hng  thi phong ph v phn tch im yu bng cng ngh AI.
        </p>

        {/* Main CTA - Glow Effect */}
        <div className="relative group inline-block">
          <div className="absolute -inset-1 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl blur opacity-30 group-hover:opacity-70 transition duration-200"></div>
          <button className="relative flex items-center gap-3 px-8 py-4 bg-white rounded-xl leading-none text-slate-900 font-bold border border-slate-200 hover:bg-slate-50 transition-all active:scale-95 shadow-xl">
            <div className="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white">
              <Play className="w-4 h-4 fill-current ml-0.5" />
            </div>
            <span className="text-lg">Bt u thi th ngay</span>
            <ChevronRight className="w-5 h-5 text-slate-400 group-hover:translate-x-1 transition-transform" />
          </button>
        </div>

        {/* Stats Strip (Mobile Friendly) */}
        <div className="mt-12 pt-8 border-t border-slate-200/60 flex flex-wrap justify-center gap-8 sm:gap-16">
          <div className="text-center">
            <p className="text-2xl font-bold text-slate-900">500+</p>
            <p className="text-sm font-semibold text-slate-500 uppercase tracking-wide"> thi</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-slate-900">24/7</p>
            <p className="text-sm font-semibold text-slate-500 uppercase tracking-wide">H tr</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-slate-900">Top 1</p>
            <p className="text-sm font-semibold text-slate-500 uppercase tracking-wide">Uy tn</p>
          </div>
        </div>

      </div>

      {/* --- 4. Orbiting Elements (V tinh trang tr) --- */}
      {/* V tr c t absolute so vi khung hnh, to cm gic bao quanh ni dung */}
      
      {/* Tri Trn: Listening */}
      <OrbitCard 
        icon={Headphones} 
        title="Listening Part 1" 
        subtitle="ang luyn"
        className="top-[20%] left-[10%] -rotate-6"
        delayClass="animate-float-slow"
      />

      {/* Phi Trn: Reading */}
      <OrbitCard 
        icon={BookOpen} 
        title="Reading Part 4" 
        subtitle="Mi nht"
        className="top-[25%] right-[10%] rotate-3"
        delayClass="animate-float-delayed"
      />

      {/* Tri Di: im s */}
      <OrbitCard 
        icon={Award} 
        title="Target: 9.0" 
        subtitle="Mc tiu"
        className="bottom-[20%] left-[15%] rotate-6"
        delayClass="animate-float-delayed"
      />

      {/* Phi Di: Streak */}
      <OrbitCard 
        icon={Zap} 
        title="5 Ngy Streak" 
        subtitle="Chm ch"
        className="bottom-[25%] right-[12%] -rotate-3"
        delayClass="animate-float-slow"
      />

    </div>
  );
};

export default HeaderSection;
</file>

<file path="Backend/chat-server.js">
// Backend/chat-server.js
import express from 'express';
import http from 'http';
import { Server } from 'socket.io';
import cors from 'cors';

// Import routes
import chatRoutes from './routes/chat.js';

// Import controllers
import { 
  handleUserJoin, 
  handleSendMessage, 
  handleDeleteMessage, 
  handleUserDisconnect 
} from './controllers/chatController.js';

// Import Firestore
import { initializeFirestore } from './firebase-config.js';

const app = express();
const server = http.createServer(app);

// ============================================
// CORS Configuration
// ============================================

// Parse allowed origins from environment variable
const allowedOrigins = process.env.FRONTEND_URL 
  ? process.env.FRONTEND_URL.split(',').map(url => url.trim())
  : ['http://localhost:5173'];

console.log(' Allowed CORS origins:', allowedOrigins);

// CORS options vi wildcard support
const corsOptions = {
  origin: function (origin, callback) {
    // Allow requests with no origin (mobile apps, Postman, curl)
    if (!origin) {
      console.log(' Request with no origin allowed');
      return callback(null, true);
    }
    
    // Check exact match first
    if (allowedOrigins.includes(origin)) {
      console.log(' CORS allowed (exact match):', origin);
      return callback(null, true);
    }
    
    // Check wildcard patterns (*.vercel.app, *.onrender.com)
    const wildcardMatch = allowedOrigins.some(allowedOrigin => {
      if (allowedOrigin.includes('*')) {
        // Convert wildcard to regex pattern
        const pattern = allowedOrigin
          .replace(/\./g, '\\.')  // Escape dots
          .replace(/\*/g, '.*');  // Replace * with .*
        const regex = new RegExp(`^${pattern}$`);
        return regex.test(origin);
      }
      return false;
    });
    
    if (wildcardMatch) {
      console.log(' CORS allowed (wildcard match):', origin);
      return callback(null, true);
    }
    
    // Origin not allowed
    console.warn(' CORS blocked origin:', origin);
    console.warn('   Allowed origins:', allowedOrigins);
    callback(new Error('Not allowed by CORS'));
  },
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
};

// ============================================
// Socket.IO Configuration
// ============================================

const io = new Server(server, {
  cors: corsOptions,
  pingTimeout: 60000,
  pingInterval: 25000,
  transports: ['websocket', 'polling']
});

// ============================================
// Middleware
// ============================================

app.use(cors(corsOptions));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Request logging middleware
app.use((req, res, next) => {
  console.log(` ${req.method} ${req.path} - Origin: ${req.get('origin') || 'no origin'}`);
  next();
});

// ============================================
// Initialize Firestore
// ============================================

console.log(' Initializing Firestore...');
try {
  await initializeFirestore();
  console.log(' Firestore initialization complete');
} catch (error) {
  console.error(' Failed to initialize Firestore:', error);
  console.error('   Server will continue but database features may not work');
  // Don't exit - let server run for health checks
}

// ============================================
// Routes
// ============================================

// Root endpoint
app.get('/', (req, res) => {
  res.json({ 
    message: ' HUFLIT Chat Server',
    status: 'running',
    version: '1.0.0',
    timestamp: new Date().toISOString(),
    environment: process.env.NODE_ENV || 'development'
  });
});

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({ 
    status: ' Server is running',
    timestamp: new Date().toISOString(),
    uptime: Math.floor(process.uptime()),
    memory: {
      used: Math.round(process.memoryUsage().heapUsed / 1024 / 1024),
      total: Math.round(process.memoryUsage().heapTotal / 1024 / 1024)
    },
    environment: process.env.NODE_ENV || 'development'
  });
});

// API routes
app.use('/api/chat', chatRoutes(io));

// 404 handler
app.use((req, res) => {
  res.status(404).json({ 
    error: 'Not Found',
    path: req.path,
    message: 'The requested endpoint does not exist'
  });
});

// Error handler
app.use((err, req, res, next) => {
  console.error(' Server error:', err);
  res.status(err.status || 500).json({
    error: err.message || 'Internal Server Error',
    ...(process.env.NODE_ENV === 'development' && { stack: err.stack })
  });
});

// ============================================
// Socket.IO Connection Handling
// ============================================

io.on('connection', (socket) => {
  console.log(' User connected:', socket.id);
  console.log('   Transport:', socket.conn.transport.name);
  console.log('   Total connections:', io.engine.clientsCount);

  // User join room
  socket.on('user-join', (data) => {
    try {
      console.log(' User joining:', data);
      handleUserJoin(socket, io, data);
    } catch (error) {
      console.error(' Error in user-join:', error);
      socket.emit('error', { message: 'Failed to join chat' });
    }
  });

  // Send message
  socket.on('send-message', (data) => {
    try {
      console.log(' Message received:', { from: data.username, length: data.message?.length });
      handleSendMessage(socket, io, data);
    } catch (error) {
      console.error(' Error in send-message:', error);
      socket.emit('error', { message: 'Failed to send message' });
    }
  });

  // Delete message
  socket.on('delete-message', (messageId) => {
    try {
      console.log(' Deleting message:', messageId);
      handleDeleteMessage(socket, io, messageId);
    } catch (error) {
      console.error(' Error in delete-message:', error);
      socket.emit('error', { message: 'Failed to delete message' });
    }
  });

  // Handle typing indicator
  socket.on('typing', (data) => {
    socket.broadcast.emit('user-typing', data);
  });

  socket.on('stop-typing', (data) => {
    socket.broadcast.emit('user-stop-typing', data);
  });

  // User disconnect
  socket.on('disconnect', (reason) => {
    console.log(' User disconnected:', socket.id);
    console.log('   Reason:', reason);
    console.log('   Remaining connections:', io.engine.clientsCount);
    
    try {
      handleUserDisconnect(socket, io);
    } catch (error) {
      console.error(' Error in disconnect handler:', error);
    }
  });

  // Handle errors
  socket.on('error', (error) => {
    console.error(' Socket error:', socket.id, error);
  });
});

// Socket.IO error handling
io.engine.on('connection_error', (err) => {
  console.error(' Socket.IO connection error:', err);
});

// ============================================
// Graceful Shutdown
// ============================================

const gracefulShutdown = async (signal) => {
  console.log(`\n ${signal} received: closing server gracefully...`);
  
  // Stop accepting new connections
  server.close(() => {
    console.log(' HTTP server closed');
  });

  // Close all socket connections
  io.close(() => {
    console.log(' Socket.IO server closed');
  });

  // Give existing connections time to finish
  setTimeout(() => {
    console.log(' Forcing shutdown after timeout');
    process.exit(0);
  }, 10000);
};

process.on('SIGTERM', () => gracefulShutdown('SIGTERM'));
process.on('SIGINT', () => gracefulShutdown('SIGINT'));

// Handle uncaught errors
process.on('uncaughtException', (error) => {
  console.error(' Uncaught Exception:', error);
  process.exit(1);
});

process.on('unhandledRejection', (reason, promise) => {
  console.error(' Unhandled Rejection at:', promise, 'reason:', reason);
  process.exit(1);
});

// ============================================
// Export
// ============================================

export { app, server, io };
export default server;
</file>

<file path="Backend/index.js">
// backend/index.js
import dotenv from 'dotenv';
dotenv.config();

import app from './chat-server.js';

const PORT = process.env.PORT || 5000;

const server = app.listen(PORT, () => {
  console.log(` Server running at http://localhost:${PORT}`);
  console.log(` Socket.IO ready for connections`);
});

// Graceful shutdown
process.on('SIGTERM', () => {
  console.log('SIGTERM signal received: closing HTTP server');
  server.close(() => {
    console.log('HTTP server closed');
  });
});

export default app;
</file>

<file path="src/components/common/LoadingSpinner.jsx">
import React, { memo } from 'react';

const LoadingSpinner = memo(({ message = "Loading..." }) => {
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-blue-900 via-purple-900 to-blue-900">
      <style>{`
        @keyframes startround {
          0% {
            filter: brightness(5);
            box-shadow: none;
          }
          70% {
            filter: brightness(5);
            box-shadow: none;
          }
          100% {
            filter: brightness(1);
            box-shadow: inset 0 0.5em rgba(255, 255, 255, 0.25),
                        inset 0 -0.5em rgba(0, 0, 0, 0.25);
          }
        }

        @keyframes round1 {
          0% {
            left: -2em;
            opacity: 1;
          }
          30% {
            left: -6em;
            opacity: 1;
            transform: skewX(-25deg) rotate(25deg);
          }
          31% {
            opacity: 0;
          }
          35% {
            left: 7em;
            opacity: 0;
          }
          45% {
            left: 7em;
            opacity: 1;
            transform: skewX(25deg) rotate(-25deg);
          }
          100% {
            left: -2em;
            opacity: 1;
            transform: skewX(0deg) rotate(0deg);
          }
        }

        @keyframes round2 {
          0% {
            left: 5em;
            opacity: 1;
          }
          75% {
            left: -7em;
            opacity: 1;
            transform: skewX(-25deg) rotate(25deg);
          }
          76% {
            opacity: 0;
          }
          77% {
            left: 8em;
            opacity: 0;
          }
          80% {
            left: 8em;
            opacity: 1;
            transform: skewX(25deg) rotate(-25deg);
          }
          100% {
            left: 5em;
            opacity: 1;
            transform: skewX(0deg) rotate(0deg);
          }
        }

        .earth-loader {
          position: relative;
          width: 6rem;
          height: 6rem;
          background-color: #3344c1;
          border-radius: 50%;
          overflow: hidden;
          border: 3px solid white;
          box-shadow: inset 0 0.5em rgba(255, 255, 255, 0.25),
                      inset 0 -0.5em rgba(0, 0, 0, 0.25);
          animation: startround 2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
          transform: translate3d(0, 0, 0);
          backface-visibility: hidden;
        }

        @media (min-width: 640px) {
          .earth-loader {
            width: 7.5rem;
            height: 7.5rem;
          }
        }

        @media (min-width: 768px) {
          .earth-loader {
            width: 8.5rem;
            height: 8.5rem;
          }
        }

        .land-mass-1,
        .land-mass-2,
        .land-mass-3,
        .land-mass-4 {
          position: absolute;
          width: 7em;
          height: auto;
          will-change: transform, opacity;
          transform: translate3d(0, 0, 0);
          backface-visibility: hidden;
        }

        .land-mass-1 {
          bottom: -2em;
          animation: round1 5s linear infinite 2.75s;
        }

        .land-mass-2 {
          top: -3em;
          animation: round1 5s linear infinite 2s;
        }

        .land-mass-3 {
          top: -2.5em;
          animation: round2 5s linear infinite 2s;
        }

        .land-mass-4 {
          bottom: -2.2em;
          animation: round2 5s linear infinite 2.75s;
        }

        @media (prefers-reduced-motion: reduce) {
          .earth-loader,
          .land-mass-1,
          .land-mass-2,
          .land-mass-3,
          .land-mass-4 {
            animation: none !important;
          }
        }
      `}</style>

      <div className="flex flex-col items-center justify-center gap-4">
        {/* Earth Loader */}
        <div className="earth-loader">
          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            viewBox="0 0 200 200" 
            className="land-mass-1"
            aria-hidden="true"
            role="presentation"
          >
            <path
              transform="translate(100 100)"
              d="M29.4,-17.4C33.1,1.8,27.6,16.1,11.5,31.6C-4.7,47,-31.5,63.6,-43,56C-54.5,48.4,-50.7,16.6,-41,-10.9C-31.3,-38.4,-15.6,-61.5,-1.4,-61C12.8,-60.5,25.7,-36.5,29.4,-17.4Z"
              fill="#7CC133"
            />
          </svg>

          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            viewBox="0 0 200 200" 
            className="land-mass-2"
            aria-hidden="true"
            role="presentation"
          >
            <path
              transform="translate(100 100)"
              d="M31.7,-55.8C40.3,-50,45.9,-39.9,49.7,-29.8C53.5,-19.8,55.5,-9.9,53.1,-1.4C50.6,7.1,43.6,14.1,41.8,27.6C40.1,41.1,43.4,61.1,37.3,67C31.2,72.9,15.6,64.8,1.5,62.2C-12.5,59.5,-25,62.3,-31.8,56.7C-38.5,51.1,-39.4,37.2,-49.3,26.3C-59.1,15.5,-78,7.7,-77.6,0.2C-77.2,-7.2,-57.4,-14.5,-49.3,-28.4C-41.2,-42.4,-44.7,-63,-38.5,-70.1C-32.2,-77.2,-16.1,-70.8,-2.3,-66.9C11.6,-63,23.1,-61.5,31.7,-55.8Z"
              fill="#7CC133"
            />
          </svg>

          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            viewBox="0 0 200 200" 
            className="land-mass-3"
            aria-hidden="true"
            role="presentation"
          >
            <path
              transform="translate(100 100)"
              d="M30.6,-49.2C42.5,-46.1,57.1,-43.7,67.6,-35.7C78.1,-27.6,84.6,-13.8,80.3,-2.4C76.1,8.9,61.2,17.8,52.5,29.1C43.8,40.3,41.4,53.9,33.7,64C26,74.1,13,80.6,2.2,76.9C-8.6,73.1,-17.3,59,-30.6,52.1C-43.9,45.3,-61.9,45.7,-74.1,38.2C-86.4,30.7,-92.9,15.4,-88.6,2.5C-84.4,-10.5,-69.4,-20.9,-60.7,-34.6C-52.1,-48.3,-49.8,-65.3,-40.7,-70C-31.6,-74.8,-15.8,-67.4,-3.2,-61.8C9.3,-56.1,18.6,-52.3,30.6,-49.2Z"
              fill="#7CC133"
            />
          </svg>

          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            viewBox="0 0 200 200" 
            className="land-mass-4"
            aria-hidden="true"
            role="presentation"
          >
            <path
              transform="translate(100 100)"
              d="M39.4,-66C48.6,-62.9,51.9,-47.4,52.9,-34.3C53.8,-21.3,52.4,-10.6,54.4,1.1C56.3,12.9,61.7,25.8,57.5,33.2C53.2,40.5,39.3,42.3,28.2,46C17,49.6,8.5,55.1,1.3,52.8C-5.9,50.5,-11.7,40.5,-23.6,37.2C-35.4,34,-53.3,37.5,-62,32.4C-70.7,27.4,-70.4,13.7,-72.4,-1.1C-74.3,-15.9,-78.6,-31.9,-73.3,-43C-68.1,-54.2,-53.3,-60.5,-39.5,-60.9C-25.7,-61.4,-12.9,-56,1.1,-58C15.1,-59.9,30.2,-69.2,39.4,-66Z"
              fill="#7CC133"
            />
          </svg>
        </div>

        {/* Loading Text */}
        <p className="text-white text-base sm:text-lg md:text-xl font-semibold tracking-wide animate-pulse">
          {message}
        </p>
      </div>
    </div>
  );
});

LoadingSpinner.displayName = 'LoadingSpinner';

export { LoadingSpinner };
export default LoadingSpinner;
</file>

<file path="src/components/Display/ExplanationDisplay.jsx">
import React, { useState, useRef } from 'react';
import { 
  Lightbulb, ChevronDown, ChevronUp, Brain, 
  Copy, Check, Sparkles, Target, BookOpen, Zap
} from 'lucide-react';

const ExplanationSection = ({ 
  explanation, 
  question, 
  userAnswer, 
  correctAnswer, 
  isCorrect,
  questionId,
  options = []
}) => {
  // ===== STATE MANAGEMENT =====
  const [isExpanded, setIsExpanded] = useState(false);
  const [isCopied, setIsCopied] = useState(false);
  const [isExplanationExpanded, setIsExplanationExpanded] = useState(false);
  const [isMainCardHovered, setIsMainCardHovered] = useState(false);
  const contentRef = useRef(null);

  // ===== DERIVED DATA =====
  const selectedAnswerText = options[userAnswer] || 'Cha chn';
  const correctAnswerText = options[correctAnswer] || 'N/A';
  const isLongExplanation = explanation && explanation.length > 300;
  
  const displayedExplanation = isExplanationExpanded || !isLongExplanation 
    ? explanation 
    : explanation?.substring(0, 300);

  // ===== HANDLERS WITH ACCESSIBILITY =====
  const copyToClipboard = async () => {
    try {
      await navigator.clipboard.writeText(explanation);
      setIsCopied(true);
      setTimeout(() => setIsCopied(false), 2000);
    } catch (err) {
      console.error('Copy failed:', err);
    }
  };

  const handleExpandClick = () => {
    setIsExpanded(!isExpanded);
  };

  const handleExplanationToggle = () => {
    setIsExplanationExpanded(!isExplanationExpanded);
  };

  // ===== ENHANCED TEXT RENDERING WITH SEMANTIC FORMATTING =====
  const renderFormattedText = (text) => {
    if (!text) return null;
    
    // Split by **bold text** pattern and preserve structure
    const parts = text.split(/(\*\*[^*]+\*\*)/g);
    
    return parts.map((part, idx) => {
      if (part.startsWith('**') && part.endsWith('**')) {
        const boldText = part.slice(2, -2);
        return (
          <span 
            key={idx}
            className="font-semibold text-blue-600 bg-gradient-to-r from-blue-50 to-cyan-50 px-2 py-1 rounded-md text-sm inline-block transition-all duration-200 hover:shadow-sm hover:from-blue-100 hover:to-cyan-100"
          >
            {boldText}
          </span>
        );
      }
      return <span key={idx}>{part}</span>;
    });
  };

  if (!explanation) return null;

  return (
    <div className="w-full my-6 space-y-3 sm:space-y-4">
      {/* ===== HEADER TOGGLE BUTTON - ENHANCED UX =====*/}
      <button
        onClick={handleExpandClick}
        onKeyDown={(e) => e.key === 'Enter' && handleExpandClick()}
        aria-expanded={isExpanded}
        aria-controls={`explanation-content-${questionId}`}
        aria-label={isExpanded ? 'Thu gn gii thch' : 'Xem gii thch chi tit'}
        className={`
          w-full text-left transition-all duration-300 ease-out 
          px-4 sm:px-6 py-4 rounded-xl focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500
          ${isExpanded 
            ? 'bg-gradient-to-r from-slate-50 via-slate-50 to-blue-50/30 border border-slate-200 shadow-md' 
            : 'bg-white border border-slate-200 hover:border-slate-300 shadow-sm hover:shadow-md active:shadow-lg'
          }
        `}
      >
        <div className="flex items-center justify-between gap-3 sm:gap-4">
          {/* LEFT SECTION: Icon + Title */}
          <div className="flex items-center gap-2 sm:gap-3 flex-1 min-w-0">
            <div className={`
              flex-shrink-0 p-2 rounded-lg transition-all duration-300
              ${isCorrect 
                ? 'bg-emerald-100/50' 
                : 'bg-rose-100/50'
              }
            `}>
              <Lightbulb className={`w-5 h-5 transition-colors duration-300 ${
                isCorrect ? 'text-emerald-600' : 'text-rose-500'
              }`} />
            </div>
            
            <div className="flex-1 min-w-0">
              <p className="text-sm font-bold text-slate-900 tracking-tight">
                {isCorrect ? ' Gii thch' : ' Phn tch li'}
              </p>
              <p className="text-xs text-slate-500 mt-0.5 font-medium">
                {isExpanded ? 'Nhn  thu gn' : 'Nhn  xem chi tit'}
              </p>
            </div>
          </div>
          
          {/* MIDDLE SECTION: Status Badge with Animation */}
          <div className={`
            px-3 sm:px-4 py-2 rounded-full text-xs font-semibold flex-shrink-0
            transition-all duration-300 backdrop-blur-sm
            ${isCorrect 
              ? 'bg-emerald-100/60 text-emerald-700 border border-emerald-200/50 shadow-sm shadow-emerald-200/20' 
              : 'bg-rose-100/60 text-rose-700 border border-rose-200/50 shadow-sm shadow-rose-200/20'
            }
          `}>
            <span className={isCorrect ? '' : ''} /> 
            <span className="ml-1">{isCorrect ? 'Chnh xc' : 'Cn ci thin'}</span>
          </div>
          
          {/* RIGHT SECTION: Chevron Icon */}
          <ChevronDown className={`
            w-5 h-5 text-slate-600 transition-all duration-300 flex-shrink-0
            ${isExpanded ? 'rotate-180 text-blue-600' : ''}
          `} />
        </div>
      </button>

      {/* ===== EXPANDED CONTENT - SMOOTH ANIMATION ===== */}
      <div
        id={`explanation-content-${questionId}`}
        className={`
          overflow-hidden transition-all duration-500 ease-in-out origin-top
          ${isExpanded ? 'opacity-100 visible' : 'max-h-0 opacity-0 invisible'}
        `}
      >
        <div ref={contentRef} className="space-y-4 pt-2 animate-in fade-in slide-in-from-top-2">
          
          {/* ===== ANSWER COMPARISON CARD - PREMIUM LAYOUT ===== */}
          <div className="bg-white border border-slate-150 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden group">
            {/* Card Header */}
            <div className="px-4 sm:px-6 py-3 border-b border-slate-100 bg-gradient-to-r from-slate-50 via-slate-50 to-slate-100/50 group-hover:from-slate-100 group-hover:to-slate-100/50 transition-colors duration-300">
              <div className="flex items-center gap-2">
                <BookOpen className="w-4 h-4 text-slate-600" />
                <h3 className="text-sm font-bold text-slate-900">So snh kt qu</h3>
              </div>
            </div>
            
            {/* Answer Grid - Responsive 2-Column Layout */}
            <div className="grid grid-cols-1 sm:grid-cols-2 divide-y sm:divide-y-0 sm:divide-x divide-slate-100">
              {/* User's Answer */}
              <div className="p-4 sm:p-6 hover:bg-slate-50/50 transition-colors duration-200">
                <div className="flex items-center gap-3 mb-4">
                  <div className={`
                    flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold flex-shrink-0
                    transition-all duration-200
                    ${isCorrect 
                      ? 'bg-gradient-to-br from-emerald-200 to-emerald-100 text-emerald-800 shadow-sm' 
                      : 'bg-gradient-to-br from-rose-200 to-rose-100 text-rose-800 shadow-sm'
                    }
                  `}>
                    {userAnswer !== undefined ? String.fromCharCode(65 + userAnswer) : '?'}
                  </div>
                  <span className="text-sm font-semibold text-slate-700">Cu tr li ca bn</span>
                </div>
                <p className="text-sm text-slate-800 leading-relaxed font-medium break-words">
                  {selectedAnswerText}
                </p>
              </div>

              {/* Correct Answer - Only Show if Wrong */}
              {!isCorrect && (
                <div className="p-4 sm:p-6 bg-gradient-to-br from-emerald-50 to-emerald-50/30 hover:from-emerald-100/50 hover:to-emerald-100/30 transition-colors duration-200">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="flex items-center justify-center w-7 h-7 rounded-full bg-gradient-to-br from-emerald-300 to-emerald-200 text-emerald-900 text-xs font-bold flex-shrink-0 shadow-sm">
                      {String.fromCharCode(65 + correctAnswer)}
                    </div>
                    <span className="text-sm font-semibold text-emerald-700">p n ng</span>
                  </div>
                  <p className="text-sm text-slate-800 leading-relaxed font-medium break-words">
                    {correctAnswerText}
                  </p>
                </div>
              )}
            </div>
          </div>

          {/* ===== MAIN EXPLANATION CARD - PREMIUM BOOK-LIKE DESIGN ===== */}
          <div 
            onMouseEnter={() => setIsMainCardHovered(true)}
            onMouseLeave={() => setIsMainCardHovered(false)}
            className="bg-white border border-slate-150 rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden group"
          >
            {/* Premium Header */}
            <div className={`
              px-4 sm:px-6 py-4 border-b border-slate-100 
              transition-all duration-300
              ${isMainCardHovered 
                ? 'bg-gradient-to-r from-blue-50 via-blue-50/50 to-cyan-50/30 border-blue-100/50' 
                : 'bg-gradient-to-r from-slate-50 via-slate-50 to-slate-100/50'
              }
            `}>
              <div className="flex items-center gap-3">
                <div className={`
                  p-2 rounded-lg transition-all duration-300
                  ${isMainCardHovered ? 'bg-blue-100/60 scale-110' : 'bg-blue-50/60'}
                `}>
                  <Brain className={`w-4 h-4 transition-colors duration-300 ${
                    isMainCardHovered ? 'text-blue-700' : 'text-slate-600'
                  }`} />
                </div>
                <h3 className="text-sm font-bold text-slate-900">Gii thch chi tit</h3>
              </div>
            </div>
            
            {/* Content Area with Premium Typography */}
            <div className="p-5 sm:p-8">
              {/* Explanation Text Container */}
              <div className="relative mb-6">
                <div className={`
                  text-sm leading-relaxed text-slate-800 font-medium
                  transition-all duration-300
                  ${isLongExplanation && !isExplanationExpanded 
                    ? 'line-clamp-5 relative' 
                    : ''
                  }
                `}>
                  {renderFormattedText(displayedExplanation)}
                </div>
                
                {/* Sophisticated Gradient Fade Effect */}
                {isLongExplanation && !isExplanationExpanded && (
                  <div className="absolute inset-x-0 bottom-0 h-16 bg-gradient-to-t from-white via-white/80 to-transparent pointer-events-none" />
                )}
              </div>

              {/* Expand/Collapse Toggle - Elegant Button */}
              {isLongExplanation && (
                <button
                  onClick={handleExplanationToggle}
                  onKeyDown={(e) => e.key === 'Enter' && handleExplanationToggle()}
                  aria-expanded={isExplanationExpanded}
                  aria-label={isExplanationExpanded ? 'Thu gn gii thch chi tit' : 'Xem ton b gii thch'}
                  className="mt-4 flex items-center gap-2 text-blue-600 hover:text-blue-700 text-sm font-semibold transition-all duration-200 group/btn hover:gap-3 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500"
                >
                  {isExplanationExpanded ? (
                    <>
                      <ChevronUp className="w-4 h-4 transition-transform duration-200 group-hover/btn:-translate-y-0.5" />
                      <span>Thu gn</span>
                    </>
                  ) : (
                    <>
                      <ChevronDown className="w-4 h-4 transition-transform duration-200 group-hover/btn:translate-y-0.5" />
                      <span>Xem ton b ({explanation.length} k t)</span>
                    </>
                  )}
                </button>
              )}
            </div>
          </div>

          {/* ===== LEARNING INSIGHT BOX - MOTIVATIONAL DESIGN ===== */}
          <div className={`
            rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-all duration-300
            border backdrop-blur-sm
            ${isCorrect 
              ? 'bg-gradient-to-br from-emerald-50 via-emerald-50/50 to-teal-50/30 border-emerald-200/50' 
              : 'bg-gradient-to-br from-violet-50 via-violet-50/50 to-purple-50/30 border-violet-200/50'
            }
          `}>
            <div className="p-5 sm:p-6 relative overflow-hidden">
              {/* Decorative Background Element */}
              <div className={`
                absolute top-0 right-0 opacity-5 transform translate-x-8 -translate-y-4
                transition-transform duration-300 group-hover:translate-x-6 group-hover:-translate-y-2
              `}>
                <Sparkles className={`w-20 h-20 ${isCorrect ? 'text-emerald-600' : 'text-violet-600'}`} />
              </div>
              
              <div className="flex items-start gap-4 relative z-10">
                <div className={`
                  p-2 rounded-lg flex-shrink-0 mt-0.5
                  ${isCorrect 
                    ? 'bg-emerald-200/50 text-emerald-700' 
                    : 'bg-violet-200/50 text-violet-700'
                  }
                `}>
                  {isCorrect ? (
                    <Zap className="w-5 h-5" />
                  ) : (
                    <Target className="w-5 h-5" />
                  )}
                </div>

                <div className="flex-1 min-w-0">
                  <h4 className={`text-sm font-bold mb-2 ${
                    isCorrect 
                      ? 'text-emerald-900' 
                      : 'text-violet-900'
                  }`}>
                    {isCorrect ? ' Tip tc duy tr!' : ' Hc t sai lm'}
                  </h4>
                  <p className={`text-sm leading-relaxed font-medium ${
                    isCorrect 
                      ? 'text-emerald-800' 
                      : 'text-violet-800'
                  }`}>
                    {isCorrect 
                      ? 'Xut sc! Bn  nm vng kin thc ny. Hy tip tc luyn tp  ghi nh lu di hn v p dng vo cc tnh hung thc t.'
                      : 'Mi sai lm l mt c hi hc tp qu gi. Hy xem li phn l thuyt lin quan v luyn tp thm 3-5 bi tng t  nm vng kin thc.'}
                  </p>
                </div>
              </div>
            </div>
          </div>

          {/* ===== COPY BUTTON - PREMIUM INTERACTION ===== */}
          <button
            onClick={copyToClipboard}
            onKeyDown={(e) => e.key === 'Enter' && copyToClipboard()}
            aria-label={isCopied ? 'Gii thch  c sao chp' : 'Sao chp gii thch'}
            className={`
              w-full flex items-center justify-center gap-3
              py-3 sm:py-4 px-5 rounded-xl font-semibold text-sm sm:text-base
              transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2
              ${isCopied
                ? 'bg-gradient-to-r from-emerald-100 to-emerald-50 text-emerald-700 border border-emerald-300/50 shadow-sm focus-visible:ring-emerald-500' 
                : 'bg-white border-2 border-slate-300 text-slate-700 hover:border-slate-400 hover:shadow-md active:shadow-lg focus-visible:ring-blue-500'
              }
            `}
          >
            {isCopied ? (
              <>
                <Check className="w-5 h-5 animate-bounce" />
                <span> sao chp!</span>
              </>
            ) : (
              <>
                <Copy className="w-5 h-5" />
                <span>Sao chp gii thch</span>
              </>
            )}
          </button>
        </div>
      </div>
    </div>
  );
};

export default ExplanationSection;
</file>

<file path="src/components/Display/QuestionDisplay.jsx">
import React, { useMemo, useCallback, useState, memo, useEffect } from 'react';
import { 
  Save, CheckCircle, AlertCircle, Volume2, Check, 
  ChevronRight, Sparkles, Clock, Zap, Lightbulb, X, Menu
} from 'lucide-react';
import { collection, addDoc, serverTimestamp } from 'firebase/firestore';
import { db } from '../../config/firebase';
import { useUnifiedAuth } from '../../hooks/useUnifiedAuth';

// ==========================================
// SUB-COMPONENT: Animated Progress Bar
// ==========================================
const ProgressBar = memo(({ percentage }) => (
  <div className="relative h-2.5 w-full bg-slate-200 rounded-full overflow-hidden shadow-sm">
    <div className="absolute inset-0 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200" />
    
    <div
      className="h-full bg-gradient-to-r from-blue-600 via-blue-500 to-cyan-500 transition-all duration-900 ease-out rounded-full shadow-lg shadow-blue-500/30 relative overflow-hidden"
      style={{ width: `${percentage}%` }}
    >
      <div className="absolute inset-y-0 -left-full w-full h-full bg-gradient-to-r from-transparent via-white/40 to-transparent animate-[slide_3s_infinite] skew-x-12" />
    </div>
  </div>
));

ProgressBar.displayName = 'ProgressBar';

// ==========================================
// SUB-COMPONENT: Question Option
// ==========================================
const QuestionOption = memo(({ 
  option, 
  index, 
  isSelected, 
  onSelect, 
  questionId
}) => {
  const label = String.fromCharCode(65 + index);

  return (
    <label className="block group cursor-pointer relative">
      <input
        type="radio"
        className="sr-only"
        name={`q-${questionId}`}
        checked={isSelected}
        onChange={onSelect}
        aria-label={`${label}. ${option}`}
      />
      
      <div className={`
        relative flex items-center gap-3 p-3 sm:p-3.5 rounded-lg border-2 
        transition-all duration-300 ease-out overflow-hidden
        ${isSelected 
          ? 'border-blue-500 bg-gradient-to-r from-blue-50/80 to-cyan-50/30 shadow-[0_0_15px_rgba(59,130,246,0.15)]' 
          : 'border-slate-200 bg-white hover:border-blue-300 hover:bg-slate-50 hover:shadow-md'}
      `}>
        {isSelected && (
          <div className="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-cyan-500/5 animate-pulse" />
        )}

        <div className={`
          relative flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center 
          text-xs font-bold transition-all duration-300
          ${isSelected 
            ? 'bg-gradient-to-br from-blue-600 to-blue-500 text-white shadow-md' 
            : 'bg-slate-100 text-slate-600 group-hover:bg-slate-200'}
        `}>
          {label}
        </div>
        
        <span className={`
          relative text-sm sm:text-[14px] leading-relaxed transition-colors duration-200 flex-1 line-clamp-2
          ${isSelected ? 'text-slate-900 font-semibold' : 'text-slate-700 group-hover:text-slate-800'}
        `}>
          {option}
        </span>

        {isSelected && (
          <div className="relative animate-in zoom-in duration-300 flex-shrink-0">
            <div className="w-4 h-4 sm:w-5 sm:h-5 rounded-full bg-blue-500 flex items-center justify-center">
              <Check className="w-2.5 h-2.5 sm:w-3 sm:h-3 text-white" strokeWidth={3} />
            </div>
          </div>
        )}
      </div>
    </label>
  );
});

QuestionOption.displayName = 'QuestionOption';

// ==========================================
// SUB-COMPONENT: Script Display
// ==========================================
const ScriptDisplay = memo(({ script }) => {
  if (!script) return null;

  return (
    <div className="mb-4 sm:mb-5 p-3 sm:p-4 bg-gradient-to-br from-blue-50/80 to-cyan-50/40 rounded-lg border-l-4 border-blue-500 shadow-sm hover:shadow-md transition-shadow duration-300">
      <div className="flex items-start gap-3">
        <Volume2 className="w-4 h-4 sm:w-5 sm:h-5 text-blue-600 flex-shrink-0 mt-0.5" strokeWidth={2} />
        <div className="flex-1 min-w-0">
          <p className="text-xs font-bold text-blue-800 uppercase tracking-wider mb-2">
             Bi nghe
          </p>
          <p className="text-[13px] sm:text-[13.5px] text-slate-700 leading-relaxed font-[450] break-words">
            {script}
          </p>
        </div>
      </div>
    </div>
  );
});

ScriptDisplay.displayName = 'ScriptDisplay';

// ==========================================
// SUB-COMPONENT: Question Card
// ==========================================
const QuestionCard = memo(({ 
  question, 
  script, 
  options, 
  selectedAnswer, 
  onAnswerSelect,
  questionNumber,
  totalQuestions 
}) => {
  const isAnswered = selectedAnswer !== undefined;

  return (
    <article 
      className="group relative bg-white border border-slate-200 rounded-xl p-4 sm:p-5 transition-all duration-300 hover:border-blue-300 hover:shadow-md focus-within:ring-2 focus-within:ring-blue-500 scroll-m-4"
      role="region"
      aria-label={`Question ${question.id}`}
    >
      <ScriptDisplay script={script} />

      <div className="flex flex-col sm:flex-row sm:items-start justify-between gap-2 sm:gap-3 mb-3 sm:mb-4 pb-3 sm:pb-4 border-b border-slate-200">
        <div className="flex items-baseline gap-2 sm:gap-3 flex-1 min-w-0">
          <span className="flex-shrink-0 inline-flex items-center justify-center w-6 h-6 sm:w-7 sm:h-7 rounded-lg bg-gradient-to-br from-blue-600 to-blue-500 text-white text-xs font-bold shadow-md">
            {question.id}
          </span>
          
          <h3 className="text-sm sm:text-[15px] font-semibold text-slate-900 leading-snug flex-1">
            {question.question}
          </h3>
        </div>

        <div className="flex-shrink-0">
          <span className="inline-block text-[11px] sm:text-xs font-bold text-slate-500 bg-slate-100 px-2 sm:px-2.5 py-1 rounded-full whitespace-nowrap">
            {questionNumber}/{totalQuestions}
          </span>
        </div>
      </div>

      <div className="space-y-2">
        {options?.map((opt, i) => (
          <QuestionOption
            key={`${question.id}-${i}`}
            index={i}
            option={opt}
            isSelected={selectedAnswer === i}
            onSelect={() => onAnswerSelect(question.id, i)}
            questionId={question.id}
          />
        ))}
      </div>

      {isAnswered && selectedAnswer !== undefined && (
        <div className="mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-slate-200 animate-in fade-in slide-in-from-bottom-2 duration-300">
          <div className="flex items-center gap-2 text-xs bg-emerald-50 p-2.5 sm:p-3 rounded-lg border border-emerald-200">
            <CheckCircle className="w-3.5 h-3.5 sm:w-4 sm:h-4 text-emerald-600 flex-shrink-0" strokeWidth={2.5} />
            <span className="font-semibold text-emerald-900">
                chn: ({String.fromCharCode(65 + selectedAnswer)})
            </span>
          </div>
        </div>
      )}
    </article>
  );
});

QuestionCard.displayName = 'QuestionCard';

// ==========================================
// SUB-COMPONENT: Floating Progress Button (Mobile)
// ==========================================
const FloatingProgressButton = memo(({ 
  onClick, 
  answersCount, 
  totalQuestions,
  isAllAnswered 
}) => {
  return (
    <button
      onClick={onClick}
      className={`
        fixed bottom-20 sm:bottom-16 md:bottom-12 right-6 lg:hidden z-40 
        w-14 h-14 rounded-full shadow-lg transition-all duration-300
        flex items-center justify-center font-bold text-sm
        ${isAllAnswered
          ? 'bg-gradient-to-br from-blue-600 to-cyan-500 hover:shadow-xl hover:scale-110 text-white'
          : 'bg-slate-300 text-slate-500 cursor-not-allowed opacity-50'}
      `}
      aria-label="Show progress and submit"
      disabled={!isAllAnswered}
      title={`${answersCount}/${totalQuestions} answered`}
    >
      <span className="text-lg font-bold">
        {answersCount}/{totalQuestions}
      </span>
    </button>
  );
});

FloatingProgressButton.displayName = 'FloatingProgressButton';

// ==========================================
// SUB-COMPONENT: Mobile Sidebar Modal
// ==========================================
const MobileSidebarModal = memo(({ 
  isOpen, 
  onClose,
  answersCount,
  totalQuestions,
  percentage,
  isSignedIn,
  handleSubmitWithSave,
  isAllAnswered
}) => {
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = 'unset';
    }
    return () => {
      document.body.style.overflow = 'unset';
    };
  }, [isOpen]);

  if (!isOpen) return null;

  return (
    <>
      {/* Backdrop */}
      <div 
        className="fixed inset-0 bg-black/50 z-40 lg:hidden backdrop-blur-sm"
        onClick={onClose}
        role="presentation"
      />
      
      {/* Modal */}
      <div className="fixed inset-0 z-50 lg:hidden flex items-end">
        <div className="w-full bg-white rounded-t-2xl shadow-2xl max-h-[90vh] overflow-y-auto animate-in slide-in-from-bottom duration-300">
          {/* Header */}
          <div className="sticky top-0 bg-white border-b border-slate-200 px-4 sm:px-6 py-4 flex items-center justify-between z-10">
            <h2 className="font-bold text-slate-900 text-lg">Tin  & Hnh ng</h2>
            <button 
              onClick={onClose} 
              className="p-1 hover:bg-slate-100 rounded-lg transition-colors"
              aria-label="Close progress modal"
            >
              <X className="w-5 h-5 text-slate-600" />
            </button>
          </div>

          {/* Content */}
          <div className="p-4 sm:p-6 space-y-4 sm:space-y-5">
            {/* Status Card */}
            <div className="relative bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 text-white rounded-xl p-5 sm:p-6 shadow-lg overflow-hidden">
              <div className="absolute -top-12 -right-12 w-32 h-32 bg-blue-500/20 rounded-full blur-3xl" />
              <div className="absolute -bottom-8 -left-8 w-24 h-24 bg-cyan-500/10 rounded-full blur-3xl" />

              <div className="relative z-10 space-y-5">
                <div>
                  <p className="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">
                    Trng thi lm bi
                  </p>
                  <div className="flex items-baseline gap-2">
                    <span className="text-4xl font-black bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent">
                      {answersCount}
                    </span>
                    <span className="text-slate-400 text-sm font-semibold">/{totalQuestions} cu</span>
                  </div>
                </div>

                <div className="space-y-2">
                  <ProgressBar percentage={percentage} />
                  <div className="flex items-center justify-between text-xs text-slate-400 font-medium">
                    <span>Hon thnh: {Math.round(percentage)}%</span>
                    <span>{totalQuestions - answersCount} cn li</span>
                  </div>
                </div>

                <div className={`p-3 rounded-lg text-xs font-semibold text-center transition-all ${
                  isAllAnswered 
                    ? 'bg-emerald-500/20 border border-emerald-400/50 text-emerald-200' 
                    : 'bg-amber-500/20 border border-amber-400/50 text-amber-200'
                }`}>
                  {isAllAnswered 
                    ? ' Sn sng np bi!' 
                    : `Cn tr li thm ${totalQuestions - answersCount} cu`}
                </div>

                <button
                  disabled={!isAllAnswered}
                  onClick={handleSubmitWithSave}
                  className={`
                    w-full group relative flex items-center justify-center gap-1 sm:gap-2 py-2.5 sm:py-3.5 px-3 sm:px-4 rounded-lg 
                    font-bold text-xs sm:text-sm transition-all overflow-hidden
                    ${isAllAnswered 
                      ? 'bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 shadow-lg shadow-blue-600/40 active:scale-95 cursor-pointer text-white' 
                      : 'bg-slate-700 text-slate-500 cursor-not-allowed opacity-60'}
                  `}
                  aria-disabled={!isAllAnswered}
                >
                  {isAllAnswered && (
                    <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent transform -skew-x-12 translate-x-full group-hover:translate-x-0 transition-transform duration-500" />
                  )}
                  
                  <Save className="w-3.5 h-3.5 sm:w-4 sm:h-4 relative flex-shrink-0" strokeWidth={2} />
                  <span className="relative whitespace-nowrap">
                    {isSignedIn ? (
                      <>
                        <span className="inline sm:hidden">Np & Lu</span>
                        <span className="hidden sm:inline">Np & Lu kt qu</span>
                      </>
                    ) : 'Np bi'}
                  </span>
                </button>

                {!isSignedIn && (
                  <div className="flex items-start gap-2 p-3 bg-amber-500/15 border border-amber-400/30 rounded-lg">
                    <AlertCircle className="w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5" strokeWidth={2} />
                    <p className="text-xs text-amber-100/90 font-[450]">
                      ng nhp  lu kt qu v theo di tin .
                    </p>
                  </div>
                )}
              </div>
            </div>

            {/* Tips Card */}
            <div className="bg-slate-50 rounded-lg p-4 border border-slate-200">
              <div className="flex items-center gap-2 mb-3">
                <Lightbulb className="w-4 h-4 text-emerald-600" strokeWidth={2} />
                <h4 className="text-sm font-bold text-slate-900">Mo lm bi</h4>
              </div>
              <ul className="space-y-2 text-xs text-slate-600 font-[450]">
                <li className="flex gap-2">
                  <span className="text-emerald-600 font-bold flex-shrink-0"></span>
                  <span>Ch  t kha "trng lp" trong bi nghe</span>
                </li>
                <li className="flex gap-2">
                  <span className="text-emerald-600 font-bold flex-shrink-0"></span>
                  <span>c k tt c cc p n trc khi chn</span>
                </li>
                <li className="flex gap-2">
                  <span className="text-emerald-600 font-bold flex-shrink-0"></span>
                  <span>Khng  qu nhiu cu  cui cng</span>
                </li>
              </ul>
            </div>

            {/* Info Cards */}
            <div className="grid grid-cols-2 gap-3">
              <div className="bg-white rounded-lg border border-slate-200 p-4 text-center">
                <div className="flex justify-center mb-2">
                  <Clock className="w-4 h-4 text-slate-600" strokeWidth={2} />
                </div>
                <p className="text-xs font-bold text-slate-600 uppercase tracking-wider mb-1">
                  Thi gian
                </p>
                <p className="text-sm font-bold text-slate-900">T do</p>
              </div>

              <div className="bg-white rounded-lg border border-slate-200 p-4 text-center">
                <div className="flex justify-center mb-2">
                  <Zap className="w-4 h-4 text-slate-600" strokeWidth={2} />
                </div>
                <p className="text-xs font-bold text-slate-600 uppercase tracking-wider mb-1">
                   kh
                </p>
                <p className="text-sm font-bold text-slate-900">Trung bnh</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </>
  );
});

MobileSidebarModal.displayName = 'MobileSidebarModal';

// ==========================================
// SUB-COMPONENT: Desktop Progress Sidebar
// ==========================================
const DesktopSidebar = memo(({ 
  answersCount, 
  totalQuestions, 
  percentage,
  isSignedIn,
  handleSubmitWithSave,
  isAllAnswered
}) => {
  return (
    <aside className="hidden lg:flex flex-col w-80 h-screen sticky top-0 pt-4 pb-6 overflow-hidden">
      {/* Scrollable Container */}
      <div className="flex-1 overflow-y-auto pr-3 space-y-4 scroll-smooth scrollbar-hide">
        {/* Status Card */}
        <div className="relative bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 text-white rounded-xl p-5 shadow-lg overflow-hidden flex-shrink-0">
          <div className="absolute -top-12 -right-12 w-32 h-32 bg-blue-500/20 rounded-full blur-3xl" />
          <div className="absolute -bottom-8 -left-8 w-24 h-24 bg-cyan-500/10 rounded-full blur-3xl" />

          <div className="relative z-10 space-y-5">
            <div>
              <p className="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">
                Trng thi lm bi
              </p>
              <p className="text-2xl font-bold">Tin </p>
            </div>

            <div className="text-center">
              <span className="text-4xl font-black bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent">
                {answersCount}
              </span>
              <p className="text-slate-400 text-xs font-semibold mt-1">/{totalQuestions} cu</p>
            </div>

            <div className="space-y-2">
              <ProgressBar percentage={percentage} />
              <div className="flex items-center justify-between text-xs text-slate-400 font-medium">
                <span>Hon thnh: {Math.round(percentage)}%</span>
                <span>{totalQuestions - answersCount} cn</span>
              </div>
            </div>

            <div className={`p-3 rounded-lg text-xs font-semibold text-center transition-all ${
              isAllAnswered 
                ? 'bg-emerald-500/20 border border-emerald-400/50 text-emerald-200' 
                : 'bg-amber-500/20 border border-amber-400/50 text-amber-200'
            }`}>
              {isAllAnswered 
                ? ' Sn sng np!' 
                : `Cn ${totalQuestions - answersCount} cu`}
            </div>

            <button
              disabled={!isAllAnswered}
              onClick={handleSubmitWithSave}
              className={`
                w-full group relative flex items-center justify-center gap-2 py-3 px-4 rounded-lg 
                font-bold text-xs sm:text-sm transition-all overflow-hidden
                ${isAllAnswered 
                  ? 'bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 shadow-lg shadow-blue-600/40 active:scale-95 cursor-pointer text-white' 
                  : 'bg-slate-700 text-slate-500 cursor-not-allowed opacity-60'}
              `}
              aria-disabled={!isAllAnswered}
            >
              {isAllAnswered && (
                <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent transform -skew-x-12 translate-x-full group-hover:translate-x-0 transition-transform duration-500" />
              )}
              
              <Save className="w-4 h-4 relative flex-shrink-0" strokeWidth={2} />
              <span className="relative text-xs">
                {isSignedIn ? 'Np & Lu' : 'Np'}
              </span>
            </button>

            {!isSignedIn && (
              <div className="flex items-start gap-2 p-2.5 bg-amber-500/15 border border-amber-400/30 rounded-lg">
                <AlertCircle className="w-3.5 h-3.5 text-amber-400 flex-shrink-0 mt-0.5" strokeWidth={2} />
                <p className="text-xs text-amber-100/90 font-[450] leading-snug">
                  ng nhp  lu.
                </p>
              </div>
            )}
          </div>
        </div>

        {/* Tips Card */}
        <div className="bg-white rounded-lg border border-slate-200 p-4 shadow-sm hover:shadow-md transition-shadow flex-shrink-0">
          <div className="flex items-center gap-2 mb-3">
            <Lightbulb className="w-4 h-4 text-emerald-600 flex-shrink-0" strokeWidth={2} />
            <h4 className="text-sm font-bold text-slate-900">Mo lm bi</h4>
          </div>
          <ul className="space-y-2.5 text-xs text-slate-600 font-[450]">
            <li className="flex gap-2">
              <span className="text-emerald-600 font-bold flex-shrink-0"></span>
              <span>Ch  t kha trng lp</span>
            </li>
            <li className="flex gap-2">
              <span className="text-emerald-600 font-bold flex-shrink-0"></span>
              <span>c k tt c p n</span>
            </li>
            <li className="flex gap-2">
              <span className="text-emerald-600 font-bold flex-shrink-0"></span>
              <span>Khng  qu nhiu cu</span>
            </li>
          </ul>
        </div>

        {/* Info Cards */}
        <div className="space-y-3 flex-shrink-0">
          <div className="bg-white rounded-lg border border-slate-200 p-4 text-center shadow-sm hover:shadow-md transition-shadow">
            <div className="flex justify-center mb-2">
              <Clock className="w-4 h-4 text-slate-600" strokeWidth={2} />
            </div>
            <p className="text-xs font-bold text-slate-600 uppercase tracking-wider mb-1">
              Thi gian
            </p>
            <p className="text-sm font-bold text-slate-900">T do</p>
          </div>

          <div className="bg-white rounded-lg border border-slate-200 p-4 text-center shadow-sm hover:shadow-md transition-shadow">
            <div className="flex justify-center mb-2">
              <Zap className="w-4 h-4 text-slate-600" strokeWidth={2} />
            </div>
            <p className="text-xs font-bold text-slate-600 uppercase tracking-wider mb-1">
               kh
            </p>
            <p className="text-sm font-bold text-slate-900">Trung bnh</p>
          </div>
        </div>
      </div>

      {/* Scrollbar Style */}
      <style>{`
        aside .scroll-smooth::-webkit-scrollbar {
          width: 6px;
        }
        aside .scroll-smooth::-webkit-scrollbar-track {
          background: transparent;
        }
        aside .scroll-smooth::-webkit-scrollbar-thumb {
          background: #cbd5e1;
          border-radius: 3px;
        }
        aside .scroll-smooth::-webkit-scrollbar-thumb:hover {
          background: #94a3b8;
        }
      `}</style>
    </aside>
  );
});

DesktopSidebar.displayName = 'DesktopSidebar';

// ==========================================
// SUB-COMPONENT: Tablet Sidebar (for md breakpoint)
// ==========================================
const TabletSidebar = memo(({ 
  answersCount, 
  totalQuestions, 
  percentage,
  isSignedIn,
  handleSubmitWithSave,
  isAllAnswered
}) => {
  const [isExpanded, setIsExpanded] = useState(false);

  return (
    <div className="hidden md:flex lg:hidden flex-col w-full">
      {/* Collapsible Header */}
      <button
        onClick={() => setIsExpanded(!isExpanded)}
        className="w-full flex items-center justify-between gap-3 p-4 bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-lg mb-4 hover:shadow-md transition-shadow"
      >
        <div className="flex items-baseline gap-2">
          <span className="text-2xl font-black text-blue-600">{Math.round(percentage)}%</span>
          <span className="text-sm font-semibold text-slate-600">{answersCount}/{totalQuestions} cu</span>
        </div>
        <ChevronRight className={`w-5 h-5 text-blue-600 transition-transform ${isExpanded ? 'rotate-90' : ''}`} />
      </button>

      {/* Expanded Content */}
      {isExpanded && (
        <div className="space-y-4 animate-in fade-in slide-in-from-top-2 duration-300 mb-8 pb-6">
          {/* Status Card */}
          <div className="relative bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 text-white rounded-xl p-5 shadow-lg overflow-hidden">
            <div className="absolute -top-12 -right-12 w-32 h-32 bg-blue-500/20 rounded-full blur-3xl" />
            <div className="absolute -bottom-8 -left-8 w-24 h-24 bg-cyan-500/10 rounded-full blur-3xl" />

            <div className="relative z-10 space-y-4">
              <div className="space-y-2">
                <ProgressBar percentage={percentage} />
                <div className="flex items-center justify-between text-xs text-slate-400 font-medium">
                  <span>Hon thnh: {Math.round(percentage)}%</span>
                  <span>{totalQuestions - answersCount} cn</span>
                </div>
              </div>

              <div className={`p-3 rounded-lg text-xs font-semibold text-center transition-all ${
                isAllAnswered 
                  ? 'bg-emerald-500/20 border border-emerald-400/50 text-emerald-200' 
                  : 'bg-amber-500/20 border border-amber-400/50 text-amber-200'
              }`}>
                {isAllAnswered 
                  ? ' Sn sng np!' 
                  : `Cn ${totalQuestions - answersCount} cu`}
              </div>

              <button
                disabled={!isAllAnswered}
                onClick={handleSubmitWithSave}
                className={`
                  w-full group relative flex items-center justify-center gap-1 sm:gap-2 py-2.5 sm:py-3 px-3 sm:px-4 rounded-lg 
                  font-bold text-xs sm:text-sm transition-all overflow-hidden
                  ${isAllAnswered 
                    ? 'bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 shadow-lg shadow-blue-600/40 active:scale-95 cursor-pointer text-white' 
                    : 'bg-slate-700 text-slate-500 cursor-not-allowed opacity-60'}
                `}
                aria-disabled={!isAllAnswered}
              >
                {isAllAnswered && (
                  <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent transform -skew-x-12 translate-x-full group-hover:translate-x-0 transition-transform duration-500" />
                )}
                
                <Save className="w-3.5 h-3.5 sm:w-4 sm:h-4 relative flex-shrink-0" strokeWidth={2} />
                <span className="relative whitespace-nowrap text-xs sm:text-xs">
                  {isSignedIn ? 'Np & Lu' : 'Np'}
                </span>
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
});

TabletSidebar.displayName = 'TabletSidebar';

// ==========================================
// MAIN COMPONENT: QuestionDisplay
// ==========================================
const QuestionDisplay = memo(({
  selectedPart,
  selectedExam,
  partData,
  answers,
  onAnswerSelect,
  showResults,
  onSubmit,
  testType
}) => {
  const { user: firebaseUser, isSignedIn } = useUnifiedAuth();
  const [submitStatus, setSubmitStatus] = useState({ show: false, message: '', success: false });

  // ===== COMPUTED VALUES =====
  const answersCount = useMemo(() => Object.keys(answers).length, [answers]);
  const totalQuestions = useMemo(() => partData?.questions?.length || 0, [partData?.questions?.length]);
  const percentage = useMemo(() => totalQuestions > 0 ? (answersCount / totalQuestions) * 100 : 0, [answersCount, totalQuestions]);
  const isAllAnswered = useMemo(() => answersCount === totalQuestions && totalQuestions > 0, [answersCount, totalQuestions]);

  // ===== HELPERS =====
  const getUserIdentifier = useCallback(() => {
    if (firebaseUser) {
      return {
        firebaseUid: firebaseUser.uid,
        email: firebaseUser.email || '',
        displayName: firebaseUser.displayName || firebaseUser.email?.split('@')[0] || 'Anonymous'
      };
    }
    return null;
  }, [firebaseUser]);

  // ===== SUBMIT HANDLER =====
  const handleSubmitWithSave = useCallback(async () => {
    try {
      onSubmit();

      if (!isSignedIn) {
        setSubmitStatus({
          show: true,
          message: 'Vui lng ng nhp  lu kt qu',
          success: false
        });
        setTimeout(() => setSubmitStatus({ show: false, message: '', success: false }), 3000);
        return;
      }

      const userIdentifier = getUserIdentifier();
      if (!userIdentifier) {
        setSubmitStatus({
          show: true,
          message: 'Khng th xc nh ngi dng',
          success: false
        });
        setTimeout(() => setSubmitStatus({ show: false, message: '', success: false }), 3000);
        return;
      }

      setSubmitStatus({
        show: true,
        message: 'ang lu kt qu...',
        success: false
      });

      const dataToSave = {
        firebaseUid: userIdentifier.firebaseUid,
        email: userIdentifier.email,
        displayName: userIdentifier.displayName,
        exam: selectedExam,
        part: selectedPart,
        answers: answers,
        totalQuestions: totalQuestions,
        testType: testType,
        createdAt: serverTimestamp(),
        completedAt: serverTimestamp(),
      };

      await addDoc(collection(db, 'userProgress'), dataToSave);

      setSubmitStatus({
        show: true,
        message: ' lu thnh cng!',
        success: true
      });

      setTimeout(() => setSubmitStatus({ show: false, message: '', success: false }), 3000);

    } catch (error) {
      console.error('Error:', error);
      setSubmitStatus({
        show: true,
        message: `Li: ${error.message}`,
        success: false
      });
      setTimeout(() => setSubmitStatus({ show: false, message: '', success: false }), 3000);
    }
  }, [isSignedIn, getUserIdentifier, onSubmit, selectedExam, selectedPart, answers, totalQuestions, testType]);

  // ===== RENDER CONDITION =====
  if (!partData || showResults || !partData.questions) {
    return null;
  }

  // ===== MAIN RENDER =====
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50 overflow-x-hidden" style={{ paddingBottom: 'max(1rem, env(safe-area-inset-bottom))' }}>
      
      {/* Ambient Background */}
      <div className="fixed inset-0 pointer-events-none overflow-hidden z-0">
        <div className="absolute top-0 right-0 w-60 h-60 md:w-96 md:h-96 bg-blue-100/20 rounded-full blur-3xl" />
        <div className="absolute bottom-0 left-0 w-60 h-60 md:w-96 md:h-96 bg-slate-100/20 rounded-full blur-3xl" />
      </div>

      {/* Header */}
      <header className="relative z-20 sticky top-0 bg-white/80 backdrop-blur-lg border-b border-slate-200 shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between">
          <div className="flex items-center gap-2 sm:gap-3 min-w-0">
            <Sparkles className="w-5 h-5 sm:w-6 sm:h-6 text-blue-600 fill-blue-600 flex-shrink-0" />
            <div className="min-w-0">
              <h1 className="text-base sm:text-lg md:text-xl font-bold text-slate-900 truncate">Practice Mode</h1>
              <p className="text-[10px] sm:text-xs text-slate-600 font-[450]">
                TOEIC {testType?.toUpperCase() || 'TRAINING'}
              </p>
            </div>
          </div>
          
          {/* Desktop Progress Indicator */}
          <div className="hidden sm:block text-right flex-shrink-0 ml-4">
            <div className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">
              Tin 
            </div>
            <div className="text-2xl md:text-3xl font-black text-blue-600">
              {Math.round(percentage)}%
            </div>
          </div>
        </div>
      </header>

      {/* Main Content Container */}
      <div className="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-6 md:py-8 pb-40 sm:pb-32 md:pb-24 lg:pb-8">
        
        {/* Questions Area */}
        <div className="mb-6 md:mb-0 flex flex-col lg:flex-row gap-6">
          
          {/* Left: Questions (Main Content) */}
          <div className="flex-1 min-w-0">
            <div className="overflow-y-auto max-h-[calc(100vh-240px)] lg:max-h-[calc(100vh-180px)] scroll-smooth pr-2 sm:pr-4">
              <div className="space-y-4 pb-8 sm:pb-6">
                {partData.questions.map((q, idx) => (
                  <QuestionCard
                    key={q.id}
                    question={q}
                    script={q.script}
                    options={q.options}
                    selectedAnswer={answers[q.id]}
                    onAnswerSelect={onAnswerSelect}
                    questionNumber={idx + 1}
                    totalQuestions={totalQuestions}
                  />
                ))}
              </div>
            </div>

            {/* Scrollbar styling */}
            <style>{`
              div.overflow-y-auto::-webkit-scrollbar {
                width: 6px;
              }
              div.overflow-y-auto::-webkit-scrollbar-track {
                background: transparent;
              }
              div.overflow-y-auto::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 3px;
              }
              div.overflow-y-auto::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
              }
            `}</style>

            {/* Mobile: Submit Button Below Questions */}
            <div className="lg:hidden mt-4 pt-4 border-t border-slate-200">
              <button
                disabled={!isAllAnswered}
                onClick={handleSubmitWithSave}
                className={`
                  w-full group relative flex items-center justify-center gap-2 py-3 px-4 rounded-lg 
                  font-bold text-sm transition-all overflow-hidden
                  ${isAllAnswered 
                    ? 'bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 shadow-lg shadow-blue-600/40 active:scale-95 cursor-pointer text-white' 
                    : 'bg-slate-700 text-slate-500 cursor-not-allowed opacity-60'}
                `}
                aria-disabled={!isAllAnswered}
              >
                {isAllAnswered && (
                  <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent transform -skew-x-12 translate-x-full group-hover:translate-x-0 transition-transform duration-500" />
                )}
                
                <Save className="w-4 h-4 relative flex-shrink-0" strokeWidth={2} />
                <span className="relative">
                  {isSignedIn ? 'Np & Lu kt qu' : 'Np bi'}
                </span>
              </button>

              {!isAllAnswered && (
                <p className="text-xs text-slate-500 text-center mt-2 font-[450]">
                  Vui lng tr li tt c {totalQuestions - answersCount} cu cn li
                </p>
              )}
            </div>
          </div>

          {/* Right: Desktop Sidebar (lg+) */}
          <div className="hidden lg:block">
            <DesktopSidebar
              answersCount={answersCount}
              totalQuestions={totalQuestions}
              percentage={percentage}
              isSignedIn={isSignedIn}
              handleSubmitWithSave={handleSubmitWithSave}
              isAllAnswered={isAllAnswered}
            />
          </div>
        </div>

        {/* Tablet Sidebar (md-lg) */}
        <TabletSidebar
          answersCount={answersCount}
          totalQuestions={totalQuestions}
          percentage={percentage}
          isSignedIn={isSignedIn}
          handleSubmitWithSave={handleSubmitWithSave}
          isAllAnswered={isAllAnswered}
        />
      </div>

      {/* Mobile Floating Button - Hidden since we moved submit button below questions */}
      {/* FloatingProgressButton will no longer be used on mobile */}

      {/* Mobile Sidebar Modal - No longer needed, submit button is now below questions */}
      {/* MobileSidebarModal will no longer be used */}

      {/* Submit Status Notification */}
      {submitStatus.show && (
        <div className={`
          fixed bottom-24 sm:bottom-6 left-4 right-4 sm:left-auto sm:right-4 sm:max-w-sm p-4 rounded-lg z-50
          animate-in fade-in slide-in-from-bottom-4 duration-300
          ${submitStatus.success 
            ? 'bg-emerald-50 border border-emerald-300 text-emerald-900' 
            : 'bg-amber-50 border border-amber-300 text-amber-900'}
        `}>
          <div className="flex items-center gap-3">
            {submitStatus.success ? (
              <CheckCircle className="w-5 h-5 flex-shrink-0" strokeWidth={2.5} />
            ) : (
              <AlertCircle className="w-5 h-5 flex-shrink-0" strokeWidth={2.5} />
            )}
            <span className="text-sm font-semibold">{submitStatus.message}</span>
          </div>
        </div>
      )}
    </div>
  );
});

QuestionDisplay.displayName = 'QuestionDisplay';

export default QuestionDisplay;
</file>

<file path="src/components/pages/ExamAnswersPage.jsx">
import React, { useState, useEffect, useMemo, useRef } from 'react';
  // Lu : m bo cc hm ny  c export ng trong file data ca bn
  import { 
    loadExamData, getAllExamMetadata, getExamQuestions 
  } from '../../data/examData';
  import { 
    BookOpen, Search, ChevronDown, ArrowLeft,
    CheckCircle2, Sparkles, Filter, LayoutGrid, Target, Zap, Info
  } from 'lucide-react';

  // H mu thng hiu ti u cho EdTech
  const COLORS = {
    primary: '#00358E', // Blue Navy
    accent: '#FF7D00',  // Orange Energy
    cyan: '#06b6d4',
    blue: '#3b82f6',
    emerald: '#10b981'
  };

  /**
   * COMPONENT: Dropdown ty chnh
   */
  const SelectDropdown = ({ value, options, onChange, label, icon: Icon, disabled }) => {
    const [isOpen, setIsOpen] = useState(false);
    const dropdownRef = useRef(null);

    useEffect(() => {
      const handleClickOutside = (e) => {
        if (dropdownRef.current && !dropdownRef.current.contains(e.target)) setIsOpen(false);
      };
      document.addEventListener('mousedown', handleClickOutside);
      return () => document.removeEventListener('mousedown', handleClickOutside);
    }, []);

    const selected = options.find(opt => opt.value === value);

    return (
      <div ref={dropdownRef} className="relative flex-1 min-w-[200px]">
        <label className="flex items-center gap-1.5 text-[10px] font-black text-slate-400 mb-2 uppercase tracking-[0.15em] ml-1">
          {Icon && <Icon className="w-3.5 h-3.5" style={{ color: COLORS.primary }} />}
          {label}
        </label>
        <button
          onClick={() => !disabled && setIsOpen(!isOpen)}
          disabled={disabled}
          className={`w-full group flex items-center justify-between px-4 py-3.5 bg-white border-2 border-slate-100 rounded-2xl text-[13px] font-bold transition-all shadow-sm ${
            disabled ? 'opacity-50 cursor-not-allowed' : 'hover:border-blue-200 hover:shadow-md'
          }`}
        >
          <span className="text-slate-700 truncate">{selected?.label || 'Chn...'}</span>
          <ChevronDown className={`w-4 h-4 transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`} style={{ color: COLORS.primary }} />
        </button>

        {isOpen && (
          <div className="absolute z-[100] w-full mt-2 bg-white rounded-2xl shadow-2xl border border-slate-100 py-2 animate-in fade-in zoom-in-95 duration-200">
            <div className="max-h-60 overflow-y-auto overflow-x-hidden">
              {options.map((opt) => (
                <button
                  key={opt.value}
                  onClick={() => { onChange(opt.value); setIsOpen(false); }}
                  className={`w-full px-4 py-3 text-left text-[13px] font-semibold transition-colors ${
                    opt.value === value ? 'text-white' : 'text-slate-600 hover:bg-slate-50'
                  }`}
                  style={opt.value === value ? { backgroundColor: COLORS.primary } : {}}
                >
                  {opt.label}
                </button>
              ))}
            </div>
          </div>
        )}
      </div>
    );
  };

  /**
   * COMPONENT: Th cu hi vi phn Gii thch nng cao
   */
  const QuestionCard = ({ question }) => {
    const [isExpanded, setIsExpanded] = useState(false);

    return (
      <div className="group bg-white border border-slate-200 rounded-[2.5rem] transition-all duration-500 hover:shadow-2xl hover:shadow-[#00358E]/5 overflow-hidden">
        <div className="p-6 sm:p-10">
          <div className="flex flex-col sm:flex-row gap-6">
            {/* Badge S cu */}
            <div 
              className="flex-shrink-0 flex items-center justify-center w-14 h-14 rounded-[1.25rem] text-white font-black text-lg shadow-xl transform group-hover:-rotate-6 transition-transform duration-500"
              style={{ background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.blue})` }}
            >
              {question.id}
            </div>

            <div className="flex-1">
              <h3 className="text-[16px] sm:text-[18px] font-extrabold text-slate-800 leading-snug mb-8">
                {question.question}
              </h3>
              
              <div className="grid grid-cols-1 gap-4">
                {question.options?.map((option, idx) => {
                  const isCorrect = idx === question.correct;
                  return (
                    <div
                      key={idx}
                      className={`flex items-center gap-4 p-5 rounded-[1.5rem] border-2 transition-all duration-300 ${
                        isCorrect 
                        ? 'border-emerald-500 bg-emerald-50/30 shadow-sm' 
                        : 'border-slate-50 bg-slate-50/50 hover:border-blue-100 hover:bg-white'
                      }`}
                    >
                      <div className={`w-9 h-9 rounded-xl flex items-center justify-center text-[13px] font-black transition-all ${
                        isCorrect ? 'bg-emerald-500 text-white scale-110 shadow-lg shadow-emerald-200' : 'bg-white text-slate-400 border border-slate-200'
                      }`}>
                        {String.fromCharCode(65 + idx)}
                      </div>
                      <span className={`text-[14px] font-bold ${isCorrect ? 'text-emerald-900' : 'text-slate-600'}`}>
                        {option}
                      </span>
                      {isCorrect && <CheckCircle2 className="w-6 h-6 text-emerald-500 ml-auto animate-bounce" />}
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </div>

        {/* --- PHN GII THCH NNG CAO --- */}
        {question.explanation && (
          <div className="bg-slate-50/30 border-t border-slate-100">
            <button
              onClick={() => setIsExpanded(!isExpanded)}
              className="w-full flex items-center justify-between px-10 py-5 transition-all hover:bg-slate-50"
            >
              <div className="flex items-center gap-3">
                <div className="p-2 rounded-xl bg-orange-100 shadow-inner">
                  <Sparkles className="w-4 h-4 text-[#FF7D00]" />
                </div>
                <div className="text-left">
                  <p className="text-[11px] font-black tracking-widest text-[#FF7D00] uppercase">Analysis</p>
                  <p className="text-[13px] font-bold text-slate-700">Ti sao p n ny ng?</p>
                </div>
              </div>
              <div className={`w-10 h-10 rounded-full flex items-center justify-center border-2 border-slate-200 transition-all ${isExpanded ? 'bg-[#FF7D00] border-[#FF7D00] text-white rotate-180' : 'bg-white text-slate-400'}`}>
                <ChevronDown className="w-5 h-5" />
              </div>
            </button>
            
            <div className={`transition-all duration-700 ease-in-out overflow-hidden ${isExpanded ? 'max-h-[1000px] opacity-100' : 'max-h-0 opacity-0'}`}>
              <div className="px-10 pb-10 pt-2">
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                  
                  {/* Lung gii thch chnh */}
                  <div className="lg:col-span-8 p-8 bg-white rounded-[2rem] border border-slate-100 shadow-sm relative">
                    <div className="absolute top-0 right-0 p-4 opacity-5">
                      <Info className="w-20 h-20 text-[#00358E]" />
                    </div>
                    <p className="text-[14px] text-slate-600 leading-[1.8] font-medium italic relative z-10">
                      "{question.explanation}"
                    </p>
                  </div>

                  {/* Sidebar: Tips & Metadata */}
                  <div className="lg:col-span-4 space-y-4">
                    <div className="p-6 bg-gradient-to-br from-[#00358E] to-blue-700 rounded-[2rem] text-white shadow-lg shadow-blue-900/20">
                      <div className="flex items-center gap-2 mb-4">
                        <Zap className="w-4 h-4 text-[#FF7D00] fill-[#FF7D00]" />
                        <span className="text-[11px] font-black uppercase tracking-widest">Smart Tips</span>
                      </div>
                      <ul className="space-y-3">
                        <li className="flex gap-3 text-[12px] font-medium leading-relaxed">
                          <div className="w-1.5 h-1.5 rounded-full bg-white/40 mt-1.5 shrink-0" />
                          Lun ch  n t kha quan trng trong cu hi.
                        </li>
                        <li className="flex gap-3 text-[12px] font-medium leading-relaxed">
                          <div className="w-1.5 h-1.5 rounded-full bg-white/40 mt-1.5 shrink-0" />
                          S dng phng php loi tr cho cc p n tng t.
                        </li>
                      </ul>
                    </div>

                    <div className="flex items-center justify-between p-5 bg-white border border-slate-100 rounded-2xl shadow-sm">
                      <span className="text-[11px] font-black text-slate-400 uppercase tracking-tighter"> kh cu hi</span>
                      <div className="flex gap-1.5">
                        {[1, 2, 3].map((i) => (
                          <div 
                            key={i} 
                            className="w-5 h-1.5 rounded-full transition-all duration-1000" 
                            style={{ backgroundColor: i <= 2 ? COLORS.accent : '#f1f5f9' }} 
                          />
                        ))}
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  const ExamAnswersPage = () => {
    const [selectedExam, setSelectedExam] = useState('exam1');
    const [selectedPart, setSelectedPart] = useState('');
    const [currentExam, setCurrentExam] = useState(null);
    const [parts, setParts] = useState([]);
    const [questions, setQuestions] = useState([]);
    const [searchQuery, setSearchQuery] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const examList = getAllExamMetadata ? getAllExamMetadata() : [];

    useEffect(() => {
      const loadData = async () => {
        if (!selectedExam) return;
        setIsLoading(true);
        try {
          const examData = await loadExamData(selectedExam);
          if (examData) {
            setCurrentExam(examData);
            setParts(examData.parts ? Object.keys(examData.parts) : []);
            if (selectedPart) {
              const qs = await getExamQuestions(selectedExam, selectedPart);
              setQuestions(qs || []);
            } else {
              setQuestions([]);
            }
          }
        } catch (err) {
          console.error("Error loading data:", err);
        } finally { 
          setIsLoading(false); 
        }
      };
      loadData();
    }, [selectedExam, selectedPart]);

    const filteredQuestions = useMemo(() => 
      questions.filter(q => q.question.toLowerCase().includes(searchQuery.toLowerCase())), 
    [questions, searchQuery]);

    return (
     <div className="min-h-screen bg-[#F8FAFC]">
      {/* Navigation - normal flow (khng sticky) */}
      <nav className="relative z-10 bg-white/90 backdrop-blur-xl border-b border-slate-100 shadow-sm">
        <div className="max-w-6xl mx-auto px-6 h-20 flex items-center justify-center">
          
          <div className="flex items-center gap-4">
            <div 
              className="w-11 h-11 rounded-2xl flex items-center justify-center shadow-xl transform rotate-3" 
              style={{ backgroundColor: COLORS.primary }}
            >
              <BookOpen className="w-6 h-6 text-white" />
            </div>

            <div>
              <p className="font-black text-slate-900 leading-none text-lg uppercase tracking-tight">
                Exam<span style={{ color: COLORS.accent }}>Keys</span>
              </p>
              <p className="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mt-1">
                Premium Answer Hub
              </p>
            </div>
          </div>

        </div>
      </nav>
        <main className="max-w-4xl mx-auto px-6 py-12">
          {/* --- Hero --- */}
          <header className="mb-12 text-center sm:text-left relative">
            <div className="absolute -top-10 -left-10 w-40 h-40 bg-blue-100/50 rounded-full blur-3xl -z-10"></div>
            <h1 className="text-4xl font-black text-slate-900 mb-4 tracking-tight">
              Th vin <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-700 to-cyan-500">p n chi tit</span>
            </h1>
            <p className="text-slate-500 font-medium max-w-xl leading-relaxed">
              H thng h tr tra cu gii thut v phn tch chuyn su cho cc k thi trng im.
            </p>
          </header>

         {/* Control Panel - normal flow (khng sticky, khng fixed) */}
            <section className="relative z-10 bg-white/95 backdrop-blur-lg p-6 rounded-[2.5rem] border border-white shadow-2xl shadow-blue-900/5 mb-12">
              <div className="flex flex-col md:flex-row gap-6 items-end">
                <SelectDropdown 
                  label="K thi"
                  icon={LayoutGrid}
                  value={selectedExam}
                  options={examList.map(e => ({ value: e.id, label: e.title }))}
                  onChange={(val) => { 
                    setSelectedExam(val); 
                    setSelectedPart(''); 
                  }}
                />

                <SelectDropdown 
                  label="Phn thi"
                  icon={Filter}
                  value={selectedPart}
                  options={parts.map(p => ({ 
                    value: p, 
                    label: currentExam?.parts[p]?.title || p 
                  }))}
                  onChange={setSelectedPart}
                />

                <div className="relative flex-[1.5] w-full group">
                  <label className="flex items-center gap-1.5 text-[10px] font-black text-slate-400 mb-2 uppercase tracking-widest ml-1">
                    Tm ni dung
                  </label>
                  <Search className="absolute left-5 bottom-[1.1rem] w-4 h-4 text-slate-300 group-focus-within:text-blue-500 transition-colors" />
                  <input 
                    type="text"
                    placeholder="Nhp cu hi..."
                    className="w-full pl-12 pr-5 py-3.5 bg-slate-50/50 border-2 border-slate-100 rounded-2xl text-[13px] font-bold focus:bg-white focus:border-blue-400 outline-none transition-all shadow-inner"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                  />
                </div>
              </div>
            </section>


          {/* --- List --- */}
          <div className="space-y-8 pb-32">
            {isLoading ? (
              <div className="flex flex-col items-center py-20">
                <div className="w-14 h-14 border-4 border-slate-100 border-t-blue-600 rounded-full animate-spin shadow-inner"></div>
                <p className="mt-4 text-[11px] font-black text-slate-400 uppercase tracking-[0.3em]">ang ng b...</p>
              </div>
            ) : selectedPart && filteredQuestions.length > 0 ? (
              <div className="grid grid-cols-1 gap-10">
                {filteredQuestions.map(q => <QuestionCard key={q.id} question={q} />)}
              </div>
            ) : (
              <div className="text-center py-24 bg-white rounded-[4rem] border-4 border-dashed border-slate-50">
                <div className="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner">
                  <Target className="w-10 h-10 text-blue-200" />
                </div>
                <h3 className="text-xl font-black text-slate-800 mb-2 tracking-tight">Sn sng  bt u?</h3>
                <p className="text-slate-400 text-sm font-medium">Chn k thi v phn thi pha trn  ti d liu p n.</p>
              </div>
            )}
          </div>
        </main>
      </div>
    );
  };

  export default ExamAnswersPage;
</file>

<file path="src/config/firebase.js">
// src/firebase.js
import { initializeApp } from "firebase/app";
import { getAuth, connectAuthEmulator } from "firebase/auth";
import { getFirestore, connectFirestoreEmulator } from "firebase/firestore";
import { getStorage, connectStorageEmulator } from "firebase/storage";
import { getDatabase } from "firebase/database";

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID,
  databaseURL: "https://huflit-test-4ce25-default-rtdb.asia-southeast1.firebasedatabase.app/", //  THM
};

if (!firebaseConfig.apiKey) {
  console.warn('Firebase config is missing. Check your .env file.');
}

const app = initializeApp(firebaseConfig);

export const auth = getAuth(app);
export const db = getFirestore(app);
export const storage = getStorage(app);
export const rtdb = getDatabase(app); // By gi c URL  hot ng!

// Emulator
if (process.env.NODE_ENV === 'development' && import.meta.env.VITE_USE_EMULATOR === 'true') {
  try {
    connectAuthEmulator(auth, 'http://localhost:9099', { disableWarnings: true });
    connectFirestoreEmulator(db, 'localhost', 8080);
    connectStorageEmulator(storage, 'localhost', 9199);
    // Khng cn connect RTDB emulator nu dng production URL
    console.log('Connected to Firebase Emulators');
  } catch (error) {
    console.log('Firebase Emulators not available');
  }
}

export default app;
</file>

<file path="src/hooks/useAudioPlayer.js">
import { useState, useCallback, useRef, useEffect } from 'react';

export const useAudioPlayer = (audioUrl) => {
  const [isPlaying, setIsPlaying] = useState(false);
  const [isPaused, setIsPaused] = useState(false);
  const [currentTime, setCurrentTime] = useState(0);
  const [duration, setDuration] = useState(0);
  const [volume, setVolume] = useState(1);
  const [error, setError] = useState(null);
  const [isLoading, setIsLoading] = useState(false);

  const audioRef = useRef(null);

  //  LOAD AUDIO KHI URL THAY I
  useEffect(() => {
    if (!audioUrl) return;

    let finalUrl = audioUrl;

    // Chun ha URL cho Vite public folder
    if (!/^https?:\/\//i.test(finalUrl)) {
      finalUrl = finalUrl.replace(/^\/?public\//, '');
      finalUrl = finalUrl.startsWith('/') ? finalUrl : '/' + finalUrl;
    }

    console.log(' AUDIO LOAD:', finalUrl);

    const audio = new Audio(finalUrl);
    audioRef.current = audio;
    audio.volume = volume;

    let isMounted = true;

    const handleLoadedMetadata = () => {
      if (!isMounted) return;
      setDuration(audio.duration);
      setIsLoading(false);
    };

    const handleTimeUpdate = () => {
      if (!isMounted) return;
      setCurrentTime(audio.currentTime);
    };

    const handleEnded = () => {
      if (!isMounted) return;
      setIsPlaying(false);
      setIsPaused(false);
      setCurrentTime(0);
    };

    const handleError = (e) => {
      if (!isMounted) return;
      setError('Failed to load audio');
      setIsPlaying(false);
      console.error('Audio error:', finalUrl, e);
    };

    audio.addEventListener('loadedmetadata', handleLoadedMetadata);
    audio.addEventListener('timeupdate', handleTimeUpdate);
    audio.addEventListener('ended', handleEnded);
    audio.addEventListener('error', handleError);

    return () => {
      isMounted = false;
      audio.pause();
      audio.src = ''; //  hy request c trnh AbortError
      audio.removeEventListener('loadedmetadata', handleLoadedMetadata);
      audio.removeEventListener('timeupdate', handleTimeUpdate);
      audio.removeEventListener('ended', handleEnded);
      audio.removeEventListener('error', handleError);
    };
  }, [audioUrl]);

  //  PLAY
  const play = useCallback(async () => {
    const audio = audioRef.current;
    if (!audio) return;

    try {
      setError(null);
      setIsLoading(true);
      await audio.play();
      setIsPlaying(true);
      setIsPaused(false);
    } catch (err) {
      if (err.name !== 'AbortError') {
        setError('Failed to play audio');
        console.error('Play error:', err);
      }
    } finally {
      setIsLoading(false);
    }
  }, []);

  //  PAUSE
  const pause = useCallback(() => {
    const audio = audioRef.current;
    if (!audio) return;
    audio.pause();
    setIsPlaying(false);
    setIsPaused(true);
  }, []);

  //  STOP
  const stop = useCallback(() => {
    const audio = audioRef.current;
    if (!audio) return;
    audio.pause();
    audio.currentTime = 0;
    setCurrentTime(0);
    setIsPlaying(false);
    setIsPaused(false);
  }, []);

  //  SEEK
  const seek = useCallback((time) => {
    const audio = audioRef.current;
    if (!audio) return;
    audio.currentTime = Math.max(0, Math.min(time, duration));
    setCurrentTime(audio.currentTime);
  }, [duration]);

  //  VOLUME
  const handleVolumeChange = useCallback((newVolume) => {
    setVolume(newVolume);
    if (audioRef.current) {
      audioRef.current.volume = newVolume;
    }
  }, []);

  //  FORMAT TIME
  const formatTime = (seconds) => {
    if (!seconds || isNaN(seconds)) return '0:00';
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  return {
    isPlaying,
    isPaused,
    isLoading,
    currentTime,
    duration,
    volume,
    error,
    play,
    pause,
    stop,
    seek,
    setVolume: handleVolumeChange,
    formatTime,
  };
};
</file>

<file path="src/hooks/useOnlineUsers.js">
// src/hooks/useOnlineUsers.js
import { useEffect, useState, useRef } from 'react';
import { onValue, ref, query, limitToLast } from 'firebase/database';
import { onSnapshot, doc } from 'firebase/firestore';
import { rtdb, db } from '../config/firebase.js';

/**
 * Hook useOnlineUsers  Theo di s lng ngi dng online (RTDB) v tng ngi dng (Firestore)
 * 
 * - onlineCount: S ngi dng hin ang online (da trn /presence, online: true)
 * - totalUsers: Tng s ngi dng duy nht (ly t Firestore /stats/appUsage)
 * 
 * Ti u:
 * - Ch lng nghe thay i cn thit
 * - Trnh re-render khng cn thit bng useRef
 * - X l li v trng thi loading
 * - H tr c production v emulator
 */
export const useOnlineUsers = () => {
  const [onlineCount, setOnlineCount] = useState(0);
  const [totalUsers, setTotalUsers] = useState(0);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // useRef  lu unsubscribe functions, trnh memory leak
  const unsubscribers = useRef([]);

  useEffect(() => {
    let isMounted = true;
    setLoading(true);
    setError(null);

    // === 1. Lng nghe s ngi online t Realtime Database (/presence) ===
    try {
      const presenceRef = ref(rtdb, 'presence');
      // Dng query  ti u (nu d liu ln, ch ly 1000 bn ghi gn nht)
      const presenceQuery = query(presenceRef, limitToLast(1000));

      const unsubscribePresence = onValue(
        presenceQuery,
        (snapshot) => {
          if (!isMounted) return;

          const data = snapshot.val();
          if (data && typeof data === 'object') {
            const count = Object.values(data).filter(
              (user) => user?.online === true && 
                        user?.lastSeen && 
                        // Optional: ch tnh ngi online trong 2 pht gn nht
                        Date.now() - new Date(user.lastSeen).getTime() < 2 * 60 * 1000
            ).length;
            setOnlineCount(count);
          } else {
            setOnlineCount(0);
          }
          setLoading(false);
        },
        (err) => {
          if (!isMounted) return;
          console.error('Li lng nghe presence:', err);
          setError(err.message);
          setOnlineCount(0);
          setLoading(false);
        }
      );

      unsubscribers.current.push(unsubscribePresence);
    } catch (err) {
      console.error('Khi to presence listener tht bi:', err);
      setError(err.message);
    }

    // === 2. Lng nghe tng ngi dng t Firestore (/stats/appUsage) ===
    try {
      const statsDocRef = doc(db, 'stats', 'appUsage');

      const unsubscribeStats = onSnapshot(
        statsDocRef,
        (docSnap) => {
          if (!isMounted) return;

          if (docSnap.exists()) {
            const data = docSnap.data();
            const total = data?.totalUsers ?? 0;
            setTotalUsers(Number(total));
          } else {
            setTotalUsers(0);
          }
          setLoading(false);
        },
        (err) => {
          if (!isMounted) return;
          console.error('Li lng nghe appUsage:', err);
          setError(err.message);
          setTotalUsers(0);
          setLoading(false);
        }
      );

      unsubscribers.current.push(unsubscribeStats);
    } catch (err) {
      console.error('Khi to stats listener tht bi:', err);
      setError(err.message);
    }

    // === Cleanup khi component unmount ===
    return () => {
      isMounted = false;
      unsubscribers.current.forEach(unsub => {
        try { unsub?.(); } catch (e) {}
      });
      unsubscribers.current = [];
    };
  }, []);

  return {
    onlineCount,
    totalUsers,
    loading,
    error,
    // Helper: reload th cng (nu cn)
    refetch: () => {
      // Kch hot li bng cch clear cache (khng cn thit vi onValue/onSnapshot)
    }
  };
};
</file>

<file path="src/hooks/useUserProgress.js">
import { useState, useEffect } from 'react';
import { 
  collection, 
  addDoc, 
  updateDoc, 
  doc, 
  query, 
  where, 
  getDocs, 
  onSnapshot, 
  serverTimestamp 
} from 'firebase/firestore';
import { auth, db } from '../config/firebase';

/**
 * Hook  qun l tin  luyn thi ca ngi dng
 * Ch s dng Firebase Authentication (Clerk  b loi b)
 */
export const useUserProgress = () => {
  // Firebase authentication state
  const [firebaseUser, setFirebaseUser] = useState(null);
  const [firebaseLoaded, setFirebaseLoaded] = useState(false);
  
  // Progress data v status
  const [progress, setProgress] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [currentUser, setCurrentUser] = useState(null);

  // ============================================
  // Listen to Firebase Auth State
  // ============================================
  useEffect(() => {
    const unsubscribe = auth.onAuthStateChanged((user) => {
      setFirebaseUser(user);
      setFirebaseLoaded(true);
    });
    return unsubscribe;
  }, []);

  // ============================================
  // Get Current User Info (Firebase Only)
  // ============================================
  const getCurrentUser = () => {
    if (firebaseUser) {
      return {
        id: firebaseUser.uid,
        firebaseUid: firebaseUser.uid,
        email: firebaseUser.email,
        name: firebaseUser.displayName || firebaseUser.email || 'Anonymous',
        provider: 'firebase',
        photoURL: firebaseUser.photoURL,
      };
    }
    
    return null;
  };

  // Update currentUser whenever Firebase auth changes
  useEffect(() => {
    const user = getCurrentUser();
    setCurrentUser(user);
  }, [firebaseUser]);

  // ============================================
  // Subscribe to User's Progress from Firestore
  // ============================================
  useEffect(() => {
    // i Firebase auth load xong
    if (!firebaseLoaded) {
      return;
    }

    const user = getCurrentUser();
    
    if (!user) {
      setProgress([]);
      return;
    }

    console.log(' Setting up progress listener:', {
      provider: user.provider,
      firebaseUid: user.firebaseUid,
      email: user.email,
    });

    try {
      // Query Firestore cho user ny
      const q = query(
        collection(db, 'userProgress'),
        where('firebaseUid', '==', user.firebaseUid)
      );

      console.log(' Querying Firebase user with firebaseUid:', user.firebaseUid);

      const unsubscribe = onSnapshot(
        q,
        (snapshot) => {
          console.log(` Progress snapshot received: ${snapshot.size} documents`);
          const data = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
            // Convert Firestore timestamp to JavaScript Date
            completedAt: doc.data().completedAt?.toDate?.() || doc.data().completedAt,
          }));
          
          // Sort by completedAt (newest first)
          const sortedData = data.sort((a, b) => {
            const dateA = a.completedAt instanceof Date ? a.completedAt : new Date(0);
            const dateB = b.completedAt instanceof Date ? b.completedAt : new Date(0);
            return dateB - dateA;
          });

          console.log(' Progress data loaded:', sortedData.length, 'documents');
          setProgress(sortedData);
          setError(null);
        },
        (err) => {
          console.error(' Snapshot listener error:', err.code, err.message);
          if (err.code === 'permission-denied') {
            console.warn(' Permission denied - Check Firestore Rules!');
            setError('Permission denied - check Firestore rules');
          } else {
            setError(err.message);
          }
        }
      );

      return unsubscribe;
    } catch (err) {
      console.error(' Error setting up listener:', err);
      setError(err.message);
    }
  }, [firebaseUser, firebaseLoaded]);

  // ============================================
  // Save or Update Progress to Firestore
  // ============================================
  const saveProgress = async (testData) => {
  const user = getCurrentUser();
  
  if (!user) {
    console.warn(' User not authenticated');
    return false;
  }

  //  Validate required fields trc
  const requiredFields = ['exam', 'part', 'score', 'answers', 'totalQuestions'];
  for (const field of requiredFields) {
    if (testData[field] === undefined) {
      throw new Error(`Missing required field: ${field}`);
    }
  }

    try {
      setLoading(true);

      //  Build progress data object - ONLY include defined fields
      // Firestore strictly forbids undefined values
      const progressData = {
        // Required user info
        firebaseUid: user.firebaseUid,
        userEmail: user.email || '',
        userName: user.name || 'Anonymous',
        
        // Test data
        exam: testData.exam,
        part: testData.part,
        score: testData.score || 0,
        answers: testData.answers || {},
        totalQuestions: testData.totalQuestions || 0,
        correctAnswers: testData.correctAnswers || 0,
        isDraft: testData.isDraft || false,
        testType: testData.testType || 'unknown',  //  FIXED: testData.testType not testType
        
        // Timestamps
        createdAt: serverTimestamp(),
        completedAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      };

      // Optional fields - only add if they have values
      if (user.photoURL) {
        progressData.photoURL = user.photoURL;
      }

      // Include additional listening/reading specific data if provided
      if (testData.listeningScore !== undefined) {
        progressData.listeningScore = testData.listeningScore;
      }
      if (testData.readingScore !== undefined) {
        progressData.readingScore = testData.readingScore;
      }
      if (testData.listeningCorrect !== undefined) {
        progressData.listeningCorrect = testData.listeningCorrect;
      }
      if (testData.readingCorrect !== undefined) {
        progressData.readingCorrect = testData.readingCorrect;
      }

      //  CRITICAL: Verify no undefined values
      for (const [key, value] of Object.entries(progressData)) {
        if (value === undefined) {
          console.warn(` WARNING: Field "${key}" is undefined, removing it`);
          delete progressData[key];
        }
      }

      console.log(' Final progressData to save:', progressData);
      console.log(' Saving progress - User info:', {
        firebaseUid: user.firebaseUid,
        email: user.email,
      });
      console.log(' Saving progress - Test data:', {
        exam: testData.exam,
        part: testData.part,
        score: testData.score,
        testType: testData.testType,
      });

      // Check if progress already exists for this test
      const existingQuery = query(
        collection(db, 'userProgress'),
        where('firebaseUid', '==', user.firebaseUid),
        where('exam', '==', testData.exam),
        where('part', '==', testData.part)
      );

      const existingDocs = await getDocs(existingQuery);

      if (existingDocs.size > 0) {
        // Update existing document
        const existingDoc = existingDocs.docs[0];
        await updateDoc(doc(db, 'userProgress', existingDoc.id), progressData);
        console.log(` Progress updated:`, existingDoc.id);
      } else {
        // Create new document
        const docRef = await addDoc(collection(db, 'userProgress'), progressData);
        console.log(` Progress saved:`, docRef.id);
      }

      setError(null);
      return true;
    } catch (err) {
      console.error(' Error saving progress:', err.code, err.message);
      if (err.code === 'permission-denied') {
        setError('Cannot save progress - check Firestore rules');
        console.error(' Permission denied! Make sure Firestore rules allow writes.');
      } else {
        setError(err.message);
      }
      throw err;
    } finally {
      setLoading(false);
    }
  };

  return {
    progress,
    loading,
    error,
    saveProgress,
    currentUser, // User info from Firebase
    isLoaded: firebaseLoaded, // Auth state is loaded
  };
};
</file>

<file path="src/components/Display/ContentDisplay.jsx">
import React, { useMemo, memo } from 'react';
import { AlertCircle, Headphones, FileText, BookOpen } from 'lucide-react';

import ReadingDisplay from './Readingdisplay';
import ScriptDisplay from './ScriptDisplay';

// Helper function  ly audio path
const getAudioPath = (examId, partId) => {
  if (!examId || !partId) return null;
  return `/public/data/audio/${examId}/listening/${partId}.mp3`;
};

// ========================================
// HELPER COMPONENT: InfoCard
// ========================================
const InfoCard = memo(({ icon: Icon, label, value, color = 'indigo' }) => {
  const colorMap = {
    indigo: 'text-indigo-600 bg-indigo-50',
    purple: 'text-purple-600 bg-purple-50',
    emerald: 'text-emerald-600 bg-emerald-50',
    amber: 'text-amber-600 bg-amber-50',
  };

  return (
    <div className="flex items-center gap-2 p-2 md:p-3 rounded-lg bg-slate-50 border border-slate-200 hover:bg-slate-100 transition-colors">
      <div className={`p-1.5 md:p-2 rounded-lg ${colorMap[color]}`}>
        <Icon className={`w-3.5 h-3.5 md:w-4 md:h-4`} strokeWidth={2} />
      </div>
      <div className="flex-1 min-w-0">
        <p className="text-xs font-semibold text-slate-600 uppercase tracking-wider">{label}</p>
        <p className="text-xs md:text-sm font-bold text-slate-900 truncate">{value}</p>
      </div>
    </div>
  );
});

InfoCard.displayName = 'InfoCard';

// ========================================
// MAIN COMPONENT: Listening Content
// ========================================
const ListeningContent = memo(({ 
  partData, 
  selectedPart,
  testType,
  examId,
  isPartPlayed,
  onAudioStart,    //  NEW PROP: Called when audio starts
  onAudioEnd,      //  EXISTING: Called when audio ends
}) => {
  const partNumber = selectedPart.replace('part', '');
  
  // Script extraction logic
  const script = useMemo(() => {
    if (!partData) {
      console.warn(' partData is null');
      return '';
    }
    
    console.log(' partData keys:', Object.keys(partData));
    
    if (partData.script) {
      console.log(' Found script in partData.script');
      return partData.script;
    }
    
    if (partData.text) {
      console.log(' Found text in partData.text');
      return partData.text;
    }
    
    if (partData.questions && Array.isArray(partData.questions)) {
      console.log(` Found ${partData.questions.length} questions, extracting scripts...`);
      
      const scripts = partData.questions
        .filter(q => q.script)
        .map(q => q.script)
        .join('\n\n---\n\n');
      
      if (scripts.trim()) {
        console.log(' Extracted scripts from questions');
        return scripts;
      }
    }
    
    if (partData.description) {
      console.log(' Using description as fallback');
      return partData.description;
    }
    
    console.warn(' No script found in any property');
    return '';
  }, [partData]);

  // Audio URL - u tin t partData, nu khng th to mc nh
  const audioUrl = useMemo(() => {
    if (!examId) return null;
    
    if (partData?.audioUrl) {
      return partData.audioUrl;
    }
    
    return getAudioPath(examId, selectedPart);
  }, [examId, selectedPart, partData]);

  const partTitle = useMemo(() => {
    return partData?.title || `Part ${partNumber} - Phn Nghe`;
  }, [partData, partNumber]);

  if (!script) {
    return (
      <div className="bg-gradient-to-br from-slate-50 to-white rounded-xl md:rounded-2xl border-2 border-slate-200 p-6 md:p-8 text-center">
        <div className="w-14 h-14 md:w-16 md:h-16 rounded-lg md:rounded-xl bg-slate-100 flex items-center justify-center mx-auto mb-3 md:mb-4">
          <Headphones className="w-7 h-7 md:w-8 md:h-8 text-slate-400" strokeWidth={1.5} />
        </div>
        <p className="text-slate-900 font-bold text-base md:text-lg">Cha c kch bn</p>
        <p className="text-slate-600 text-sm mt-1 md:mt-2">Kch bn cho phn ny s sm c</p>
        <p className="text-slate-500 text-xs mt-3">Part: {partNumber}</p>
      </div>
    );
  }

  return (
    <div className="animate-in fade-in duration-300 w-full relative z-20">
      <ScriptDisplay 
        script={script}
        audioUrl={audioUrl}
        partTitle={partTitle}
        isPartPlayed={isPartPlayed}              //  NEW PROP
        onAudioStart={onAudioStart}              //  NEW PROP
        onAudioEnd={onAudioEnd}                  //  EXISTING PROP
      />
    </div>
  );
});

ListeningContent.displayName = 'ListeningContent';

// ========================================
// MAIN COMPONENT: Empty State
// ========================================
const EmptyState = memo(({ type = 'no-part' }) => {
  const states = {
    'no-part': {
      icon: AlertCircle,
      iconColor: 'text-slate-400',
      bgColor: 'from-slate-50 to-white',
      borderColor: 'border-slate-200',
      title: 'Chn Part  bt u',
      description: 'Vui lng chn mt phn thi t danh sch trn'
    },
    'no-content': {
      icon: FileText,
      iconColor: 'text-amber-600',
      bgColor: 'from-amber-50 to-white',
      borderColor: 'border-amber-200',
      title: 'Khng c ni dung',
      description: 'Ni dung cho phn ny cha c ti hoc cp nht'
    }
  };

  const state = states[type] || states['no-part'];
  const Icon = state.icon;

  return (
    <div className={`bg-gradient-to-br ${state.bgColor} rounded-xl md:rounded-2xl border-2 ${state.borderColor} p-6 md:p-12 animate-in fade-in duration-300 w-full`}>
      <div className="text-center py-8 md:py-12">
        <div className="w-16 h-16 md:w-20 md:h-20 rounded-lg md:rounded-xl bg-white border-2 border-slate-200 flex items-center justify-center mx-auto mb-4 md:mb-6 shadow-sm">
          <Icon className={`w-8 h-8 md:w-10 md:h-10 ${state.iconColor}`} strokeWidth={1.5} />
        </div>
        <p className="text-slate-900 font-bold text-lg md:text-xl mb-1 md:mb-2">
          {state.title}
        </p>
        <p className="text-slate-600 text-sm md:text-base">
          {state.description}
        </p>
      </div>
    </div>
  );
});

EmptyState.displayName = 'EmptyState';

// ========================================
// MAIN COMPONENT: ContentDisplay
// ========================================
/**
 * ContentDisplay Component
 * 
 * Props:
 * - partData: Object - D liu ca phn thi
 * - selectedPart: String - Phn c chn (e.g., 'part1', 'part5')
 * - currentQuestionIndex: Number - Index cu hi hin ti
 * - testType: String - Loi thi ('listening' hoc 'reading')
 * - examId: String - ID  thi
 * - isPartPlayed: Boolean - C nghe xong audio phn ny cha
 * - onAudioStart: Function - Callback khi audio bt u pht
 * - onAudioEnd: Function - Callback khi audio kt thc
 */
const ContentDisplay = memo(({ 
  partData, 
  selectedPart, 
  currentQuestionIndex, 
  testType,
  examId,
  isPartPlayed,        //  NEW PROP
  onAudioStart,        //  NEW PROP: Callback when audio starts
  onAudioEnd,          //  EXISTING: Callback when audio ends
}) => {
  
  // Extract content
  const content = useMemo(() => {
    if (!partData) return '';

    if (testType === 'listening') {
      if (partData.script) {
        return partData.script;
      }
      if (partData.text) {
        return partData.text;
      }
      if (partData.questions && Array.isArray(partData.questions)) {
        const scripts = partData.questions
          .filter(q => q.script)
          .map(q => q.script)
          .join('\n\n');
        return scripts;
      }
      return '';
    }
    
    return partData.text || '';
  }, [partData, testType]);

  // CASE 1: Hide for reading part 5
  if (testType === 'reading' && selectedPart === 'part5') {
    return null;
  }

  // CASE 2: No part data
  if (!partData) {
    return <EmptyState type="no-part" />;
  }

  // CASE 3: No content
  if (!content.trim()) {
    return <EmptyState type="no-content" />;
  }

  // ========================================
  // RENDER: READING PARTS
  // ========================================
  if (testType === 'reading') {
    return (
      <ReadingDisplay data={partData} />
    );
  }

  // ========================================
  // RENDER: LISTENING PARTS
  // ========================================
  if (testType === 'listening') {
    return (
      <ListeningContent 
        partData={partData}
        selectedPart={selectedPart}
        testType={testType}
        examId={examId}
        isPartPlayed={isPartPlayed}              //  PASS NEW PROP
        onAudioStart={onAudioStart}              //  PASS NEW PROP
        onAudioEnd={onAudioEnd}                  //  PASS EXISTING PROP
      />
    );
  }

  return null;
});

ContentDisplay.displayName = 'ContentDisplay';

export default ContentDisplay;
</file>

<file path="src/components/footer/Footer.jsx">
import React, { useState, useCallback, useMemo, memo } from 'react';
import {
  Mail, Phone, MapPin, Facebook, Youtube, MessageCircle,
  BookOpen, Zap, Users, HelpCircle, Send,
  ChevronRight, Heart, TrendingUp, Award, Github,
  Sparkles, ExternalLink, Rocket, AlertCircle
} from 'lucide-react';

// --- SUB-COMPONENTS (MEMOIZED) ---

const FooterCard = memo(({ title, children, icon: Icon }) => (
  <div className="flex flex-col gap-6 animate-in fade-in duration-500">
    <div className="flex items-center gap-3">
      <div className="p-2 bg-blue-100 rounded-lg text-blue-600">
        <Icon size={20} strokeWidth={2.5} />
      </div>
      <h3 className="text-lg font-bold text-slate-800 tracking-tight">{title}</h3>
    </div>
    <div className="flex flex-col gap-3">{children}</div>
  </div>
));

FooterCard.displayName = 'FooterCard';

const SmartLink = memo(({ label, href, icon: Icon }) => (
  <a
    href={href}
    className="group flex items-center justify-between p-3 rounded-xl hover:bg-white hover:shadow-md transition-all duration-300 border border-transparent hover:border-blue-50 cursor-pointer"
  >
    <div className="flex items-center gap-3">
      <div className="w-8 h-8 rounded-full bg-slate-100 group-hover:bg-blue-600 flex items-center justify-center transition-colors duration-300">
        <Icon size={14} className="text-slate-500 group-hover:text-white" />
      </div>
      <span className="text-sm font-semibold text-slate-600 group-hover:text-blue-700">{label}</span>
    </div>
    <ChevronRight size={14} className="opacity-0 group-hover:opacity-100 text-blue-400 transition-all duration-300" />
  </a>
));

SmartLink.displayName = 'SmartLink';

const SocialButton = memo(({ href, icon: Icon, bgGradient, title }) => (
  <a 
    href={href} 
    className={`w-11 h-11 rounded-full ${bgGradient} text-white flex items-center justify-center shadow-lg hover:shadow-xl hover:scale-110 transition-transform duration-300`}
    title={title}
  >
    <Icon size={20} />
  </a>
));

SocialButton.displayName = 'SocialButton';

const StatusMessage = memo(({ message, type }) => (
  <div
    className={`flex items-center gap-3 text-sm px-5 py-3.5 rounded-xl font-semibold transition-all border-2 animate-in fade-in duration-300 ${
      type === 'success'
        ? 'bg-green-50 text-green-700 border-green-300'
        : type === 'error'
        ? 'bg-red-50 text-red-700 border-red-300'
        : 'bg-blue-50 text-blue-700 border-blue-300'
    }`}
  >
    <AlertCircle size={18} className="flex-shrink-0" />
    <span>{message}</span>
  </div>
));

StatusMessage.displayName = 'StatusMessage';

const ContactInfo = memo(() => (
  <div className="p-6 bg-[#00358E] rounded-[24px] text-white space-y-4 shadow-xl">
    <div className="flex items-center gap-4 group cursor-pointer hover:opacity-80 transition-opacity">
      <div className="w-10 h-10 rounded-full bg-blue-800 group-hover:bg-[#FF7D00] flex items-center justify-center transition-colors duration-300">
        <Mail size={18} />
      </div>
      <div>
        <p className="text-[10px] uppercase font-bold text-blue-300">Email h tr</p>
        <p className="text-sm font-bold">lekhoale3009@gmail.com</p>
      </div>
    </div>
    <div className="flex items-center gap-4 group cursor-pointer hover:opacity-80 transition-opacity">
      <div className="w-10 h-10 rounded-full bg-blue-800 group-hover:bg-[#FF7D00] flex items-center justify-center transition-colors duration-300">
        <Phone size={18} />
      </div>
      <div>
        <p className="text-[10px] uppercase font-bold text-blue-300">Hotline</p>
        <p className="text-sm font-bold">+84 383 196 830</p>
      </div>
    </div>
  </div>
));

ContactInfo.displayName = 'ContactInfo';

const DiscordForm = memo(({ isSubmitting, discord, setDiscord, message, setMessage, discordStatus, onSubmit }) => (
  <div className="lg:col-span-7 bg-gradient-to-br from-white via-blue-50 to-white p-8 rounded-[32px] shadow-2xl shadow-blue-100/50 border border-blue-100 relative overflow-hidden animate-in fade-in duration-500">
    {/* Decorative background elements */}
    <div className="absolute -top-20 -right-20 w-40 h-40 bg-blue-200 rounded-full blur-3xl opacity-20 pointer-events-none" />
    <div className="absolute -bottom-20 -left-20 w-40 h-40 bg-orange-200 rounded-full blur-3xl opacity-10 pointer-events-none" />
    
    <div className="relative z-10 space-y-6">
      {/* Header with Icon */}
      <div className="flex items-center justify-center gap-4 pb-2">
        <div className="p-4 bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl shadow-lg shadow-blue-300/50 hover:scale-110 transition-transform duration-300">
          <MessageCircle className="w-7 h-7 text-yellow-300" />
        </div>
        <div>
          <h3 className="text-2xl font-black text-[#00358E]">Trao i & Kt Ni</h3>
          <p className="text-xs text-slate-500 font-semibold">Lin h trc tip vi i ng</p>
        </div>
      </div>

      {/* Subtitle */}
      <p className="text-center text-slate-600 text-sm leading-relaxed px-2">
        C cu hi hoc  xut? Gi tin nhn trc tip n i ng HUFLIT Exam qua Discord ngay!
      </p>

      {/* Form Fields */}
      <div className="space-y-3 pt-2">
        {/* Discord Username Input */}
        <div className="relative animate-in fade-in duration-500" style={{ animationDelay: '100ms' }}>
          <label className="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">
             Discord Username
          </label>
          <input
            type="text"
            value={discord}
            onChange={(e) => setDiscord(e.target.value)}
            placeholder="V d: user#1234"
            disabled={isSubmitting}
            className="w-full px-5 py-3.5 rounded-xl bg-white border-2 border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm font-medium transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed placeholder:text-slate-400"
          />
        </div>

        {/* Message Textarea */}
        <div className="relative animate-in fade-in duration-500" style={{ animationDelay: '200ms' }}>
          <label className="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">
             Tin Nhn Ca Bn
          </label>
          <textarea
            value={message}
            onChange={(e) => setMessage(e.target.value)}
            placeholder="Chia s tm s, gp  hoc t cu hi ca bn... (Ti thiu 10 k t)"
            disabled={isSubmitting}
            className="w-full px-5 py-3.5 rounded-xl bg-white border-2 border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm font-medium transition-all duration-300 resize-none h-24 disabled:opacity-50 disabled:cursor-not-allowed placeholder:text-slate-400"
          />
          <div className="absolute bottom-3 right-3 text-xs font-semibold text-slate-400">
            {message.length}/10
          </div>
        </div>
        
        {/* Submit Button */}
        <button
          onClick={onSubmit}
          disabled={isSubmitting}
          className="w-full py-4 bg-gradient-to-r from-[#00358E] to-blue-700 hover:from-blue-800 hover:to-blue-900 disabled:from-slate-400 disabled:to-slate-500 text-white rounded-xl font-bold flex items-center justify-center gap-3 shadow-xl shadow-blue-300/50 transition-all duration-300 disabled:cursor-not-allowed text-base active:scale-95 animate-in fade-in duration-500"
          style={{ animationDelay: '300ms' }}
        >
          {isSubmitting ? (
            <>
              <div className="w-5 h-5 border-2.5 border-white border-t-transparent rounded-full animate-spin"></div>
              <span>ang gi...</span>
            </>
          ) : (
            <>
              <Send size={20} />
              <span>Gi Tin Nhn</span>
            </>
          )}
        </button>
      </div>

      {/* Status Message with Animation */}
      {discordStatus.message && (
        <StatusMessage message={discordStatus.message} type={discordStatus.type} />
      )}

      {/* Social Links */}
      <div className="pt-4 border-t border-slate-200 flex justify-center gap-4">
        <SocialButton href="#" icon={Facebook} bgGradient="bg-gradient-to-br from-[#1877F2] to-blue-700" title="Facebook" />
        <SocialButton href="#" icon={Github} bgGradient="bg-gradient-to-br from-[#24292F] to-black" title="Github" />
        <SocialButton href="#" icon={Youtube} bgGradient="bg-gradient-to-br from-[#FF0000] to-red-700" title="Youtube" />
      </div>
    </div>
  </div>
));

DiscordForm.displayName = 'DiscordForm';

const TopSection = memo(({ isSubmitting, discord, setDiscord, message, setMessage, discordStatus, onSubmit }) => (
  <div className="grid grid-cols-1 lg:grid-cols-12 gap-12 mb-20 items-center">
    <div className="lg:col-span-5 space-y-6">
      <div className="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-full border border-blue-100 text-blue-700 font-bold text-xs uppercase tracking-widest animate-in fade-in duration-500">
        <Rocket size={14} /> Chinh phc im cao ngay hm nay
      </div>
      <h2 className="text-4xl md:text-5xl font-black text-[#00358E] leading-tight animate-in fade-in duration-500" style={{ animationDelay: '100ms' }}>
        Nng tm k nng <br /> 
        <span className="text-[#FF7D00] relative">
          Toeic & English
          <svg className="absolute -bottom-2 left-0 w-full" height="8" viewBox="0 0 100 8" preserveAspectRatio="none">
            <path d="M0 7C25 2 75 2 100 7" stroke="#FF7D00" strokeWidth="3" fill="none" opacity="0.3" />
          </svg>
        </span>
      </h2>
      <p className="text-slate-500 text-lg max-w-md animate-in fade-in duration-500" style={{ animationDelay: '200ms' }}>
        H thng luyn thi thng minh gip bn ti u ha thi gian v t kt qu mong mun vi l trnh c nhn ha.
      </p>
    </div>

    <DiscordForm 
      isSubmitting={isSubmitting}
      discord={discord}
      setDiscord={setDiscord}
      message={message}
      setMessage={setMessage}
      discordStatus={discordStatus}
      onSubmit={onSubmit}
    />
  </div>
));

TopSection.displayName = 'TopSection';

const BottomSection = memo(() => (
  <div className="pt-8 border-t border-slate-200 flex flex-col md:flex-row justify-between items-center gap-6">
    <div className="flex items-center gap-2">
      <div className="w-8 h-8 bg-[#00358E] rounded-lg flex items-center justify-center text-white font-black text-xs">H</div>
      <span className="text-slate-400 text-sm font-medium"> 2026 <span className="text-slate-900">HUFLIT Exam</span>. All rights reserved.</span>
    </div>

    <div className="flex items-center gap-8">
      {['iu khon', 'Bo mt', 'Cookies'].map((item, i) => (
        <a key={i} href="#" className="text-sm text-slate-500 hover:text-blue-600 font-semibold transition-colors duration-300">{item}</a>
      ))}
    </div>

    <div className="flex items-center gap-1 text-slate-400 text-sm font-medium">
      Crafted with <Heart size={14} className="text-red-500 fill-red-500 animate-pulse" /> by <span className="text-slate-900 font-bold ml-1">Khoale</span>
    </div>
  </div>
));

BottomSection.displayName = 'BottomSection';

// --- MAIN COMPONENT ---
const Footer = memo(() => {
  const [discord, setDiscord] = useState('');
  const [message, setMessage] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [discordStatus, setDiscordStatus] = useState({ type: null, message: '' });

  // Handle form submission with Discord webhook integration
  const handleDiscordSubmit = useCallback(async (e) => {
    e?.preventDefault();
    
    // Validate inputs
    if (!discord.trim()) {
      setDiscordStatus({ type: 'error', message: 'Vui lng nhp Discord username' });
      return;
    }
    
    if (message.length < 10) {
      setDiscordStatus({ type: 'error', message: 'Tin nhn phi c t nht 10 k t' });
      return;
    }

    setIsSubmitting(true);
    setDiscordStatus({ type: 'info', message: 'ang gi...' });

    try {
      // Send message to Discord webhook
      const webhookUrl = 'https://discord.com/api/webhooks/1456551898457833564/Mp-FcK12R8udXBLjEtNCnWcC71hX8aYuj00m_PwmoFPzuiY7wejp9_q7qYCvP-u0LWiH';
      
      const response = await fetch(webhookUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          username: 'HUFLIT Exam System',
          avatar_url: 'https://cdn-icons-png.flaticon.com/512/3588/3588592.png',
          embeds: [
            {
              color: 0x00358E,
              title: ' Tin Nhn Mi T Khch Hng',
              fields: [
                {
                  name: ' Discord Username',
                  value: discord,
                  inline: true,
                },
                {
                  name: ' Thi gian',
                  value: new Date().toLocaleString('vi-VN'),
                  inline: true,
                },
                {
                  name: ' Tin Nhn',
                  value: message,
                  inline: false,
                },
              ],
              footer: {
                text: 'HUFLIT Exam - Discord Integration',
              },
              timestamp: new Date().toISOString(),
            },
          ],
        }),
      });

      if (!response.ok) {
        throw new Error('Failed to send message');
      }
      
      // Success feedback
      setDiscordStatus({ type: 'success', message: 'Tin nhn  c gi thnh cng! Cm n bn ' });
      setDiscord('');
      setMessage('');
      
      // Clear success message after 5 seconds
      setTimeout(() => setDiscordStatus({ type: null, message: '' }), 5000);
    } catch (error) {
      console.error('Discord submission error:', error);
      setDiscordStatus({ type: 'error', message: 'C li xy ra, vui lng th li' });
    } finally {
      setIsSubmitting(false);
    }
  }, [discord, message]);

  // Memoize link data
  const learningLinks = useMemo(() => [
    { label: 'Th vin  thi', icon: Sparkles },
    { label: 'L trnh hc tp', icon: TrendingUp },
    { label: 'Mo lm bi thi', icon: Zap },
  ], []);

  const supportLinks = useMemo(() => [
    { label: 'Cng ng tho lun', icon: MessageCircle },
    { label: 'Cu hi thng gp', icon: HelpCircle },
    { label: 'Vinh danh th khoa', icon: Award },
  ], []);

  return (
    <footer className="relative bg-[#F8FAFC] pt-24 pb-12 overflow-hidden border-t border-slate-200">
      {/* Background Decorative Elements */}
      <div className="absolute top-0 left-1/2 -translate-x-1/2 w-full h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent opacity-20 pointer-events-none" />
      <div className="absolute -top-24 -left-24 w-64 h-64 bg-blue-200 rounded-full blur-[100px] opacity-30 pointer-events-none" />
      <div className="absolute top-1/2 -right-24 w-64 h-64 bg-orange-200 rounded-full blur-[100px] opacity-20 pointer-events-none" />

      <div className="max-w-7xl mx-auto px-6 relative z-10">
        
        {/* TOP SECTION */}
        <TopSection 
          isSubmitting={isSubmitting}
          discord={discord}
          setDiscord={setDiscord}
          message={message}
          setMessage={setMessage}
          discordStatus={discordStatus}
          onSubmit={handleDiscordSubmit}
        />

        {/* MIDDLE SECTION: LINKS GRID */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-16 mb-20">
          <FooterCard title="Ti Nguyn Hc Tp" icon={BookOpen}>
            {learningLinks.map((link, i) => (
              <SmartLink key={i} label={link.label} href="#" icon={link.icon} />
            ))}
          </FooterCard>

          <FooterCard title="H Tr Thnh Vin" icon={Users}>
            {supportLinks.map((link, i) => (
              <SmartLink key={i} label={link.label} href="#" icon={link.icon} />
            ))}
          </FooterCard>

          <FooterCard title="Lin H Trc Tip" icon={Phone}>
            <ContactInfo />
          </FooterCard>
        </div>

        {/* BOTTOM SECTION */}
        <BottomSection />
      </div>
    </footer>
  );
});

Footer.displayName = 'Footer';

export default Footer;
</file>

<file path="src/data/exams/exam2.js">
export const EXAM2_DATA = {
  title: "HUFLIT Listening & Reading Practice - Exam 2",
  description: "B  thi y  vi Listening (4 parts, 20 cu) v Reading (4 parts, 40 cu)",
  
  metadata: {
    exam: "exam2",
    hasAudio: true,
    listeningAudioUrl: "/public/data/audio/exam2/listening/full.mp3",
  },

  parts: {
    // ==========================================
    // LISTENING PART 1
    // ==========================================
    part1: {
      title: "PART 1: Task Prioritization",
      description: "Nghe on hi thoi gia Susanne v Mario v cc nhim v. Chn p n tt nht cho 5 cu hi.",
      type: "listening",
      audioUrl: "/public/data/audio/exam2/listening/part1.mp3",
      script: `Susanne: Hi, Mario. Can you help me prepare some things for the next month?
Mario: OK, sure. What can I help you with?
Susanne: I need to visit the customer in Germany. It's important.
Mario: What can I do to help?
Susanne: Can you send an email to the customer? Ask them when I can visit them next week. Please do this first. It's a priority and very urgent.
Mario: Right. I'll do it today.
Susanne: Thanks. This next task is also important. Can you invite everyone to the next team meeting?
Mario: Yes, I will.
Susanne: But first you need to book a meeting room. After that, please send everyone an email about it.
Mario: Yes, of course.
Susanne: And finally, can you write a short report about our new project? I have to give a presentation to our managers next month. Please do it when you have time  sometime in the next two or three weeks. It's not too urgent.
Mario: Sure, no problem. I can do it this week.
Susanne: There's no hurry. Take your time.`,

      questions: [
        {
          id: 1,
          question: "What is Mario's most immediate priority?",
          options: [
            "A. Booking a room for the team meeting",
            "B. Writing a project report for the managers",
            "C. Contacting a client in Germany via email",
            "D. Organizing a presentation for next month"
          ],
          correct: 2,
          explanation: "Susanne ni: 'Please do this first. It's a priority and very urgent' (gi email cho khch hng c).  u tin cao nht l lin h khch hng."
        },
        {
          id: 2,
          question: "What is the correct order of actions for the team meeting?",
          options: [
            "A. Send the email, then book the room",
            "B. Book the room, then invite the team",
            "C. Invite the team, then find a room",
            "D. Conduct the meeting, then send a report"
          ],
          correct: 1,
          explanation: "Susanne ni r: 'But first you need to book a meeting room. After that, please send everyone an email about it.'  Phi t phng trc, ri gi email mi mi ngi."
        },
        {
          id: 3,
          question: "When does the project report need to be completed?",
          options: [
            "A. By the end of today",
            "B. Within the next seven days",
            "C. In approximately two to three weeks",
            "D. After the presentation next month"
          ],
          correct: 2,
          explanation: "Susanne  cp: 'sometime in the next two or three weeks. It's not too urgent.'  Thi hn l 2-3 tun ti."
        },
        {
          id: 4,
          question: "How does Susanne feel about the project report task?",
          options: [
            "A. She believes it is the most important task",
            "B. She is worried it won't be finished on time",
            "C. She wants Mario to prioritize it over the client email",
            "D. She considers it a low-pressure task with a flexible deadline"
          ],
          correct: 3,
          explanation: "Susanne ni: 'There's no hurry. Take your time.' v 'It's not too urgent.'  C cm thy khng gp gp, c thi gian linh hot."
        },
        {
          id: 5,
          question: "Why did Susanne ask Mario to contact the customer first?",
          options: [
            "A. Because Mario works in the Germany office",
            "B. Because it is the most urgent task",
            "C. Because the customer requested to be contacted today",
            "D. Because the email address needs to be verified first"
          ],
          correct: 1,
          explanation: "Susanne nhn mnh: 'Please do this first. It's a priority and very urgent.'  V y l vic gp nht v u tin cao nht."
        }
      ]
    },

    // ==========================================
    // LISTENING PART 2
    // ==========================================
    part2: {
      title: "PART 2: Four Different Stories",
      description: "Nghe bn on hi thoi ngn (A-D) v cc ch  khc nhau. Chn p n tt nht cho mi cu hi.",
      type: "listening",
      audioUrl: "/public/data/audio/exam2/listening/part2.mp3",
      script: `STORY A - Job Interview
Man: How did it go?
Woman: Umm, I think it went quite well. I did a lot of research and prepared a lot. I was in there for ... I don't know ... half an hour?
Man: And? What did they say?
Woman: Nothing much. At the end I asked them, 'What happens now?', and the woman said, 'We'll call you back with news in three or four days.'
Man: Really?
Woman: Yeah, I think I've got the job. There weren't a lot of other people there. I was the only interview that day, you know?
Man: Well, good luck with it.

---

STORY B - Museum Visit
Man: Anyway, you were saying ...
Woman: Oh, yeah, um ... let's see. Yes, so I was in the museum and there were, I don't know, a hundred people waiting to get into the room. Finally, I got in, and I tried to see the Mona Lisa but I couldn't look at it.
Man: Why not?
Woman: Because the room was filled with people taking photographs of it!
Man: Oh, right.
Woman: Yes! And selfies.
Man: Wait a minute. You can take photos while you're in there?
Woman: Yes, but you can't use flash. I don't know ... Why do we take photos of everything we see when we travel?
Man: I know. And we never look at the photos after.
Woman: Exactly! I'm tired of always taking photos. I don't feel I'm enjoying things.

---

STORY C - Old Photograph
Man: Who took this?
Woman: I can't remember. Hmmm ...
Man: What am I doing?
Woman: You're sitting on the sofa, watching TV and eating chocolates. Nothing changes!
Man: Ha! Very funny. You look very young, though.
Woman: I know. Look at my hair  it was so long!
Man: Mine too, look at me! Hey  I think I know who took this photo.
Woman: Umm  who? Was it Dad?
Man: No, it wasn't Dad or Mum. Do you remember Barry?
Woman: No.
Man: Yes, YES! You do remember. Barry, your boyfriend at high school. You were seventeen and he was sixteen and he was so very polite: 'Hello, I'm Barry. It's very nice to meet you ...'
Woman: Stop it! He was nice.
Man: Yeah, well, he took the photo.

---

STORY D - Group Project
Woman: Let's see. OK. I'm glad we could talk about this. It's not easy to say.
Man: What?
Woman: Well, you're not in our group  for the class project.
Man: What do you mean? You know I'm always in a group with you.
Woman: I know. It's just that this time  this time we made the group differently and because you were late ...
Man: I see. You don't want me in the group?
Woman: No, no. It isn't that. It's that we've already made the group, see? There's four of us already.
Man: So? We can't be a group of five?
Woman: Well, the teacher said four people per group.
Man: Oh.
Woman: It's not about you or your work or anything like that. It's ... errrr ... well, we already have the group.
Man: So I have to find another group.
Woman: I'm sorry.`,

      questions: [
        {
          id: 6,
          question: "What is the woman in Story A talking about?",
          options: [
            "A. A meeting with her friends",
            "B. A job interview she has just had",
            "C. A training course she wants to join",
            "D. A phone call from a company"
          ],
          correct: 1,
          explanation: "C ni: 'I did a lot of research and prepared a lot', 'I think I've got the job'  y l mt bui phng vn xin vic."
        },
        {
          id: 7,
          question: "In Story B, why couldn't the woman really look at the Mona Lisa?",
          options: [
            "A. Because photography was not allowed",
            "B. Because the painting was too small",
            "C. Because the room was too crowded with people taking photos",
            "D. Because she was tired after waiting"
          ],
          correct: 2,
          explanation: "C ni: 'the room was filled with people taking photographs of it'  Phng ng nght ngi chp nh nn c khng th ngm tranh."
        },
        {
          id: 8,
          question: "In Story C, who took the photo they are talking about?",
          options: [
            "A. The woman's father",
            "B. The woman's mother",
            "C. A friend named Barry",
            "D. A photographer"
          ],
          correct: 2,
          explanation: "Ngi n ng ni: 'he took the photo' (referring to Barry). Barry l bn trai thi trung hc ca c y."
        },
        {
          id: 9,
          question: "In Story D, why is the man not included in the group?",
          options: [
            "A. Because his work is not good enough",
            "B. Because the woman doesn't like him",
            "C. Because he was late and the group is already full",
            "D. Because the teacher changed the project"
          ],
          correct: 2,
          explanation: "C ni: 'because you were late' v 'the teacher said four people per group'  Anh n mun nn nhm   4 ngi."
        },
        {
          id: 10,
          question: "What is the main difference between Story A and Story D?",
          options: [
            "A. They both involve the same two people",
            "B. Story A is positive and Story D is negative",
            "C. They both take place at the same location",
            "D. They are both about work-related events"
          ],
          correct: 1,
          explanation: "Story A ni v phng vn thnh cng vi tin tt, Story D ni v tin xu khng c vo nhm  Mt tch cc, mt tiu cc."
        }
      ]
    },

    // ==========================================
    // LISTENING PART 3
    // ==========================================
    part3: {
      title: "PART 3: Comparison of Mars and Earth",
      description: "Nghe hai sinh vin tho lun v nhng im ging v khc gia Sao Ha v Tri t. Chn p n tt nht cho 5 cu hi.",
      type: "listening",
      audioUrl: "/public/data/audio/exam2/listening/part3.mp3",
      script: `Teacher: So you've got a few minutes to discuss with your partner.
Student 1: So, as far as I know, the main similarity between Mars and Earth is that they can both support human life.
Student 2: Yeah, but do we know that's actually true? I mean, Mars is much colder than Earth, isn't it? It says here it's about minus 55 degrees most of the time, whereas on Earth only places like Antarctica get that cold.
Student 1: True. Well then, I suppose you could say both planets are a similar distance from the Sun?
Student 2: No way! Mars is much further away! It says here it's about 228 million kilometres, while Earth is about 150 million.
Student 1: Yes, but in space that's not that far. Jupiter is, like, almost 780 million kilometres. That's why we use astronomical units when we talk about distances in space. Earth is 1 astronomical unit from the Sun and Mars is 1.3. The difference doesn't sound so big when you look at it that way.
Student 2: I see what you mean. Jupiter is 5.2 astronomical units so I guess you're right. What other similarities are there between the two planets?
Student 1: Let's see  not the colour, obviously!
Student 2: Yeah! Earth is called the blue planet and Mars is called the red planet for pretty obvious reasons!
Student 1: Their sizes are pretty different. Mars is about half the size of Earth.
Student 2: What about this? It looks like the days on both planets are almost the same length. Earth's day is 24 hours but Mars's is about half an hour longer.
Student 1: You're right. OK, any other things they both share?
Student 2: I suppose you could say they have water in common.
Student 1: Could you? How?
Student 2: Well, Earth is 70 per cent water and Mars probably had huge oceans in the past. It's just that most of the water there now is probably frozen.
Student 1: Ah, I see. I don't think we can say the air is the same, though. Most of Earth's air is nitrogen and oxygen, but Mars ?
Student 2: Mars doesn't really have air, not compared with Earth. It's got about one per cent as much air as Earth.
Student 1: Right, and it's mostly carbon dioxide.
Student 2: Gravity is another difference. I didn't know this, but Mars has higher gravity than the Moon. But it's much less than on Earth, of course.
Student 1: Oh, yes. It says Mars has about 38 per cent of Earth's gravity.
Teacher: OK, let's see what you've found `,

      questions: [
        {
          id: 11,
          question: "What is the main point the students make about the distance of Mars from the Sun?",
          options: [
            "A. Mars is almost as close to the Sun as Earth",
            "B. Mars is much further from the Sun than Earth and the difference is very large",
            "C. The distance seems smaller when measured in astronomical units",
            "D. Jupiter is closer to the Sun than Mars"
          ],
          correct: 2,
          explanation: "Student 1 ni: 'The difference doesn't sound so big when you look at it that way' (khi dng astronomical units, t 1 AU ln 1.3 AU khng qu ln)."
        },
        {
          id: 12,
          question: "Why does Student 2 doubt that Mars can support human life?",
          options: [
            "A. Because Mars has no gravity",
            "B. Because Mars is much colder than Earth",
            "C. Because Mars is smaller than Earth",
            "D. Because Mars has no water"
          ],
          correct: 1,
          explanation: "Student 2 ni: 'Mars is much colder than Earth ... about minus 55 degrees most of the time.'   lnh qu cao khin con ngi khng th sng."
        },
        {
          id: 13,
          question: "What similarity between Earth and Mars do the students finally agree on?",
          options: [
            "A. They are the same colour",
            "B. They have the same atmosphere",
            "C. Their days are almost the same length",
            "D. They have the same amount of water"
          ],
          correct: 2,
          explanation: "Student 2 ni: 'the days on both planets are almost the same length. Earth's day is 24 hours but Mars's is about half an hour longer.'   di ngy gn ging nhau."
        },
        {
          id: 14,
          question: "What is true about Mars's atmosphere compared to Earth's?",
          options: [
            "A. It has more oxygen than Earth",
            "B. It is mostly nitrogen",
            "C. It has much less air and is mainly carbon dioxide",
            "D. It is almost the same as Earth's atmosphere"
          ],
          correct: 2,
          explanation: "Students ni: Mars ch c khong 1% lng khng kh ca Tri t v thnh phn chnh l carbon dioxide."
        },
        {
          id: 15,
          question: "According to the discussion, what percentage of Earth's gravity does Mars have?",
          options: [
            "A. About 25 percent",
            "B. About 38 percent",
            "C. About 50 percent",
            "D. About 70 percent"
          ],
          correct: 1,
          explanation: "Student 1 ni: 'It says Mars has about 38 per cent of Earth's gravity.'  Mars c 38% trng lc ca Tri t."
        }
      ]
    },

    // ==========================================
    // LISTENING PART 4
    // ==========================================
    part4: {
      title: "PART 4: Positive Psychology",
      description: "Nghe bi ging v tm l hc tch cc v l thuyt flow. Chn p n tt nht cho 5 cu hi.",
      type: "listening",
      audioUrl: "/public/data/audio/exam2/listening/part4.mp3",
      script: `Good afternoon, everyone. Welcome to the first lecture of our new course in Positive Psychology. While some people may associate psychology with looking at what's wrong with us, and at what problems we have, there is much more to psychology than that. Positive psychology, for example, looks at how to help people become happier.
This lecture begins with a question: what makes a happy life?
Now, I'm going to give you one possible answer. A happy life is a life in which you are completely absorbed in what you do. Now, how does this compare with what you and your partner said? 
This answer comes from the work of Mihaly Csikszentmihalyi and the theory of flow. Csikszentmihalyi is a psychologist who has spent much of his professional life on the study of what makes people happy and how we can find happiness.
Csikszentmihalyi suggests the theory that happiness is not caused by external events or things that happen to us. Our perception of these things and how we see these events either makes us happy or sad. In other words, if we want happiness, we have to actively look for it. However, this does not mean that we should always look for happiness! Csikszentmihalyi believed that our happiest moments happen when we are in a state of flow.
The theory of flow can be summarised like this: when we are totally involved in, or focused on, what we are doing, we are in a state of flow.
Csikszentmihalyi got the inspiration for this theory when he noticed how artists worked in a studio. They completely lost track of time, they didn't notice they were hungry or tired, and they could work for hours, even days, without stopping. Anyone I have spoken to who has experienced this state of concentration has said it's difficult to explain. The best way to explain it is that it is like being in a river and the flow of the water carries you away.
For the rest of this lecture, I will explore this theory of flow in more detail. First we will look at Csikszentmihalyi's life, and how it influenced his ideas. Then we will look at the conditions that go with a state of flow. What creates flow, exactly? Finally, we will look at activities that can help us achieve flow in our everyday lives. Will this course make you happy for life? Well, maybe. Maybe. 
Right, let's get started. If you look at the next slide `,

      questions: [
        {
          id: 16,
          question: "What is positive psychology mainly about?",
          options: [
            "A. Studying mental illness",
            "B. Finding out what is wrong with people",
            "C. Helping people become happier",
            "D. Solving serious psychological problems"
          ],
          correct: 2,
          explanation: "Bi ging ni r: 'Positive psychology  looks at how to help people become happier.'  Tm l hc tch cc tp trung vo gip con ngi hnh phc hn."
        },
        {
          id: 17,
          question: "According to the lecture, when is a person happiest?",
          options: [
            "A. When they have a lot of money",
            "B. When they are doing nothing",
            "C. When they are completely focused on what they are doing",
            "D. When good things happen to them"
          ],
          correct: 2,
          explanation: "Ging vin ni: 'A happy life is a life in which you are completely absorbed in what you do.'  Hnh phc n khi tp trung hon ton vo vic ang lm."
        },
        {
          id: 18,
          question: "What does Csikszentmihalyi believe about happiness?",
          options: [
            "A. Happiness comes from external events",
            "B. Happiness depends on how we see and experience events",
            "C. Happiness can be achieved by always looking for it",
            "D. Happiness is impossible to control"
          ],
          correct: 1,
          explanation: "Bi ni: 'Happiness is not caused by external events Our perception of these things  makes us happy or sad.'  Hnh phc ph thuc vo cch chng ta nhn nhn s vic."
        },
        {
          id: 19,
          question: "Why did Csikszentmihalyi develop the theory of flow?",
          options: [
            "A. Because he studied people with depression",
            "B. Because he wanted to explain why people feel tired",
            "C. Because he observed how artists worked with deep concentration",
            "D. Because he believed happiness comes from rest"
          ],
          correct: 2,
          explanation: "Ging vin ni ng ly cm hng khi quan st ngh s lm vic trong studio: qun thi gian, khng thy i hay mt, lm vic rt lu  y chnh l trng thi flow."
        },
        {
          id: 20,
          question: "What will the lecture cover in the remaining time?",
          options: [
            "A. Only Csikszentmihalyi's life history",
            "B. Csikszentmihalyi's life, conditions of flow, and activities to achieve flow",
            "C. Only how to make money and become successful",
            "D. Only the history of psychology as a science"
          ],
          correct: 1,
          explanation: "Ging vin ni: 'First we will look at Csikszentmihalyi's life... Then we will look at the conditions... Finally, we will look at activities that can help us achieve flow.'  Ba phn chnh."
        }
      ]
    },

    // ==========================================
    // READING PART 5 - GRAMMAR/VOCABULARY
    // ==========================================
    part5: {
      title: "PART 5: Fill in the Blank (Grammar/Vocabulary)",
      description: "10 cu hi - Chn t/cm t ph hp  hon thnh cu.",
      type: "reading",
      questions: [
        {
          id: 21,
          question: "The company's new sustainability initiative has been widely _______ by environmental organizations worldwide.",
          options: [
            "A. Praised",
            "B. Praising",
            "C. Praise",
            "D. Praisingly"
          ],
          correct: 0,
          explanation: "Cu trc: 'has been + V3 (qu kh phn t)' cho th hin ti hon thnh b ng. 'Praised' l p n ng."
        },
        {
          id: 22,
          question: "The elderly residents at the nursing home benefit greatly from the _______ care provided by trained professionals.",
          options: [
            "A. Compassionate",
            "B. Compassion",
            "C. Compassionately",
            "D. Compassionate"
          ],
          correct: 0,
          explanation: "'Compassionate care' cn tnh t  m t danh t 'care'. 'Compassionate' (t nh, thng xt) l tnh t ph hp."
        },
        {
          id: 23,
          question: "_______ the challenging economic conditions, the startup has managed to maintain steady growth and profitability.",
          options: [
            "A. Despite",
            "B. Because",
            "C. Although",
            "D. However"
          ],
          correct: 0,
          explanation: "'Despite + noun' = 'mc d'. Sau 'despite' l danh t 'the challenging economic conditions'. 'Despite' l p n ng."
        },
        {
          id: 24,
          question: "The research team must _______ all data before publishing their findings in a peer-reviewed journal.",
          options: [
            "A. Verify",
            "B. Verification",
            "C. Verifying",
            "D. Verified"
          ],
          correct: 0,
          explanation: "'Must + V nguyn th' l cu trc th hin s cn thit. 'Verify' (xc minh) l ng t nguyn th ng."
        },
        {
          id: 25,
          question: "The marketing department is _______ responsible for promoting the new product line across all digital platforms.",
          options: [
            "A. Entire",
            "B. Entirely",
            "C. Entirety",
            "D. Entired"
          ],
          correct: 1,
          explanation: "Sau ng t 'is' cn trng t  b ngha cho tnh t 'responsible'. 'Entirely' (hon ton) l trng t ng."
        },
        {
          id: 26,
          question: "The building's architectural design is not only beautiful but also _______ to minimize energy consumption.",
          options: [
            "A. Efficient",
            "B. Efficiency",
            "C. Efficiently",
            "D. Inefficient"
          ],
          correct: 0,
          explanation: "Cu trc: 'not only... but also...' cn nhng t cng loi. Sau 'but also' cn tnh t 'efficient'  song song vi 'beautiful'."
        },
        {
          id: 27,
          question: "The contract was _______ by both parties because they could not reach an agreement on the final terms.",
          options: [
            "A. Terminate",
            "B. Terminating",
            "C. Terminated",
            "D. Termination"
          ],
          correct: 2,
          explanation: "'was + V3' l cu trc th qu kh n b ng. 'Terminated' (kt thc) l qu kh phn t ng."
        },
        {
          id: 28,
          question: "The consultant's _______ approach to problem-solving has earned him respect from colleagues and clients alike.",
          options: [
            "A. Creative",
            "B. Creativity",
            "C. Create",
            "D. Creatively"
          ],
          correct: 0,
          explanation: "'The consultant's _______ approach' cn tnh t  m t danh t 'approach'. 'Creative' (sng to) l tnh t ph hp."
        },
        {
          id: 29,
          question: "Environmental protection regulations now _______ all manufacturing companies to reduce their carbon footprint by 2030.",
          options: [
            "A. Required",
            "B. Require",
            "C. Requiring",
            "D. Requirement"
          ],
          correct: 1,
          explanation: "'now' l du hiu ca th hin ti n. 'Regulations require' - ch ng s nhiu nn dng 'require' (khng thm s)."
        },
        {
          id: 30,
          question: "The new employee orientation program provides comprehensive information about the company's policies and _______.",
          options: [
            "A. Procedure",
            "B. Procedures",
            "C. Procedural",
            "D. Procedurally"
          ],
          correct: 1,
          explanation: "'policies and _______' - cn danh t s nhiu  song song vi 'policies'. 'Procedures' (quy trnh) l p n ng."
        }
      ]
    },

    // ==========================================
    // READING PART 6 - CLOZE TEXT
    // ==========================================
    part6: {
      title: "PART 6: Cloze Text (Article)",
      description: "10 cu hi - in t/cm ph hp vo vn bn.",
      type: "reading",
      text: `REMOTE WORK: TRANSFORMING THE MODERN WORKPLACE

The rise of remote work has fundamentally changed how companies operate and how employees view their professional lives. Over the past few years, advances in technology have made it (31) _______ for workers to collaborate effectively from different locations. This shift has brought both benefits and challenges to organizations worldwide.

One of the primary advantages of remote work is increased flexibility. Employees can (32) _______ their schedules to accommodate personal responsibilities, which often leads to better work-life balance. Additionally, companies can (33) _______ on office space and related expenses. Many organizations have discovered that remote workers are just as productive, if not more so, than their office-based counterparts.

However, remote work also (34) _______ certain difficulties. The lack of face-to-face interaction can make it harder for new employees to (35) _______ with the company culture. Maintaining team cohesion and employee engagement requires deliberate effort and creative communication strategies. Moreover, some workers struggle with isolation and find it difficult to maintain clear (36) _______ between work and personal life.

To address these challenges, successful remote-first companies have (37) _______ regular virtual meetings and team-building activities. They also invest in collaboration tools and provide guidelines to (38) _______ that employees have a comfortable and productive workspace at home. Clear communication protocols are essential to (39) _______ misunderstandings and maintain transparency across distributed teams.

Looking forward, many industry experts predict that hybrid modelscombining remote and office workwill become the (40) _______ standard. This approach may offer the best of both worlds, allowing companies to retain top talent while maintaining the personal connections that foster creativity and innovation.`,

      questions: [
        {
          id: 31,
          question: "(31) - in t thch hp",
          options: [
            "A. Possible",
            "B. Impossible",
            "C. Challenging",
            "D. Difficult"
          ],
          correct: 0,
          explanation: "'it is _______ for workers to collaborate' - cn tnh t c  thch hp. 'Possible' (c th) ph hp nht."
        },
        {
          id: 32,
          question: "(32) - in t thch hp",
          options: [
            "A. Create",
            "B. Manage",
            "C. Organize",
            "D. Structure"
          ],
          correct: 1,
          explanation: "'Employees can _______ their schedules' - 'manage' (qun l) l ng t ph hp nht trong ng cnh."
        },
        {
          id: 33,
          question: "(33) - in t thch hp",
          options: [
            "A. Save",
            "B. Reduce",
            "C. Cut",
            "D. Lower"
          ],
          correct: 0,
          explanation: "'companies can _______ on office space' - 'save on' (tit kim) l cm ng t ph hp."
        },
        {
          id: 34,
          question: "(34) - in t thch hp",
          options: [
            "A. Presents",
            "B. Offers",
            "C. Creates",
            "D. Brings"
          ],
          correct: 2,
          explanation: "'remote work also _______ certain difficulties' - 'creates' (to ra) ph hp nht vi bi cnh vn ."
        },
        {
          id: 35,
          question: "(35) - in t thch hp",
          options: [
            "A. Integrate",
            "B. Connect",
            "C. Relate",
            "D. Adjust"
          ],
          correct: 0,
          explanation: "'new employees to _______ with the company culture' - 'integrate' (ha nhp) l ng t ph hp nht."
        },
        {
          id: 36,
          question: "(36) - in t thch hp",
          options: [
            "A. Boundaries",
            "B. Lines",
            "C. Limits",
            "D. Borders"
          ],
          correct: 0,
          explanation: "'maintain clear _______ between work and personal life' - 'boundaries' (ranh gii) l t ph hp nht."
        },
        {
          id: 37,
          question: "(37) - in t thch hp",
          options: [
            "A. Arranged",
            "B. Implemented",
            "C. Established",
            "D. Conducted"
          ],
          correct: 1,
          explanation: "'have _______ regular virtual meetings' - 'implemented' (trin khai) ph hp nht vi ng t 'have'."
        },
        {
          id: 38,
          question: "(38) - in t thch hp",
          options: [
            "A. Ensure",
            "B. Guarantee",
            "C. Promise",
            "D. Confirm"
          ],
          correct: 0,
          explanation: "'guidelines to _______ that employees have' - 'ensure' (m bo) ph hp vi cu trc 'to + V'."
        },
        {
          id: 39,
          question: "(39) - in t thch hp",
          options: [
            "A. Prevent",
            "B. Avoid",
            "C. Reduce",
            "D. Minimize"
          ],
          correct: 0,
          explanation: "'to _______ misunderstandings' - 'prevent' (ngn chn) l ng t ph hp nht."
        },
        {
          id: 40,
          question: "(40) - in t thch hp",
          options: [
            "A. Emerging",
            "B. Developing",
            "C. Dominant",
            "D. Preferred"
          ],
          correct: 2,
          explanation: "'become the _______ standard' - 'dominant' (chim u th) ph hp vi  ngha d on v xu hng tng lai."
        }
      ]
    },

    // ==========================================
    // READING PART 7 - MULTIPLE TEXTS
    // ==========================================
    part7: {
      title: "PART 7: Multiple Texts - Career Workshop Advertisement",
      description: "10 cu hi - c thng bo v email, chn p n tt nht.",
      type: "reading",
      text: `**CAREER ADVANCEMENT WORKSHOP**
Enhance Your Professional Growth with Expert Training

A professional career advancement workshop creates excellent opportunities for development. Our comprehensive program meets your specifications to advance essential skills within one business day!

SERVICES WE OFFER:

1. Professional Career Coaching  We have numerous experienced career coaches with expertise in resume building, interview preparation, and career strategy. Visit www.careercenter.com to hear success stories and choose the program that suits your needs.

2. Leadership Development  We also create professional leadership programs with practical modules to enhance management skills.

3. Customized Training  Our experienced instructors help you craft personalized learning experiences aligned with your career goals and business needs.

4. Networking Opportunities  For those seeking to expand professional networks, we offer services facilitating connections with industry leaders.

Date: Saturday, March 15, 2024
Time: 9:00 AM - 4:00 PM
Location: Innovation Center, 250 Business Avenue

To register, visit www.careercenter.com or call (555) 123-4567.

Cancellation Policy: Full refund available if cancelled before March 10. After March 10, no refunds will be issued.

---

To: register@careercenter.com
From: j.smith@techcompany.com
Date: March 1, 2024
Subject: Career Workshop Registration Request

Dear Career Center Team,

I found your advertisement online and wish to use your services for my technology company's professional development program. I am looking specifically for a comprehensive career advancement workshop for our management team, and I wonder if you would be available to conduct this for us, and how soon.

Since we work with both English and Spanish-speaking managers, I would like the workshop materials to be provided in both languages. Please reach out to me at my office phone between the hours of 9:00 A.M. and 5:00 P.M. PST. I hope to hear from you soon.

Thank you,
Jennifer Smith
Tech Innovations Inc.
(415) 555-7890 (office)
789 Silicon Road, San Francisco, CA 94105

From: David.Martinez@techsolutions.com
To: HR.Team@techsolutions.com
Date: February 28, 2024
Subject: Approved - Career Workshop Attendance

Dear Team,

I am writing to inform you that the company has approved funding for eligible employees to attend the Career Advancement Workshop on March 15. We believe this professional development opportunity will benefit our organization.

Interested employees should submit their names to the HR department by March 5 to secure a spot. The company will cover the registration fee for the first 10 approved participants. For employees beyond the first 10, the fee will be shared: company pays 50%, employee pays 50%.

Please note that attendance is not mandatory, but we highly encourage those seeking career growth to participate. Following the workshop, attendees will be asked to share key insights with their respective departments.

If you have any questions about the workshop details or the application process, please contact the HR department.

Best regards,
David Martinez
Chief Human Resources Officer`,

      questions: [
        {
          id: 41,
          question: "What is the primary purpose of the Career Advancement Workshop?",
          options: [
            "A. To introduce new company policies",
            "B. To help professionals advance their careers through skill development",
            "C. To recruit new employees for the company",
            "D. To test the leadership abilities of current staff"
          ],
          correct: 1,
          explanation: "Thng bo ni r: 'This comprehensive one-day workshop is designed for professionals seeking to advance their careers.'  Mc ch l gip chuyn gia pht trin s nghip."
        },
        {
          id: 42,
          question: "How much discount can early registrants receive?",
          options: [
            "A. $25",
            "B. $30",
            "C. $40",
            "D. $50"
          ],
          correct: 0,
          explanation: "Thng bo ni: 'Early bird discount: $50 until March 1' cho bit gi gc $75 - $50 = $25 discount."
        },
        {
          id: 43,
          question: "What is Margaret Chen's main qualification for instructing this workshop?",
          options: [
            "A. She is the director of the Innovation Center",
            "B. She has been a career coach for over 15 years",
            "C. She founded the Career Advancement Workshop",
            "D. She works at Tech Solutions company"
          ],
          correct: 1,
          explanation: "Thng bo ni: 'Instructor: Margaret Chen, Career Coach with 15+ years of experience.'  C y c 15+ nm kinh nghim lm career coach."
        },
        {
          id: 44,
          question: "According to David Martinez's email, what is the company's payment policy for workshop fees?",
          options: [
            "A. The company pays 100% for all employees",
            "B. The company pays 50% for all employees",
            "C. The company pays 100% for the first 10 employees, then 50% for additional employees",
            "D. Employees must pay 100% of their own fees"
          ],
          correct: 2,
          explanation: "Email ni: 'company will cover... for the first 10 approved participants. For employees beyond the first 10, the fee will be shared: company pays 50%, employee pays 50%.'  Cng ty tr ton b cho 10 ngi u, sau  chia i."
        },
        {
          id: 45,
          question: "What is the deadline for employees to submit their names for company-funded attendance?",
          options: [
            "A. March 1",
            "B. March 5",
            "C. March 10",
            "D. March 15"
          ],
          correct: 1,
          explanation: "Email ni: 'Interested employees should submit their names to the HR department by March 5 to secure a spot.'  Hn cht l 5 thng 3."
        },
        {
          id: 46,
          question: "What will participants do after the workshop?",
          options: [
            "A. They will receive a certificate of completion",
            "B. They will be asked to share key insights with their departments",
            "C. They will take a final examination",
            "D. They will attend a follow-up session"
          ],
          correct: 1,
          explanation: "Email ni: 'attendees will be asked to share key insights with their respective departments.'  H s c yu cu chia s nhng hiu bit quan trng."
        },
        {
          id: 47,
          question: "According to the workshop advertisement, what is the maximum number of participants?",
          options: [
            "A. 10",
            "B. 25",
            "C. 50",
            "D. 75"
          ],
          correct: 2,
          explanation: "Thng bo ni: 'Maximum Capacity: 50 participants.'  Sc cha ti a l 50 ngi."
        },
        {
          id: 48,
          question: "What happens if someone cancels their registration after March 10?",
          options: [
            "A. They receive a full refund",
            "B. They receive a 50% refund",
            "C. They receive no refund",
            "D. They can attend a different workshop instead"
          ],
          correct: 2,
          explanation: "Thng bo ni: 'After March 10, no refunds will be issued.'  Sau 10 thng 3, khng hon li tin."
        },
        {
          id: 49,
          question: "Is workshop attendance mandatory for Tech Solutions employees?",
          options: [
            "A. Yes, all employees must attend",
            "B. Yes, only if they want a promotion",
            "C. No, attendance is optional but encouraged",
            "D. No, only management needs to attend"
          ],
          correct: 2,
          explanation: "Email ni: 'Attendance is not mandatory, but we highly encourage those seeking career growth to participate.'  Khng bt buc nhng c khuyn khch."
        },
        {
          id: 50,
          question: "How can interested individuals register for the workshop?",
          options: [
            "A. Only by calling the HR department",
            "B. Only through the company's internal system",
            "C. By visiting the website or calling the phone number provided",
            "D. By sending an email to Margaret Chen"
          ],
          correct: 2,
          explanation: "Thng bo ni: 'To register, visit www.careercenter.com or call (555) 123-4567.'  C th ng k qua website hoc gi in."
        }
      ]
    },

    // ==========================================
    // READING PART 8 - TEXT MESSAGE CONVERSATION
    // ==========================================
    part8: {
      title: "PART 8: Instant Message Conversation",
      description: "10 cu hi - c cuc tr chuyn nhn tin, chn p n tt nht.",
      type: "reading",
     text: `SARAH T (2:15): Hi James! How's the project coming along?

JAMES (2:18): Hi Sarah! It's progressing well, but I hit a major obstacle yesterday. The client suddenly requested significant changes to the design.

SARAH T (2:19): Oh no! What kind of changes?

JAMES (2:22): They want to completely revamp the color scheme and add several new features that weren't in the original plan. I estimate these changes will require at least two more weeks of work.

SARAH T (2:23): That's frustrating. Have you informed the project manager yet?

JAMES (2:25): Not yet. I wanted to calculate the exact time and cost implications first. I'm planning to meet with Marcus tomorrow morning to discuss everything.

SARAH T (2:26): Smart thinking. Marcus will need to know the financial impact before deciding whether to proceed.

JAMES (2:30): Exactly. I'm also preparing documentation of the requested changes so we have everything in writing. I don't want any miscommunication later.

SARAH T (2:32): That's a good precaution. Are you going to recommend that the client stick with the original plan, or are you open to negotiating?

JAMES (2:35): I think some of their requests are actually good improvements, especially the design changes. However, the new features seem unnecessary and would blow up our budget. I'll suggest we implement the design changes but defer the feature additions until a future phase.

SARAH T (2:37): That sounds like a reasonable compromise. I hope Marcus agrees with your approach.

JAMES (2:40): Thanks for the support, Sarah. I'll let you know how the meeting goes tomorrow.

SARAH T (2:41): Looking forward to it. Good luck!`,

      questions: [
        {
          id: 51,
          question: "What is the main problem James is facing with the project?",
          options: [
            "A. The project is behind schedule",
            "B. The client requested significant design changes and new features",
            "C. He doesn't have enough team members",
            "D. The budget has been reduced"
          ],
          correct: 1,
          explanation: "James ni: 'The client suddenly requested significant changes to the design' v 'add several new features'  Vn  chnh l yu cu thay i t khch hng."
        },
        {
          id: 52,
          question: "How much additional time does James estimate for the required changes?",
          options: [
            "A. One week",
            "B. Two weeks",
            "C. At least two weeks",
            "D. One month"
          ],
          correct: 2,
          explanation: "James ni: 'I estimate these changes will require at least two more weeks of work.'  c tnh t nht 2 tun thm."
        },
        {
          id: 53,
          question: "Why hasn't James informed the project manager yet?",
          options: [
            "A. He forgot to contact him",
            "B. He wanted to wait until the project was complete",
            "C. He wanted to calculate time and cost implications first",
            "D. He was planning to inform him next week"
          ],
          correct: 2,
          explanation: "James ni: 'I wanted to calculate the exact time and cost implications first.'  Anh mun tnh ton r rng trc khi bo co."
        },
        {
          id: 54,
          question: "What is James preparing to bring to his meeting with Marcus?",
          options: [
            "A. A cost estimate only",
            "B. A new design proposal",
            "C. Documentation of the requested changes in writing",
            "D. A recommendation to reject all client requests"
          ],
          correct: 2,
          explanation: "James ni: 'I'm also preparing documentation of the requested changes so we have everything in writing.'  Anh chun b ti liu ghi chp tt c yu cu."
        },
        {
          id: 55,
          question: "What is James's stance on the client's requested design changes?",
          options: [
            "A. He thinks they are all unnecessary",
            "B. He thinks some of them are good improvements",
            "C. He thinks they will definitely exceed the budget",
            "D. He wants to reject them completely"
          ],
          correct: 1,
          explanation: "James ni: 'some of their requests are actually good improvements, especially the design changes.'  Anh ngh mt s yu cu l nhng ci tin tt."
        },
        {
          id: 56,
          question: "What does James want to do about the new features the client requested?",
          options: [
            "A. Implement them immediately",
            "B. Reject them completely",
            "C. Defer them until a future phase",
            "D. Double the budget to accommodate them"
          ],
          correct: 2,
          explanation: "James ni: 'I'll suggest we implement the design changes but defer the feature additions until a future phase.'  Anh s  ngh tr hon tnh nng mi."
        },
        {
          id: 57,
          question: "Why does James think the new features are problematic?",
          options: [
            "A. They are too complicated to implement",
            "B. They would exceed the budget",
            "C. The client doesn't really need them",
            "D. They conflict with the current design"
          ],
          correct: 1,
          explanation: "James ni: 'the new features seem unnecessary and would blow up our budget.'  Tnh nng mi s vt qu ngn sch."
        },
        {
          id: 58,
          question: "What does Sarah appreciate about James's approach?",
          options: [
            "A. That he's working quickly to complete the project",
            "B. That he's documenting the changes and considering financial implications",
            "C. That he's rejecting all client requests",
            "D. That he's not bothering Marcus with the details"
          ],
          correct: 1,
          explanation: "Sarah ni: 'Smart thinking... That's a good precaution... That sounds like a reasonable compromise.'  C y nh gi cao cch tip cn suy tnh ca James."
        },
        {
          id: 59,
          question: "What does Sarah believe Marcus will need to know before making a decision?",
          options: [
            "A. The client's identity",
            "B. The financial impact of the requested changes",
            "C. The original project timeline",
            "D. James's personal opinion"
          ],
          correct: 1,
          explanation: "Sarah ni: 'Marcus will need to know the financial impact before deciding whether to proceed.'  Marcus cn bit nh hng ti chnh."
        },
        {
          id: 60,
          question: "When is James planning to meet with Marcus?",
          options: [
            "A. Later today",
            "B. Tomorrow morning",
            "C. Next week",
            "D. After the project is completed"
          ],
          correct: 1,
          explanation: "James ni: 'I'm planning to meet with Marcus tomorrow morning to discuss everything.'  Cuc hp d kin vo sng mai."
        }
      ]
    }
  }
};

export default EXAM2_DATA;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ======================================================= */
/*  SCROLLBAR STYLING - Optimized */
/* ======================================================= */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.7);
  border-radius: 12px;
  border: 1px solid rgba(249, 115, 22, 0.05);
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #fb923c 0%, #f59e0b 100%);
  border-radius: 12px;
  border: 3px solid transparent;
  background-clip: padding-box;
  transition: background 0.3s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, #ea580c 0%, #d97706 100%);
  box-shadow: 0 0 10px rgba(234, 88, 12, 0.5);
}

/* Firefox scrollbar */
* {
  scrollbar-color: #f59e0b rgba(255, 255, 255, 0.7);
  scrollbar-width: thin;
}

/* Thin scrollbar variant */
.scrollbar-thin::-webkit-scrollbar {
  width: 8px;
}

.scrollbar-thin::-webkit-scrollbar-track {
  background: rgba(243, 244, 246, 0.5);
  border-radius: 10px;
}

.scrollbar-thin::-webkit-scrollbar-thumb {
  background: linear-gradient(to bottom, #f97316, #facc15);
  border-radius: 10px;
}

.scrollbar-thin::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(to bottom, #ea580c, #d97706);
}

/* ======================================================= */
/*  GLOBAL BASE STYLES */
/* ======================================================= */
html {
  scroll-behavior: smooth;
  @apply font-sans;
  font-size: clamp(13px, 2vw, 16px);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  @apply antialiased text-gray-800 box-border;
  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 50%, #fde68a 100%);
  min-height: 100vh;
  margin: 0;
  padding: 0;
  width: 100%;
  overflow-x: hidden;
  position: relative;
}

/*  Optimized background - Removed animation */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    radial-gradient(circle at 10% 80%, rgba(254, 215, 170, 0.3) 0%, transparent 60%),
    radial-gradient(circle at 90% 20%, rgba(255, 243, 220, 0.4) 0%, transparent 60%),
    radial-gradient(circle at 50% 50%, rgba(249, 115, 22, 0.03) 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
  opacity: 0.8;
}

/* ======================================================= */
/*  TEXT SELECTION */
/* ======================================================= */
::selection {
  @apply bg-orange-300/60 text-orange-900;
}

::-moz-selection {
  @apply bg-orange-300/60 text-orange-900;
}

/* ======================================================= */
/*  HEADINGS */
/* ======================================================= */
h1, h2, h3, h4 {
  overflow-wrap: break-word;
}

h1 {
  font-size: clamp(1.5rem, 5vw, 3rem);
  @apply font-extrabold text-center mb-3 sm:mb-4 tracking-tighter;
  line-height: 1.2;
}

h2 {
  font-size: clamp(1.25rem, 4vw, 2rem);
  @apply font-extrabold text-gray-900 tracking-tight;
}

h3 {
  font-size: clamp(1rem, 3.5vw, 1.5rem);
  @apply font-bold text-gray-900 tracking-tight;
}

h4 {
  font-size: clamp(0.875rem, 2.5vw, 1.125rem);
  @apply font-semibold text-gray-900;
}

/* ======================================================= */
/*  CUSTOM COMPONENTS */
/* ======================================================= */
@layer components {
  /* Main App Container */
  .app {
    @apply min-h-screen relative z-10 overflow-x-hidden;
    padding: max(0.75rem, clamp(0.75rem, 3vw, 1.25rem));
    width: 100%;
  }

  /*  Main Container - Optimized shadow and transitions */
  .container {
    @apply max-w-6xl w-full mx-auto relative overflow-hidden rounded-3xl bg-white/95 backdrop-blur-xl shadow-lg border;
    padding: max(1.5rem, 2rem);
    border-color: rgba(254, 215, 170, 0.5);
    box-shadow:
      0 20px 40px rgba(249, 115, 22, 0.15),
      inset 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: box-shadow 0.3s ease, transform 0.3s ease;
  }

  .container:hover {
    box-shadow:
      0 25px 50px rgba(249, 115, 22, 0.2),
      inset 0 1px 2px rgba(0, 0, 0, 0.05);
    transform: translateY(-2px);
  }

  /*  Container top border - Simplified */
  .container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #f97316 0%, #facc15 50%, #f97316 100%);
    border-radius: 30px 30px 0 0;
  }

  /* Utility Classes */
  .subtitle {
    @apply text-center text-gray-600 mb-8 sm:mb-12 font-medium leading-relaxed;
    font-size: clamp(0.875rem, 2.5vw, 1.125rem);
  }

  .section-title {
    font-size: clamp(1.25rem, 3.5vw, 1.75rem);
    @apply text-gray-900 mb-4 sm:mb-6 pb-2 sm:pb-3 font-extrabold tracking-tight border-b-2;
    border-image: linear-gradient(90deg, #ea580c, #f97316, #facc15) 1;
    transition: color 0.3s ease;
  }

  /*  Buttons - Consolidated */
  .btn-primary {
    @apply px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-orange-600 to-amber-500 text-white rounded-xl font-extrabold uppercase tracking-wider cursor-pointer shadow-lg border-b-4 border-orange-800 transition-all duration-200 active:shadow-md active:border-b-2 active:translate-y-0.5;
    min-height: 44px;
    font-size: clamp(0.7rem, 1.5vw, 0.875rem);
  }

  .btn-primary:hover {
    @apply -translate-y-1 shadow-xl;
  }

  .btn-secondary {
    @apply px-4 sm:px-6 py-2.5 sm:py-3 bg-gray-700 text-white rounded-xl font-bold cursor-pointer shadow-lg border-b-4 border-gray-900 transition-all duration-200 active:border-b-2 active:translate-y-0.5;
    min-height: 44px;
    font-size: clamp(0.7rem, 1.5vw, 0.875rem);
  }

  .btn-secondary:hover {
    @apply bg-gray-800 shadow-xl -translate-y-0.5;
  }

  /*  Play Button - Optimized */
  .btn-play {
    @apply bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-full font-bold cursor-pointer relative overflow-hidden inline-flex items-center justify-center transition-all duration-200;
    min-height: 44px;
    padding: clamp(0.65rem, 1.5vw, 0.875rem);
    font-size: clamp(0.8rem, 2vw, 1rem);
    box-shadow: 0 6px 16px rgba(249, 115, 22, 0.3);
  }

  .btn-play::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.4);
    transform: translate(-50%, -50%);
    transition: width 0.6s ease-out, height 0.6s ease-out;
  }

  .btn-play:hover::before {
    width: 300px;
    height: 300px;
  }

  .btn-play:hover {
    @apply -translate-y-0.5;
    box-shadow: 0 8px 24px rgba(249, 115, 22, 0.45);
  }

  /* Cards */
  .premium-card {
    @apply bg-white rounded-3xl p-4 sm:p-8 shadow-lg border border-orange-200 transition-all duration-300 hover:border-orange-400 hover:shadow-xl hover:-translate-y-2;
  }

  .premium-card:hover {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 250, 235, 0.85));
  }

  /*  Badges - Consolidated */
  .badge-orange, .badge-success {
    @apply inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full font-bold border transition-all duration-200;
    font-size: clamp(0.65rem, 1.2vw, 0.8rem);
  }

  .badge-orange {
    @apply bg-gradient-to-r from-orange-100 to-amber-100 text-orange-900 border-orange-300;
  }

  .badge-success {
    @apply bg-gradient-to-r from-green-100 to-emerald-100 text-green-900 border-green-300;
  }

  /* Status */
  .status {
    @apply text-center p-3 sm:p-6 rounded-2xl mb-4 sm:mb-6 font-bold border-2 backdrop-blur-xl tracking-tight;
    font-size: clamp(0.9rem, 2vw, 1.125rem);
    transition: all 0.3s ease;
  }

  .status.playing {
    @apply bg-gradient-to-r from-green-100 to-emerald-100 text-green-900 border-emerald-400;
    box-shadow: 0 2px 12px rgba(16, 185, 129, 0.2);
    animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  .status.paused {
    @apply bg-gradient-to-r from-amber-100 to-yellow-100 text-amber-900 border-amber-400;
    box-shadow: 0 2px 12px rgba(217, 119, 6, 0.15);
  }

  .status.stopped {
    @apply bg-gradient-to-r from-red-100 to-rose-100 text-red-900 border-rose-400;
    box-shadow: 0 2px 12px rgba(220, 38, 38, 0.15);
  }

  /* Progress Bar */
  .progress-bar {
    @apply w-full h-4 bg-gradient-to-r from-orange-100 to-amber-100 rounded-full overflow-hidden mb-4 sm:mb-6 shadow-inner border border-orange-200;
  }

  .progress {
    @apply h-full transition-all duration-500;
    background: linear-gradient(90deg, #f97316 0%, #eab308 50%, #f97316 100%);
    background-size: 200% 100%;
    animation: progressShine 4s linear infinite;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  /* Info Box */
  .info-box {
    @apply rounded-3xl p-4 sm:p-8 mb-6 sm:mb-8 relative overflow-hidden border-l-[6px] border-orange-500 bg-gradient-to-br from-orange-50 to-amber-50 shadow-md;
  }

  .info-box h3 {
    @apply text-orange-900 mb-2 sm:mb-3 relative z-10 font-bold;
    font-size: clamp(0.95rem, 2.5vw, 1.25rem);
  }

  .info-box.warning {
    @apply border-l-amber-500 bg-gradient-to-r from-amber-50 to-yellow-50;
  }

  .info-box.warning h3 {
    @apply text-amber-900;
  }

  .info-box ul {
    @apply ml-6 text-gray-800 leading-7 sm:leading-8 relative z-10 font-medium;
    font-size: clamp(0.825rem, 2vw, 1rem);
  }

  .info-box li {
    @apply mb-2;
  }

  .info-box::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 150px;
    height: 150px;
    background: radial-gradient(circle, rgba(249, 115, 22, 0.1), transparent);
    border-radius: 50%;
  }

  /* Questions */
  .questions-container {
    @apply bg-gradient-to-br from-orange-50 to-amber-50 p-4 sm:p-8 rounded-2xl mb-4 sm:mb-6 border-2 border-orange-200 shadow-md;
  }

  .question-item {
    @apply bg-white p-4 sm:p-7 rounded-2xl mb-4 sm:mb-6 shadow-lg border-2 border-orange-100 transition-all duration-200 cursor-pointer hover:shadow-xl hover:border-orange-400 hover:-translate-y-1;
  }

  .question-item h4 {
    @apply text-gray-900 mb-3 sm:mb-5 leading-relaxed font-bold;
    font-size: clamp(0.95rem, 2.2vw, 1.125rem);
  }

  /* Options */
  .options {
    @apply flex flex-col gap-3;
  }

  .option {
    @apply flex items-start p-4 border-2 border-orange-200 rounded-2xl cursor-pointer transition-all duration-200 bg-gradient-to-r from-white to-orange-50 hover:from-orange-50 hover:to-yellow-50 hover:border-orange-400 hover:translate-x-1 hover:shadow-md;
  }

  .option input[type="radio"] {
    @apply mr-3 mt-0.5 cursor-pointer w-5 h-5 flex-shrink-0;
    accent-color: #f97316;
  }

  .option span {
    @apply flex-1 leading-7 text-gray-800 font-semibold;
    font-size: clamp(0.825rem, 1.8vw, 1rem);
  }

  .option input[type="radio"]:checked + span {
    @apply text-orange-700 font-bold;
  }

  /* Part Info */
  .part-info {
    @apply bg-gradient-to-r from-orange-50 to-amber-50 p-4 sm:p-7 rounded-2xl mt-3 sm:mt-5 border-l-[5px] border-orange-500 relative overflow-hidden shadow-md;
  }

  .part-info h3 {
    @apply text-orange-800 mb-3 relative z-10 font-bold;
    font-size: clamp(0.95rem, 2vw, 1.125rem);
  }

  .part-info p {
    @apply text-gray-800 leading-7 relative z-10 font-medium;
    font-size: clamp(0.825rem, 1.8vw, 1rem);
  }

  .part-info::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 180px;
    height: 180px;
    background: #f97316;
    border-radius: 50%;
    opacity: 0.06;
  }

  /* Question Navigation */
  .question-nav {
    @apply flex gap-3 flex-wrap justify-center;
  }

  .question-nav-btn {
    @apply px-6 py-3 border-2 border-orange-300 bg-white text-gray-800 rounded-2xl cursor-pointer font-bold transition-all duration-200 shadow-sm hover:bg-gradient-to-r hover:from-orange-400 hover:to-amber-400 hover:text-white hover:border-transparent hover:-translate-y-0.5 hover:shadow-lg;
    font-size: clamp(0.7rem, 1.5vw, 0.875rem);
    min-width: 40px;
    min-height: 40px;
  }

  .question-nav-btn.active {
    @apply bg-gradient-to-r from-orange-500 to-amber-500 text-white border-transparent -translate-y-0.5 shadow-lg;
    animation: glow 3s ease-in-out infinite;
  }

  /* Script Content */
  .script-content {
    @apply bg-gradient-to-br from-orange-50 to-amber-50 p-4 sm:p-7 rounded-2xl border-2 border-orange-200 overflow-y-auto leading-7 text-gray-900 shadow-inner font-medium;
    font-size: clamp(0.8rem, 2vw, 1rem);
    max-height: 50vh;
  }

  /* Results */
  .results {
    @apply bg-gradient-to-br from-orange-50 to-amber-50 p-4 sm:p-9 rounded-3xl shadow-2xl border border-orange-200;
  }

  .score-summary {
    @apply bg-white/95 p-4 sm:p-10 rounded-3xl text-center mb-6 sm:mb-10 shadow-2xl border-2 border-orange-300;
  }

  .score-summary h3 {
    font-size: clamp(2.5rem, 7vw, 4rem);
    @apply font-extrabold mb-4;
    background: linear-gradient(135deg, #f97316 0%, #eab308 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .score-summary p {
    @apply text-gray-700 mb-6 font-bold;
    font-size: clamp(0.95rem, 2.5vw, 1.375rem);
  }

  .score-bar {
    @apply w-full h-10 bg-gradient-to-r from-orange-100 to-amber-100 rounded-full overflow-hidden shadow-inner border border-orange-200;
  }

  .score-fill {
    @apply h-full transition-all flex items-center justify-center text-white font-black tracking-tight;
    font-size: clamp(0.7rem, 1.5vw, 0.875rem);
    animation: scoreShine 2s ease infinite;
    background: linear-gradient(90deg, #f97316 0%, #eab308 50%, #f97316 100%);
    background-size: 200% 100%;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  .answers-review {
    @apply bg-white p-4 sm:p-8 rounded-3xl mb-4 sm:mb-6 shadow-md border border-orange-200;
  }

  .answers-review h4 {
    @apply text-gray-900 mb-4 sm:mb-6 pb-3 font-bold;
    font-size: clamp(1.1rem, 2.5vw, 1.5rem);
    border-bottom: 2px solid;
    border-image: linear-gradient(90deg, #f97316, #eab308) 1;
  }

  /* Answer Item */
  .answer-item {
    @apply p-3 sm:p-6 rounded-2xl mb-3 sm:mb-4 border-l-[5px] transition-all duration-200 hover:translate-x-1.5 hover:shadow-xl cursor-pointer;
  }

  .answer-item.correct {
    @apply bg-gradient-to-r from-green-100 to-emerald-50 border-l-green-500;
  }

  .answer-item.incorrect {
    @apply bg-gradient-to-r from-red-100 to-rose-50 border-l-red-500;
  }

  .answer-item p {
    @apply mb-2 leading-8 font-medium text-gray-900;
    font-size: clamp(0.825rem, 1.8vw, 1rem);
  }

  .answer-item strong {
    @apply text-gray-900 font-bold;
  }

  .correct-answer {
    @apply text-green-700 font-bold;
    font-size: clamp(0.7rem, 1.2vw, 0.875rem);
  }

  /* Forms */
  .controls {
    @apply grid gap-6;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }

  .control-group {
    @apply flex flex-col gap-2;
  }

  label {
    @apply text-gray-800 font-bold tracking-tight;
    font-size: clamp(0.75rem, 1.5vw, 0.875rem);
  }

  select,
  input[type="range"],
  .part-select {
    @apply p-3 border-2 border-orange-300 rounded-2xl bg-white transition-all duration-200 font-semibold text-gray-800 shadow-sm w-full;
    font-size: clamp(0.825rem, 2vw, 1rem);
  }

  select:hover,
  input[type="range"]:hover,
  .part-select:hover {
    @apply border-orange-500 shadow-md -translate-y-0.5;
  }

  select:focus,
  .part-select:focus {
    @apply outline-none border-orange-600;
    box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.25);
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    @apply w-6 h-6 bg-white rounded-full border-4 border-orange-500 cursor-pointer transition-all duration-200;
    box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    @apply scale-110;
    box-shadow: 0 4px 16px rgba(249, 115, 22, 0.4);
  }

  input[type="range"]::-moz-range-thumb {
    @apply w-6 h-6 bg-white rounded-full border-4 border-orange-500 cursor-pointer;
    box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
  }

  /* Button Group */
  .button-group {
    @apply gap-5 mb-4 sm:mb-6;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  }

  button {
    @apply p-4 border-none rounded-xl text-base font-extrabold cursor-pointer transition-all shadow-lg tracking-tight;
    min-height: 44px;
  }

  button:active {
    @apply shadow-md;
    transform: scale(0.98);
  }

  /* Responsive */
  @screen xl {
    .container {
      @apply max-w-7xl;
    }
  }

  @screen lg {
    .container {
      @apply max-w-5xl;
    }
  }

  @screen md {
    .controls {
      grid-template-columns: 1fr;
    }
  }
}

/* ======================================================= */
/*  KEYFRAME ANIMATIONS - Optimized */
/* ======================================================= */
@keyframes progressShine {
  0% { background-position: 0% 50%; }
  100% { background-position: 300% 50%; }
}

@keyframes scoreShine {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 150% 50%; }
}

@keyframes glow {
  0%, 100% {
    box-shadow: 0 0 12px rgba(255, 165, 0, 0.5), 0 0 20px rgba(249, 115, 22, 0.3);
  }
  50% {
    box-shadow: 0 0 18px rgba(255, 165, 0, 0.7), 0 0 35px rgba(249, 115, 22, 0.5);
  }
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.9;
    transform: scale(1.01);
  }
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px) rotate(0.1deg);
  }
  50% {
    transform: translateY(-4px) rotate(-0.1deg);
  }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* ======================================================= */
/*  UTILITY CLASSES */
/* ======================================================= */
@layer utilities {
  .tracking-tighter {
    letter-spacing: -0.8px;
  }

  .slide-in-up {
    animation: slideInUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
  }

  .fade-in-scale {
    animation: fadeInScale 0.7s ease-out both;
  }

  .animate-messageSlideIn {
    animation: messageSlideIn 0.4s ease-out;
  }

  .animate-slideIn {
    animation: slideIn 0.4s ease-out;
  }

  .animate-fadeIn {
    animation: fadeIn 0.4s ease-in-out;
  }
}

/* Thm vo index.css */
html {
  scroll-behavior: auto; /* Khng smooth-scroll */
}

body {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* B position: relative trn cc parent nu c */
}

* {
  /* Trnh s dng will-change qu nhiu */
}
</file>

<file path="src/main.jsx">
import React, { Suspense, StrictMode } from 'react';
import ReactDOM from 'react-dom/client';
import { LoadingSpinner } from './components/common/LoadingSpinner';
import './index.css';

//  Lazy load App and AuthProvider
const App = React.lazy(() => import('./App'));
const AuthProvider = React.lazy(() => 
  import('./contexts/AuthContext').then(module => ({ 
    default: module.AuthProvider 
  }))
);

//  Loading Fallback - Keep it simple and fast
const RootFallback = () => (
  <div className="flex items-center justify-center h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50">
    <LoadingSpinner />
  </div>
);

//  Root Component - Only wrap with StrictMode in dev
const Root = () => {
  const isDev = process.env.NODE_ENV === 'development';
  
  const content = (
    <Suspense fallback={<RootFallback />}>
      <AuthProvider>
        <App />
      </AuthProvider>
    </Suspense>
  );

  return isDev ? <StrictMode>{content}</StrictMode> : content;
};

//  Initialize React root with error handling
const rootElement = document.getElementById('root');

if (!rootElement) {
  throw new Error('Root element with id="root" not found in HTML');
}

const root = ReactDOM.createRoot(rootElement);
root.render(<Root />);

//  Web Vitals monitoring (Production only)
if (process.env.NODE_ENV === 'production') {
  // Report Web Vitals for monitoring
  import('web-vitals')
    .then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
      // Send to analytics (replace with your analytics service)
      getCLS(metric => console.log('CLS:', metric.value));
      getFID(metric => console.log('FID:', metric.value));
      getFCP(metric => console.log('FCP:', metric.value));
      getLCP(metric => console.log('LCP:', metric.value));
      getTTFB(metric => console.log('TTFB:', metric.value));
    })
    .catch(() => {
      // web-vitals not installed
    });

  //  Long Task monitoring - only in production
  if ('PerformanceObserver' in window) {
    try {
      const observer = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          // Log tasks longer than 50ms
          if (entry.duration > 50) {
            console.warn(`Long task detected: ${entry.duration.toFixed(2)}ms`, entry);
          }
        }
      });
      // Only observe 'longtask' in production
      observer.observe({ entryTypes: ['longtask'] });
    } catch (e) {
      // PerformanceObserver or longtask not supported
    }
  }

  //  Handle unhandled promise rejections
  window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
    // Send to error tracking service (e.g., Sentry)
  });

  //  Handle runtime errors
  window.addEventListener('error', (event) => {
    console.error('Runtime error:', event.error);
    // Send to error tracking service
  });
}
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    open: true,
    cors: true,
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    target: 'esnext',
    minify: 'terser',
    chunkSizeWarningLimit: 1000, // optional
    rollupOptions: {
      output: {
        manualChunks(id) {
          if (id.includes('firebase')) {
            return 'firebase'
          }
          if (id.includes('node_modules')) {
            return 'vendor'
          }
        }
      }
    }
  }
})
</file>

<file path="src/components/Display/ScriptDisplay.jsx">
import React, {
  useState,
  useMemo,
  useCallback,
  memo,
  useRef,
  useEffect,
} from 'react';
import {
  Play,
  Pause,
  Eye,
  EyeOff,
  Volume2,
  SkipBack,
  SkipForward,
  VolumeX,
  Volume1,
  AlertCircle,
} from 'lucide-react';
import { useAudioPlayer } from '../../hooks/useAudioPlayer';

/* ===================== CONSTANTS ===================== */
const ITEM_HEIGHT = 120;
const SKIP_SECONDS = 10;

/* ===================== VISUALIZER ===================== */
const Visualizer = memo(({ isPlaying }) => (
  <div className="flex items-end justify-center gap-1 h-20 bg-black/20 rounded-lg p-2 mb-6">
    {[...Array(16)].map((_, i) => (
      <div
        key={i}
        className="flex-1 bg-blue-500 rounded-full transition-all"
        style={{
          height: isPlaying ? `${25 + (i % 4) * 20}%` : '15%',
          opacity: isPlaying ? 0.6 : 0.3,
        }}
      />
    ))}
  </div>
));
Visualizer.displayName = 'Visualizer';

/* ===================== TRANSCRIPT LINE ===================== */
const Line = memo(({ line }) => {
  const parsed = useMemo(() => {
    const i = line.indexOf(':');
    return i > 0
      ? { name: line.slice(0, i).trim(), text: line.slice(i + 1).trim() }
      : { text: line };
  }, [line]);

  return (
    <div className="mb-4 p-4 bg-white/40 rounded-lg border border-slate-100">
      {parsed.name && (
        <div className="text-[10px] font-bold uppercase text-blue-600 mb-1">
          {parsed.name}
        </div>
      )}
      <p className="text-base leading-relaxed text-slate-700">
        {parsed.text}
      </p>
    </div>
  );
});
Line.displayName = 'Line';

/* ===================== VIRTUAL LIST ===================== */
const VirtualList = memo(({ lines }) => {
  const ref = useRef(null);
  const [range, setRange] = useState({ start: 0, end: 15 });

  useEffect(() => {
    const el = ref.current;
    if (!el) return;

    const onScroll = () => {
      const top = el.scrollTop;
      const start = Math.max(0, Math.floor(top / ITEM_HEIGHT) - 3);
      const end = Math.min(
        lines.length,
        Math.ceil((top + el.clientHeight) / ITEM_HEIGHT) + 3
      );
      setRange({ start, end });
    };

    el.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
    return () => el.removeEventListener('scroll', onScroll);
  }, [lines.length]);

  return (
    <div ref={ref} className="flex-1 overflow-y-auto px-6 py-6 custom-scrollbar">
      <div style={{ height: lines.length * ITEM_HEIGHT }}>
        <div style={{ transform: `translateY(${range.start * ITEM_HEIGHT}px)` }}>
          {lines.slice(range.start, range.end).map((l, i) => (
            <Line key={range.start + i} line={l} />
          ))}
        </div>
      </div>
    </div>
  );
});
VirtualList.displayName = 'VirtualList';

/* ===================== MAIN COMPONENT ===================== */
const ScriptDisplay = ({
  script,
  audioUrl,
  partTitle,
  isPartPlayed,
  onAudioStart,
  onAudioEnd,
}) => {
  const audio = useAudioPlayer(audioUrl);
  const [show, setShow] = useState(false);
  const [volShow, setVolShow] = useState(false);

  /* ========= AUDIO STATE SYNC ========= */
  const prevPlayingRef = useRef(false);
  const endedRef = useRef(false);

  //  Pht hin bt u pht
  useEffect(() => {
    if (audio.isPlaying && !prevPlayingRef.current) {
      onAudioStart?.();
      endedRef.current = false;
    }
    prevPlayingRef.current = audio.isPlaying;
  }, [audio.isPlaying, onAudioStart]);

  //  Pht hin kt thc (SA LI NT NEXT B DISABLE)
  useEffect(() => {
    // S dng sai s nh (0.3s)  m bo trigger c onAudioEnd trn mi trnh duyt
    const isFinished = audio.duration > 0 && (audio.duration - audio.currentTime) < 0.3;

    if (isFinished && !endedRef.current) {
      endedRef.current = true;
      console.log(" Audio finished, calling onAudioEnd");
      onAudioEnd?.();
    }
  }, [audio.currentTime, audio.duration, onAudioEnd]);

  /* ========= MEMO ========= */
  const lines = useMemo(
    () => script.split('\n').filter(Boolean),
    [script]
  );
  
  const prog = useMemo(
    () => (audio.duration > 0 ? (audio.currentTime / audio.duration) * 100 : 0),
    [audio.currentTime, audio.duration]
  );

  const VolIcon = useMemo(
    () => (audio.volume === 0 ? VolumeX : audio.volume < 0.5 ? Volume1 : Volume2),
    [audio.volume]
  );

  /* ========= CONTROLS ========= */
  const toggle = useCallback(() => {
    audio.isPlaying ? audio.pause() : audio.play();
  }, [audio]);

  const fwd = useCallback(() => {
    if (!audio.duration) return;
    audio.seek(Math.min(audio.currentTime + SKIP_SECONDS, audio.duration));
  }, [audio]);

  const bwd = useCallback(() => {
    audio.seek(Math.max(audio.currentTime - SKIP_SECONDS, 0));
  }, [audio]);

  // FIX: Thm hm thiu gy crash
  const toggleVolSlider = useCallback(() => {
    setVolShow((prev) => !prev);
  }, []);

  const progClick = useCallback(
    (e) => {
      if (!audio.duration) return;
      const r = e.currentTarget.getBoundingClientRect();
      const pct = (e.clientX - r.left) / r.width;
      audio.seek(Math.max(0, Math.min(1, pct)) * audio.duration);
    },
    [audio]
  );

  return (
    <div className="min-h-screen bg-slate-50 p-4 sm:p-6">
      <div className="max-w-7xl mx-auto">
        
        {/* Header */}
        <div className="mb-4 flex items-center justify-between">
          <div className="text-sm text-slate-600">
            <span className="font-semibold text-slate-900">{partTitle}</span>
            {isPartPlayed && (
              <span className="ml-2 text-xs font-bold text-emerald-600"> Completed</span>
            )}
          </div>
          <div className="px-3 py-1 bg-white rounded-full text-sm font-semibold text-slate-700 border border-slate-200">
            {Math.round(prog)}%
          </div>
        </div>

        {audio.error && (
          <div className="mb-3 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm flex items-center gap-2">
            <AlertCircle className="w-4 h-4 flex-shrink-0" />
            {audio.error}
          </div>
        )}

        <div className="bg-white rounded-xl shadow-lg overflow-hidden border border-slate-200">
          <div className="grid lg:grid-cols-[320px_1fr]">
            
            {/* LEFT PANEL */}
            <div className="bg-slate-900 p-6 flex flex-col">
              <div className="mb-auto">
                <h1 className="text-2xl font-bold text-white mb-2">{partTitle}</h1>
                <p className="text-slate-400 text-sm mb-6">Listening Practice</p>

                <div className="grid grid-cols-2 gap-2 mb-6">
                  <div className="bg-white/5 rounded-lg p-3 border border-white/10">
                    <div className="text-[9px] font-semibold uppercase text-slate-400 mb-1">Duration</div>
                    <p className="text-base font-bold text-white">{audio.formatTime(audio.duration)}</p>
                  </div>
                  <div className="bg-white/5 rounded-lg p-3 border border-white/10">
                    <div className="text-[9px] font-semibold uppercase text-slate-400 mb-1">Lines</div>
                    <p className="text-base font-bold text-white">{lines.length}</p>
                  </div>
                </div>
              </div>

              <Visualizer isPlaying={audio.isPlaying} />

              {/* Progress Bar */}
              <div className="mb-3">
                <div 
                  className="h-1.5 bg-white/10 rounded-full overflow-hidden cursor-pointer hover:bg-white/20 transition-colors"
                  onClick={progClick}
                >
                  <div className="h-full bg-blue-500 transition-all" style={{ width: `${prog}%` }} />
                </div>
                <div className="flex justify-between text-[10px] font-medium text-slate-400 mt-1">
                  <span>{audio.formatTime(audio.currentTime)}</span>
                  <span>{audio.formatTime(audio.duration)}</span>
                </div>
              </div>

              <button 
                onClick={toggle}
                disabled={audio.isLoading}
                className="w-full py-4 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 rounded-lg flex items-center justify-center gap-2 mb-3 transition-colors"
              >
                {audio.isLoading ? (
                  <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                ) : audio.isPlaying ? (
                  <Pause size={18} fill="white" className="text-white" />
                ) : (
                  <Play size={18} fill="white" className="text-white" />
                )}
                <span className="font-bold text-white text-sm">
                  {audio.isLoading ? 'Loading...' : audio.isPlaying ? 'Pause' : 'Play'}
                </span>
              </button>
              
              <div className="grid grid-cols-3 gap-2">
                <button 
                  onClick={bwd}
                  disabled={!audio.duration}
                  className="aspect-square rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center transition-colors"
                >
                  <SkipBack size={16} className="text-white" />
                </button>
                
                <div className="relative">
                  <button 
                    onClick={toggleVolSlider}
                    className="w-full aspect-square rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center"
                  >
                    <VolIcon size={16} className="text-white" />
                  </button>

                  {volShow && (
                    <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 p-3 bg-slate-800 rounded-lg border border-white/20 z-50">
                      <input
                        type="range"
                        min="0"
                        max="1"
                        step="0.01"
                        value={audio.volume}
                        onChange={(e) => audio.setVolume(parseFloat(e.target.value))}
                        className="w-16 h-1 accent-blue-500"
                        style={{ height: '50px', WebkitAppearance: 'slider-vertical' }}
                      />
                    </div>
                  )}
                </div>
                
                <button 
                  onClick={fwd}
                  disabled={!audio.duration}
                  className="aspect-square rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center"
                >
                  <SkipForward size={16} className="text-white" />
                </button>
              </div>
            </div>

            {/* RIGHT PANEL */}
            <div className="flex flex-col max-h-[800px] bg-slate-50">
              <div className="bg-white border-b border-slate-200 px-6 py-3 flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <div className={`w-2 h-2 rounded-full ${audio.isPlaying ? 'bg-emerald-500' : 'bg-slate-300'}`} />
                  <h3 className="font-bold text-slate-800 text-sm">Transcript</h3>
                </div>
                <button 
                  onClick={() => setShow(!show)}
                  className="flex items-center gap-1.5 px-3 py-1.5 text-xs font-semibold text-slate-600 bg-slate-100 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors"
                >
                  {show ? <EyeOff size={14} /> : <Eye size={14} />}
                  {show ? 'Hide' : 'Show'}
                </button>
              </div>

              {show ? (
                <VirtualList lines={lines} />
              ) : (
                <div className="flex-1 flex items-center justify-center p-10">
                  <div className="text-center">
                    <div className="p-6 bg-slate-200 rounded-xl mb-3 inline-block">
                      <Play 
                        size={40} 
                        fill="currentColor" 
                        className={audio.isPlaying ? 'text-blue-500' : 'text-slate-400'} 
                      />
                    </div>
                    <h3 className="text-lg font-bold text-slate-700 mb-1">Focus Mode</h3>
                    <p className="text-slate-500 text-sm">
                      {audio.isPlaying ? 'Listen carefully - transcript hidden' : 'Press play to start practice'}
                    </p>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>

      <style>{`
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      `}</style>
    </div>
  );
};

ScriptDisplay.displayName = 'ScriptDisplay';

export default memo(ScriptDisplay);
</file>

<file path="Backend/firebase-config.js">
// backend/firebase-config.js
import admin from 'firebase-admin';
import dotenv from 'dotenv';

dotenv.config();

let db;
let isFirebaseEnabled = false;

try {
  const firebaseEnv = process.env.FIREBASE_SERVICE_ACCOUNT;
  
  if (!firebaseEnv) {
    throw new Error('FIREBASE_SERVICE_ACCOUNT not provided');
  }
  
  let serviceAccount;
  
  // Parse JSON t environment variable
  if (typeof firebaseEnv === 'string') {
    serviceAccount = JSON.parse(firebaseEnv);
  } else {
    serviceAccount = firebaseEnv;
  }
  
  // Validate credentials
  if (!serviceAccount.project_id || !serviceAccount.private_key) {
    throw new Error('Missing required Firebase credentials');
  }
  
  // Initialize Firebase Admin
  if (!admin.apps.length) {
    admin.initializeApp({
      credential: admin.credential.cert(serviceAccount),
    });
  }
  
  db = admin.firestore();
  isFirebaseEnabled = true;
  
  console.log(' Firebase Admin initialized:', serviceAccount.project_id);
  
} catch (error) {
  console.warn(' Firebase initialization failed:', error.message);
  console.warn(' Using mock Firestore storage (development mode)');
  
  // Mock Firestore object for development/testing
  db = {
    collection: (name) => ({
      doc: (id) => ({
        set: async (data) => {
          console.log(` [Mock] Set ${name}/${id}:`, JSON.stringify(data).substring(0, 50));
          return Promise.resolve();
        },
        delete: async () => {
          console.log(` [Mock] Delete ${name}/${id}`);
          return Promise.resolve();
        },
        get: async () => ({ exists: false, data: () => null }),
      }),
      where: (field, op, value) => ({
        get: async () => {
          console.log(` [Mock] Query ${name} where ${field} ${op} ${value}`);
          return Promise.resolve({ docs: [] });
        },
      }),
      orderBy: (field, direction = 'asc') => ({
        limit: (n) => ({
          get: async () => {
            console.log(` [Mock] Get ${n} docs from ${name} ordered by ${field}`);
            return Promise.resolve({ docs: [] });
          },
        }),
        get: async () => {
          console.log(` [Mock] Get all docs from ${name} ordered by ${field}`);
          return Promise.resolve({ docs: [] });
        },
      }),
      get: async () => {
        console.log(` [Mock] Get all docs from ${name}`);
        return Promise.resolve({ docs: [] });
      },
      add: async (data) => {
        console.log(` [Mock] Add to ${name}:`, JSON.stringify(data).substring(0, 50));
        return Promise.resolve({ id: Date.now().toString() });
      },
    }),
    batch: () => ({
      set: (ref, data) => console.log(` [Mock Batch] Set`),
      delete: (ref) => console.log(` [Mock Batch] Delete`),
      commit: async () => {
        console.log(' [Mock Batch] Committed');
        return Promise.resolve();
      },
    }),
  };
  
  isFirebaseEnabled = false;
}

/**
 * Initialize Firestore with cleanup job
 */
export const initializeFirestore = async () => {
  if (isFirebaseEnabled) {
    console.log(' Firestore initialized with auto-cleanup');
    // Schedule cleanup every hour
    setInterval(cleanupOldMessages, 60 * 60 * 1000);
  } else {
    console.log(' Firestore mock mode - no auto-cleanup');
  }
};

/**
 * Auto-delete messages older than 24 hours
 */
export const cleanupOldMessages = async () => {
  if (!isFirebaseEnabled) {
    console.log(' [Mock] Auto-cleanup skipped');
    return;
  }
  
  try {
    const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);
    
    const snapshot = await db.collection('messages')
      .where('timestamp', '<', admin.firestore.Timestamp.fromDate(twentyFourHoursAgo))
      .get();

    if (snapshot.docs.length > 0) {
      const batch = db.batch();
      
      snapshot.docs.forEach((doc) => {
        batch.delete(doc.ref);
      });
      
      await batch.commit();
      console.log(` Cleaned up ${snapshot.docs.length} old messages`);
    }
  } catch (error) {
    console.error(' Error cleaning up messages:', error.message);
  }
};

export { isFirebaseEnabled };
export { db };
export default db;
</file>

<file path="src/components/FullExam/FullExamMode.jsx">
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useUserProgress } from '../../hooks/useUserProgress';

// ===== IMPORTS: Constants =====
import { COLORS } from './constants/colors';
import { EXAM_STRUCTURE, EXAM_MODES, EXAM_SECTIONS } from './constants/examConfig';
import { EXAM_TIMINGS } from './constants/timings';
import { EXAM_MESSAGES } from './constants/messages';

// ===== IMPORTS: Utils =====
import { 
  formatTime, 
  calculateFullResults,
  countUnansweredQuestions,
  countTotalUnansweredQuestions,
  getCEFRLevel,
  getResultsByPart,
} from './utils/examHelpers';
import { generateAnswerKey } from './utils/answerKey';

// ===== IMPORTS: Hooks =====
import { useExamState } from './hooks/useExamState';
import { useExamTimer } from './hooks/useExamTimer';
import { useKeyboardShortcuts } from './hooks/useKeyboardShortcuts';
import { useNetworkStatus } from './hooks/useNetworkStatus';

// ===== IMPORTS: Components =====
import StepIndicator from './StepIndicator';
import { ExamSetup } from './components/ExamSetup/ExamSetup';
import { ExamScreen } from './components/ExamScreen/ExamScreen';
import { ResultsScreen } from './components/Results/ResultsScreen';
import { Timer } from './components/Header/Timer';
import { AutosaveIndicator } from './components/Header/AutosaveIndicator';
import { TimeWarning } from './components/Warnings/TimeWarning';
import { OfflineWarning } from './components/Warnings/OfflineWarning';
import { SubmitModal } from './components/Modals/SubmitModal';

// ===== IMPORTS: Data =====
import { getExamById } from '../../data/examData';

// ===== STORAGE KEY =====
const EXAM_DRAFT_KEY = 'exam-progress-draft';

/**
 * FullExamMode - Main Exam Component (REFACTORED)
 * 
 *  IMPROVEMENTS:
 * - 1000+ lines  300 lines (70% smaller)
 * - 18 useState  1 useReducer (organized state)
 * - 10+ useEffect  3-4 useEffect (clean logic)
 * - Logic isolated in hooks (reusable)
 * - Components separated (maintainable)
 * 
 * STRUCTURE:
 * 1. State Management (useExamState reducer)
 * 2. Side Effects (Timer, Keyboard, Auto-save)
 * 3. Handlers (Start, Answer, Submit)
 * 4. Computed Values (Results, Navigation)
 * 5. Render (Setup / Exam / Results)
 */
const FullExamMode = ({ onComplete }) => {
  // ===== EXTERNAL HOOKS =====
  const { saveProgress, currentUser, loading: progressLoading } = useUserProgress();
  const isOnline = useNetworkStatus().isOnline;

  // ===== STATE MANAGEMENT =====
  //  Instead of 18 useState, we use 1 reducer!
  const {
    state,
    setMode,
    setSection,
    setPart,
    setAnswers,
    addAnswer,
    setTimeLeft,
    tickTimer,
    pauseTimer,
    resumeTimer,
    setExamData,
    setExamId,
    markPartPlayed,
    reset: resetExam,
  } = useExamState();

  // ===== LOCAL UI STATE =====
  // Only UI-specific state that doesn't affect exam logic
  const [showWarning, setShowWarning] = useState(false);
  const [showSubmitModal, setShowSubmitModal] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [lastSaved, setLastSaved] = useState(null);
  const [saveError, setSaveError] = useState(null);
  const [isAudioPlaying, setIsAudioPlaying] = useState(false);
  const [submitRetrying, setSubmitRetrying] = useState(false);

  // ===== PROTECT AGAINST UNLOAD =====
  useEffect(() => {
    const handleBeforeUnload = (e) => {
      if (state.mode === EXAM_MODES.EXAM && Object.keys(state.answers).length > 0) {
        e.preventDefault();
        e.returnValue = '';
      }
    };

    window.addEventListener('beforeunload', handleBeforeUnload);
    return () => window.removeEventListener('beforeunload', handleBeforeUnload);
  }, [state.mode, state.answers]);

  // ===== RESTORE FROM DRAFT =====
  useEffect(() => {
    try {
      const draft = localStorage.getItem(EXAM_DRAFT_KEY);
      if (draft) {
        const { answers } = JSON.parse(draft);
        if (answers) {
          setAnswers(answers);
        }
      }
    } catch (err) {
      console.error('Failed to restore draft:', err);
    }
  }, []);

  // ===== PERSIST ANSWERS =====
  // Auto-save answers to localStorage (always)
  useEffect(() => {
    try {
      localStorage.setItem(EXAM_DRAFT_KEY, JSON.stringify({
        answers: state.answers,
        timestamp: Date.now(),
      }));
    } catch (err) {
      console.error('Failed to persist answers:', err);
    }
  }, [state.answers]);

  // ===== TIMER SETUP =====
  //  Clean timer logic isolated in hook
  useExamTimer({
    isActive: state.mode === EXAM_MODES.EXAM && !state.isPaused && state.examData,
    section: state.section,
    timeLeft: state.timeLeft,
    onTick: tickTimer,
    onComplete: () => {
      // Time expired
      if (state.section === EXAM_SECTIONS.LISTENING) {
        setSection(EXAM_SECTIONS.READING);
        setPart(5);
        setTimeLeft(EXAM_TIMINGS.READING);
      } else {
        setMode(EXAM_MODES.RESULTS);
      }
    },
    onWarning: () => setShowWarning(true),
  });

  // ===== KEYBOARD SHORTCUTS =====
  //  Keyboard logic isolated in hook
  useKeyboardShortcuts({
    isActive: state.mode === EXAM_MODES.EXAM,
    isAudioPlaying,
    onNavigatePrev: () => {
      const minPart = state.section === EXAM_SECTIONS.LISTENING ? 1 : 5;
      if (state.part > minPart) {
        setPart(state.part - 1);
      }
    },
    onNavigateNext: () => {
      const maxPart = state.section === EXAM_SECTIONS.LISTENING ? 4 : 8;
      if (state.part < maxPart) {
        setPart(state.part + 1);
      }
    },
    onTogglePause: () => state.isPaused ? resumeTimer() : pauseTimer(),
    onSelectAnswer: (answerIndex) => {
      // Select first question's answer
      const key = generateAnswerKey({
        section: state.section,
        part: state.part,
        question: 1,
      });
      addAnswer(key, answerIndex);
    },
    onSubmit: () => {
      if (state.section === EXAM_SECTIONS.READING && state.part === 8) {
        setShowSubmitModal(true);
      }
    },
    onExit: () => {
      if (window.confirm('Are you sure you want to exit? Your progress will be saved.')) {
        resetExam();
        onComplete?.();
      }
    },
  });

  // ===== AUTOSAVE TO SERVER =====
  // Auto-save progress every 30 seconds when online
  useEffect(() => {
    if (state.mode !== EXAM_MODES.EXAM || !currentUser || progressLoading || !state.examData) {
      return;
    }

    const autoSaveTimer = setInterval(async () => {
      // Skip if offline
      if (!isOnline) {
        console.log('Offline: Skipping server autosave, local draft saved');
        return;
      }

      try {
        setIsSaving(true);
        setSaveError(null);

        const results = calculateFullResults(state.examData, state.answers);

        await saveProgress({
          exam: state.examId,
          part: state.section === EXAM_SECTIONS.LISTENING ? 'listening' : 'reading',
          score: parseFloat(results.averageScore),
          answers: state.answers,
          timestamp: Date.now(),
        });

        setLastSaved(Date.now());
      } catch (err) {
        console.error('Autosave failed:', err);
        setSaveError(err.message || 'Failed to save progress');
      } finally {
        setIsSaving(false);
      }
    }, EXAM_TIMINGS.AUTOSAVE);

    return () => clearInterval(autoSaveTimer);
  }, [state.mode, state.section, state.answers, state.examId, state.examData, currentUser, isOnline, progressLoading, saveProgress]);

  // ===== LOAD EXAM DATA =====
  useEffect(() => {
    if (state.mode === EXAM_MODES.SETUP) return;

    const loadExam = async () => {
      try {
        const data = await getExamById(state.examId);
        if (!data?.parts) {
          throw new Error('Invalid exam data');
        }
        setExamData(data);
      } catch (err) {
        console.error('Failed to load exam:', err);
        setSaveError(err.message || 'Failed to load exam');
      }
    };

    loadExam();
  }, [state.examId, state.mode, setExamData]);

  // ===== INITIALIZE SECTION TIMER =====
  // When switching sections, set appropriate timer
  useEffect(() => {
    if (state.mode === EXAM_MODES.EXAM) {
      const newTime = state.section === EXAM_SECTIONS.LISTENING
        ? EXAM_TIMINGS.LISTENING
        : EXAM_TIMINGS.READING;
      setTimeLeft(newTime);
    }
  }, [state.section, state.mode, setTimeLeft]);

  // ===== HANDLERS =====

  const handleStartExam = useCallback((examId) => {
    setExamId(examId);
    setMode(EXAM_MODES.EXAM);
    setTimeLeft(EXAM_TIMINGS.LISTENING);
    setShowWarning(false);
  }, [setExamId, setMode, setTimeLeft]);

  const handleSelectAnswer = useCallback((questionNum, optionIndex) => {
    const key = generateAnswerKey({
      section: state.section,
      part: state.part,
      question: questionNum,
    });
    addAnswer(key, optionIndex);
  }, [state.section, state.part, addAnswer]);

  const handleNavigatePart = useCallback((newPart) => {
    // Prevent going back to played listening parts
    if (state.section === EXAM_SECTIONS.LISTENING) {
      if (newPart < state.part && state.playedListeningParts.has(newPart)) {
        alert(' Cannot return to a listening part you already completed.');
        return;
      }
    }
    setPart(newPart);
  }, [state.section, state.part, state.playedListeningParts, setPart]);

  const handleNextSection = useCallback(() => {
    setSection(EXAM_SECTIONS.READING);
    setPart(5);
    setTimeLeft(EXAM_TIMINGS.READING);
  }, [setSection, setPart, setTimeLeft]);

  const handleAudioEnd = useCallback(() => {
    if (state.section === EXAM_SECTIONS.LISTENING) {
      markPartPlayed(state.part);
      setIsAudioPlaying(false);

      if (state.part < 4) {
        setPart(state.part + 1);
      } else {
        handleNextSection();
      }
    }
  }, [state.section, state.part, markPartPlayed, setPart, handleNextSection]);

 const handleFinalSubmit = useCallback(async () => {
  setSubmitRetrying(true);
  setSaveError(null);

  try {
    if (!state.examData) {
      throw new Error('No exam data');
    }

    const results = calculateFullResults(state.examData, state.answers);

    if (isOnline && currentUser) {
      await saveProgress({
        exam: state.examId,
        part: state.section === EXAM_SECTIONS.LISTENING ? 'listening' : 'reading',  //  Thm part
        score: parseFloat(results.averageScore),
        answers: state.answers,
        totalQuestions: state.examData?.totalQuestions || 0,  //  Thm cc required fields
        correctAnswers: results.correctAnswers || 0,           // 
        isDraft: false,                                        //  Thay v completed
        testType: 'full-exam',                                //  Thm testType
        timestamp: Date.now(),
      });
    }

    localStorage.removeItem(EXAM_DRAFT_KEY);
    setMode(EXAM_MODES.RESULTS);
    setShowSubmitModal(false);
  } catch (err) {
    console.error('Submit failed:', err);
    setSaveError(err.message || 'Failed to submit test');
  } finally {
    setSubmitRetrying(false);
  }
}, [state.examData, state.answers, state.examId, state.section, isOnline, currentUser, setMode, saveProgress]);

  // ===== COMPUTED VALUES =====

  const cfg = useMemo(() => EXAM_STRUCTURE[state.section], [state.section]);

  const partData = useMemo(() => {
    if (!state.examData?.parts) return null;
    const partKey = `part${state.part}`;
    return state.examData.parts[partKey] || null;
  }, [state.examData, state.part]);

  const unansweredCount = useMemo(() => {
    if (!state.examData) return 0;
    return countUnansweredQuestions(state.examData, state.answers, state.section);
  }, [state.examData, state.answers, state.section]);

  const isLastListeningPart = useMemo(
    () => state.section === EXAM_SECTIONS.LISTENING && state.part === 4,
    [state.section, state.part]
  );

  const isLastReadingPart = useMemo(
    () => state.section === EXAM_SECTIONS.READING && state.part === 8,
    [state.section, state.part]
  );

  // ===== RENDER =====

  // Setup Screen
  if (state.mode === EXAM_MODES.SETUP) {
    return <ExamSetup onStartExam={handleStartExam} />;
  }

  // Exam Screen
  if (state.mode === EXAM_MODES.EXAM) {
    return (
      <div className="min-h-screen bg-white">
        {/* Header */}
        <div className="sticky top-0 z-30 bg-white border-b border-slate-200 px-8 py-4 shadow-sm">
          <div className="max-w-7xl mx-auto flex items-center justify-between">
            {/* Title */}
            <div>
              <h2 className="text-lg font-bold text-slate-900">
                {state.section.toUpperCase()} - Part {state.part}
              </h2>
              <p className="text-sm text-slate-600">
                Exam: {state.examId}
              </p>
            </div>

            {/* Right: Timer & Autosave */}
            <div className="flex items-center gap-8">
              <Timer
                timeLeft={state.timeLeft}
                isWarning={showWarning}
              />
              <AutosaveIndicator
                isSaving={isSaving}
                lastSaved={lastSaved}
                isOnline={isOnline}
                saveError={saveError}
              />
            </div>
          </div>
        </div>

        {/* Step Indicator */}
        <div className="bg-slate-50 border-b border-slate-200 px-8 py-6">
          <div className="max-w-7xl mx-auto">
            <StepIndicator
              currentMode={EXAM_MODES.EXAM}
              listeningComplete={state.section === EXAM_SECTIONS.READING}
            />
          </div>
        </div>

        {/* Warnings */}
        <TimeWarning
          visible={showWarning}
          section={state.section}
          isLastListeningPart={isLastListeningPart}
          timeLeft={state.timeLeft}
        />

        <OfflineWarning isOnline={isOnline} />

        {/* Main Content */}
        {state.examData && (
          <ExamScreen
            examData={state.examData}
            section={state.section}
            part={state.part}
            answers={state.answers}
            onSelectAnswer={handleSelectAnswer}
            onNavigatePart={handleNavigatePart}
            onNextSection={handleNextSection}
            onSubmit={() => setShowSubmitModal(true)}
            onAudioStart={() => setIsAudioPlaying(true)}
            onAudioEnd={handleAudioEnd}
            isLastListeningPart={isLastListeningPart}
            isLastReadingPart={isLastReadingPart}
            playedParts={Array.from(state.playedListeningParts)}
            isAudioPlaying={isAudioPlaying}
          />
        )}

        {/* Submit Modal */}
        <SubmitModal
          visible={showSubmitModal}
          unansweredCount={unansweredCount}
          saveError={saveError}
          isOnline={isOnline}
          isSubmitting={submitRetrying}
          onConfirm={handleFinalSubmit}
          onCancel={() => setShowSubmitModal(false)}
        />
      </div>
    );
  }

  // Results Screen
  if (state.mode === EXAM_MODES.RESULTS) {
    return (
      <ResultsScreen
        examData={state.examData}
        answers={state.answers}
        onRetry={() => {
          resetExam();
          setShowWarning(false);
        }}
        onExit={() => {
          resetExam();
          localStorage.removeItem(EXAM_DRAFT_KEY);
          onComplete?.();
        }}
      />
    );
  }

  // Fallback
  return null;
};

FullExamMode.displayName = 'FullExamMode';

export default FullExamMode;
</file>

<file path="src/data/examData.js">
// src/data/examData.js

  /**
   * Lazy Loading Exam Data
   * - Ch load exam khi ngi dng chn
   * - Gim bundle size ban u
   * - Cache data sau ln load u tin
   */

  // Metadata cho tt c cc exams (lightweight)
  const EXAM_METADATA = {};
  for (let i = 1; i <= 2; i++) {
    EXAM_METADATA[`exam${i}`] = {
      id: `exam${i}`,
      title: ` thi ${i}`,
      loaded: false,
      data: null,
      loading: false,
      loadPromise: null
    };
  }

  // Cache  trnh load li
  const examCache = new Map();

  /**
   * Load exam data dynamically
   * @param {string} examId - ID ca exam (exam1, exam2, ...)
   * @returns {Promise<Object>} Exam data
   */
  export const loadExamData = async (examId) => {
    // Kim tra cache trc
    if (examCache.has(examId)) {
      return examCache.get(examId);
    }

    const metadata = EXAM_METADATA[examId];
    if (!metadata) {
      console.warn(` Exam "${examId}" khng tn ti`);
      return null;
    }

    // Nu ang load, i promise hin ti
    if (metadata.loading && metadata.loadPromise) {
      return metadata.loadPromise;
    }

    // Bt u load
    metadata.loading = true;
    
    const examNumber = examId.replace('exam', '');
    
    metadata.loadPromise = import(`./exams/exam${examNumber}.js`)
      .then(module => {
        const dataKey = `EXAM${examNumber}_DATA`;
        const data = module[dataKey];
        
        if (!data) {
          throw new Error(` Khng tm thy ${dataKey} trong module`);
        }

        // Lu vo cache
        examCache.set(examId, data);
        metadata.data = data;
        metadata.loaded = true;
        metadata.loading = false;
        
        console.log(`  load ${examId}`);
        return data;
      })
      .catch(error => {
        console.error(` Li khi load ${examId}:`, error);
        metadata.loading = false;
        metadata.loadPromise = null;
        return null;
      });

    return metadata.loadPromise;
  };

  /**
   * Preload exam  tng tc (optional)
   * @param {string} examId 
   */
  export const preloadExamData = (examId) => {
    if (!examCache.has(examId)) {
      loadExamData(examId);
    }
  };

  /**
   * Get exam by ID (async)
   * @param {string} examId 
   * @returns {Promise<Object|null>}
   */
  export const getExamById = async (examId) => {
    return await loadExamData(examId);
  };

  /**
   * Get all exam metadata (synchronous - ch tr v thng tin c bn)
   * @returns {Array<Object>}
   */
  export const getAllExamMetadata = () => {
    return Object.values(EXAM_METADATA).map(({ id, title, loaded }) => ({
      id,
      title,
      loaded
    }));
  };

  /**
   * Get all loaded exams (synchronous)
   * @returns {Array<Object>}
   */
  export const getAllLoadedExams = () => {
    return Array.from(examCache.values());
  };

  /**
   * Get exam parts (async)
   * @param {string} examId 
   * @returns {Promise<Object>}
   */
  export const getExamParts = async (examId) => {
    const exam = await loadExamData(examId);
    return exam?.parts || {};
  };

  /**
   * Get exam questions (async)
   * @param {string} examId 
   * @param {string} partId 
   * @returns {Promise<Array>}
   */
  export const getExamQuestions = async (examId, partId) => {
    const exam = await loadExamData(examId);
    const part = exam?.parts?.[partId];
    return part?.questions || [];
  };

  /**
   * Clear cache (dng khi cn reset)
   */
  export const clearExamCache = () => {
    examCache.clear();
    Object.values(EXAM_METADATA).forEach(meta => {
      meta.loaded = false;
      meta.data = null;
      meta.loading = false;
      meta.loadPromise = null;
    });
    console.log('  xa cache exams');
  };

  /**
   * Get cache stats (debug)
   */
  export const getCacheStats = () => {
    return {
      totalExams: Object.keys(EXAM_METADATA).length,
      loadedExams: examCache.size,
      exams: Array.from(examCache.keys())
    };
  };

  // Export metadata  dng cho dropdown
  export const EXAM_LIST = getAllExamMetadata();
</file>

<file path="src/data/exams/exam1.js">
export const EXAM1_DATA = {
  title: "HUFLIT Listening & Reading Practice - Exam 1",
  description: "B  thi y  vi Listening (4 parts, 20 cu) v Reading (4 parts, 40 cu)",
  
  metadata: {
    exam: "exam1",
    hasAudio: true,
    listeningAudioUrl: "/public/data/audio/exam1/listening/full.mp3",
  },

  parts: {
    // ==========================================
    // LISTENING PART 1
    // ==========================================
    part1: {
      title: "PART 1: Short Conversations",
      description: "Nghe 5 on hi thoi ngn. Chn p n tt nht (A, B, C, D) cho mi cu hi.",
      type: "listening",
      audioUrl: "/public/data/audio/exam1/listening/part1.mp3",
      script: `Cu 01: Shopping Experience
Michael: Hi Sarah! I just got back from the shopping mall.

Sarah: Oh wonderful! Did you find anything nice?

Michael: Well, I went looking for a new jacket and some shoes, but honestly, I'm quite disappointed. The problem is the prices. Everything was just ridiculously expensive! I didn't buy anything in the end because the prices were way too high.

Sarah: Oh no, that's too bad.

---

Cu 02: Gap Year in Thailand
David: Jennifer, welcome back! How long were you in Thailand exactly?

Jennifer: Hi David! It was amazing. I spent seven months there altogether.

David: Seven months! That's quite a long time. What did you do all that time?

Jennifer: I taught English for five months, and then I traveled for the remaining two months.

---

Cu 03: Business Trip to Taipei
Robert: Hi Victoria! Did you do any shopping in Taipei?

Victoria: Yes, I did, but I didn't go crazy with it. I bought a few things - some local tea, a small jade bracelet, and a couple of books about Taiwan's history.

Robert: A few things, that's nice.

---

Cu 04: Planning a Trip to Japan
Andrew: Lisa, do you have any recommendations about when I should go to Japan?

Lisa: Oh, you should definitely go in spring!

Andrew: Why spring specifically?

Lisa: Well, all of my friends who've been to Japan told me that spring is the best time to visit. The cherry blossoms are beautiful.

---

Cu 05: Navigating Tokyo
Amanda: Christopher, how was Tokyo? Easy to navigate?

Christopher: Well, to be honest, no. It was pretty difficult to get around, actually.

Amanda: Really? I thought the public transportation was good.

Christopher: It is, but there are so many lines and stations. Everything is so confusing.`,

      questions: [
        {
          id: 1,
          question: "Why didn't Michael buy anything?",
          options: [
            "A. He didn't find anything beautiful.",
            "B. He found the prices too high.",
            "C. He bought a lot of things because they're really cheap.",
            "D. He didn't have enough time."
          ],
          correct: 1,
          explanation: "Michael ni: 'I didn't buy anything in the end because the prices were way too high.'  Anh khng mua g v gi qu cao."
        },
        {
          id: 2,
          question: "How long did Jennifer spend in Thailand?",
          options: [
            "A. She spent one month there.",
            "B. She spent seven months there.",
            "C. She spent one week there.",
            "D. She spent several times there."
          ],
          correct: 1,
          explanation: "Jennifer ni: 'I spent seven months there altogether.'  C y  Thi Lan 7 thng."
        },
        {
          id: 3,
          question: "What did Victoria buy in Taipei?",
          options: [
            "A. She didn't buy anything in Taipei.",
            "B. She bought many things in Taipei.",
            "C. She bought a few things in Taipei.",
            "D. She bought a souvenir in Taipei."
          ],
          correct: 2,
          explanation: "Victoria ni: 'I bought a few things - some local tea, a small jade bracelet, and a couple of books'  C mua mt vi mn ."
        },
        {
          id: 4,
          question: "When should Andrew visit Japan according to Lisa?",
          options: [
            "A. People told him to visit in the summer.",
            "B. People didn't tell him to visit in the spring.",
            "C. People told him to visit in the spring.",
            "D. People told him to visit in the autumn."
          ],
          correct: 2,
          explanation: "Lisa ni: 'you should definitely go in spring! The cherry blossoms are beautiful.'  Nn i vo ma xun."
        },
        {
          id: 5,
          question: "How does Christopher feel about navigating Tokyo?",
          options: [
            "A. He found that Tokyo was very easy to get around.",
            "B. He found that Tokyo was not easy to get around.",
            "C. He found that Tokyo was a little bit easy to get around.",
            "D. He found that Tokyo was too busy to get around."
          ],
          correct: 1,
          explanation: "Christopher ni: 'It was pretty difficult to get around'  Kh tm ng."
        }
      ]
    },

    // ==========================================
    // LISTENING PART 2
    // ==========================================
    part2: {
      title: "PART 2: Conversation",
      description: "Nghe mt on hi thoi gia 3 ngi ti qun c ph. Chn p n tt nht cho 5 cu hi.",
      type: "listening",
      audioUrl: "/public/data/audio/exam1/listening/part2.mp3",
      script: `MARK: Alright everyone, before we order, let's just checkwho wants orange juice? I know I do.

LINDA: Same here. I really need something fresh today.

ROBERTSON: Me too. I'll have orange juice as well.

MARK: Okay, that's three so far. What about you, Linda?

LINDA: I already said yes, Mark. That makes three of us.

MARK: Right, sorry. So three orange juices. Got it. Are you sure you don't want anything to eat, Linda? The sandwiches here are pretty good.

LINDA: No, thanks. I'm really not hungry right now. I had a big breakfast this morning.

MARK: Fair enough.

ROBERTSON: This place reminds me of my old job, actually.

MARK: Oh really? I thought you owned a restaurant before.

ROBERTSON: I used to, years ago. But now I spend most of my time working with young players. I coach at a local sports academy.

MARK: That sounds rewarding.

By the way, my mother-in-law is coming to lunch tomorrow... and she's bringing her sister along.

MARK: Speaking of family, have you decided what to give your granddaughter for her birthday yet?

ROBERTSON: Honestly, we're still talking about it. My wife thinks clothes, I think money... we haven't made a final decision yet.`,

      questions: [
        {
          id: 6,
          question: "How many people want orange juice?",
          options: [
            "A. Two",
            "B. Three",
            "C. Four",
            "D. Five"
          ],
          correct: 1,
          explanation: "Mark, Linda, v Robertson u mun nc cam. Mark xc nhn: 'So three orange juices.'"
        },
        {
          id: 7,
          question: "Why doesn't the woman (Linda) want anything to eat?",
          options: [
            "A. Because she's not hungry.",
            "B. Because she doesn't feel well.",
            "C. Because she's on a diet.",
            "D. Because the food is not good enough."
          ],
          correct: 0,
          explanation: "Linda ni: 'I'm really not hungry right now. I had a big breakfast this morning.'"
        },
        {
          id: 8,
          question: "What does Robertson do now?",
          options: [
            "A. He owns a restaurant.",
            "B. He works in Orlando.",
            "C. He works with young players.",
            "D. He works in a restaurant."
          ],
          correct: 2,
          explanation: "Robertson ni: 'now I spend most of my time working with young players. I coach at a local sports academy.'"
        },
        {
          id: 9,
          question: "Who's coming to lunch?",
          options: [
            "A. The man's mother-in-law and his sister.",
            "B. The man's mother and his sister-in-law.",
            "C. The man's mother-in-law and her sister.",
            "D. The man's sister-in-law and his sister."
          ],
          correct: 2,
          explanation: "Mark ni: 'my mother-in-law is coming to lunch tomorrow... and she's bringing her sister along.'"
        },
        {
          id: 10,
          question: "What are they going to give their granddaughter for her birthday?",
          options: [
            "A. Money",
            "B. Clothes",
            "C. A hat",
            "D. They can't decide."
          ],
          correct: 3,
          explanation: "Robertson ni: 'we're still talking about it... we haven't made a final decision yet.'"
        }
      ]
    },

    // ==========================================
    // LISTENING PART 3
    // ==========================================
    part3: {
      title: "PART 3: Monologue",
      description: "Nghe mt bi ni c thoi. Chn p n tt nht cho 5 cu hi.",
      type: "listening",
      audioUrl: "/public/data/audio/exam1/listening/part3.mp3",
      script: `Hello everyone, and a very warm welcome back to the podcast! I'm your host, Angela Carter. I hope you're all having a fantastic week. Today, I've been doing a bit of soul-searching, and I wanted to share a quick reflection on my recent learning journey, along with a few personal stories that I think many of you might relate to.

First off, let's talk about that English course I finally wrapped up last week. You know how sometimes you sign up for a class and it's just... okay? Well, this wasn't that. I can honestly tell you, looking back, the class was a real success. It wasn't just 'acceptable' or 'good enough'and thank goodness it was far from 'awful'! The energy in the room was electric, and the tutor really knew how to break down those complex grammar walls. By the final session, I walked out of there feeling like a different person.

And speaking of results, I have some major personal news to share with you all. It's been a week of nervous waiting, but I've just got the result of my English test! When I saw that email notification, my heart actually skipped a beat. After all those late nights and endless practice exercises, seeing the score was just so rewarding. It's a great reminder that the grind really does pay off.

However, it wasn't all sunshine and rainbows. Our tutor was legendary for being strict about one thing: accountability. She made it crystal clear from day one that if you miss a deadline she has set, you will only get fifty percent of your marks for that task. No excuses! While that 50% penalty felt a bit harsh at first, it actually forced me to stop procrastinating and finally master my calendar.

Reflecting on this made me think about my younger self. To be honest, I was a bit bored at my school back then. It wasn't that I was a poor student or lacked intelligencefar from itbut the traditional classroom just didn't spark anything in me. I often found the lessons repetitive and, frankly, struggled to see the point of it all. Funny how much things change when you're an adult and you actually choose what you want to learn, right?

Anyway, before I let you go, I have to give a shout-out to a little gem I found. Last weekend, I finally checked out that restaurant on Main Street a friend kept raving about. And wowit has a great menu, the food is absolutely delicious, and what impressed me most was that it has lots of options for vegetarians. Usually, you only get one of those things, but this place had it all. It's definitely my new favorite spot.

Thanks so much for tuning in today. It's been a pleasure sharing these moments with you. Until next time, keep learning and keep exploring!`,

      questions: [
        {
          id: 11,
          question: "Angela describes the English class as __________.",
          options: [
            "A. good enough",
            "B. acceptable",
            "C. awful",
            "D. a real success"
          ],
          correct: 3,
          explanation: "Angela ni: 'the class was a real success. It wasn't just acceptable or good enoughand thank goodness it was far from awful!'"
        },
        {
          id: 12,
          question: "Angela has just __________.",
          options: [
            "A. done a master's",
            "B. got the result of my English test",
            "C. got 6.5",
            "D. get"
          ],
          correct: 1,
          explanation: "Angela ni: 'I've just got the result of my English test!'"
        },
        {
          id: 13,
          question: "If you miss a deadline your tutor has set, you __________.",
          options: [
            "A. will be given a zero",
            "B. will get 50% of your marks",
            "C. will be fined",
            "D. will get all marks"
          ],
          correct: 1,
          explanation: "Angela ni: 'if you miss a deadline she has set, you will only get fifty percent of your marks for that task.'"
        },
        {
          id: 14,
          question: "Angela was __________.",
          options: [
            "A. an intelligent kid in class",
            "B. a bit bored at her school",
            "C. an AI",
            "D. already"
          ],
          correct: 1,
          explanation: "Angela ni: 'I was a bit bored at my school back then' v gii thch 'the traditional classroom just didn't spark anything in me.'"
        },
        {
          id: 15,
          question: "The restaurant in the main street __________.",
          options: [
            "A. has a good menu",
            "B. has nice food",
            "C. has lots of options for vegetarians",
            "D. all correct"
          ],
          correct: 3,
          explanation: "Angela ni: 'it has a great menu, the food is absolutely delicious, and what impressed me most was that it has lots of options for vegetarians.'"
        }
      ]
    },

    // ==========================================
    // LISTENING PART 4
    // ==========================================
    part4: {
      title: "PART 4: Extended Conversation",
      description: "Nghe mt on hi thoi di. Chn p n tt nht cho 5 cu hi.",
      type: "listening",
      audioUrl: "/public/data/audio/exam1/listening/part4.mp3",
      script: `NARRATOR: A customer named Michael is at a men's clothing store asking to return a tie he bought.

MICHAEL: Hi, I need to return a tie. This tie was given to me as a birthday present from my wife. But then I also got the same tie as a Christmas present from my company. And my daughter just gave me the same tie as a gift too!

JESSICA: Oh wow! So the tie was a birthday present, a Christmas present, and a gift from your daughter?

MICHAEL: Exactly! I have three of the same tie now. I'd like to return one.

JESSICA: When did you receive the first tie?

MICHAEL: My wife gave me the first one about two weeks ago on my birthday. That's when she bought it from your store.

JESSICA: So the tie was purchased two weeks ago?

MICHAEL: Yes, two weeks ago. That's the one I want to return.

JESSICA: Do you have the receipt?

MICHAEL: No, I don't have the receipt. My wife bought it as a gift and didn't give me the receipt. I'm sorry, but the tie is definitely from your store. I remember the packaging.

JESSICA: Without a receipt, I need proof of purchase. Do you have it at home?

MICHAEL: I'm not sure if my wife kept it. It's been two weeks. I don't have the receipt.

MICHAEL: But why won't you help? I have the tie and it's from your store!

JESSICA: Without a receipt, I have no way to verify that this tie was purchased from our store. It could be from anywhereanother store, online, anywhere. Company policy requires proof of purchase. Without the receipt, the man couldn't prove that the tie was purchased from our store. I simply don't have the authority to process a refund without proof.

MICHAEL: So you don't believe me?

JESSICA: It's not about believing you. It's about having documentation. I cannot authorize a refund without proof. That's the policy.

MICHAEL: I'm frustrated. This doesn't seem fair.

JESSICA: I understand your frustration and I really want to help. Go home and look for the receipt. Check your email for a receipt confirmation. Check your wife's credit card statement. If you find any proof of purchase, bring it back and I'll process your return immediately.

MICHAEL: That's actually helpful. Thank you.

JESSICA: You're welcome. Let's stay positive. You've got this! Come back when you find the proof, and we'll take care of you.

NARRATOR: Michael left the store to search for the receipt. Jessica tried to help him by suggesting solutions, even though she couldn't process the return without proof of purchase.`,

      questions: [
        {
          id: 16,
          question: "The tie __________.",
          options: [
            "A. was a birthday present",
            "B. was a Christmas present",
            "C. was a gift of a boyfriend",
            "D. all correct"
          ],
          correct: 0,
          explanation: "Michael ni: 'This tie was given to me as a birthday present from my wife.'"
        },
        {
          id: 17,
          question: "The tie was purchased __________.",
          options: [
            "A. last week",
            "B. a few weeks ago",
            "C. two weeks ago",
            "D. two years ago"
          ],
          correct: 2,
          explanation: "Michael ni: 'My wife gave me the first one about two weeks ago on my birthday.'"
        },
        {
          id: 18,
          question: "When asking for refunding, the man __________.",
          options: [
            "A. had a receipt",
            "B. left his receipt at home",
            "C. didn't have receipt",
            "D. don't receipt"
          ],
          correct: 2,
          explanation: "Michael ni: 'No, I don't have the receipt. My wife bought it as a gift and didn't give me the receipt.'"
        },
        {
          id: 19,
          question: "She (the shop assistant) didn't agree to pay back money because __________.",
          options: [
            "A. she didn't believe in the man",
            "B. the man couldn't prove that the tie was purchased from her store",
            "C. she has no right to do so",
            "D. she hadn't believed"
          ],
          correct: 1,
          explanation: "Jessica ni: 'Without a receipt, I have no way to verify that this tie was purchased from our store. Company policy requires proof of purchase.'"
        },
        {
          id: 20,
          question: "The shop assistant tries to __________.",
          options: [
            "A. make the man angry",
            "B. calm the man down",
            "C. bother the man",
            "D. make the man happy"
          ],
          correct: 1,
          explanation: "Jessica ni: 'I understand your frustration and I really want to help... Let's stay positive. You've got this!'"
        }
      ]
    },

    // ==========================================
    // READING PART 5 - GRAMMAR/VOCABULARY
    // ==========================================
    part5: {
      title: "PART 5: Fill in the Blank (Grammar/Vocabulary)",
      description: "10 cu hi - Chn t/cm t ph hp  hon thnh cu.",
      type: "reading",
      questions: [
        {
          id: 21,
          question: "Customer reviews indicate that many modern mobile devices are often unnecessarily _______.",
          options: [
            "A. Complication",
            "B. Complicates",
            "C. Complicate",
            "D. Complicated"
          ],
          correct: 3,
          explanation: "Cu trc: 'devices are _______' yu cu tnh t. 'Complicated' l p n ng (c ngha l phc tp)."
        },
        {
          id: 22,
          question: "Among ________ recognized at the company awards ceremony were senior business analyst Natalie Obi and sales associate Peter Comeau.",
          options: [
            "A. who",
            "B. whose",
            "C. they",
            "D. those"
          ],
          correct: 3,
          explanation: "'Among those recognized... were [subject]' s dng 'those' lm i t. 'Those' = nhng ngi c cng nhn."
        },
        {
          id: 23,
          question: "Jamal Nawzad has received top performance reviews _______ he joined the sales department two years ago.",
          options: [
            "A. despite",
            "B. except",
            "C. since",
            "D. during"
          ],
          correct: 2,
          explanation: "'has received... since' l cu trc th hin ti hon thnh ng. 'Since' = t khi no ."
        },
        {
          id: 24,
          question: "All clothing sold in Develyn's Boutique is made from natural materials and contains no __________ dyes.",
          options: [
            "A. immediate",
            "B. synthetic",
            "C. reasonable",
            "D. assumed"
          ],
          correct: 1,
          explanation: "'Synthetic dyes' (thuc nhum nhn to) tri ngc vi 'natural materials'. 'Synthetic' = nhn to."
        },
        {
          id: 25,
          question: "Gyeon Corporation's continuing education policy states that _______ learning new skills enhances creativity and focus.",
          options: [
            "A. regular",
            "B. regularity",
            "C. regulate",
            "D. regularly"
          ],
          correct: 0,
          explanation: "'regular learning' cn tnh t  m t danh t 'learning'. 'Regular' = thng xuyn, u n."
        },
        {
          id: 26,
          question: "The new employee orientation will begin at 9 a.m. and will _______ an overview of company policies.",
          options: [
            "A. include",
            "B. includes",
            "C. included",
            "D. including"
          ],
          correct: 0,
          explanation: "'will + V nguyn th' l cu trc th tng lai n. 'Include' = bao gm."
        },
        {
          id: 27,
          question: "To ensure product quality, all items must be thoroughly tested _______ being shipped to customers.",
          options: [
            "A. before",
            "B. during",
            "C. between",
            "D. unless"
          ],
          correct: 0,
          explanation: "'before + V-ing' ch hnh ng xy ra trc mt hnh ng khc. 'Before' = trc khi."
        },
        {
          id: 28,
          question: "The marketing department is seeking a graphic designer who can work _______ and meet tight deadlines.",
          options: [
            "A. independence",
            "B. independently",
            "C. independent",
            "D. dependently"
          ],
          correct: 1,
          explanation: "Sau ng t 'work' cn trng t. 'Independently' = c lp. (work independently = lm vic c lp)"
        },
        {
          id: 29,
          question: "Because of the heavy rain, the outdoor event has been _______ until next weekend.",
          options: [
            "A. postponed",
            "B. postponing",
            "C. postpone",
            "D. postpones"
          ],
          correct: 0,
          explanation: "'has been + V3' l cu trc th hin ti hon thnh b ng. 'Postponed' = c hon li."
        },
        {
          id: 30,
          question: "The manager reminded the staff that punctuality and teamwork are key factors in maintaining a positive _______.",
          options: [
            "A. environment",
            "B. equipment",
            "C. advertisement",
            "D. appointment"
          ],
          correct: 0,
          explanation: "'positive environment' (mi trng tch cc) l collocation ph hp. 'Environment' = mi trng."
        }
      ]
    },

    // ==========================================
    // READING PART 6 - CLOZE TEXT
    // ==========================================
    part6: {
      title: "PART 6: Cloze Text (Email/Announcement)",
      description: "10 cu hi - in t/cm vo vn bn email.",
      type: "reading",
      text: `To: All Marketing Department Staff
From: Clara Lee, Marketing Director
Subject: Upcoming Product Launch Preparation

Dear Team,

As you all know, we are preparing for the official launch of our new product line, the EcoSmart Home Series, scheduled for early next quarter. In order to ensure a successful debut, we will begin a series of meetings next week to finalize the promotional strategy. Each team member will be assigned specific responsibilities to (31) smooth coordination between departments.

Our primary objective is to increase brand awareness and attract potential customers through both online and offline marketing channels. The social media team will focus on digital advertising, while the design team will create visual materials to (32) our brand image.

Additionally, we will collaborate closely with our sales representatives to collect feedback from clients. This will help us make any necessary adjustments before the official release. Please note that all suggestions should be submitted to my office no later than Friday, March 22, so that we have enough time to review and (33) them.

The official press conference will take place at our headquarters on April 5. We expect several major media outlets to attend, so everyone must be prepared to present our product in the most professional manner possible. A rehearsal session will be held two days before the event to (34) that all participants are comfortable with their roles.

For those who are new to the team, we will organize a short orientation program to explain our marketing policies and internal communication procedures. Attendance is highly encouraged, as this session will provide essential information on how to (35) with other departments effectively.

We truly appreciate everyone's dedication and teamwork during this busy time. Your hard work and creativity will certainly make this product launch a success. If you have any questions or concerns, please don't hesitate to (36) me directly.

Thank you once again for your continued commitment to excellence. I am confident that, together, we will achieve outstanding results.

Best regards,
Clara Lee
Marketing Director
InnovateTech Solutions`,

      questions: [
        {
          id: 31,
          question: "(31) - in t thch hp",
          options: [
            "A. ensure",
            "B. suggest",
            "C. describe",
            "D. remind"
          ],
          correct: 0,
          explanation: "'ensure + noun' = 'm bo rng'. Cu trc: 'assigned specific responsibilities to ensure smooth coordination.'"
        },
        {
          id: 32,
          question: "(32) - in t thch hp",
          options: [
            "A. attend",
            "B. improve",
            "C. reinforce",
            "D. prevent"
          ],
          correct: 2,
          explanation: "'reinforce brand image' = 'tng cng/cng c hnh nh thng hiu'. Reinforce = lm cho mnh m hn."
        },
        {
          id: 33,
          question: "(33) - in t thch hp",
          options: [
            "A. reject",
            "B. implement",
            "C. transfer",
            "D. decline"
          ],
          correct: 1,
          explanation: "'review and implement' = 'xem xt v trin khai'. Implement = a vo thc hin, trin khai."
        },
        {
          id: 34,
          question: "(34) - in t thch hp",
          options: [
            "A. warn",
            "B. announce",
            "C. require",
            "D. ensure"
          ],
          correct: 3,
          explanation: "'ensure + that + clause' = 'm bo rng'. Cu trc: 'held to ensure that all participants are comfortable.'"
        },
        {
          id: 35,
          question: "(35) - in t thch hp",
          options: [
            "A. compete",
            "B. cooperate",
            "C. complain",
            "D. compare"
          ],
          correct: 1,
          explanation: "'cooperate with other departments' = 'hp tc vi cc phng ban khc'. Cooperate = lm vic cng nhau."
        },
        {
          id: 36,
          question: "(36) - in t thch hp",
          options: [
            "A. reach",
            "B. push",
            "C. delay",
            "D. ignore"
          ],
          correct: 0,
          explanation: "'reach me directly' = 'lin h vi ti trc tip'. Reach = tip cn, lin h."
        },
        {
          id: 37,
          question: "The EcoSmart Home Series will most likely be released __________.",
          options: [
            "A. next week",
            "B. early next quarter",
            "C. by the end of the year",
            "D. after the press conference"
          ],
          correct: 1,
          explanation: "Email ni r: 'scheduled for early next quarter'  Sn phm s c ra mt vo u qu ti."
        },
        {
          id: 38,
          question: "What is the main purpose of this message?",
          options: [
            "A. To introduce a new marketing policy",
            "B. To inform staff of product launch preparations",
            "C. To announce the cancellation of a campaign",
            "D. To request client feedback after the event"
          ],
          correct: 1,
          explanation: "Email ni: 'we are preparing for the official launch' v tho lun v cc bc chun b  Mc ch l thng bo chun b ra mt sn phm."
        },
        {
          id: 39,
          question: "Who is the sender of this message?",
          options: [
            "A. A sales representative",
            "B. A design manager",
            "C. The marketing director",
            "D. The chief financial officer"
          ],
          correct: 2,
          explanation: "Email k tn: 'Clara Lee, Marketing Director'  Ngi gi l gim c marketing."
        },
        {
          id: 40,
          question: "When will the rehearsal for the press conference take place?",
          options: [
            "A. March 22",
            "B. April 3",
            "C. April 5",
            "D. The following week"
          ],
          correct: 1,
          explanation: "Email ni: 'press conference will take place... on April 5' v 'rehearsal session will be held two days before the event'  April 5 - 2 ngy = April 3."
        }
      ]
    },

    // ==========================================
    // READING PART 7 - MULTIPLE TEXTS
    // ==========================================
    part7: {
      title: "PART 7: Multiple Texts (Advertisement & Email)",
      description: "10 cu hi - c qung co dch v v email khch hng, chn p n tt nht.",
      type: "reading",
      text: `BUSINESS AUDIO PRO
Enhance Your Company's Image with a Professionally Recorded Telephone Greeting

A professional, personalized voicemail message creates an excellent first impression. Business Audio Pro meets your specifications to record a customized telephone greeting within three business days!

SERVICES WE OFFER:

1. Professional Voice Talent for Voicemail Messages  We have numerous male and female voice actors with a wide range of tones, accents, and dialects. Visit businessaudiopro.com to hear examples of what each actor sounds like and choose the one that best suits your needs.

2. On-Hold Messages  We also create professional on-hold messages with pleasant music to enhance your customers' experience.

3. Customized Script Writing  Our experienced script writers can help you craft a personalized message that represents you and your business.

4. Multilingual Voice Production  For those with a multilingual customer base, we offer services in a wide range of languages.

Send us an e-mail (inquiry@businessaudiopro.com) with your contact information and your specific needs. A representative will call you within 24 hours to discuss your project and provide a price estimate.

---

To: inquiry@businessaudiopro.com
From: j.annesly@anneslydata.com
Date: June 25
Subject: Request

I found your notice in the newspaper and wish to use your services for my data-processing and transcription business. I am looking specifically for a professionally recorded voicemail greeting intended for my clients, and I wonder if you would be available to write and record this for me, and how soon. Since I work with English- and Spanish-speaking clients, I would like the message to be recorded in both languages. Please reach out to me at my mobile phone between the hours of 10:00 A.M. and 5:00 P.M. I hope to hear from you soon.

Thank you,
Jody Annesly
Annesly Data
512-555-6879 (mobile)
342 Maymill Road, Fort Worth, TX 70609`,

      questions: [
        {
          id: 41,
          question: "According to the advertisement, why should customers visit the Business Audio Pro Web site?",
          options: [
            "A. To hear voice samples",
            "B. To add a new phone number",
            "C. To submit a credit card payment",
            "D. To request recording equipment"
          ],
          correct: 0,
          explanation: "Qung co ni: 'Visit businessaudiopro.com to hear examples of what each actor sounds like.'   nghe cc mu ging ni."
        },
        {
          id: 42,
          question: "What is suggested about Business Audio Pro?",
          options: [
            "A. It fills orders once a week.",
            "B. It advertises in the newspaper.",
            "C. It specializes in data-processing services.",
            "D. It has recently expanded its business."
          ],
          correct: 1,
          explanation: "Email t Annesly: 'I found your notice in the newspaper'  Business Audio Pro qung co trn bo."
        },
        {
          id: 43,
          question: "Who most likely is Ms. Annesly?",
          options: [
            "A. An actor",
            "B. A script writer",
            "C. A sales associate",
            "D. A business owner"
          ],
          correct: 3,
          explanation: "Email: 'my data-processing and transcription business' + ch k 'Annesly Data'  C l ch s hu doanh nghip."
        },
        {
          id: 44,
          question: "What service does Ms. Annesly NOT request from Business Audio Pro?",
          options: [
            "A. Professional voice talent",
            "B. On-hold messages",
            "C. Customized script writing",
            "D. Multilingual voice production"
          ],
          correct: 1,
          explanation: "Annesly yu cu: 'voicemail greeting', 'write and record', v 'both languages'. C KHNG  cp 'on-hold messages' (thng ip ch trn ng)."
        },
        {
          id: 45,
          question: "What will Ms. Annesly most likely do within 24 hours?",
          options: [
            "A. Meet with an actor",
            "B. Visit a recording studio",
            "C. Write a script",
            "D. Speak with a representative"
          ],
          correct: 3,
          explanation: "Qung co: 'A representative will call you within 24 hours to discuss your project'  C s ni chuyn vi i din cng ty."
        },
        {
          id: 46,
          question: "According to the advertisement, Business Audio Pro will respond to customer inquiries within",
          options: [
            "A. 12 hours",
            "B. 24 hours",
            "C. 48 hours",
            "D. three business days"
          ],
          correct: 1,
          explanation: "Qung co ni: 'A representative will call you within 24 hours'  Business Audio Pro s tr li trong vng 24 gi."
        },
        {
          id: 47,
          question: "What can be inferred about Business Audio Pro's services?",
          options: [
            "A. They are limited to English-speaking clients.",
            "B. They are available only on weekends.",
            "C. They can accommodate different languages.",
            "D. They require customers to visit the office in person."
          ],
          correct: 2,
          explanation: "Qung co ni: 'Multilingual Voice Production  For those with a multilingual customer base, we offer services in a wide range of languages.'  H c th cung cp dch v nhiu ngn ng."
        },
        {
          id: 48,
          question: "What does Ms. Annesly specifically request in her message?",
          options: [
            "A. A sample of recorded music",
            "B. A bilingual voicemail recording",
            "C. A newspaper advertisement",
            "D. A refund for a previous order"
          ],
          correct: 1,
          explanation: "Email ni: 'I would like the message to be recorded in both languages'  C yu cu ghi m li cho hng nhn vin bng c ting Anh v ting Ty Ban Nha."
        },
        {
          id: 49,
          question: "What detail does Ms. Annesly include to make communication easier?",
          options: [
            "A. Her office address",
            "B. Her preferred calling hours",
            "C. Her company's website link",
            "D. Her client list"
          ],
          correct: 1,
          explanation: "Email: 'Please reach out to me at my mobile phone between the hours of 10:00 A.M. and 5:00 P.M.'  C cung cp thi gian gi in u tin."
        },
        {
          id: 50,
          question: "What is the likely next step for Business Audio Pro?",
          options: [
            "A. Sending Ms. Annesly a contract to sign",
            "B. Visiting Ms. Annesly's office for recording",
            "C. Calling Ms. Annesly to discuss her project and pricing",
            "D. Posting a new advertisement in the newspaper"
          ],
          correct: 2,
          explanation: "Qung co ni: 'A representative will call you within 24 hours to discuss your project and provide a price estimate.'  Bc tip theo l gi  tho lun d n v gi."
        }
      ]
    },

    // ==========================================
    // READING PART 8 - TEXT MESSAGE CHAIN
    // ==========================================
    part8: {
      title: "PART 8: Text Message Chain",
      description: "10 cu hi - c chui tin nhn, chn p n tt nht.",
      type: "reading",
      text: `SAM BACH (11:59): My first flight was delayed, so I missed my connection in Beijing.
SAM BACH (12:00): So now, I'm going to be on a flight arriving in Kansai at 18:00.

AKIRA OTANI (12:05): OK. Same airline?

SAM BACH (12:06): It's still Fly Right Airlines. It will be later in the day but still in time for our client meeting.

AKIRA OTANI (12:06): I'll confirm the arrival time. Do you have any checked bags?

SAM BACH (12:10): I do. Would you mind meeting me at the door after I go through customs?

AKIRA OTANI (12:15): Sure thing. Parking spots can be hard to find, but now I'll have extra time to drive around and look.

SAM BACH (12:16): Yes, sorry about that. See you then!`,

      questions: [
        {
          id: 51,
          question: "What is suggested about Mr. Bach?",
          options: [
            "A. He has been to Kansai more than once.",
            "B. He currently works in Beijing.",
            "C. He is on a business trip.",
            "D. He works for Fly Right Airlines."
          ],
          correct: 2,
          explanation: "Mr. Bach  cp n 'our client meeting' (cuc hp khch hng ca chng ta), iu ny ng  ng ang thc hin mt chuyn cng tc."
        },
        {
          id: 52,
          question: "At 12:15, what does Mr. Otani mean when he writes, 'Sure thing'?",
          options: [
            "A. He has confirmed the arrival time of a flight.",
            "B. He is certain he will be able to find a parking place.",
            "C. He agrees to wait at the door near the customs area.",
            "D. He knows Mr. Bach must pass through customs."
          ],
          correct: 2,
          explanation: "'Sure thing' l cu tr li ng  cho yu cu trc : 'Would you mind meeting me at the door after I go through customs?'"
        },
        {
          id: 53,
          question: "Why was Mr. Bach's flight delayed?",
          options: [
            "A. There was bad weather in Kansai.",
            "B. He missed his connection in Beijing.",
            "C. The airline changed the departure time.",
            "D. He forgot to check in early."
          ],
          correct: 1,
          explanation: "Khng c thng tin trc tip v l do delay. Tuy nhin, Mr. Bach ni 'My first flight was delayed, so I missed my connection in Beijing'  Chuyn bay u tin b tr khin anh l kt ni."
        },
        {
          id: 54,
          question: "What time is Mr. Bach's new flight expected to arrive?",
          options: [
            "A. 11:59",
            "B. 12:06",
            "C. 18:00",
            "D. 20:15"
          ],
          correct: 2,
          explanation: "Mr. Bach thng bo  tin nhn lc 12:00: 'I'm going to be on a flight arriving in Kansai at 18:00'  n lc 18 gi (6 chiu)."
        },
        {
          id: 55,
          question: "What does Mr. Otani offer to do for Mr. Bach?",
          options: [
            "A. Drive him to the hotel",
            "B. Pick him up at the airport",
            "C. Change his flight booking",
            "D. Help carry his luggage"
          ],
          correct: 1,
          explanation: "Bng vic ng  'meeting me at the door after I go through customs', Mr. Otani ang  ngh n Mr. Bach ti sn bay."
        },
        {
          id: 56,
          question: "What can be inferred about the two men?",
          options: [
            "A. They are colleagues attending the same meeting.",
            "B. They are family members traveling together.",
            "C. They both work for Fly Right Airlines.",
            "D. They have never met before."
          ],
          correct: 0,
          explanation: "Vic s dng cm t 'our client meeting' (cuc hp khch hng ca chng ta) cho thy h l ng nghip v cng tham gia vo mt s kin cng vic chung."
        },
        {
          id: 57,
          question: "At 12:06, why does Mr. Bach mention 'still in time for our client meeting'?",
          options: [
            "A. To apologize for missing the meeting",
            "B. To confirm he will not be late",
            "C. To ask about the meeting location",
            "D. To cancel his attendance"
          ],
          correct: 1,
          explanation: "Mr. Bach mun trn an Mr. Otani rng mc d chuyn bay b tr nhng ng vn s n kp gi cho cuc hp vi khch hng."
        },
        {
          id: 58,
          question: "What does Mr. Otani mean when he writes, 'I'll confirm the arrival time'?",
          options: [
            "A. He plans to check the airline's schedule.",
            "B. He will change the meeting time.",
            "C. He needs to contact the travel agent.",
            "D. He will book another ticket for Mr. Bach."
          ],
          correct: 0,
          explanation: "Mr. Otani s kim tra li lch trnh thc t ca hng hng khng  chc chn thi gian h cnh chnh xc trc khi i n."
        },
        {
          id: 59,
          question: "What is implied about Mr. Otani's travel to the airport?",
          options: [
            "A. He expects heavy traffic or limited parking.",
            "B. He plans to take public transportation.",
            "C. He works at the airport.",
            "D. He has never been to Kansai Airport before."
          ],
          correct: 0,
          explanation: "Mr. Otani ni 'Parking spots can be hard to find, but now I'll have extra time to drive around and look.'  ng d on s c kh khn v bi  xe."
        },
        {
          id: 60,
          question: "What does Mr. Bach express in his final message?",
          options: [
            "A. Thanks for the help",
            "B. Regret about missing the meeting",
            "C. Frustration with the airline",
            "D. Request for flight confirmation"
          ],
          correct: 0,
          explanation: "Dng cui 'Yes, sorry about that. See you then!' mang hm  cm n v s gip  v kin nhn ca Mr. Otani."
        }
      ]
    }
  }
};

export default EXAM1_DATA;
</file>

<file path="src/components/layout/MainLayout.jsx">
import React from 'react';
import Navbar from '../Navbar';
import Footer from '../footer/Footer';

const MainLayout = ({ 
  children, 
  testType, 
  onTestTypeChange, 
  practiceType, 
  onPracticeTypeChange,
  user,
  onAuthClick,
  onChatClick,
  onProfileClick,
  viewMode,
  onlineCount,
  totalUsers,
  onAnswersClick
}) => {
  return (
    <div className="min-h-screen bg-white flex flex-col">
      
      {/* Navbar - Fixed at top */}
      <div className="sticky top-0 z-50">
        <Navbar
          testType={testType}
          onTestTypeChange={onTestTypeChange}
          practiceType={practiceType}
          onPracticeTypeChange={onPracticeTypeChange}
          user={user}
          onAuthClick={onAuthClick}
          onChatClick={onChatClick}
          onProfileClick={onProfileClick}
          viewMode={viewMode}
          onlineCount={onlineCount}
          totalUsers={totalUsers}
          onAnswersClick={onAnswersClick}
        />
      </div>

      {/* Main Content Container */}
      <main className="flex-1 w-full">
        {/* Padding wrapper - Gim padding top t py-6 sm:py-8 */}
        <div className="h-full px-4 sm:px-6 md:px-8 lg:px-10 pt-0 pb-6 sm:pb-8">
          {/* Max width container */}
          <div className="mx-auto max-w-7xl">
            {children}
          </div>
        </div>
      </main>

      {/* Footer */}
      <footer className="w-full mt-auto border-t border-slate-200 bg-white">
        <Footer 
          onlineCount={onlineCount}
          totalUsers={totalUsers}
        />
      </footer>
      
    </div>
  );
};

export default MainLayout;
</file>

<file path="src/components/Navbar.jsx">
import React, { useState, useEffect, useCallback } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Headphones, BookOpen, GraduationCap, Sparkles, 
  ChevronDown, LogOut, User, Menu, X, Flame, Languages, Home, FileText
} from 'lucide-react';
import { useFirebaseAuth } from '../hooks/useFirebaseAuth';
import { useStreak } from './hooks/useStreak';
import { ROUTES } from '../config/routes';
import logo from '../assets/logo.png';

const Navbar = ({ testType, onTestTypeChange, practiceType, onPracticeTypeChange }) => {
  const navigate = useNavigate();
  const location = useLocation();
  const { user, isSignedIn, signInWithGoogle, signOut } = useFirebaseAuth();
  const { streak } = useStreak();
  
  const [isScrolled, setIsScrolled] = useState(false);
  const [mobileOpen, setMobileOpen] = useState(false);
  const [showProfileMenu, setShowProfileMenu] = useState(false);
  const [scrollDirection, setScrollDirection] = useState('up');
  const [lastScrollY, setLastScrollY] = useState(0);

  const menuItems = [
    { id: 'listening', label: 'Luyn Nghe', icon: Headphones, type: 'test', path: ROUTES.TEST },
    { id: 'reading', label: 'Luyn c', icon: BookOpen, type: 'test', path: ROUTES.TEST },
    { id: 'full', label: 'Thi Th', icon: GraduationCap, type: 'exam', path: ROUTES.FULL_EXAM },
    { id: 'grammar', label: 'Ng Php', icon: Sparkles, type: 'practice', path: ROUTES.GRAMMAR },
    { id: 'vocabulary', label: 'T Vng', icon: Languages, type: 'practice', path: ROUTES.VOCABULARY },
  ];

  const bottomMenuItems = [
    { id: 'home', label: 'Trang ch', icon: Home, path: ROUTES.HOME },
    ...menuItems.slice(0, 2),
  ];

  // Scroll effect - Navbar lun hin th, khng b n
  useEffect(() => {
    const handleScroll = () => {
      const currentScrollY = window.scrollY;
      
      if (currentScrollY > lastScrollY && currentScrollY > 100) {
        setScrollDirection('down');
      } else {
        setScrollDirection('up');
      }
      
      setLastScrollY(currentScrollY);
      setIsScrolled(currentScrollY > 20);
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, [lastScrollY]);

  // Body overflow management
  useEffect(() => {
    document.body.style.overflow = mobileOpen ? 'hidden' : 'unset';
    return () => {
      document.body.style.overflow = 'unset';
    };
  }, [mobileOpen]);

  const handleNavClick = useCallback((item) => {
    if (item.type === 'test') onTestTypeChange?.(item.id);
    if (item.type === 'practice') onPracticeTypeChange?.(item.id);
    navigate(item.path);
    setMobileOpen(false);
    setShowProfileMenu(false);
  }, [onTestTypeChange, onPracticeTypeChange, navigate]);

  const handleLogoClick = useCallback(() => {
    navigate(ROUTES.HOME);
    setMobileOpen(false);
  }, [navigate]);

  const isItemActive = (item) => {
    const pathMatch = location.pathname === item.path;
    if (item.type === 'test') return pathMatch && testType === item.id;
    if (item.type === 'practice') return pathMatch && practiceType === item.id;
    return pathMatch;
  };

  const handleSignOut = useCallback(() => {
    signOut();
    setShowProfileMenu(false);
    setMobileOpen(false);
  }, [signOut]);

  const handleProfileClick = useCallback(() => {
    navigate(ROUTES.PROFILE);
    setShowProfileMenu(false);
    setMobileOpen(false);
  }, [navigate]);

  //  FIX: Thm function handleAnswersClick
  const handleAnswersClick = useCallback(() => {
    navigate(ROUTES.ANSWERS);
    setShowProfileMenu(false);
    setMobileOpen(false);
  }, [navigate]);

  const NavButton = ({ item, isActive, onClick }) => {
    const Icon = item.icon;
    return (
      <button
        onClick={onClick}
        className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all whitespace-nowrap ${
          isActive
            ? 'bg-[#00358E] text-white shadow-md'
            : 'text-slate-700 hover:bg-slate-100'
        }`}
      >
        <Icon className="w-4 h-4 flex-shrink-0" />
        <span>{item.label}</span>
      </button>
    );
  };

  const BottomNavItem = ({ item, isActive, onClick }) => {
    const Icon = item.icon;
    return (
      <motion.button
        onClick={onClick}
        whileHover={{ scale: 1.08 }}
        whileTap={{ scale: 0.95 }}
        className={`flex flex-col items-center justify-center gap-1.5 py-2 px-3 rounded-xl transition-all relative group ${
          isActive
            ? 'text-[#00358E]'
            : 'text-slate-600 hover:text-[#00358E]'
        }`}
      >
        <div className={`p-2 rounded-lg transition-all ${
          isActive
            ? 'bg-blue-100'
            : 'group-hover:bg-slate-100'
        }`}>
          <Icon className="w-5 h-5" />
        </div>
        <span className="text-[10px] font-semibold text-center whitespace-nowrap">{item.label}</span>
        {isActive && (
          <motion.div
            layoutId="bottom-active"
            className="absolute bottom-0 h-1 w-8 bg-[#00358E] rounded-full"
          />
        )}
      </motion.button>
    );
  };

  return (
    <>
      {/* NAVBAR - LUN HIN TH, STICKY POSITION */}
      <nav
        className={`fixed top-0 left-0 right-0 z-40 transition-all duration-300 ${
          isScrolled
            ? 'bg-white/70 backdrop-blur-xl shadow-md border-b border-white/40'
            : 'bg-white/30 backdrop-blur-lg border-b border-white/20'
        }`}
      >
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-16 sm:h-20">
            {/* Logo */}
            <button 
              onClick={handleLogoClick}
              className="flex items-center gap-2 cursor-pointer group flex-shrink-0 hover:opacity-80 transition-opacity"
            >
              <div className="w-10 h-10 bg-[#00358E] rounded-lg flex items-center justify-center shadow-lg">
                <img src={logo} alt="Logo" className="w-6 h-6 object-contain" />
              </div>
              <div className="hidden sm:block">
                <h1 className="text-[#00358E] font-black text-lg leading-tight">HUFLIT</h1>
                <p className="text-[#FF7D00] text-xs font-bold tracking-wider uppercase">Exam Center</p>
              </div>
            </button>

            {/* Desktop Menu */}
            <div className="hidden lg:flex items-center gap-1 bg-slate-100 p-1 rounded-2xl">
              {menuItems.map((item) => (
                <NavButton
                  key={item.id}
                  item={item}
                  isActive={isItemActive(item)}
                  onClick={() => handleNavClick(item)}
                />
              ))}
            </div>

            {/* Right Actions */}
            <div className="flex items-center gap-2 sm:gap-3">
              {/* Streak Badge */}
              {isSignedIn && streak > 0 && (
                <motion.div 
                  initial={{ opacity: 0, scale: 0.5 }}
                  animate={{ opacity: 1, scale: 1 }}
                  className="hidden xs:flex items-center gap-1.5 bg-orange-50 px-3 py-1.5 rounded-full border border-orange-100"
                >
                  <Flame className="w-4 h-4 text-[#FF7D00] fill-[#FF7D00] animate-pulse" />
                  <span className="text-[#FF7D00] font-bold text-xs sm:text-sm">{streak} Ngy</span>
                </motion.div>
              )}

              {/* Auth Button / Profile */}
              {isSignedIn ? (
                <div className="relative">
                  <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={() => setShowProfileMenu(!showProfileMenu)}
                    className="flex items-center gap-2 p-1 rounded-full hover:bg-slate-100 transition-colors"
                  >
                    <img
                      src={user?.photoURL}
                      alt="Profile"
                      className="w-8 h-8 rounded-full border-2 border-white shadow-sm object-cover"
                    />
                    <ChevronDown className="hidden sm:block w-4 h-4 text-slate-400" />
                  </motion.button>

                  {/* Profile Dropdown */}
                  <AnimatePresence>
                    {showProfileMenu && (
                      <>
                        <motion.div
                          initial={{ opacity: 0 }}
                          animate={{ opacity: 1 }}
                          exit={{ opacity: 0 }}
                          className="fixed inset-0 z-20"
                          onClick={() => setShowProfileMenu(false)}
                        />
                        <motion.div 
                          initial={{ opacity: 0, y: 10 }}
                          animate={{ opacity: 1, y: 0 }}
                          exit={{ opacity: 0, y: 10 }}
                          className="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-slate-200 p-2 z-30"
                        >
                          <button 
                            onClick={handleProfileClick}
                            className="w-full flex items-center gap-3 px-3 py-2.5 text-sm text-slate-700 hover:bg-blue-50 rounded-lg transition-colors font-medium"
                          >
                            <User className="w-4 h-4" />
                            <span>Trang c nhn</span>
                          </button>
                          {/*  FIX: Thm nt p n */}
                          <button 
                            onClick={handleAnswersClick}
                            className="w-full flex items-center gap-3 px-3 py-2.5 text-sm text-slate-700 hover:bg-blue-50 rounded-lg transition-colors font-medium"
                          >
                            <FileText className="w-4 h-4" />
                            <span>p n</span>
                          </button>
                          <div className="border-t border-slate-100 my-1" />
                          <button
                            onClick={handleSignOut}
                            className="w-full flex items-center gap-3 px-3 py-2.5 text-sm text-red-500 hover:bg-red-50 rounded-lg transition-colors font-medium"
                          >
                            <LogOut className="w-4 h-4" />
                            <span>ng xut</span>
                          </button>
                        </motion.div>
                      </>
                    )}
                  </AnimatePresence>
                </div>
              ) : (
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={signInWithGoogle}
                  className="bg-[#00358E] text-white px-4 sm:px-6 py-2 rounded-lg font-bold text-xs sm:text-sm hover:bg-[#002763] transition-all whitespace-nowrap"
                >
                  <span className="hidden sm:inline">ng nhp</span>
                  <span className="sm:hidden">Login</span>
                </motion.button>
              )}

              {/* Mobile Menu Button */}
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => setMobileOpen(!mobileOpen)}
                className="lg:hidden p-2 rounded-lg hover:bg-slate-100 transition-colors"
              >
                {mobileOpen ? (
                  <X className="w-5 h-5 text-slate-600" />
                ) : (
                  <Menu className="w-5 h-5 text-slate-600" />
                )}
              </motion.button>
            </div>
          </div>
        </div>
      </nav>

      {/* Mobile Menu Panel */}
      <AnimatePresence>
        {mobileOpen && (
          <>
            {/* Overlay */}
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              onClick={() => setMobileOpen(false)}
              className="fixed inset-0 bg-black/40 backdrop-blur-sm z-20 lg:hidden"
            />

            {/* Menu Panel */}
            <motion.div
              initial={{ x: '100%' }}
              animate={{ x: 0 }}
              exit={{ x: '100%' }}
              transition={{ type: 'spring', damping: 30, stiffness: 300 }}
              className="fixed right-0 top-0 h-full w-64 sm:w-72 bg-white/95 backdrop-blur-xl z-30 lg:hidden overflow-y-auto shadow-2xl"
            >
              {/* Header */}
              <div className="sticky top-0 flex items-center justify-between p-4 border-b border-slate-200 bg-white/95 backdrop-blur-sm">
                <h2 className="text-lg font-bold text-slate-800">Menu</h2>
                <motion.button
                  whileHover={{ scale: 1.1 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={() => setMobileOpen(false)}
                  className="p-1 hover:bg-slate-100 rounded-lg transition-colors"
                >
                  <X className="w-5 h-5 text-slate-600" />
                </motion.button>
              </div>

              {/* Menu Items */}
              <div className="p-3 space-y-1">
                {menuItems.map((item, index) => (
                  <motion.button
                    key={item.id}
                    initial={{ opacity: 0, x: 20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: index * 0.05 }}
                    onClick={() => handleNavClick(item)}
                    whileHover={{ x: 4 }}
                    whileTap={{ scale: 0.95 }}
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all font-medium text-sm ${
                      isItemActive(item)
                        ? 'bg-gradient-to-r from-[#00358E] to-[#002763] text-white shadow-lg'
                        : 'text-slate-700 hover:bg-slate-100'
                    }`}
                  >
                    <item.icon className="w-5 h-5 flex-shrink-0" />
                    <span>{item.label}</span>
                  </motion.button>
                ))}
              </div>

              {/* User Section */}
              {isSignedIn && user && (
                <motion.div 
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="border-t border-slate-200 p-3 space-y-3"
                >
                  {/* User Card */}
                  <div className="flex items-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-br from-blue-50 to-slate-50 border border-slate-200">
                    <img
                      src={user.photoURL}
                      alt="User"
                      className="w-10 h-10 rounded-full border-2 border-white shadow-md object-cover flex-shrink-0"
                    />
                    <div className="flex-1 min-w-0">
                      <p className="text-sm font-bold text-slate-800 truncate">
                        {user.displayName || 'User'}
                      </p>
                      <p className="text-xs text-slate-500 truncate">{user.email}</p>
                    </div>
                  </div>

                  {/* Streak Card */}
                  {streak > 0 && (
                    <motion.div 
                      initial={{ opacity: 0, scale: 0.9 }}
                      animate={{ opacity: 1, scale: 1 }}
                      className="flex items-center justify-center gap-2 bg-gradient-to-r from-orange-50 to-yellow-50 px-3 py-3 rounded-xl border border-orange-200"
                    >
                      <Flame className="w-5 h-5 text-[#FF7D00] fill-[#FF7D00] animate-pulse flex-shrink-0" />
                      <div className="text-center">
                        <p className="text-[#FF7D00] font-bold text-sm">{streak}</p>
                        <p className="text-[#FF7D00] text-xs font-semibold">ngy lin tip</p>
                      </div>
                    </motion.div>
                  )}

                  {/* Action Buttons */}
                  <motion.button 
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={handleProfileClick}
                    className="w-full flex items-center justify-center gap-2 px-4 py-2.5 text-slate-700 hover:bg-blue-100 rounded-lg transition-colors font-semibold text-sm"
                  >
                    <User className="w-4 h-4" />
                    <span>Trang c nhn</span>
                  </motion.button>
                  
                  {/*  FIX: Thm nt p n  mobile */}
                  <motion.button 
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={handleAnswersClick}
                    className="w-full flex items-center justify-center gap-2 px-4 py-2.5 text-slate-700 hover:bg-blue-100 rounded-lg transition-colors font-semibold text-sm"
                  >
                    <FileText className="w-4 h-4" />
                    <span>p n</span>
                  </motion.button>

                  <motion.button
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={handleSignOut}
                    className="w-full flex items-center justify-center gap-2 px-4 py-2.5 text-red-500 hover:bg-red-100 rounded-lg transition-colors font-semibold text-sm"
                  >
                    <LogOut className="w-4 h-4" />
                    <span>ng xut</span>
                  </motion.button>
                </motion.div>
              )}
            </motion.div>
          </>
        )}
      </AnimatePresence>

      {/* Bottom Navigation for Mobile - Lun hin th */}
      <motion.div 
        className="fixed bottom-0 left-0 right-0 sm:hidden bg-white/50 backdrop-blur-xl border-t border-white/30 shadow-lg z-30"
        animate={{ y: 0 }}
        transition={{ duration: 0.3 }}
      >
        <div className="flex items-center justify-around px-2 py-3">
          {bottomMenuItems.map((item) => (
            <BottomNavItem
              key={item.id}
              item={item}
              isActive={isItemActive(item)}
              onClick={() => handleNavClick(item)}
            />
          ))}
          {/* More Menu */}
          <motion.button
            whileHover={{ scale: 1.08 }}
            whileTap={{ scale: 0.95 }}
            onClick={() => setMobileOpen(true)}
            className="flex flex-col items-center justify-center gap-1.5 py-2 px-3 rounded-xl hover:bg-slate-100 transition-all"
          >
            <div className="p-2 rounded-lg hover:bg-slate-200">
              <Menu className="w-5 h-5 text-slate-600" />
            </div>
            <span className="text-[10px] font-semibold text-slate-600">Thm</span>
          </motion.button>
        </div>
      </motion.div>

      {/* Spacer - iu chnh theo navbar height */}
      <div className="h-16 sm:h-20" />
    </>
  );
};

export default Navbar;
</file>

<file path="src/config/voiceConfig.js">
// ==================== IMPROVED TTS CONFIGURATION ====================

/**
 *  Enhanced Gender Categories
 */
export const GENDER_CATEGORIES = {
  FEMALE: [
    'Woman', 'Sarah', 'Anna', 'Linda', 'Client 2', 'Sales Associate', 
    'Older Woman', 'Student B', 'Student 2', 'Counselor', 'Emma', 
    'Trang', 'Jennifer', 'Lisa', 'Doctor Chen'
  ],
  MALE: [
    'Man', 'Kevin', 'Mark', 'Dr.Chen', 'Ben', 'Client 1', 'Professor', 
    'John', 'Mike', 'Waiter', 'Customer', 'Manager', 'HR Rep', 
    'Interviewer 1', 'Interviewer 2', 'Candidate', 'Professor A', 
    'Student 1', 'Student', 'Parent', 'Travel Agent', 'Narrator', 
    'Dr. Harrison', 'Smith', 'Tom', 'Peter', 'Alex', 'Training', 
    'HR', 'Professor Mitchell'
  ],
  NEUTRAL: ['Narrator', 'System', 'AI Assistant']
};

/**
 *  Enhanced Voice Settings - Thm emotional baseline + naturalness
 */
export const VOICE_SETTINGS = {
  // === MALE VOICES ===
  Mark: { pitch: 0.89, rate: 0.95, volume: 0.85, energy: 'medium', formality: 'professional' },
  Man: { pitch: 0.65, rate: 0.95, volume: 0.85, energy: 'medium', formality: 'casual' },
  Alex: { pitch: 0.88, rate: 0.95, volume: 0.85, energy: 'medium', formality: 'professional' },
  HR: { pitch: 0.45, rate: 0.95, volume: 0.85, energy: 'medium', formality: 'formal' },
  Training: { pitch: 0.87, rate: 0.95, volume: 0.85, energy: 'high', formality: 'professional' },
  Tom: { pitch: 1.06, rate: 0.95, volume: 0.85, energy: 'medium', formality: 'casual' },
  Peter: { pitch: 0.88, rate: 0.90, volume: 0.90, energy: 'low', formality: 'formal' },
  Kevin: { pitch: 0.85, rate: 0.95, volume: 0.85, energy: 'high', formality: 'casual' },
  John: { pitch: 0.82, rate: 0.88, volume: 0.90, energy: 'medium', formality: 'formal' },
  Ben: { pitch: 0.50, rate: 0.92, volume: 0.88, energy: 'high', formality: 'casual' },
  'Doctor Chen': { pitch: 0.38, rate: 0.90, volume: 0.85, energy: 'low', formality: 'formal' },
  'Professor Mitchell': { pitch: 0.45, rate: 0.88, volume: 0.87, energy: 'low', formality: 'formal' },
  'Dr. Harrison': { pitch: 0.87, rate: 0.88, volume: 0.87, energy: 'medium', formality: 'formal' },
  Mike: { pitch: 0.90, rate: 0.98, volume: 0.87, energy: 'high', formality: 'casual' },
  Professor: { pitch: 0.55, rate: 0.88, volume: 0.87, energy: 'low', formality: 'formal' },
  'Professor A': { pitch: 0.83, rate: 0.85, volume: 0.90, energy: 'low', formality: 'formal' },
  Waiter: { pitch: 0.92, rate: 0.95, volume: 0.85, energy: 'high', formality: 'casual' },
  Customer: { pitch: 0.88, rate: 0.98, volume: 0.88, energy: 'high', formality: 'casual' },
  Manager: { pitch: 0.80, rate: 0.90, volume: 0.92, energy: 'medium', formality: 'professional' },
  'HR Rep': { pitch: 0.88, rate: 0.92, volume: 0.86, energy: 'medium', formality: 'formal' },
  'Interviewer 1': { pitch: 0.86, rate: 0.92, volume: 0.87, energy: 'medium', formality: 'professional' },
  Candidate: { pitch: 0.92, rate: 0.95, volume: 0.84, energy: 'high', formality: 'formal' },
  'Client 1': { pitch: 0.87, rate: 0.95, volume: 0.86, energy: 'medium', formality: 'professional' },
  Parent: { pitch: 0.88, rate: 0.92, volume: 0.85, energy: 'medium', formality: 'casual' },
  'Travel Agent': { pitch: 0.90, rate: 0.95, volume: 0.87, energy: 'high', formality: 'professional' },
  Student: { pitch: 0.95, rate: 1.00, volume: 0.83, energy: 'high', formality: 'casual' },
  'Student 1': { pitch: 0.94, rate: 1.00, volume: 0.82, energy: 'high', formality: 'casual' },

  // === FEMALE VOICES ===
  Sarah: { pitch: 1.25, rate: 0.95, volume: 0.85, energy: 'high', formality: 'professional' },
  Trang: { pitch: 1.30, rate: 0.95, volume: 0.88, energy: 'medium', formality: 'casual' },
  Emma: { pitch: 1.28, rate: 0.92, volume: 0.90, energy: 'high', formality: 'casual' },
  Jennifer: { pitch: 1.28, rate: 0.92, volume: 0.90, energy: 'medium', formality: 'professional' },
  Anna: { pitch: 1.32, rate: 0.95, volume: 0.88, energy: 'high', formality: 'casual' },
  Linda: { pitch: 1.32, rate: 0.95, volume: 0.88, energy: 'medium', formality: 'professional' },
  Lisa: { pitch: 1.30, rate: 0.90, volume: 0.85, energy: 'medium', formality: 'formal' },
  'Sales Associate': { pitch: 1.28, rate: 0.98, volume: 0.88, energy: 'high', formality: 'casual' },
  'Interviewer 2': { pitch: 1.25, rate: 0.95, volume: 0.85, energy: 'medium', formality: 'professional' },
  Counselor: { pitch: 1.22, rate: 0.88, volume: 0.82, energy: 'low', formality: 'formal' },
  'Older Woman': { pitch: 1.20, rate: 0.85, volume: 0.80, energy: 'low', formality: 'formal' },
  'Client 2': { pitch: 1.28, rate: 0.95, volume: 0.87, energy: 'medium', formality: 'professional' },
  'Student 2': { pitch: 1.25, rate: 1.00, volume: 0.84, energy: 'high', formality: 'casual' },
  'Student B': { pitch: 1.25, rate: 1.00, volume: 0.84, energy: 'high', formality: 'casual' },

  // === NEUTRAL ===
  Narrator: { pitch: 1.0, rate: 0.95, volume: 0.90, energy: 'medium', formality: 'formal' },

  // === DEFAULT ===
  default: { pitch: 1.0, rate: 0.95, volume: 0.85, energy: 'medium', formality: 'neutral' }
};

/**
 *  Emotion Adjustments - p dng cho TTS
 * Web Speech API ch support pitch + rate + volume
 */
export const EMOTION_ADJUSTMENTS = {
  excited: {
    pitchMultiplier: 1.15,
    rateMultiplier: 1.15,
    volumeMultiplier: 1.1,
    pauseAfter: 200
  },
  happy: {
    pitchMultiplier: 1.08,
    rateMultiplier: 1.05,
    volumeMultiplier: 1.05,
    pauseAfter: 100
  },
  sad: {
    pitchMultiplier: 0.92,
    rateMultiplier: 0.85,
    volumeMultiplier: 0.95,
    pauseAfter: 300
  },
  angry: {
    pitchMultiplier: 1.05,
    rateMultiplier: 1.2,
    volumeMultiplier: 1.15,
    pauseAfter: 150
  },
  neutral: {
    pitchMultiplier: 1.0,
    rateMultiplier: 1.0,
    volumeMultiplier: 1.0,
    pauseAfter: 0
  }
};

/**
 *  Optimized Speaker Themes
 */
export const SPEAKER_THEMES = {
  Mark: { gradient: 'from-blue-50 to-blue-100', border: 'border-blue-400', text: 'text-blue-900' },
  'Dr.Chen': { gradient: 'from-blue-50 to-blue-100', border: 'border-blue-400', text: 'text-blue-900' },
  Sarah: { gradient: 'from-pink-50 to-rose-100', border: 'border-pink-400', text: 'text-pink-900' },
  Anna: { gradient: 'from-pink-50 to-rose-100', border: 'border-pink-400', text: 'text-pink-900' },
  Mike: { gradient: 'from-green-50 to-emerald-100', border: 'border-green-400', text: 'text-green-900' },
  'Client 1': { gradient: 'from-emerald-50 to-emerald-100', border: 'border-emerald-400', text: 'text-emerald-900' },
  John: { gradient: 'from-purple-50 to-violet-100', border: 'border-purple-400', text: 'text-purple-900' },
  Counselor: { gradient: 'from-purple-50 to-violet-100', border: 'border-purple-400', text: 'text-purple-900' },
  Waiter: { gradient: 'from-yellow-50 to-amber-100', border: 'border-yellow-400', text: 'text-yellow-900' },
  'Client 2': { gradient: 'from-amber-50 to-amber-100', border: 'border-amber-400', text: 'text-amber-900' },
  'Older Woman': { gradient: 'from-orange-50 to-orange-100', border: 'border-orange-400', text: 'text-orange-900' },
  Professor: { gradient: 'from-indigo-50 to-indigo-100', border: 'border-indigo-400', text: 'text-indigo-900' },
  'Professor A': { gradient: 'from-indigo-50 to-indigo-100', border: 'border-indigo-400', text: 'text-indigo-900' },
  Customer: { gradient: 'from-teal-50 to-teal-100', border: 'border-teal-400', text: 'text-teal-900' },
  'Student 1': { gradient: 'from-teal-50 to-teal-100', border: 'border-teal-400', text: 'text-teal-900' },
  'Travel Agent': { gradient: 'from-cyan-50 to-cyan-100', border: 'border-cyan-400', text: 'text-cyan-900' },
  'Student B': { gradient: 'from-cyan-50 to-cyan-100', border: 'border-cyan-400', text: 'text-cyan-900' },
  'Sales Associate': { gradient: 'from-rose-50 to-rose-100', border: 'border-rose-400', text: 'text-rose-900' },
  Manager: { gradient: 'from-slate-50 to-slate-100', border: 'border-slate-400', text: 'text-slate-900' },
  Narrator: { gradient: 'from-gray-50 to-gray-100', border: 'border-gray-400', text: 'text-gray-900' },
  'Interviewer 1': { gradient: 'from-sky-50 to-sky-100', border: 'border-sky-400', text: 'text-sky-900' },
  'Interviewer 2': { gradient: 'from-lime-50 to-lime-100', border: 'border-lime-400', text: 'text-lime-900' },
  Candidate: { gradient: 'from-fuchsia-50 to-fuchsia-100', border: 'border-fuchsia-400', text: 'text-fuchsia-900' },
  default: { gradient: 'from-gray-50 to-gray-100', border: 'border-gray-400', text: 'text-gray-900' }
};

/**
 *  Speaker Icons
 */
export const SPEAKER_ICONS = {
  'Travel Agent': '', 'Client 1': '', 'Client 2': '', Manager: '',
  'HR Rep': '', 'Interviewer 1': '', 'Interviewer 2': '', Candidate: '',
  Professor: '', 'Professor A': '', 'Professor Mitchell': '', 'Dr. Harrison': '',
  'Student 1': '', 'Student 2': '', 'Student B': '', Student: '',
  Waiter: '', Customer: '', 'Sales Associate': '',
  Counselor: '', 'Doctor Chen': '',
  Mark: '', Sarah: '', Anna: '', Ben: '', Alex: '',
  Mike: '', Kevin: '', John: '', Tom: '', Peter: '',
  Emma: '', Trang: '', Lisa: '', Jennifer: '', Linda: '',
  'Older Woman': '', Parent: '', Man: '', Woman: '',
  Narrator: '', HR: '', Training: '',
  default: ''
};

// ==================== ENHANCED UTILITY FUNCTIONS ====================

const voiceCache = new Map();
const themeCache = new Map();
const genderCache = new Map();
let allSpeakersCache = null;

export const getSpeakerVoice = (speakerName) => {
  if (voiceCache.has(speakerName)) {
    return voiceCache.get(speakerName);
  }
  const voice = VOICE_SETTINGS[speakerName] || VOICE_SETTINGS.default;
  voiceCache.set(speakerName, voice);
  return voice;
};

export const getSpeakerColor = (speakerName) => {
  if (themeCache.has(speakerName)) {
    return themeCache.get(speakerName);
  }
  const theme = SPEAKER_THEMES[speakerName] || SPEAKER_THEMES.default;
  const colorClass = `bg-gradient-to-br ${theme.gradient}`;
  themeCache.set(speakerName, colorClass);
  return colorClass;
};

export const getSpeakerIcon = (speakerName) => {
  return SPEAKER_ICONS[speakerName] || SPEAKER_ICONS.default;
};

/**
 *  NEW: Apply emotion to voice settings
 */
export const applyEmotionToVoice = (speakerName, emotion = 'neutral') => {
  const baseVoice = getSpeakerVoice(speakerName);
  const emotionMod = EMOTION_ADJUSTMENTS[emotion] || EMOTION_ADJUSTMENTS.neutral;
  
  return {
    rate: Math.max(0.5, Math.min(2.0, baseVoice.rate * emotionMod.rateMultiplier)),
    pitch: Math.max(0.5, Math.min(2.0, baseVoice.pitch * emotionMod.pitchMultiplier)),
    volume: Math.max(0.0, Math.min(1.0, baseVoice.volume * emotionMod.volumeMultiplier)),
    pauseAfter: emotionMod.pauseAfter
  };
};

/**
 *  NEW: Get TTS options with emotion support
 */
export const getSpeakerTTSOptions = (speakerName, emotion = 'neutral', rateMultiplier = 1.0, pitchMultiplier = 1.0) => {
  const voice = applyEmotionToVoice(speakerName, emotion);
  
  return {
    rate: Math.max(0.5, Math.min(2.0, voice.rate * rateMultiplier)),
    pitch: Math.max(0.5, Math.min(2.0, voice.pitch * pitchMultiplier)),
    volume: voice.volume,
    pauseAfter: voice.pauseAfter
  };
};

/**
 *  NEW: Process text with natural pauses
 * Thm pause trc question marks, du chm, ellipsis
 */
export const processTextForNaturalSpeech = (text) => {
  return text
    .replace(/([.!?])\s+/g, '$1 <break time="300ms"/> ') // Pause after sentences
    .replace(/\.\.\./g, '<break time="200ms"/>') // Pause for ellipsis
    .replace(/,/g, '<break time="150ms"/>'); // Short pause for commas
};

/**
 *  NEW: Detect and adjust for questions
 */
export const isQuestion = (text) => {
  return text.trim().endsWith('?');
};

/**
 *  NEW: Analyze emotion from text
 */
export const analyzeTextEmotion = (text) => {
  if (!text || typeof text !== 'string') return 'neutral';
  
  const lower = text.toLowerCase();
  
  // Excited patterns
  if (/\b(wow|amazing|great|excellent|fantastic|awesome|incredible)\b/.test(lower) || 
      (text.match(/!/g) || []).length >= 2) {
    return 'excited';
  }
  
  // Angry patterns
  if (/\b(angry|mad|terrible|awful|horrible|hate)\b/.test(lower) || 
      (text.match(/!/g) || []).length >= 1 && text.length < 30) {
    return 'angry';
  }
  
  // Happy patterns
  if (/\b(happy|glad|love|wonderful|delighted)\b/.test(lower)) {
    return 'happy';
  }
  
  // Sad patterns
  if (/\b(sad|sorry|regret|disappointed|upset)\b/.test(lower)) {
    return 'sad';
  }
  
  return 'neutral';
};

export const isFemaleVoice = (speakerName) => {
  const cacheKey = `female_${speakerName}`;
  if (genderCache.has(cacheKey)) {
    return genderCache.get(cacheKey);
  }
  const result = GENDER_CATEGORIES.FEMALE.includes(speakerName);
  genderCache.set(cacheKey, result);
  return result;
};

export const isMaleVoice = (speakerName) => {
  const cacheKey = `male_${speakerName}`;
  if (genderCache.has(cacheKey)) {
    return genderCache.get(cacheKey);
  }
  const result = GENDER_CATEGORIES.MALE.includes(speakerName);
  genderCache.set(cacheKey, result);
  return result;
};

export const getAllSpeakers = () => {
  if (allSpeakersCache) {
    return allSpeakersCache;
  }
  allSpeakersCache = [
    ...GENDER_CATEGORIES.FEMALE,
    ...GENDER_CATEGORIES.MALE,
    ...GENDER_CATEGORIES.NEUTRAL
  ].filter((v, i, a) => a.indexOf(v) === i);
  return allSpeakersCache;
};

export const isValidVoiceSettings = (settings) => {
  if (!settings || typeof settings !== 'object') return false;
  const { pitch, rate, volume } = settings;
  return (
    typeof pitch === 'number' && pitch >= 0.5 && pitch <= 2.0 &&
    typeof rate === 'number' && rate >= 0.1 && rate <= 10.0 &&
    (!volume || (typeof volume === 'number' && volume >= 0.0 && volume <= 1.0))
  );
};

export const clearCaches = () => {
  voiceCache.clear();
  themeCache.clear();
  genderCache.clear();
  allSpeakersCache = null;
  console.log(' All caches cleared');
};

// ==================== USAGE EXAMPLE ====================

/**
 *  Usage trong TTS synthesis:
 * 
 * const text = "This is amazing!";
 * const speaker = "Sarah";
 * const emotion = analyzeTextEmotion(text);
 * const options = getSpeakerTTSOptions(speaker, emotion);
 * 
 * const utterance = new SpeechSynthesisUtterance(text);
 * utterance.pitch = options.pitch;
 * utterance.rate = options.rate;
 * utterance.volume = options.volume;
 * 
 * if (isQuestion(text)) {
 *   utterance.pitch *= 1.05; // Slightly raise pitch for questions
 * }
 * 
 * window.speechSynthesis.speak(utterance);
 * 
 * if (options.pauseAfter) {
 *   setTimeout(() => {
 *     // Next speech or action
 *   }, options.pauseAfter);
 * }
 */

export default {
  GENDER_CATEGORIES,
  VOICE_SETTINGS,
  EMOTION_ADJUSTMENTS,
  SPEAKER_THEMES,
  SPEAKER_ICONS,
  getSpeakerVoice,
  getSpeakerColor,
  getSpeakerIcon,
  getSpeakerTTSOptions,
  applyEmotionToVoice,
  processTextForNaturalSpeech,
  isQuestion,
  analyzeTextEmotion,
  isFemaleVoice,
  isMaleVoice,
  getAllSpeakers,
  isValidVoiceSettings,
  clearCaches
};

export const VOICE_CONFIG = {
  FEMALE_SPEAKERS: GENDER_CATEGORIES.FEMALE,
  MALE_SPEAKERS: GENDER_CATEGORIES.MALE,
  SPEAKER_CONFIG: VOICE_SETTINGS
};

export const SPEAKER_STYLES = Object.fromEntries(
  Object.entries(SPEAKER_THEMES).map(([name, theme]) => [
    name,
    `bg-gradient-to-br ${theme.gradient} border ${theme.border} ${theme.text}`
  ])
);
</file>

<file path="package.json">
{
  "name": "listening",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "homepage": "https://khoale-dev-code.github.io/huflit-test/",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "start": "vite",
    "test": "echo \"Error: no test specified\" && exit 1",
    "eject": "echo \"Not supported in Vite\" && exit 1",
    "upload:all": "node scripts/uploadAllData.js",
    "upload:real": "node scripts/uploadRealData.js",
    "upload:vocabulary": "node scripts/uploadvocabularyData.js",
    "upload:grammar": "node scripts/uploadGrammarData.js",
    "upload:exam": "node scripts/uploadExamData.js",
    "firebase:deploy": "firebase deploy",
    "firebase:console": "start https://console.firebase.google.com/project/huflit-test-4ce25/overview",
    "firebase:hosting": "firebase open hosting",
    "preview": "vite preview",
    "deploy": "gh-pages -d dist",
    "create-admin": "node scripts/createAdmin.js"
  },
  "dependencies": {
    "@clerk/clerk-react": "^5.53.8",
    "@elevenlabs/elevenlabs-js": "^2.28.0",
    "@heroicons/react": "^2.2.0",
    "canvas-confetti": "^1.9.4",
    "dotenv": "^17.2.3",
    "file-saver": "^2.0.5",
    "firebase": "^12.6.0",
    "firebase-admin": "^13.6.0",
    "framer-motion": "^12.23.26",
    "jspdf": "^3.0.3",
    "jspdf-autotable": "^5.0.2",
    "lucide-react": "^0.563.0",
    "react": "^19.1.1",
    "react-audio-player": "^0.17.0",
    "react-dom": "^19.1.1",
    "react-icons": "^5.5.0",
    "react-markdown": "^10.1.0",
    "react-router-dom": "^6.30.2",
    "react-window": "^2.2.5",
    "recharts": "^3.4.1",
    "rehype-raw": "^7.0.0",
    "remark-gfm": "^4.0.1",
    "socket.io-client": "^4.8.1",
    "web-vitals": "^5.1.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.36.0",
    "@types/react": "^19.1.16",
    "@types/react-dom": "^19.1.9",
    "@vitejs/plugin-react": "^5.0.4",
    "autoprefixer": "^10.4.21",
    "baseline-browser-mapping": "^2.9.18",
    "eslint": "^9.36.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.22",
    "gh-pages": "^6.3.0",
    "globals": "^16.4.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.18",
    "terser": "^5.44.1",
    "vite": "^7.2.6"
  }
}
</file>

<file path="src/App.jsx">
import React, { useMemo, useState, lazy, Suspense, useCallback, memo, useEffect } from 'react';
import { BrowserRouter as Router, Routes, Route, useNavigate } from 'react-router-dom';
import { loadExamData, getAllExamMetadata } from './data/examData';
import { useAppState } from './hooks/useAppState';
import { useSplashScreen } from './hooks/useSplashScreen.js';
import MainLayout from './components/layout/MainLayout';
import { LoadingSpinner } from './components/common/LoadingSpinner';
import HeaderSection from './components/sections/HeaderSection';
import UserProfile from './components/Auth/UserProfile.jsx';
import PartSelector from './components/Display/PartSelector.jsx';
import ContentDisplay from './components/Display/ContentDisplay';
import QuestionDisplay from './components/Display/QuestionDisplay.jsx';
import ResultsDisplay from './components/Display/ResultsDisplay.jsx';
import VocabularyPractice from './components/Voca/VocabularyPractice.jsx';
import AuthModal from './components/Auth/AuthModal.jsx';
import { useOnlineUsers } from './hooks/useOnlineUsers.js';
import ExamAnswersPage from './components/pages/ExamAnswersPage.jsx';
import { ROUTES } from './config/routes';
import HomePage from './pages/HomePage.jsx';

const AdminApp = lazy(() => import('./admin/AdminApp'));
const NotFoundPage = lazy(() => import('./components/pages/NotFoundPage.jsx'));
const GrammarReview = lazy(() => import('./components/Grama/GrammarReview.jsx'));
const FullExamMode = lazy(() => import('./components/FullExam/FullExamMode.jsx'));

import { Trophy, FileText, Zap, BarChart3, ArrowLeft } from 'lucide-react';

// --- INFO BADGE & COMPONENTS ---
const InfoBadge = memo(({ icon: Icon, label, value, color = 'indigo' }) => {
  const colorMap = {
    indigo: 'bg-indigo-50 border-indigo-200 text-indigo-700',
    emerald: 'bg-emerald-50 border-emerald-200 text-emerald-700',
    amber: 'bg-amber-50 border-amber-200 text-amber-700',
    purple: 'bg-purple-50 border-purple-200 text-purple-700',
  };

  return (
    <div className={`flex items-center gap-2 px-3 py-2 rounded-lg border-2 ${colorMap[color]}`}>
      <Icon className="w-4 h-4 flex-shrink-0" strokeWidth={2} />
      <div className="flex-1 min-w-0">
        <p className="text-xs font-semibold uppercase tracking-wider">{label}</p>
        <p className="text-sm font-bold truncate">{value}</p>
      </div>
    </div>
  );
});

InfoBadge.displayName = 'InfoBadge';

const StatsGrid = memo(({ score, isSignedIn }) => {
  if (!isSignedIn || score.total === 0) return null;

  return (
    <div className="bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm">
      <div className="flex items-center gap-3 mb-4">
        <div className="p-2 rounded-lg bg-indigo-100">
          <BarChart3 className="w-5 h-5 text-indigo-700" strokeWidth={2} />
        </div>
        <h3 className="text-lg font-bold text-slate-900">Kt qu</h3>
      </div>

      <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <InfoBadge 
          icon={FileText} 
          label="Tng cu" 
          value={score.total}
          color="indigo"
        />
        <InfoBadge 
          icon={Trophy} 
          label="Cu ng" 
          value={score.correct}
          color="emerald"
        />
        <InfoBadge 
          icon={FileText} 
          label="Cu sai" 
          value={score.total - score.correct}
          color="amber"
        />
        <InfoBadge 
          icon={Zap} 
          label="T l" 
          value={`${score.percentage.toFixed(0)}%`}
          color="purple"
        />
      </div>
    </div>
  );
});

StatsGrid.displayName = 'StatsGrid';

const BackButton = memo(({ onClick, show = true }) => {
  if (!show) return null;
  
 
});

BackButton.displayName = 'BackButton';

// --- MEMOIZED COMPONENTS ---
const MemoizedHeaderSection = memo(HeaderSection);
const MemoizedUserProfile = memo(UserProfile);
const MemoizedPartSelector = memo(PartSelector);
const MemoizedContentDisplay = memo(ContentDisplay);
const MemoizedQuestionDisplay = memo(QuestionDisplay);
const MemoizedResultsDisplay = memo(ResultsDisplay);

// --- PAGE COMPONENTS ---
const PartTestContent = memo(({
  isSignedIn,
  user,
  selectedExam,
  handleExamChange,
  testType,
  handleTestTypeChange,
  selectedPart,
  handlePartChange,
  partData,
  currentQuestionIndex,
  setCurrentQuestionIndex,
  answers,
  handleAnswerSelect,
  showResults,
  handleSubmit,
  handleReset,
  score,
}) => {
  const isSplitLayoutPart = testType === 'reading' && 
    (selectedPart === 'part6' || selectedPart === 'part7' || selectedPart === 'part8');

  return (
    <div className="w-full">
      {/* User Profile - Compact */}
      {isSignedIn && (
        <div className="mb-4">
          <MemoizedUserProfile />
        </div>
      )}

      {/* Part Selector */}
      <div className="mb-6">
        <MemoizedPartSelector
          selectedExam={selectedExam}
          onExamChange={handleExamChange}
          testType={testType}
          onTestTypeChange={(e) => handleTestTypeChange(e.target.value)}
          selectedPart={selectedPart}
          onPartChange={handlePartChange}
        />
      </div>

      {/* Content & Questions Layout */}
      {isSplitLayoutPart ? (
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          {/* Left Column - Content */}
          <div className="order-1 w-full">
            <div className="space-y-3">
              <div className="flex items-center gap-2 px-1">
                <div className="w-1 h-6 rounded-full bg-indigo-600" />
                <p className="text-xs font-bold text-slate-600 uppercase tracking-wider">Ni dung</p>
              </div>
              <div className="relative z-20">
                <MemoizedContentDisplay
                  partData={partData}
                  selectedPart={selectedPart}
                  currentQuestionIndex={currentQuestionIndex}
                  testType={testType}
                  examId={selectedExam}
                />
              </div>
            </div>
          </div>
          
          {/* Right Column - Questions */}
          <div className="order-2 w-full">
            <div className="space-y-3">
              <MemoizedQuestionDisplay
                selectedPart={selectedPart}
                selectedExam={selectedExam}
                partData={partData}
                currentQuestionIndex={currentQuestionIndex}
                onQuestionChange={setCurrentQuestionIndex}
                answers={answers}
                onAnswerSelect={handleAnswerSelect}
                showResults={showResults}
                onSubmit={handleSubmit}
                testType={testType}
              />
            </div>
          </div>
        </div>
      ) : (
        <div className="space-y-6 mb-6">
          {/* Full Width - Content */}
          <div className="space-y-3 relative z-20">
            <MemoizedContentDisplay
              partData={partData}
              selectedPart={selectedPart}
              currentQuestionIndex={currentQuestionIndex}
              testType={testType}
              examId={selectedExam}
            />
          </div>

          {/* Full Width - Questions */}
          <div className="space-y-3">
            <MemoizedQuestionDisplay
              selectedPart={selectedPart}
              selectedExam={selectedExam}
              partData={partData}
              currentQuestionIndex={currentQuestionIndex}
              onQuestionChange={setCurrentQuestionIndex}
              answers={answers}
              onAnswerSelect={handleAnswerSelect}
              showResults={showResults}
              onSubmit={handleSubmit}
              testType={testType}
            />
          </div>
        </div>
      )}

      {/* Results Section */}
      {showResults && (
        <div className="mb-6">
          <MemoizedResultsDisplay
            score={score}
            partData={partData}
            answers={answers}
            onReset={handleReset}
          />
        </div>
      )}

      {/* Stats Grid */}
      <StatsGrid score={score} isSignedIn={isSignedIn} />
    </div>
  );
});

PartTestContent.displayName = 'PartTestContent';

const TestPage = memo(({
  isSignedIn,
  user,
  selectedExam,
  handleExamChange,
  testType,
  handleTestTypeChange,
  selectedPart,
  handlePartChange,
  partData,
  currentQuestionIndex,
  setCurrentQuestionIndex,
  answers,
  handleAnswerSelect,
  showResults,
  handleSubmit,
  handleReset,
  score,
}) => (
  <PartTestContent
    isSignedIn={isSignedIn}
    user={user}
    selectedExam={selectedExam}
    handleExamChange={handleExamChange}
    testType={testType}
    handleTestTypeChange={handleTestTypeChange}
    selectedPart={selectedPart}
    handlePartChange={handlePartChange}
    partData={partData}
    currentQuestionIndex={currentQuestionIndex}
    setCurrentQuestionIndex={setCurrentQuestionIndex}
    answers={answers}
    handleAnswerSelect={handleAnswerSelect}
    showResults={showResults}
    handleSubmit={handleSubmit}
    handleReset={handleReset}
    score={score}
  />
));

TestPage.displayName = 'TestPage';

const ProfilePage = memo(({ user, handleBackToTest }) => (
  <div className="w-full">
    <div className="mb-6">
      <BackButton onClick={handleBackToTest} show={true} />
    </div>
    <MemoizedUserProfile currentUser={user} />
  </div>
));

ProfilePage.displayName = 'ProfilePage';

const FullExamPage = memo(({ handleTestTypeChange }) => {
  const [examData, setExamData] = useState(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const loadAllExams = async () => {
      setIsLoading(true);
      try {
        const examList = getAllExamMetadata();
        const loadPromises = examList.map(exam => loadExamData(exam.id));
        const loadedExams = await Promise.all(loadPromises);
        
        const data = {};
        examList.forEach((exam, index) => {
          data[exam.id] = loadedExams[index];
        });
        
        setExamData(data);
      } catch (error) {
        console.error('Error loading exam data:', error);
      } finally {
        setIsLoading(false);
      }
    };

    loadAllExams();
  }, []);

  if (isLoading || !examData) {
    return <LoadingSpinner />;
  }

  return (
    <Suspense fallback={<LoadingSpinner />}>
      <FullExamMode
        examData={examData}
        onComplete={() => handleTestTypeChange('')}
      />
    </Suspense>
  );
});

FullExamPage.displayName = 'FullExamPage';

const GrammarPage = memo(({ answers, handleAnswerSelect, handleSubmit }) => (
  <Suspense fallback={<LoadingSpinner />}>
    <GrammarReview
      answers={answers}
      onAnswerSelect={handleAnswerSelect}
      onSubmit={handleSubmit}
    />
  </Suspense>
));

GrammarPage.displayName = 'GrammarPage';

const VocabularyPage = memo(() => <VocabularyPractice />);

VocabularyPage.displayName = 'VocabularyPage';

const AnswersPage = memo(({ handleBackToMain }) => (
  <div className="w-full">
    {/* Back Button - Thm dng ny */}
    <div className="mb-6">
      <BackButton onClick={handleBackToMain} show={true} />
    </div>
    <ExamAnswersPage />
  </div>
));

AnswersPage.displayName = 'AnswersPage';

// --- MAIN APP CONTENT ---
const AppContent = memo(() => {
  const navigate = useNavigate();
  const [showAuthModal, setShowAuthModal] = useState(false);
  const [currentExamData, setCurrentExamData] = useState(null);

  const { onlineCount, totalUsers } = useOnlineUsers();

  const {
    selectedExam,
    testType,
    handleTestTypeChange,
    practiceType,
    handlePracticeTypeChange,
    selectedPart,
    currentQuestionIndex,
    setCurrentQuestionIndex,
    answers,
    handleAnswerSelect,
    handleSubmit,
    showResults,
    handleReset,
    handleExamChange,
    handlePartChange,
    isSignedIn,
    user,
  } = useAppState();

  useEffect(() => {
    const loadCurrentExam = async () => {
      if (!selectedExam) return;
      
      try {
        const data = await loadExamData(selectedExam);
        setCurrentExamData(data);
      } catch (error) {
        console.error('Error loading exam:', error);
        setCurrentExamData(null);
      }
    };

    loadCurrentExam();
  }, [selectedExam]);

  const handleAuthClose = useCallback(() => {
    setShowAuthModal(false);
  }, []);

  const handleAuthOpen = useCallback(() => {
    setShowAuthModal(true);
  }, []);

  const handleViewProfile = useCallback(() => {
    navigate(ROUTES.PROFILE);
  }, [navigate]);

  const handleBackToTest = useCallback(() => {
    navigate(ROUTES.TEST);
  }, [navigate]);

  const handleGoToAnswers = useCallback(() => {
    navigate(ROUTES.ANSWERS);
  }, [navigate]);

  const handleBackToMain = useCallback(() => {
    navigate(ROUTES.TEST);
  }, [navigate]);

  const partData = useMemo(() => {
    if (practiceType || !currentExamData) return null;
    return currentExamData.parts?.[selectedPart] || null;
  }, [practiceType, currentExamData, selectedPart]);

  const score = useMemo(() => {
    if (practiceType || !partData?.questions) {
      return { correct: 0, total: 0, percentage: 0 };
    }

    let correct = 0;
    const total = partData.questions.length;

    for (let i = 0; i < total; i++) {
      const q = partData.questions[i];
      if (answers[q.id] === q.correct) {
        correct++;
      }
    }

    return {
      correct,
      total,
      percentage: total > 0 ? (correct / total) * 100 : 0
    };
  }, [practiceType, partData, answers]);

  const layoutProps = useMemo(() => ({
    testType,
    onTestTypeChange: handleTestTypeChange,
    practiceType,
    onPracticeTypeChange: handlePracticeTypeChange,
    user,
    onAuthClick: handleAuthOpen,
    onProfileClick: handleViewProfile,
  }), [testType, handleTestTypeChange, practiceType, handlePracticeTypeChange, user, handleAuthOpen, handleViewProfile]);

  return (
    <MainLayout {...layoutProps}>
      {/* Content - No extra padding (already handled in MainLayout) */}
      <Suspense fallback={<LoadingSpinner />}>
        <Routes>
          <Route path={ROUTES.HOME} element={<HomePage />} />
          <Route 
            path={ROUTES.TEST} 
            element={
              <TestPage 
                isSignedIn={isSignedIn} 
                user={user} 
                selectedExam={selectedExam} 
                handleExamChange={handleExamChange} 
                testType={testType} 
                handleTestTypeChange={handleTestTypeChange} 
                selectedPart={selectedPart} 
                handlePartChange={handlePartChange} 
                partData={partData} 
                currentQuestionIndex={currentQuestionIndex} 
                setCurrentQuestionIndex={setCurrentQuestionIndex} 
                answers={answers} 
                handleAnswerSelect={handleAnswerSelect} 
                showResults={showResults} 
                handleSubmit={handleSubmit} 
                handleReset={handleReset} 
                score={score} 
              />
            } 
          />
          <Route path={ROUTES.FULL_EXAM} element={<FullExamPage handleTestTypeChange={handleTestTypeChange} />} />
          <Route path={ROUTES.GRAMMAR} element={<GrammarPage answers={answers} handleAnswerSelect={handleAnswerSelect} handleSubmit={handleSubmit} />} />
          <Route path={ROUTES.VOCABULARY} element={<VocabularyPage />} />
          <Route path={ROUTES.PROFILE} element={<ProfilePage user={user} handleBackToTest={handleBackToTest} />} />
          <Route path={ROUTES.ANSWERS} element={<AnswersPage handleBackToMain={handleBackToMain} />} />
          <Route path="*" element={<NotFoundPage />} />
        </Routes>
      </Suspense>
      {showAuthModal && <AuthModal onClose={handleAuthClose} />}
    </MainLayout>
  );
});

AppContent.displayName = 'AppContent';

// --- MAIN APP WITH SPLASH SCREEN ---
function App() {
  const showSplash = useSplashScreen(3000); // 3 giy splash screen

  if (showSplash) {
    return <LoadingSpinner message="Loading..." />;
  }

  return (
    <Router future={{ v7_startTransition: true, v7_relativeSplatPath: true }}>
      <Suspense fallback={<LoadingSpinner />}>
        <Routes>
          <Route path="/admin/*" element={<AdminApp />} />
          <Route path="/*" element={<AppContent />} />
          <Route path="*" element={<NotFoundPage />} />
        </Routes>
      </Suspense>
    </Router>
  );
}

export default App;
</file>

</files>
